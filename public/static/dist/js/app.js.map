{"version":3,"sources":["app.js"],"names":["pageId","$","attr","configName","config","setCookie","name","value","date","prefix","document","cookie","replace","pageInfo","cookiePrefix","encodeURI","toUTCString","getCookie","regex","RegExp","matches","match","decodeURI","getDate","Date","exec","flag","increment","parseInt","unit","setFullYear","setYear","getYear","setMonth","getMonth","setDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","setMilliseconds","getMilliseconds","readConfig","options","localStorage","JSON","parse","ex","type","isEmptyObject","writeConfig","stringify","handleMainMenu","click","css","documentElement","clientHeight","handleBackToTop","window","scroll","scrollTop","fadeIn","fadeOut","animate","handleSearchDialog","$searchDialog","on","focus","find","submit","$this","this","$searchKeyword","searchType","val","keyword","trim","rootPath","length","test","$method","Math","floor","getTime","setTimeout","fid","$current","change","data","prop","handleLogoutButton","confirm","handleThreadPageNav","e","preventDefault","num","prompt","maxPageNum","currentPageNum","urlParam","location","href","handleAtTipsBtn","time","cookieValue","currentDate","removeClass","addClass","highlightUnReadAtTipsMsg","gjc","userName","timeString","prevString","each","index","curString","text","handleIndexThreadPanel","tab","$target","target","panelName","typeName","indexOf"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\r\n// 页面ID\r\nvar pageId = $('body').attr('id');\r\nvar configName = 'kf_config';\r\nvar config = {};\r\n\r\n/**\r\n * 设置Cookie\r\n * @param {string} name Cookie名称\r\n * @param {*} value Cookie值\r\n * @param {?Date} [date] Cookie有效期，为空则表示有效期为浏览器进程关闭\r\n * @param {string} [prefix] Cookie名称前缀，留空则表示使用{@link pageInfo.cookiePrefix}前缀\r\n */\r\nvar setCookie = function (name, value, date, prefix) {\r\n    document.cookie = '{0}{1}={2}{3};path=/;'\r\n        .replace('{0}', typeof prefix === 'undefined' || prefix === null ? pageInfo.cookiePrefix : prefix)\r\n        .replace('{1}', name)\r\n        .replace('{2}', encodeURI(value))\r\n        .replace('{3}', !date ? '' : ';expires=' + date.toUTCString());\r\n};\r\n\r\n/**\r\n * 获取Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} [prefix] Cookie名称前缀，留空则表示使用{@link pageInfo.cookiePrefix}前缀\r\n * @returns {?string} Cookie值\r\n */\r\nvar getCookie = function (name, prefix) {\r\n    var regex = new RegExp('(^| ){0}{1}=([^;]*)(;|$)'\r\n        .replace('{0}', typeof prefix === 'undefined' || prefix === null ? pageInfo.cookiePrefix : prefix)\r\n        .replace('{1}', name)\r\n    );\r\n    var matches = document.cookie.match(regex);\r\n    if (!matches) return null;\r\n    else return decodeURI(matches[2]);\r\n};\r\n\r\n/**\r\n * 获取在当前时间的基础上的指定（相对）时间量的Date对象\r\n * @param {string} value 指定（相对）时间量，+或-：之后或之前（相对于当前时间）；无符号：绝对值；Y：完整年份；y：年；M：月；d：天；h：小时；m：分；s：秒；ms：毫秒\r\n * @returns {?Date} 指定（相对）时间量的Date对象\r\n * @example\r\n * Tools.getDate('+2y') 获取2年后的Date对象\r\n * Tools.getDate('+3M') 获取3个月后的Date对象\r\n * Tools.getDate('-4d') 获取4天前的Date对象\r\n * Tools.getDate('5h') 获取今天5点的Date对象（其它时间量与当前时间一致）\r\n * Tools.getDate('2015Y') 获取年份为2015年的Date对象\r\n */\r\nvar getDate = function (value) {\r\n    var date = new Date();\r\n    var matches = /^(-|\\+)?(\\d+)([a-zA-Z]{1,2})$/.exec(value);\r\n    if (!matches) return null;\r\n    var flag = typeof matches[1] === 'undefined' ? 0 : (matches[1] === '+' ? 1 : -1);\r\n    var increment = flag === -1 ? -parseInt(matches[2]) : parseInt(matches[2]);\r\n    var unit = matches[3];\r\n    switch (unit) {\r\n        case 'Y':\r\n            date.setFullYear(increment);\r\n            break;\r\n        case 'y':\r\n            date.setYear(flag === 0 ? increment : date.getYear() + increment);\r\n            break;\r\n        case 'M':\r\n            date.setMonth(flag === 0 ? increment : date.getMonth() + increment);\r\n            break;\r\n        case 'd':\r\n            date.setDate(flag === 0 ? increment : date.getDate() + increment);\r\n            break;\r\n        case 'h':\r\n            date.setHours(flag === 0 ? increment : date.getHours() + increment);\r\n            break;\r\n        case 'm':\r\n            date.setMinutes(flag === 0 ? increment : date.getMinutes() + increment);\r\n            break;\r\n        case 's':\r\n            date.setSeconds(flag === 0 ? increment : date.getSeconds() + increment);\r\n            break;\r\n        case 'ms':\r\n            date.setMilliseconds(flag === 0 ? increment : date.getMilliseconds() + increment);\r\n            break;\r\n        default:\r\n            return null;\r\n    }\r\n    return date;\r\n};\r\n\r\n/**\r\n * 读取设置\r\n */\r\nvar readConfig = function () {\r\n    var options = null;\r\n    options = localStorage['configName'];\r\n    if (!options) return;\r\n    try {\r\n        options = JSON.parse(options);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!options || $.type(options) !== 'object' || $.isEmptyObject(options)) return;\r\n    config = options;\r\n};\r\n\r\n/**\r\n * 写入设置\r\n */\r\nvar writeConfig = function () {\r\n    localStorage['configName'] = JSON.stringify(config);\r\n};\r\n\r\n/**\r\n * 处理主菜单\r\n */\r\nvar handleMainMenu = function () {\r\n    $('#mainMenuTogglerBtn').click(function () {\r\n        $('#mainMenu').css('max-height', document.documentElement.clientHeight - 50 + 'px');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理回到顶部按钮\r\n */\r\nvar handleBackToTop = function () {\r\n    $(window).scroll(function () {\r\n        if ($(window).scrollTop() > 100)\r\n            $(\"#backToTop\").fadeIn();\r\n        else\r\n            $(\"#backToTop\").fadeOut();\r\n    });\r\n\r\n    $(\"#backToTop\").click(function () {\r\n        $('body, html').animate({scrollTop: 0});\r\n    });\r\n};\r\n\r\n/**\r\n * 处理搜索对话框\r\n */\r\nvar handleSearchDialog = function () {\r\n    var $searchDialog = $('#searchDialog');\r\n\r\n    $searchDialog.on('shown.bs.modal', function () {\r\n        $('#searchKeyword').focus();\r\n    }).find('form').submit(function () {\r\n        var $this = $(this);\r\n        var $searchKeyword = $this.find('#searchKeyword');\r\n        var searchType = $this.find('#searchType').val();\r\n        var keyword = $.trim($searchKeyword.val());\r\n        if (searchType === 'gjc') {\r\n            $this.attr('action', pageInfo.rootPath + 'gjc/' + keyword);\r\n        }\r\n        else if (searchType === 'username') {\r\n            $this.attr('action', pageInfo.rootPath + 'user/username/' + keyword);\r\n        }\r\n        else {\r\n            $this.attr('action', pageInfo.rootPath + 'search');\r\n            $searchKeyword.attr('name', searchType === 'author' ? 'pwuser' : 'keyword');\r\n            if (searchType === 'title') {\r\n                if (keyword.length === 1 || (keyword.length === 2 && /^[\\w\\-]+$/.test(keyword))) {\r\n                    var $method = $this.find('input[name=\"method\"]');\r\n                    $method.val('OR');\r\n                    $searchKeyword.val(keyword + ' ' + Math.floor(new Date().getTime() / 1000));\r\n                    window.setTimeout(function () {\r\n                        $searchKeyword.val(keyword);\r\n                        $method.val('AND');\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    $searchDialog.find('input[name=\"searchRange\"]').on('click', function () {\r\n        var value = 'all';\r\n        if ($(this).val() === 'current') value = pageInfo.fid;\r\n        $searchDialog.find('input[name=\"f_fid\"]').val(value);\r\n    });\r\n\r\n    var $current = $searchDialog.find('input[name=\"searchRange\"][value=\"current\"]');\r\n    $searchDialog.find('#searchType').change(function () {\r\n        var searchType = $(this).val();\r\n        if (!$current.data('enabled')) return;\r\n        $current.prop('disabled', searchType === 'gjc' || searchType === 'username');\r\n    });\r\n\r\n    if (pageId === 'threadPage' || pageId === 'readPage') {\r\n        $current.prop('disabled', false).data('enabled', true).click();\r\n    }\r\n};\r\n\r\n/**\r\n * 处理登出按钮\r\n */\r\nvar handleLogoutButton = function () {\r\n    $(document).on('click', '#dropdownItemLogout', function () {\r\n        if (!window.confirm('是否登出账号？')) return false;\r\n    });\r\n};\r\n\r\n/**\r\n * 处理版块页面下的分页导航\r\n */\r\nvar handleThreadPageNav = function () {\r\n    $(document).on('click', '.page-item.active > .page-link', function (e) {\r\n        e.preventDefault();\r\n        var num = parseInt(window.prompt('要跳转到第几页？（共' + pageInfo.maxPageNum + '页）', pageInfo.currentPageNum));\r\n        if (num) {\r\n            var urlParam = pageInfo.urlParam.replace(/&?page=\\d*/i, '') + '&page=' + num;\r\n            location.href = pageInfo.rootPath + 'thread?' + urlParam;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页的@提醒按钮\r\n */\r\nvar handleAtTipsBtn = function () {\r\n    $('#atTips').click(function () {\r\n        var $this = $(this);\r\n        var time = $this.data('time');\r\n        var cookieValue = getCookie('at_tips_time');\r\n        if (!time || time === cookieValue) return;\r\n        if (!cookieValue) {\r\n            var currentDate = (new Date()).getDate();\r\n            setCookie('prev_at_tips_time', (currentDate < 10 ? '0' + currentDate : currentDate) + '日00时00分');\r\n        }\r\n        else if (cookieValue !== time) {\r\n            setCookie('prev_at_tips_time', cookieValue);\r\n        }\r\n        setCookie('at_tips_time', time, getDate('+3d'));\r\n        $this.removeClass('btn-outline-danger').addClass('btn-outline-primary');\r\n    });\r\n};\r\n\r\n/**\r\n * 高亮关键词页面中未读的消息\r\n */\r\nvar highlightUnReadAtTipsMsg = function () {\r\n    if (pageInfo.gjc !== pageInfo.userName) return;\r\n    var timeString = getCookie('prev_at_tips_time');\r\n    if (!timeString || !/^\\d+日\\d+时\\d+分$/.test(timeString)) return;\r\n    var prevString = '';\r\n    $('.thread-list-item time').each(function (index) {\r\n        var $this = $(this);\r\n        var curString = $.trim($this.text());\r\n        if (index === 0) prevString = curString;\r\n        if (timeString < curString && prevString >= curString) {\r\n            $this.addClass('text-danger');\r\n            prevString = curString;\r\n        }\r\n        else return false;\r\n    });\r\n\r\n    $(document).on('click', '.thread-list-item .thread-link-item a', function () {\r\n        setCookie('prev_at_tips_time', '', getDate('-1d'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页主题链接面板\r\n */\r\nvar handleIndexThreadPanel = function () {\r\n    if (config['activeNewReplyPanel']) {\r\n        $('a[data-toggle=\"tab\"][href=\"{0}\"]'.replace('{0}', config['activeNewReplyPanel'])).tab('show');\r\n    }\r\n    if (config['activeTopRecommendPanel']) {\r\n        $('a[data-toggle=\"tab\"][href=\"{0}\"]'.replace('{0}', config['activeTopRecommendPanel'])).tab('show');\r\n    }\r\n\r\n    $(document).on('shown.bs.tab', 'a[data-toggle=\"tab\"]', function (e) {\r\n        var $target = $(e.target);\r\n        readConfig();\r\n        var panelName = $target.attr('href');\r\n        var typeName = 'activeNewReplyPanel';\r\n        if (panelName.indexOf('TopRecommendPanel') > 0) typeName = 'activeTopRecommendPanel';\r\n        config[typeName] = $target.attr('href');\r\n        writeConfig();\r\n    });\r\n};\r\n\r\n$(function () {\r\n    if (pageId === 'loginPage') return;\r\n    readConfig();\r\n\r\n    handleMainMenu();\r\n    handleBackToTop();\r\n    handleSearchDialog();\r\n    handleLogoutButton();\r\n    if (pageId === 'indexPage') {\r\n        handleAtTipsBtn();\r\n        handleIndexThreadPanel();\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        handleThreadPageNav();\r\n    } else if (pageId === 'gjcPage') {\r\n        highlightUnReadAtTipsMsg();\r\n    }\r\n\r\n    //$('[data-toggle=\"tooltip\"]').tooltip();\r\n});\r\n"],"sourceRoot":"/source/"}
{"version":3,"sources":["app.js"],"names":["pageId","$","attr","configName","Config","Const","multiQuoteStorageName","atTipsTimeCookieName","prevAtTipsTimeCookieName","bgStyleCookieName","setCookie","name","value","date","prefix","document","cookie","replace","pageInfo","cookiePrefix","encodeURI","toUTCString","getCookie","regex","RegExp","matches","match","decodeURI","getDate","Date","exec","flag","increment","parseInt","unit","setFullYear","getFullYear","setMonth","getMonth","setDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","setMilliseconds","getMilliseconds","getStrLen","str","len","s_len","indexOf","length","c_len","i","charCodeAt","getHostNameUrl","location","protocol","host","addCode","textArea","code","selText","startPos","selectionStart","prePos","substr","selectionEnd","getSelText","extractQueryStr","param","each","split","arr","buildQueryStr","obj","queryStr","key","makeUrl","action","includeOtherParam","url","paramList","extend","urlParam","hasEntryFile","pathname","baseFile","rootPath","isEmptyObject","urlType","decodeHtmlSpecialChar","selectAll","$nodes","prop","selectReverse","$this","this","bindFastSubmitKeydown","$node","keydown","e","keyCode","ctrlKey","closest","submit","showValidationMsg","type","msg","removeClass","$parent","parent","inArray","addClass","$feedback","find","html","text","readConfig","options","localStorage","JSON","parse","ex","writeConfig","stringify","handleMainMenu","click","css","documentElement","clientHeight","handleRollToTopOrBottomBtn","window","scroll","$btn","scrollTop","data","height","animate","handleSearchDialog","$searchDialog","on","select","focus","$searchKeyword","searchType","val","keyword","trim","$method","Math","floor","getTime","setTimeout","fid","$current","change","handleAtTipsBtn","time","cookieValue","currentDate","highlightUnReadAtTipsMsg","gjc","userName","timeString","test","prevString","index","curString","handleIndexThreadPanel","activeNewReplyPanel","tab","activeTopRecommendPanel","$target","target","panelName","typeName","handleSelectBgImage","id","fileName","path","confirm","alert","handleCustomBgStyle","prompt","reload","toLowerCase","handlePageNav","preventDefault","maxPageNum","num","currentPageNum","href","showFloorLink","handleFastReplyBtn","$article","postContent","get","handleBlockFloorBtn","handleBuyThreadBtn","pid","price","tid","verify","copyBuyThreadList","list","map","join","selectedIndex","modal","handleFloorImage","is","naturalWidth","width","addSmileCode","blur","$relatedTarget","relatedTarget","removeData","fastGotoFloor","perPageFloorNum","floorNum","hashName","prev","hash","tuiThread","ajax","safeId","success","$num","error","complete","copyCode","next","remove","after","$pre","insertAfter","getCheckedMultiQuoteData","quoteList","push","bindMultiQuoteCheckClick","removeItem","handleMultiQuote","j","keywords","content","quote","handleClearMultiQuoteDataBtn","handleGameIntroSearchArea","tuiGameIntro","cookieName","dataType","randomSelectSmBox","$boxes","number","random","off","eq","bindFavorPageBtnsClick","$form","$checked","bindFriendPageBtnsClick","assignBirthdayField","year","month","day","syncPerPageFloorNum","syncConfig","isNaN","handleUploadAvatarFileBtn","transferKfbAlert","transferKfb","fixedDeposit","currentDeposit","bindMessageActionBtnsClick","title","handleEditorBtns","size","codeType","color","checkPostForm","$postType","$postTitle","$voteItemContent","$postContent","$postGjc","handleAttachBtns","$area","$newAttachArea","totalNum","$lastAttachArea","tooltip","container","validateRegisterField","post","username","fail","trigger"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\r\n// 页面ID\r\nvar pageId = $('body').attr('id');\r\n// 配置名称\r\nvar configName = 'kf_config';\r\n/**\r\n * 配置类\r\n */\r\nvar Config = {};\r\n/**\r\n * 配置常量类\r\n */\r\nvar Const = {\r\n    // 存储多重引用数据的LocalStorage名称\r\n    multiQuoteStorageName: 'kf_multi_quote',\r\n    // at提醒时间的Cookie名称\r\n    atTipsTimeCookieName: 'at_tips_time',\r\n    // 上一次at提醒时间的Cookie名称\r\n    prevAtTipsTimeCookieName: 'prev_at_tips_time',\r\n    // 背景样式的Cookie名称\r\n    bgStyleCookieName: 'bg_style'\r\n};\r\n\r\n/**\r\n * 设置Cookie\r\n * @param {string} name Cookie名称\r\n * @param {*} value Cookie值\r\n * @param {?Date} [date] Cookie有效期，为空则表示有效期为浏览器进程关闭\r\n * @param {string} [prefix] Cookie名称前缀，留空则表示使用{@link pageInfo.cookiePrefix}前缀\r\n */\r\nvar setCookie = function (name, value, date, prefix) {\r\n    document.cookie =\r\n        '{0}{1}={2}{3};path=/;'\r\n            .replace('{0}', typeof prefix === 'undefined' || prefix === null ? pageInfo.cookiePrefix : prefix)\r\n            .replace('{1}', name)\r\n            .replace('{2}', encodeURI(value))\r\n            .replace('{3}', !date ? '' : ';expires=' + date.toUTCString());\r\n};\r\n\r\n/**\r\n * 获取Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} [prefix] Cookie名称前缀，留空则表示使用{@link pageInfo.cookiePrefix}前缀\r\n * @returns {?string} Cookie值\r\n */\r\nvar getCookie = function (name, prefix) {\r\n    var regex = new RegExp(\r\n        '(^| ){0}{1}=([^;]*)(;|$)'\r\n            .replace('{0}', typeof prefix === 'undefined' || prefix === null ? pageInfo.cookiePrefix : prefix)\r\n            .replace('{1}', name)\r\n    );\r\n    var matches = document.cookie.match(regex);\r\n    if (!matches) return null;\r\n    else return decodeURI(matches[2]);\r\n};\r\n\r\n/**\r\n * 获取在当前时间的基础上的指定（相对）时间量的Date对象\r\n * @param {string} value 指定（相对）时间量，+或-：之后或之前（相对于当前时间）；无符号：绝对值；Y：完整年份；y：年；M：月；d：天；h：小时；m：分；s：秒；ms：毫秒\r\n * @returns {?Date} 指定（相对）时间量的Date对象\r\n * @example\r\n * Tools.getDate('+2y') 获取2年后的Date对象\r\n * Tools.getDate('+3M') 获取3个月后的Date对象\r\n * Tools.getDate('-4d') 获取4天前的Date对象\r\n * Tools.getDate('5h') 获取今天5点的Date对象（其它时间量与当前时间一致）\r\n * Tools.getDate('2015Y') 获取年份为2015年的Date对象\r\n */\r\nvar getDate = function (value) {\r\n    var date = new Date();\r\n    var matches = /^(-|\\+)?(\\d+)([a-zA-Z]{1,2})$/.exec(value);\r\n    if (!matches) return null;\r\n    var flag = typeof matches[1] === 'undefined' ? 0 : (matches[1] === '+' ? 1 : -1);\r\n    var increment = flag === -1 ? -parseInt(matches[2]) : parseInt(matches[2]);\r\n    var unit = matches[3];\r\n    switch (unit) {\r\n        case 'Y':\r\n            date.setFullYear(increment);\r\n            break;\r\n        case 'y':\r\n            date.setFullYear(flag === 0 ? increment : date.getFullYear() + increment);\r\n            break;\r\n        case 'M':\r\n            date.setMonth(flag === 0 ? increment : date.getMonth() + increment);\r\n            break;\r\n        case 'd':\r\n            date.setDate(flag === 0 ? increment : date.getDate() + increment);\r\n            break;\r\n        case 'h':\r\n            date.setHours(flag === 0 ? increment : date.getHours() + increment);\r\n            break;\r\n        case 'm':\r\n            date.setMinutes(flag === 0 ? increment : date.getMinutes() + increment);\r\n            break;\r\n        case 's':\r\n            date.setSeconds(flag === 0 ? increment : date.getSeconds() + increment);\r\n            break;\r\n        case 'ms':\r\n            date.setMilliseconds(flag === 0 ? increment : date.getMilliseconds() + increment);\r\n            break;\r\n        default:\r\n            return null;\r\n    }\r\n    return date;\r\n};\r\n\r\n/**\r\n * 获取指定字符串的字节长度（1个GBK字符按2个字节来算）\r\n * @param {string} str 指定字符串\r\n * @returns {number} 字符串的长度\r\n */\r\nvar getStrLen = function (str) {\r\n    var len = 0;\r\n    var s_len = str.indexOf('\\n') !== -1 ? str.replace(/\\r?\\n/g, '_').length : str.length;\r\n    var c_len = 2;\r\n    for (var i = 0; i < s_len; i++) {\r\n        len += str.charCodeAt(i) < 0 || str.charCodeAt(i) > 255 ? c_len : 1;\r\n    }\r\n    return len;\r\n};\r\n\r\n/**\r\n * 获取当前域名的URL\r\n * @returns {string} 当前域名的URL\r\n */\r\nvar getHostNameUrl = function () {\r\n    return location.protocol + '//' + location.host;\r\n};\r\n\r\n/**\r\n * 添加BBCode\r\n * @param textArea 文本框\r\n * @param {string} code BBCode\r\n * @param {string} selText 选择文本\r\n */\r\nvar addCode = function (textArea, code, selText) {\r\n    var startPos = selText === '' ? code.indexOf(']') + 1 : code.indexOf(selText);\r\n    if (typeof textArea.selectionStart !== 'undefined') {\r\n        var prePos = textArea.selectionStart;\r\n        textArea.value = textArea.value.substr(0, prePos) + code + textArea.value.substr(textArea.selectionEnd);\r\n        textArea.selectionStart = prePos + startPos;\r\n        textArea.selectionEnd = prePos + startPos + selText.length;\r\n    }\r\n    else {\r\n        textArea.value += code;\r\n    }\r\n};\r\n\r\n/**\r\n * 获取选择文本\r\n * @param textArea 文本框\r\n * @returns {string} 选择文本\r\n */\r\nvar getSelText = function (textArea) {\r\n    return textArea.value.substr(textArea.selectionStart, textArea.selectionEnd - textArea.selectionStart);\r\n};\r\n\r\n/**\r\n * 从URL查询字符串提取参数对象\r\n * @param {string} str URL查询字符串\r\n * @returns {{}} 参数对象\r\n */\r\nvar extractQueryStr = function (str) {\r\n    var param = {};\r\n    $.each(str.split('&'), function (i, value) {\r\n        if (!value) return;\r\n        var arr = value.split('=');\r\n        param[arr[0]] = typeof arr[1] !== 'undefined' ? arr[1] : '';\r\n    });\r\n    return param;\r\n};\r\n\r\n/**\r\n * 从参数对象中创建URL查询字符串\r\n * @param {{}} obj 参数对象\r\n * @returns {string} URL查询字符串\r\n */\r\nvar buildQueryStr = function (obj) {\r\n    var queryStr = '';\r\n    $.each(obj, function (key, value) {\r\n        queryStr += '/' + key + '/' + value;\r\n    });\r\n    return queryStr;\r\n};\r\n\r\n/**\r\n * 生成指定的URL\r\n * @param {string} action 控制器（小写）\r\n * @param {string} [param=''] 查询参数\r\n * @param {boolean} [includeOtherParam=false] 是否包括当前页面的其它查询参数\r\n * @returns {string} URL 最终的URL\r\n */\r\nvar makeUrl = function (action, param, includeOtherParam) {\r\n    var url = '';\r\n    var paramList = extractQueryStr(param ? param : '');\r\n    if (includeOtherParam) {\r\n        paramList = $.extend(extractQueryStr(pageInfo.urlParam), paramList);\r\n    }\r\n    var hasEntryFile = location.pathname.indexOf(pageInfo.baseFile) === 0;\r\n    if (hasEntryFile) url = pageInfo.baseFile;\r\n    else url = pageInfo.rootPath.substr(0, pageInfo.rootPath.length - 1);\r\n    var queryStr = '';\r\n    if (!$.isEmptyObject(paramList)) queryStr = buildQueryStr(paramList);\r\n    if (pageInfo.urlType === 2) url += '?s=' + '/' + action + queryStr;\r\n    else url += '/' + action + queryStr;\r\n    return url;\r\n};\r\n\r\n/**\r\n * 解码HTML特殊字符\r\n * @param {string} str 待解码的字符串\r\n * @returns {string} 解码后的字符串\r\n */\r\nvar decodeHtmlSpecialChar = function (str) {\r\n    if (str.length === 0) return '';\r\n    return str.replace(/<br\\s*\\/?>/gi, '\\n')\r\n        .replace(/&quot;/gi, '\\\"')\r\n        .replace(/&#39;/gi, '\\'')\r\n        .replace(/&nbsp;/gi, ' ')\r\n        .replace(/&gt;/gi, '>')\r\n        .replace(/&lt;/gi, '<')\r\n        .replace(/&amp;/gi, '&');\r\n};\r\n\r\n/**\r\n * 全选\r\n * @param {jQuery} $nodes 想要全选的节点的jQuery对象\r\n */\r\nvar selectAll = function ($nodes) {\r\n    $nodes.prop('checked', true);\r\n};\r\n\r\n/**\r\n * 反选\r\n * @param {jQuery} $nodes 想要反选的节点的jQuery对象\r\n */\r\nvar selectReverse = function ($nodes) {\r\n    $nodes.each(function () {\r\n        var $this = $(this);\r\n        $this.prop('checked', !$this.prop('checked'));\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定快速提交的按键事件\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nvar bindFastSubmitKeydown = function ($node) {\r\n    $node.keydown(function (e) {\r\n        if (e.keyCode === 13 && e.ctrlKey) {\r\n            $(this).closest('form').submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示字段验证消息\r\n * @param {jQuery} $node 验证字段的jQuery对象\r\n * @param {string} type 验证类型\r\n * @param {string} [msg] 验证消息\r\n */\r\nvar showValidationMsg = function ($node, type, msg) {\r\n    if (type === 'error') type = 'danger';\r\n    $node.removeClass('form-control-success form-control-warning form-control-danger');\r\n    var $parent = $node.parent();\r\n    $parent.removeClass('has-success has-warning has-danger');\r\n    if ($.inArray(type, ['success', 'warning', 'danger'] > -1)) {\r\n        $node.addClass('form-control-' + type).parent().addClass('has-' + type);\r\n    }\r\n    var $feedback = $parent.find('.form-control-feedback');\r\n    if (type === 'wait') {\r\n        $feedback.html('<span class=\"text-muted\"><i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i> ' + msg + '</span>');\r\n    }\r\n    else {\r\n        $feedback.text(msg ? msg : '');\r\n    }\r\n};\r\n\r\n/**\r\n * 读取设置\r\n */\r\nvar readConfig = function () {\r\n    var options = localStorage['configName'];\r\n    if (!options) return;\r\n    try {\r\n        options = JSON.parse(options);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!options || $.type(options) !== 'object' || $.isEmptyObject(options)) return;\r\n    Config = options;\r\n};\r\n\r\n/**\r\n * 写入设置\r\n */\r\nvar writeConfig = function () {\r\n    localStorage['configName'] = JSON.stringify(Config);\r\n};\r\n\r\n/**\r\n * 处理主菜单\r\n */\r\nvar handleMainMenu = function () {\r\n    $('#mainMenuTogglerBtn').click(function () {\r\n        $('#mainMenu').css('max-height', document.documentElement.clientHeight - 49 + 'px');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理滚动到页顶/页底按钮\r\n */\r\nvar handleRollToTopOrBottomBtn = function () {\r\n    $(window).scroll(function () {\r\n        var $btn = $('#rollToTopOrBottom');\r\n        if ($(window).scrollTop() > 640) {\r\n            if ($btn.data('direction') === 'top') return;\r\n            $btn.data('direction', 'top').attr('aria-label', '滚动到页顶')\r\n                .find('i').removeClass('fa-chevron-down').addClass('fa-chevron-up');\r\n        }\r\n        else {\r\n            if ($btn.data('direction') === 'bottom') return;\r\n            $btn.data('direction', 'bottom').attr('aria-label', '滚动到页底')\r\n                .find('i').removeClass('fa-chevron-up').addClass('fa-chevron-down');\r\n        }\r\n    });\r\n\r\n    $(\"#rollToTopOrBottom\").click(function () {\r\n        var scrollTop = $(this).data('direction') === 'bottom' ? $('body').height() : 0;\r\n        $('body, html').animate({scrollTop: scrollTop});\r\n    });\r\n};\r\n\r\n/**\r\n * 处理搜索对话框\r\n */\r\nvar handleSearchDialog = function () {\r\n    var $searchDialog = $('#searchDialog');\r\n\r\n    $searchDialog.on('shown.bs.modal', function () {\r\n        $('#searchKeyword').select().focus();\r\n    }).find('form').submit(function () {\r\n        var $this = $(this);\r\n        var $searchKeyword = $this.find('#searchKeyword');\r\n        var searchType = $this.find('#searchType').val();\r\n        var keyword = $.trim($searchKeyword.val());\r\n        if (searchType === 'gjc') {\r\n            $this.attr('action', makeUrl('gjc/' + keyword));\r\n        }\r\n        else if (searchType === 'username') {\r\n            $this.attr('action', makeUrl('user/username/' + keyword));\r\n        }\r\n        else {\r\n            $this.attr('action', makeUrl('search'));\r\n            $searchKeyword.attr('name', searchType === 'author' ? 'pwuser' : 'keyword');\r\n            if (searchType === 'title') {\r\n                if (keyword.length && getStrLen(keyword) <= 2) {\r\n                    var $method = $this.find('input[name=\"method\"]');\r\n                    $method.val('OR');\r\n                    $searchKeyword.val(keyword + ' ' + Math.floor(new Date().getTime() / 1000));\r\n                    window.setTimeout(function () {\r\n                        $searchKeyword.val(keyword);\r\n                        $method.val('AND');\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    $searchDialog.find('input[name=\"searchRange\"]').on('click', function () {\r\n        var value = 'all';\r\n        if ($(this).val() === 'current') value = pageInfo.fid;\r\n        $searchDialog.find('input[name=\"f_fid\"]').val(value);\r\n    });\r\n\r\n    var $current = $searchDialog.find('input[name=\"searchRange\"][value=\"current\"]');\r\n    $searchDialog.find('#searchType').change(function () {\r\n        var searchType = $(this).val();\r\n        if (!$current.data('enabled')) return;\r\n        $current.prop('disabled', searchType === 'gjc' || searchType === 'username');\r\n    });\r\n\r\n    if (pageId === 'threadPage' || pageId === 'readPage') {\r\n        $current.prop('disabled', false).data('enabled', true).click();\r\n    }\r\n};\r\n\r\n/**\r\n * 处理首页的@提醒按钮\r\n */\r\nvar handleAtTipsBtn = function () {\r\n    $('#atTips').click(function () {\r\n        var $this = $(this);\r\n        var time = $this.data('time');\r\n        var cookieValue = getCookie(Const.atTipsTimeCookieName);\r\n        if (!time || time === cookieValue) return;\r\n        if (!cookieValue) {\r\n            var currentDate = (new Date()).getDate();\r\n            setCookie(Const.prevAtTipsTimeCookieName, (currentDate < 10 ? '0' + currentDate : currentDate) + '日00时00分');\r\n        }\r\n        else if (cookieValue !== time) {\r\n            setCookie(Const.prevAtTipsTimeCookieName, cookieValue);\r\n        }\r\n        setCookie(Const.atTipsTimeCookieName, time, getDate('+3d'));\r\n        $this.removeClass('btn-outline-danger').addClass('btn-outline-primary');\r\n    });\r\n};\r\n\r\n/**\r\n * 高亮关键词页面中未读的消息\r\n */\r\nvar highlightUnReadAtTipsMsg = function () {\r\n    if (pageInfo.gjc !== pageInfo.userName) return;\r\n    var timeString = getCookie(Const.prevAtTipsTimeCookieName);\r\n    if (!timeString || !/^\\d+日\\d+时\\d+分$/.test(timeString)) return;\r\n    var prevString = '';\r\n    $('.thread-list-item time').each(function (index) {\r\n        var $this = $(this);\r\n        var curString = $.trim($this.text());\r\n        if (index === 0) prevString = curString;\r\n        if (timeString < curString && prevString >= curString) {\r\n            $this.addClass('text-danger');\r\n            prevString = curString;\r\n        }\r\n        else return false;\r\n    });\r\n\r\n    $(document).on('click', '.thread-list-item .thread-link-item a', function () {\r\n        setCookie(Const.prevAtTipsTimeCookieName, '', getDate('-1d'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页主题链接面板\r\n */\r\nvar handleIndexThreadPanel = function () {\r\n    if (Config['activeNewReplyPanel']) {\r\n        $('a[data-toggle=\"tab\"][href=\"{0}\"]'.replace('{0}', Config.activeNewReplyPanel)).tab('show');\r\n    }\r\n    if (Config['activeTopRecommendPanel']) {\r\n        $('a[data-toggle=\"tab\"][href=\"{0}\"]'.replace('{0}', Config.activeTopRecommendPanel)).tab('show');\r\n    }\r\n\r\n    $(document).on('shown.bs.tab', 'a[data-toggle=\"tab\"]', function (e) {\r\n        var $target = $(e.target);\r\n        readConfig();\r\n        var panelName = $target.attr('href');\r\n        var typeName = '';\r\n        if (panelName.indexOf('NewReplyPanel') > 0) typeName = 'activeNewReplyPanel';\r\n        else if (panelName.indexOf('TopRecommendPanel') > 0) typeName = 'activeTopRecommendPanel';\r\n        if (typeName) {\r\n            Config[typeName] = $target.attr('href');\r\n            writeConfig();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理选择页面背景图片\r\n */\r\nvar handleSelectBgImage = function () {\r\n    $('#selectBgImage').on('click', 'img', function () {\r\n        var $this = $(this);\r\n        var id = $this.data('id');\r\n        var fileName = $this.data('filename');\r\n        var path = $this.parent().data('path');\r\n        if (!id || !fileName || !path) return;\r\n        if (window.confirm('是否选择此背景图片？')) {\r\n            setCookie(Const.bgStyleCookieName, id, getDate('+1y'));\r\n            $('body, .modal-content').css('background', 'url(\"' + path + fileName + '\")');\r\n            alert('背景已更换');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理自定义背景样式\r\n */\r\nvar handleCustomBgStyle = function () {\r\n    $('#customBgStyle').click(function () {\r\n        var value = getCookie(Const.bgStyleCookieName);\r\n        if (!value || parseInt(value)) value = '';\r\n        value = window.prompt(\r\n            '请输入背景图片URL或颜色代码：\\n（例：http://xxx.com/abc.jpg 或 #fcfcfc，留空表示恢复默认背景）\\n' +\r\n            '（注：建议选择简洁、不花哨、偏浅色系的背景图片或颜色）',\r\n            value\r\n        );\r\n        if (value === null) return;\r\n        if (value === '') {\r\n            setCookie(Const.bgStyleCookieName, '', getDate('-1d'));\r\n            alert('背景已恢复默认');\r\n            location.reload();\r\n            return;\r\n        }\r\n        else if (/^https?:\\/\\/[^\"\\']+/.test(value)) {\r\n            value = 'url(\"' + value + '\")';\r\n        }\r\n        else if (/^#[0-9a-f]{6}$/i.test(value)) {\r\n            value = value.toLowerCase();\r\n        }\r\n        else {\r\n            alert('格式不正确');\r\n            return;\r\n        }\r\n        setCookie(Const.bgStyleCookieName, value, getDate('+1y'));\r\n        $('body, .modal-content').css('background', value);\r\n        alert('背景已更换');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理分页导航\r\n * @param {string} action 控制器\r\n */\r\nvar handlePageNav = function (action) {\r\n    $(document).on('click', '.page-item.active > .page-link', function (e) {\r\n        e.preventDefault();\r\n        if (pageInfo.maxPageNum && pageInfo.maxPageNum <= 1) return;\r\n        var num = parseInt(\r\n            window.prompt('要跳转到第几页？' + (pageInfo.maxPageNum ? '（共' + pageInfo.maxPageNum + '页）' : ''), pageInfo.currentPageNum)\r\n        );\r\n        if (num && num > 0) {\r\n            location.href = makeUrl(action, 'page=' + num, true);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示楼层跳转链接\r\n */\r\nvar showFloorLink = function () {\r\n    $(document).on('click', '.floor-num', function (e) {\r\n        e.preventDefault();\r\n        window.prompt('本楼的跳转链接：', getHostNameUrl() + $(this).attr('href'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理快速回复按钮\r\n */\r\nvar handleFastReplyBtn = function () {\r\n    $(document).on('click', '.fast-reply-btn', function (e) {\r\n        e.preventDefault();\r\n        var $article = $(this).closest('article');\r\n        var floor = $article.data('floor');\r\n        var userName = $article.data('username');\r\n        $('#postGjc').val(userName);\r\n        var postContent = $('#postContent').get(0);\r\n        postContent.value = '[quote]回 {0}楼({1}) 的帖子[/quote]\\n'.replace('{0}', floor).replace('{1}', userName);\r\n        postContent.selectionStart = postContent.value.length;\r\n        postContent.selectionEnd = postContent.value.length;\r\n        postContent.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理屏蔽回帖按钮\r\n */\r\nvar handleBlockFloorBtn = function () {\r\n    $(document).on('click', '.block-floor', function () {\r\n        if (!window.confirm('确认要屏蔽该回帖？本操作不可恢复！（屏蔽后该回帖将对大家不可见）')) return false;\r\n    });\r\n};\r\n\r\n/**\r\n * 处理购买帖子按钮\r\n */\r\nvar handleBuyThreadBtn = function () {\r\n    $(document).on('click', '.buy-thread-btn', function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        var pid = $this.data('pid');\r\n        var price = $this.data('price');\r\n        if (price > 5 && !window.confirm('此贴售价{0}KFB，是否购买？'.replace('{0}', price))) return;\r\n        location.href = makeUrl(\r\n            'job/buytopic',\r\n            'tid={0}&pid={1}&verify={2}'\r\n                .replace('{0}', pageInfo.tid)\r\n                .replace('{1}', pid)\r\n                .replace('{2}', pageInfo.verify)\r\n        );\r\n    });\r\n};\r\n\r\n/**\r\n * 复制购买人名单\r\n */\r\nvar copyBuyThreadList = function () {\r\n    $(document).on('change', '.buy-thread-list', function () {\r\n        var $this = $(this);\r\n        if ($this.val() !== 'copyList') return;\r\n        var list = $this.find('option').map(function (index) {\r\n            var name = $(this).text();\r\n            if (index === 0 || index === 1 || name === '-----------') return null;\r\n            else return name;\r\n        }).get().join('\\n');\r\n        if (!list) {\r\n            alert('暂时无人购买');\r\n            $this.get(0).selectedIndex = 0;\r\n            return;\r\n        }\r\n        $('#buyThreadListContent').val(list);\r\n        $('#buyThreadListDialog').modal('show');\r\n        $this.get(0).selectedIndex = 0;\r\n    });\r\n\r\n    $('#buyThreadListDialog').on('shown.bs.modal', function () {\r\n        $('#buyThreadListContent').select().focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理楼层内的图片\r\n */\r\nvar handleFloorImage = function () {\r\n    $(document).on('click', '.img', function () {\r\n        var $this = $(this);\r\n        if ($this.parent().is('a') || this.naturalWidth <= $this.closest('.read-content').width()) return;\r\n        location.href = $this.attr('src');\r\n    });\r\n};\r\n\r\n/**\r\n * 插入表情代码\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nvar addSmileCode = function ($node) {\r\n    $('.smile-panel').on('click', 'img', function () {\r\n        $('.smile-panel').addClass('open');\r\n        var textArea = $node.get(0);\r\n        if (!textArea) return;\r\n        var code = '[s:' + $(this).data('id') + ']';\r\n        addCode(textArea, code, '');\r\n        textArea.blur();\r\n    }).parent().on('shown.bs.dropdown', function () {\r\n        $('.smile-panel img').each(function () {\r\n            var $this = $(this);\r\n            if (!$this.attr('src')) {\r\n                $this.attr('src', $this.data('src'));\r\n            }\r\n        });\r\n    }).on('hide.bs.dropdown', function (e) {\r\n        var $relatedTarget = $(e.relatedTarget);\r\n        if (!$relatedTarget.data('open')) $relatedTarget.removeData('open');\r\n        else return e.preventDefault();\r\n    });\r\n\r\n    $('#smileDropdownBtn').click(function () {\r\n        var $this = $(this);\r\n        $this.data('open', !$this.data('open'));\r\n    });\r\n};\r\n\r\n/**\r\n * 快速跳转到指定楼层\r\n */\r\nvar fastGotoFloor = function () {\r\n    $('.fast-goto-floor').click(function (e) {\r\n        e.preventDefault();\r\n        if (!Config.perPageFloorNum) {\r\n            var floorNum = parseInt(\r\n                window.prompt('你的论坛设置里“文章列表每页个数”为多少（10、20、30）？\\n注：如修改了论坛中的此项设置，请访问账号设置页面即可自动同步本地设置', 10)\r\n            );\r\n            if (floorNum && $.inArray(floorNum, [10, 20, 30]) !== -1) {\r\n                Config.perPageFloorNum = floorNum;\r\n                writeConfig();\r\n            }\r\n            else return;\r\n        }\r\n        var floor = parseInt(window.prompt('你要跳转到哪一层楼？'));\r\n        if (!floor || floor <= 0) return;\r\n        location.href = makeUrl(\r\n            'read/index',\r\n            'tid={0}&page={1}&floor={2}'\r\n                .replace('{0}', pageInfo.tid)\r\n                .replace('{1}', Math.floor(floor / Config.perPageFloorNum) + 1)\r\n                .replace('{2}', floor)\r\n        );\r\n    });\r\n\r\n    if (pageInfo.floor && pageInfo.floor > 0) {\r\n        var hashName = $('article[data-floor=\"' + pageInfo.floor + '\"]').prev('a').attr('name');\r\n        if (hashName) {\r\n            location.hash = '#' + hashName;\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * 推帖子\r\n */\r\nvar tuiThread = function () {\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: '/diy_read_tui.php',\r\n            data: 'tid=' + pageInfo.tid + '&safeid=' + pageInfo.safeId,\r\n            success: function (msg) {\r\n                var matches = /<span.+?\\+\\d+!<\\/span>\\s*(\\d+)/i.exec(msg);\r\n                if (matches) {\r\n                    var $num = $this.find('span:first');\r\n                    $num.text('+1');\r\n                    window.setTimeout(function () {\r\n                        $num.text(matches[1]);\r\n                    }, 1000);\r\n                }\r\n                else if (/已推过/.test(msg)) {\r\n                    alert('已推过');\r\n                }\r\n                else {\r\n                    alert('操作失败');\r\n                }\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 复制代码\r\n */\r\nvar copyCode = function () {\r\n    $(document).on('click', '.copy-code', function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        var code = $this.data('code');\r\n        if (code) {\r\n            $this.text('复制代码').removeData('code');\r\n            $this.next('textarea').remove();\r\n            $this.after('<pre class=\"pre-scrollable\">' + code + '</pre>');\r\n        }\r\n        else {\r\n            var $pre = $this.next('pre');\r\n            var html = $pre.html();\r\n            $this.text('还原代码').data('code', html);\r\n            html = decodeHtmlSpecialChar(html);\r\n            var height = $pre.height();\r\n            if (height < 50) height = 50;\r\n            if (height > 340) height = 340;\r\n            $pre.remove();\r\n            $('<textarea class=\"form-control code-textarea\" style=\"height: ' + height + 'px\" wrap=\"off\">' + html + '</textarea>')\r\n                .insertAfter($this).select().focus();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 获取当前页面选中的多重引用数据\r\n * @returns {{}[]} 多重引用数据列表\r\n */\r\nvar getCheckedMultiQuoteData = function () {\r\n    var quoteList = [];\r\n    $('.multi-quote-check:checked').each(function () {\r\n        var $article = $(this).closest('article');\r\n        quoteList.push({floor: $article.data('floor'), pid: $article.data('pid'), userName: $article.data('username')});\r\n    });\r\n    return quoteList;\r\n};\r\n\r\n/**\r\n * 绑定多重引用复选框点击事件\r\n */\r\nvar bindMultiQuoteCheckClick = function () {\r\n    $(document).on('click', '.multi-quote-check', function () {\r\n        var data = localStorage[Const.multiQuoteStorageName];\r\n        if (data) {\r\n            try {\r\n                data = JSON.parse(data);\r\n                if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) data = null;\r\n                else if (typeof data.tid === 'undefined' || data.tid !== pageInfo.tid || $.type(data.quoteList) !== 'object') data = null;\r\n            }\r\n            catch (ex) {\r\n                data = null;\r\n            }\r\n        }\r\n        else {\r\n            data = null;\r\n        }\r\n        var quoteList = getCheckedMultiQuoteData();\r\n        if (!data) {\r\n            localStorage.removeItem(Const.multiQuoteStorageName);\r\n            data = {tid: pageInfo.tid, quoteList: {}};\r\n        }\r\n        if (quoteList.length > 0) data.quoteList[pageInfo.currentPageNum] = quoteList;\r\n        else delete data.quoteList[pageInfo.currentPageNum];\r\n        localStorage[Const.multiQuoteStorageName] = JSON.stringify(data);\r\n    });\r\n\r\n    $('.multi-reply-btn').click(function (e) {\r\n        e.preventDefault();\r\n        handleMultiQuote(1);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理多重回复和多重引用\r\n * @param {number} type 处理类型，1：多重回复；2：多重引用\r\n */\r\nvar handleMultiQuote = function (type) {\r\n    var data = localStorage[Const.multiQuoteStorageName];\r\n    if (!data) return;\r\n    try {\r\n        data = JSON.parse(data);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) return;\r\n    if (!pageInfo.tid || typeof data.tid === 'undefined' || data.tid !== pageInfo.tid || $.type(data.quoteList) !== 'object') return;\r\n    if (type === 2 && !pageInfo.fid) return;\r\n    var list = [];\r\n    for (var i in data.quoteList) {\r\n        if ($.type(data.quoteList[i]) !== 'array') continue;\r\n        for (var j in data.quoteList[i]) {\r\n            list.push(data.quoteList[i][j]);\r\n        }\r\n    }\r\n    if (!list.length) {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        return;\r\n    }\r\n\r\n    var keywords = [];\r\n    var content = '';\r\n    if (type === 2) {\r\n        // 显示多重引用等待消息\r\n    }\r\n    $.each(list, function (index, quote) {\r\n        if (typeof quote.floor === 'undefined' || typeof quote.pid === 'undefined') return;\r\n        if ($.inArray(quote.userName, keywords) === -1) keywords.push(quote.userName);\r\n        if (type === 2) {\r\n            // 处理多重引用\r\n        }\r\n        else {\r\n            content += '[quote]回 {0}楼({1}) 的帖子[/quote]\\n'.replace('{0}', quote.floor).replace('{1}', quote.userName);\r\n        }\r\n    });\r\n    $('input[name=\"diy_guanjianci\"]').val(keywords.join(','));\r\n    $('#postForm').submit(function () {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n    });\r\n    if (type === 1) $('#postContent').val(content).focus();\r\n};\r\n\r\n/**\r\n * 处理清除多重引用数据按钮\r\n * @param {number} type 处理类型，1：多重回复；2：多重引用\r\n */\r\nvar handleClearMultiQuoteDataBtn = function (type) {\r\n    $('.clear-multi-quote-data-btn').click(function (e) {\r\n        e.preventDefault();\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        $('input[name=\"diy_guanjianci\"]').val('');\r\n        if (type === 2) $('#textarea').val('');\r\n        else $('#postContent').val('');\r\n        alert('多重引用数据已被清除');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理游戏搜索区域\r\n */\r\nvar handleGameIntroSearchArea = function () {\r\n    $('#gameSearchKeyword').val(pageInfo.keyword);\r\n    $('#gameSearchType').val(pageInfo.searchType);\r\n};\r\n\r\n/**\r\n * 推游戏介绍\r\n * @param {string} type 页面类型\r\n */\r\nvar tuiGameIntro = function (type) {\r\n    var cookieName = '';\r\n    if (type === 'company') cookieName = 'g_intro_inc_tui_';\r\n    else if (type === 'type') cookieName = 'g_intro_adv_tui_';\r\n    else if (type === 'property') cookieName = 'g_intro_moe_tui_';\r\n    else cookieName = 'g_intro_tui_';\r\n    cookieName += pageInfo.id;\r\n    var url = makeUrl('game_intro/' + type, 'id=' + pageInfo.id + '&tui=1');\r\n\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        if (getCookie(cookieName, '')) {\r\n            alert('你在48小时内已经推过');\r\n            return;\r\n        }\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: url,\r\n            success: function () {\r\n                var $num = $this.find('span:first');\r\n                var num = parseInt($num.text());\r\n                $num.text('+1');\r\n                window.setTimeout(function () {\r\n                    $num.text(++num);\r\n                }, 1000);\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            },\r\n            dataType: 'html'\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 随机选择神秘盒子\r\n */\r\nvar randomSelectSmBox = function () {\r\n    $('#smBoxRandom').click(function () {\r\n        var $boxes = $('#smBoxPanel .table a');\r\n        var number = Math.floor(Math.random() * $boxes.length);\r\n        $(this).html('你选择了<b>No. ' + number + '</b>').off('click');\r\n        window.setTimeout(function () {\r\n            location.href = $boxes.eq(number).attr('href');\r\n        }, 1000);\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定收藏夹页面按钮点击事件\r\n */\r\nvar bindFavorPageBtnsClick = function () {\r\n    var $form = $('form[name=\"favorForm\"]');\r\n\r\n    $(document).on('click', '.remove-catalog', function () {\r\n        return window.confirm('是否删除该目录？');\r\n    });\r\n\r\n    $('#addCatalog').click(function (e) {\r\n        e.preventDefault();\r\n        var type = $.trim(window.prompt('请输入收藏夹目录名称：'));\r\n        if (!type) return;\r\n        $form.find('input[name=\"job\"]').val('addtype');\r\n        $form.find('input[name=\"type\"]').val(type);\r\n        $form.submit();\r\n    });\r\n\r\n    $('#favorActionBtns').on('click', 'button', function () {\r\n        var action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            selectAll($('input[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'selectReverse') {\r\n            selectReverse($('input[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'delete') {\r\n            var $checked = $('input[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && window.confirm('是否删除这{0}项？'.replace('{0}', $checked.length))) {\r\n                $form.find('input[name=\"job\"]').val('clear');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n\r\n    $('#convertCatalogDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        var type = $(this).data('type');\r\n        var $checked = $('input[name=\"delid[]\"]:checked');\r\n        if ($checked.length > 0 && window.confirm('是否将这{0}项转换到指定目录？'.replace('{0}', $checked.length))) {\r\n            $form.find('input[name=\"job\"]').val('change');\r\n            $form.find('input[name=\"type\"]').val(type);\r\n            $form.submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定好友列表页面按钮点击事件\r\n */\r\nvar bindFriendPageBtnsClick = function () {\r\n    $('#friendActionBtns').on('click', 'button[type=\"button\"]', function () {\r\n        var action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            selectAll($('input[name=\"selid[]\"]'));\r\n        }\r\n        else if (action === 'selectReverse') {\r\n            selectReverse($('input[name=\"selid[]\"]'));\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 在账号设置页面里为生日字段赋值\r\n */\r\nvar assignBirthdayField = function () {\r\n    $('#birthday').change(function () {\r\n        var value = $.trim($(this).val());\r\n        var matches = /(\\d{4})-(\\d{1,2})-(\\d{1,2})/.exec(value);\r\n        var year = '', month = '', day = '';\r\n        if (matches) {\r\n            year = parseInt(matches[1]);\r\n            month = parseInt(matches[2]);\r\n            day = parseInt(matches[3]);\r\n        }\r\n        $('input[name=\"proyear\"]').val(year);\r\n        $('input[name=\"promonth\"]').val(month);\r\n        $('input[name=\"proday\"]').val(day);\r\n    });\r\n};\r\n\r\n/**\r\n * 同步主题每页楼层数量的设置\r\n */\r\nvar syncPerPageFloorNum = function () {\r\n    /**\r\n     * 同步设置\r\n     */\r\n    var syncConfig = function () {\r\n        var perPageFloorNum = parseInt($('select[name=\"p_num\"]').val());\r\n        if (perPageFloorNum === 0) perPageFloorNum = 10;\r\n        if (!isNaN(perPageFloorNum) && perPageFloorNum !== Config.perPageFloorNum) {\r\n            Config.perPageFloorNum = perPageFloorNum;\r\n            writeConfig();\r\n        }\r\n    };\r\n\r\n    syncConfig();\r\n    $('#creator').submit(function () {\r\n        readConfig();\r\n        syncConfig();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理上传头像文件浏览按钮\r\n */\r\nvar handleUploadAvatarFileBtn = function () {\r\n    $('#browseAvatar').change(function () {\r\n        var $this = $(this);\r\n        var matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || $.inArray(matches[1].toLowerCase(), ['jpg', 'gif', 'png']) === -1) {\r\n            alert('头像图片类型不匹配');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 转账提醒\r\n */\r\nvar transferKfbAlert = function () {\r\n    $('#transferKfbForm').submit(function () {\r\n        var $this = $(this);\r\n        var transferKfb = parseInt($this.find('input[name=\"to_money\"]').val());\r\n        var fixedDeposit = parseInt($('#fixedDeposit').text());\r\n        var currentDeposit = parseInt($('#currentDeposit').text());\r\n        if (transferKfb > 0 && fixedDeposit > 0 && transferKfb > currentDeposit) {\r\n            if (!window.confirm('你的活期存款不足，转账金额将从定期存款里扣除，是否继续？')) {\r\n                return false;\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定短消息页面操作按钮点击事件\r\n */\r\nvar bindMessageActionBtnsClick = function () {\r\n    $('#messageActionBtns').on('click', 'button', function () {\r\n        var $form = $('#messageListForm');\r\n        var action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            selectAll($('input[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'selectReverse') {\r\n            selectReverse($('input[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'selectCustom') {\r\n            var title = $.trim(\r\n                window.prompt('请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）', '收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除')\r\n            );\r\n            if (!title) return;\r\n            $('input[name=\"delid[]\"]').prop('checked', false);\r\n            $('a.thread-link').each(function () {\r\n                var $this = $(this);\r\n                $.each(title.split('|'), function (index, key) {\r\n                    if ($this.text().toLowerCase().indexOf(key.toLowerCase()) > -1) {\r\n                        $this.parent().find('input[name=\"delid[]\"]').prop('checked', true);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        else if (action === 'download') {\r\n            var $checked = $('input[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && window.confirm('是否下载这{0}项？'.replace('{0}', $checked.length))) {\r\n                $form.attr('action', '/message.php').find('input[name=\"action\"]').val('down');\r\n                $form.submit();\r\n            }\r\n        }\r\n        else if (action === 'delete') {\r\n            var $checked = $('input[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && window.confirm('是否删除这{0}项？'.replace('{0}', $checked.length))) {\r\n                $form.attr('action', makeUrl('message/job')).find('input[name=\"action\"]').val('del');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理编辑器按钮\r\n */\r\nvar handleEditorBtns = function () {\r\n    var textArea = $('#postContent').get(0);\r\n\r\n    // 编辑器按钮\r\n    $(document).on('click', '.editor-btn-group button[data-action]', function () {\r\n        var action = $(this).data('action');\r\n        var value = '';\r\n        switch (action) {\r\n            case 'link':\r\n                value = window.prompt('请输入链接URL：', 'http://');\r\n                break;\r\n            case 'img':\r\n                value = window.prompt('请输入图片URL：', 'http://');\r\n                break;\r\n            case 'sell':\r\n                value = window.prompt('请输入出售金额：', 1);\r\n                break;\r\n            case 'hide':\r\n                value = window.prompt('请输入神秘等级：', 1);\r\n                break;\r\n            case 'audio':\r\n                value = window.prompt('请输入HTML5音频实际地址：\\n（可直接输入网易云音乐或虾米的单曲地址，将自动转换为外链地址）', 'http://');\r\n                var matches = /^https?:\\/\\/music\\.163\\.com\\/(?:#\\/)?song\\?id=(\\d+)/i.exec(value);\r\n                if (matches) value = 'http://music.miaola.info/163/{0}.mp3'.replace('{0}', matches[1]);\r\n                matches = /^https?:\\/\\/www\\.xiami\\.com\\/song\\/(\\d+)/i.exec(value);\r\n                if (matches) value = 'http://music.miaola.info/xiami/{0}.mp3'.replace('{0}', matches[1]);\r\n                break;\r\n            case 'video':\r\n                value = window.prompt('请输入HTML5视频实际地址：\\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）', 'http://');\r\n                var matches = /^https?:\\/\\/(?:www\\.)?youtube\\.com\\/watch\\?v=([\\w\\-]+)/i.exec(value);\r\n                if (matches) value = 'http://video.miaola.info/youtube/{0}'.replace('{0}', matches[1]);\r\n                matches = /^https?:\\/\\/youtu\\.be\\/([\\w\\-]+)$/i.exec(value);\r\n                if (matches) value = 'http://video.miaola.info/youtube/{0}'.replace('{0}', matches[1]);\r\n                break;\r\n        }\r\n        if (value === null) return;\r\n\r\n        var selText = '';\r\n        var code = '';\r\n        switch (action) {\r\n            case 'link':\r\n                selText = getSelText(textArea);\r\n                code = '[url={0}]{1}[/url]'.replace('{0}', value).replace('{1}', selText);\r\n                break;\r\n            case 'img':\r\n                code = '[img]{0}[/img]'.replace('{0}', value);\r\n                break;\r\n            case 'quote':\r\n                selText = getSelText(textArea);\r\n                code = '[quote]{0}[/quote]'.replace('{0}', selText);\r\n                break;\r\n            case 'code':\r\n                selText = getSelText(textArea);\r\n                code = '[code]{0}[/code]'.replace('{0}', selText);\r\n                break;\r\n            case 'sell':\r\n                selText = getSelText(textArea);\r\n                code = '[sell={0}]{1}[/sell]'.replace('{0}', value).replace('{1}', selText);\r\n                break;\r\n            case 'hide':\r\n                selText = getSelText(textArea);\r\n                code = '[hide={0}]{1}[/hide]'.replace('{0}', value).replace('{1}', selText);\r\n                break;\r\n            case 'bold':\r\n                selText = getSelText(textArea);\r\n                code = '[b]{0}[/b]'.replace('{0}', selText);\r\n                break;\r\n            case 'italic':\r\n                selText = getSelText(textArea);\r\n                code = '[i]{0}[/i]'.replace('{0}', selText);\r\n                break;\r\n            case 'underline':\r\n                selText = getSelText(textArea);\r\n                code = '[u]{0}[/u]'.replace('{0}', selText);\r\n                break;\r\n            case 'strike':\r\n                selText = getSelText(textArea);\r\n                code = '[strike]{0}[/strike]'.replace('{0}', selText);\r\n                break;\r\n            case 'super':\r\n                selText = getSelText(textArea);\r\n                code = '[sup]{0}[/sup]'.replace('{0}', selText);\r\n                break;\r\n            case 'sub':\r\n                selText = getSelText(textArea);\r\n                code = '[sub]{0}[/sub]'.replace('{0}', selText);\r\n                break;\r\n            case 'horizontal':\r\n                code = '[hr]';\r\n                break;\r\n            case 'align-left':\r\n                selText = getSelText(textArea);\r\n                code = '[align=left]{0}[/align]'.replace('{0}', selText);\r\n                break;\r\n            case 'align-center':\r\n                selText = getSelText(textArea);\r\n                code = '[align=center]{0}[/align]'.replace('{0}', selText);\r\n                break;\r\n            case 'align-right':\r\n                selText = getSelText(textArea);\r\n                code = '[align=right]{0}[/align]'.replace('{0}', selText);\r\n                break;\r\n            case 'fly':\r\n                selText = getSelText(textArea);\r\n                code = '[fly]{0}[/fly]'.replace('{0}', selText);\r\n                break;\r\n            case 'audio':\r\n                code = '[audio]{0}[/audio]'.replace('{0}', value);\r\n                break;\r\n            case 'video':\r\n                code = '[video]{0}[/video]'.replace('{0}', value);\r\n                break;\r\n        }\r\n        if (!code) return;\r\n        addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 字号下拉菜单\r\n    $('#fontSizeDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        var size = $(this).data('size');\r\n        var selText = getSelText(textArea);\r\n        var code = '[size={0}]{1}[/size]'.replace('{0}', size).replace('{1}', selText);\r\n        addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 颜色、背景颜色下拉菜单\r\n    $('#colorDropdownMenu, #bgColorDropdownMenu').on('click', 'span', function () {\r\n        var $this = $(this);\r\n        var codeType = $this.parent().is('#bgColorDropdownMenu') ? 'backcolor' : 'color';\r\n        var color = $this.data('color');\r\n        var selText = getSelText(textArea);\r\n        var code = '[{0}={1}]{2}[/{0}]'\r\n            .replace(/\\{0\\}/g, codeType)\r\n            .replace('{1}', color)\r\n            .replace('{2}', selText);\r\n        addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 检查发帖表单\r\n */\r\nvar checkPostForm = function () {\r\n    $('#postForm').submit(function () {\r\n        var $postType = $('#postType');\r\n        if ($postType.length > 0 && !$postType.val()) {\r\n            alert('没有选择主题分类');\r\n            $postType.focus();\r\n            return false;\r\n        }\r\n\r\n        var $postTitle = $('#postTitle');\r\n        if ($postTitle.length > 0) {\r\n            var length = getStrLen($postTitle.val());\r\n            if (!length) {\r\n                alert('标题不能为空');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n            else if (length > 100) {\r\n                alert('标题超过最大长度 100 个字节');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        var $voteItemContent = $('#voteItemContent');\r\n        if ($voteItemContent.length > 0) {\r\n            if (!$.trim($voteItemContent.val())) {\r\n                alert('投票选项不能为空');\r\n                $voteItemContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        var $postContent = $('#postContent');\r\n        if ($postContent.length > 0) {\r\n            var length = getStrLen($.trim($postContent.val()));\r\n            if (length < 12) {\r\n                alert('文章内容少于 12 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n            else if (length > 50000) {\r\n                alert('文章内容大于 50000 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        var $postGjc = $('#postGjc');\r\n        if ($postGjc.length > 0 && pageInfo.action === 'new' && !$.trim($postGjc.val())) {\r\n            alert('请在内容文本框的下方填写关键词，以方便搜索，也可以在标题中选择任意一个词填入');\r\n            $postGjc.focus();\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理附件按钮\r\n */\r\nvar handleAttachBtns = function () {\r\n    $(document).on('click', '.attach-area a[data-action]', function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        var $area = $this.closest('.attach-area');\r\n        var action = $this.data('action');\r\n        var id = $area.data('id');\r\n        if (!id) return;\r\n        if (action === 'insert') {\r\n            var type = $this.data('type');\r\n            var textArea = $('#postContent').get(0);\r\n            var code = '[{0}={1}]'.replace('{0}', type === 'new' ? 'upload' : 'attachment').replace('{1}', id);\r\n            addCode(textArea, code, '');\r\n            textArea.focus();\r\n        }\r\n        else if (action === 'update') {\r\n            $area.find('.attach-info').prop('hidden', true).after(\r\n                '<label><input name=\"replace_{0}\" type=\"file\" aria-label=\"选择附件\"></label>'.replace('{0}', id)\r\n            );\r\n            $this.data('action', 'cancel').text('取消').blur();\r\n            if (!$(document).data('attachUpdateAlert')) {\r\n                alert('本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果');\r\n                $(document).data('attachUpdateAlert', true);\r\n            }\r\n        }\r\n        else if (action === 'cancel') {\r\n            $area.find('.attach-info').prop('hidden', false).next('label').remove();\r\n            $this.data('action', 'update').text('更新').blur();\r\n        }\r\n        else if (action === 'delete') {\r\n            $area.remove();\r\n        }\r\n    });\r\n\r\n    $(document).on('change', '[type=\"file\"]', function () {\r\n        var $this = $(this);\r\n        var matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || $.inArray(matches[1].toLowerCase(), ['jpg', 'gif', 'png', 'torrent']) === -1) {\r\n            alert('附件类型不匹配');\r\n            return;\r\n        }\r\n\r\n        var type = $this.data('type');\r\n        if (type === 'new') {\r\n            $this.removeData('type').parent().next().prop('hidden', false);\r\n\r\n            var $newAttachArea = $('#newAttachArea');\r\n            var totalNum = $newAttachArea.find('[type=\"file\"]').length;\r\n            if (totalNum >= 5) return;\r\n            var $lastAttachArea = $newAttachArea.find('[type=\"file\"]:last').closest('.attach-area');\r\n            var id = parseInt($lastAttachArea.data('id'));\r\n            if (!id) return;\r\n            $(\r\n                ('<div class=\"form-group row font-size-sm attach-area\" data-id=\"{0}\">' +\r\n                '  <div class=\"col-xs-12 col-form-label\">' +\r\n                '    <label>' +\r\n                '      <input name=\"attachment_{0}\" data-type=\"new\" type=\"file\" aria-label=\"选择附件\">' +\r\n                '    </label>' +\r\n                '    <span hidden>' +\r\n                '      <a data-action=\"insert\" data-type=\"new\" href=\"#\">插入</a>&nbsp;' +\r\n                '      <a data-action=\"delete\" href=\"#\">删除</a>' +\r\n                '    </span>' +\r\n                '  </div>' +\r\n                '  <div class=\"col-xs-4\">' +\r\n                '    <label class=\"sr-only\" for=\"atc_downrvrc{0}\">神秘系数</label>' +\r\n                '    <input class=\"form-control form-control-sm\" id=\"atc_downrvrc{0}\" name=\"atc_downrvrc{0}\" data-toggle=\"tooltip\" ' +\r\n                'type=\"number\" value=\"0\" min=\"0\" title=\"神秘系数\" placeholder=\"神秘系数\">' +\r\n                '  </div>' +\r\n                '  <div class=\"col-xs-8\">' +\r\n                '    <label class=\"sr-only\" for=\"atc_desc{0}\">描述</label>' +\r\n                '    <input class=\"form-control form-control-sm\" id=\"atc_desc{0}\" name=\"atc_desc{0}\" data-toggle=\"tooltip\" type=\"text\" ' +\r\n                'title=\"描述\" placeholder=\"描述\">' +\r\n                '  </div>' +\r\n                '</div>').replace(/\\{0\\}/g, ++id)\r\n            ).insertAfter($lastAttachArea).find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 验证注册页面字段\r\n */\r\nvar validateRegisterField = function () {\r\n    $(document).on('change', 'input[name]', function () {\r\n        var $this = $(this);\r\n        var name = $this.attr('name');\r\n        var value = $this.val();\r\n        if (!value) {\r\n            showValidationMsg($this, 'clear');\r\n            return;\r\n        }\r\n        if (name === 'regemail') {\r\n            showValidationMsg($this, 'wait', '检查中，请稍等&hellip;');\r\n            $.post(makeUrl('register/check'), 'username=' + value, function (data) {\r\n                if ($this.val() === data.username) {\r\n                    showValidationMsg($this, data.type, data.msg);\r\n                }\r\n            }).fail(function () {\r\n                showValidationMsg($this, 'error', '响应失败');\r\n            });\r\n        }\r\n        else if (name === 'regpwd') {\r\n            if (value.length > 16 || value.length < 6) {\r\n                showValidationMsg($this, 'error', '密码长度不正确');\r\n            }\r\n            else {\r\n                showValidationMsg($this, 'clear');\r\n                $('[name=\"regpwdrepeat\"]').trigger('change');\r\n            }\r\n        }\r\n        else if (name === 'regpwdrepeat') {\r\n            if (value !== $('[name=\"regpwd\"]').val()) showValidationMsg($this, 'error', '两次输入的密码不相符');\r\n            else showValidationMsg($this, 'clear');\r\n        }\r\n    });\r\n\r\n    $('#registerForm').submit(function () {\r\n        if ($(this).find('.has-danger').length > 0) {\r\n            alert('请正确填写表单');\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\n$(function () {\r\n    if (pageId === 'loginPage') return;\r\n    else if (pageId === 'registerPage') {\r\n        validateRegisterField();\r\n        return;\r\n    }\r\n    readConfig();\r\n\r\n    handleMainMenu();\r\n    handleRollToTopOrBottomBtn();\r\n    handleSearchDialog();\r\n    if (pageId === 'indexPage') {\r\n        handleAtTipsBtn();\r\n        handleIndexThreadPanel();\r\n        handleSelectBgImage();\r\n        handleCustomBgStyle();\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        handlePageNav('thread/index');\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        fastGotoFloor();\r\n        handlePageNav('read/index');\r\n        tuiThread();\r\n        showFloorLink();\r\n        handleFastReplyBtn();\r\n        handleBlockFloorBtn();\r\n        handleBuyThreadBtn();\r\n        copyBuyThreadList();\r\n        handleFloorImage();\r\n        checkPostForm();\r\n        bindFastSubmitKeydown($('#postContent'));\r\n        copyCode();\r\n        bindMultiQuoteCheckClick();\r\n        handleClearMultiQuoteDataBtn(1);\r\n        addSmileCode($('#postContent'));\r\n    }\r\n    else if (pageId === 'searchPage') {\r\n        handlePageNav('search/index');\r\n    }\r\n    else if (pageId === 'gjcPage') {\r\n        highlightUnReadAtTipsMsg();\r\n    }\r\n    else if (pageId === 'myReplyPage') {\r\n        handlePageNav('personal/reply');\r\n    }\r\n    else if (pageId === 'gameIntroSearchPage') {\r\n        handlePageNav('game_intro/search');\r\n        handleGameIntroSearchArea();\r\n    }\r\n    else if (pageId === 'gameIntroPage') {\r\n        tuiGameIntro('game');\r\n    }\r\n    else if (pageId === 'gameIntroCompanyPage') {\r\n        tuiGameIntro('company');\r\n    }\r\n    else if (pageId === 'gameIntroTypePage') {\r\n        tuiGameIntro('type');\r\n    }\r\n    else if (pageId === 'gameIntroPropertyPage') {\r\n        tuiGameIntro('property');\r\n    }\r\n    else if (pageId === 'smBoxPage') {\r\n        randomSelectSmBox();\r\n    }\r\n    else if (pageId === 'favorPage') {\r\n        bindFavorPageBtnsClick();\r\n    }\r\n    else if (pageId === 'friendPage') {\r\n        bindFriendPageBtnsClick();\r\n    }\r\n    else if (pageId === 'modifyPage') {\r\n        syncPerPageFloorNum();\r\n        assignBirthdayField();\r\n        handleUploadAvatarFileBtn();\r\n    }\r\n    else if (pageId === 'bankPage') {\r\n        transferKfbAlert();\r\n    }\r\n    else if (pageId === 'bankLogPage') {\r\n        handlePageNav('bank/log');\r\n    }\r\n    else if (pageId === 'messagePage') {\r\n        handlePageNav('message/index');\r\n        bindMessageActionBtnsClick();\r\n    }\r\n    else if (pageId === 'readMessagePage') {\r\n        handleFloorImage();\r\n        copyCode();\r\n    }\r\n    else if (pageId === 'writeMessagePage') {\r\n        bindFastSubmitKeydown($('#msgContent'));\r\n        addSmileCode($('#msgContent'));\r\n    }\r\n    else if (pageId === 'messageBannedPage') {\r\n        bindFastSubmitKeydown($('#banidinfo'));\r\n    }\r\n    else if (pageId === 'selfRateLatestPage') {\r\n        handlePageNav('self_rate/latest');\r\n    }\r\n    else if (pageId === 'selfRateCompletePage') {\r\n        handlePageNav('self_rate/complete');\r\n    }\r\n    else if (pageId === 'postPage') {\r\n        checkPostForm();\r\n        bindFastSubmitKeydown($('#postContent'));\r\n        handleEditorBtns();\r\n        addSmileCode($('#postContent'));\r\n        handleAttachBtns();\r\n    }\r\n\r\n    //var tooltipStartTime = new Date();\r\n    $('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n    //console.log('tooltip初始化耗时：' + (new Date() - tooltipStartTime) + 'ms');\r\n});\r\n"],"sourceRoot":"/source/"}
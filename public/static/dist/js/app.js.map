{"version":3,"sources":["app.js"],"names":["pageId","$","attr","configName","config","setCookie","name","value","date","prefix","document","cookie","replace","pageInfo","cookiePrefix","encodeURI","toUTCString","getCookie","regex","RegExp","matches","match","decodeURI","getDate","Date","exec","flag","increment","parseInt","unit","setFullYear","setYear","getYear","setMonth","getMonth","setDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","setMilliseconds","getMilliseconds","getStrLen","str","len","s_len","indexOf","length","c_len","i","charCodeAt","getHostNameUrl","location","protocol","host","addCode","textArea","code","selText","startPos","selectionStart","prePos","substr","selectionEnd","getSelText","extractQueryStr","param","each","split","arr","buildQueryStr","obj","queryStr","key","makeUrl","action","includeOtherParam","url","paramList","extend","urlParam","hasEntryFile","pathname","baseFile","rootPath","isEmptyObject","urlType","decodeHtmlSpecialChar","readConfig","options","localStorage","JSON","parse","ex","type","writeConfig","stringify","handleMainMenu","click","css","documentElement","clientHeight","handleBackToTop","window","scroll","scrollTop","fadeIn","fadeOut","animate","handleSearchDialog","$searchDialog","on","focus","find","submit","$this","this","$searchKeyword","searchType","val","keyword","trim","$method","Math","floor","getTime","setTimeout","fid","$current","change","data","prop","handleLogoutButton","confirm","handleAtTipsBtn","time","cookieValue","currentDate","removeClass","addClass","highlightUnReadAtTipsMsg","gjc","userName","timeString","test","prevString","index","curString","text","handleIndexThreadPanel","tab","e","$target","target","panelName","typeName","handlePageNav","preventDefault","num","prompt","maxPageNum","currentPageNum","href","showFloorLink","handleFastReplyBtn","replyContent","get","handleBuyThreadBtn","pid","price","tid","verify","addSmileCode","blur","parent","$relatedTarget","relatedTarget","removeData","alertPostArticle","minLen","$textArea","alert","tuiThread","ajax","safeId","success","msg","$num","append","error","complete","copyCode","next","remove","after","$pre","html","height","insertAfter","select"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\r\n// 页面ID\r\nvar pageId = $('body').attr('id');\r\n// 配置名称\r\nvar configName = 'kf_config';\r\n// 配置\r\nvar config = {};\r\n\r\n/**\r\n * 设置Cookie\r\n * @param {string} name Cookie名称\r\n * @param {*} value Cookie值\r\n * @param {?Date} [date] Cookie有效期，为空则表示有效期为浏览器进程关闭\r\n * @param {string} [prefix] Cookie名称前缀，留空则表示使用{@link pageInfo.cookiePrefix}前缀\r\n */\r\nvar setCookie = function (name, value, date, prefix) {\r\n    document.cookie = '{0}{1}={2}{3};path=/;'\r\n        .replace('{0}', typeof prefix === 'undefined' || prefix === null ? pageInfo.cookiePrefix : prefix)\r\n        .replace('{1}', name)\r\n        .replace('{2}', encodeURI(value))\r\n        .replace('{3}', !date ? '' : ';expires=' + date.toUTCString());\r\n};\r\n\r\n/**\r\n * 获取Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} [prefix] Cookie名称前缀，留空则表示使用{@link pageInfo.cookiePrefix}前缀\r\n * @returns {?string} Cookie值\r\n */\r\nvar getCookie = function (name, prefix) {\r\n    var regex = new RegExp('(^| ){0}{1}=([^;]*)(;|$)'\r\n        .replace('{0}', typeof prefix === 'undefined' || prefix === null ? pageInfo.cookiePrefix : prefix)\r\n        .replace('{1}', name)\r\n    );\r\n    var matches = document.cookie.match(regex);\r\n    if (!matches) return null;\r\n    else return decodeURI(matches[2]);\r\n};\r\n\r\n/**\r\n * 获取在当前时间的基础上的指定（相对）时间量的Date对象\r\n * @param {string} value 指定（相对）时间量，+或-：之后或之前（相对于当前时间）；无符号：绝对值；Y：完整年份；y：年；M：月；d：天；h：小时；m：分；s：秒；ms：毫秒\r\n * @returns {?Date} 指定（相对）时间量的Date对象\r\n * @example\r\n * Tools.getDate('+2y') 获取2年后的Date对象\r\n * Tools.getDate('+3M') 获取3个月后的Date对象\r\n * Tools.getDate('-4d') 获取4天前的Date对象\r\n * Tools.getDate('5h') 获取今天5点的Date对象（其它时间量与当前时间一致）\r\n * Tools.getDate('2015Y') 获取年份为2015年的Date对象\r\n */\r\nvar getDate = function (value) {\r\n    var date = new Date();\r\n    var matches = /^(-|\\+)?(\\d+)([a-zA-Z]{1,2})$/.exec(value);\r\n    if (!matches) return null;\r\n    var flag = typeof matches[1] === 'undefined' ? 0 : (matches[1] === '+' ? 1 : -1);\r\n    var increment = flag === -1 ? -parseInt(matches[2]) : parseInt(matches[2]);\r\n    var unit = matches[3];\r\n    switch (unit) {\r\n        case 'Y':\r\n            date.setFullYear(increment);\r\n            break;\r\n        case 'y':\r\n            date.setYear(flag === 0 ? increment : date.getYear() + increment);\r\n            break;\r\n        case 'M':\r\n            date.setMonth(flag === 0 ? increment : date.getMonth() + increment);\r\n            break;\r\n        case 'd':\r\n            date.setDate(flag === 0 ? increment : date.getDate() + increment);\r\n            break;\r\n        case 'h':\r\n            date.setHours(flag === 0 ? increment : date.getHours() + increment);\r\n            break;\r\n        case 'm':\r\n            date.setMinutes(flag === 0 ? increment : date.getMinutes() + increment);\r\n            break;\r\n        case 's':\r\n            date.setSeconds(flag === 0 ? increment : date.getSeconds() + increment);\r\n            break;\r\n        case 'ms':\r\n            date.setMilliseconds(flag === 0 ? increment : date.getMilliseconds() + increment);\r\n            break;\r\n        default:\r\n            return null;\r\n    }\r\n    return date;\r\n};\r\n\r\n/**\r\n * 获取指定字符串的字节长度（1个GBK字符按2个字节来算）\r\n * @param {string} str 指定字符串\r\n * @returns {number} 字符串的长度\r\n */\r\nvar getStrLen = function (str) {\r\n    var len = 0;\r\n    var s_len = str.indexOf('\\n') !== -1 ? str.replace(/\\r?\\n/g, '_').length : str.length;\r\n    var c_len = 2;\r\n    for (var i = 0; i < s_len; i++) {\r\n        len += str.charCodeAt(i) < 0 || str.charCodeAt(i) > 255 ? c_len : 1;\r\n    }\r\n    return len;\r\n};\r\n\r\n/**\r\n * 获取当前域名的URL\r\n * @returns {string} 当前域名的URL\r\n */\r\nvar getHostNameUrl = function () {\r\n    return location.protocol + '//' + location.host;\r\n};\r\n\r\n/**\r\n * 添加BBCode\r\n * @param textArea 文本框\r\n * @param {string} code BBCode\r\n * @param {string} selText 选择文本\r\n */\r\nvar addCode = function (textArea, code, selText) {\r\n    var startPos = selText === '' ? code.indexOf(']') + 1 : code.indexOf(selText);\r\n    if (typeof textArea.selectionStart !== 'undefined') {\r\n        var prePos = textArea.selectionStart;\r\n        textArea.value = textArea.value.substr(0, prePos) + code + textArea.value.substr(textArea.selectionEnd);\r\n        textArea.selectionStart = prePos + startPos;\r\n        textArea.selectionEnd = prePos + startPos + selText.length;\r\n    }\r\n    else {\r\n        textArea.value += code;\r\n    }\r\n};\r\n\r\n/**\r\n * 获取选择文本\r\n * @param textArea 文本框\r\n * @returns {string} 选择文本\r\n */\r\nvar getSelText = function (textArea) {\r\n    return textArea.value.substr(textArea.selectionStart, textArea.selectionEnd - textArea.selectionStart);\r\n};\r\n\r\n/**\r\n * 从URL查询字符串提取参数对象\r\n * @param {string} str URL查询字符串\r\n * @returns {{}} 参数对象\r\n */\r\nvar extractQueryStr = function (str) {\r\n    var param = {};\r\n    $.each(str.split('&'), function (i, value) {\r\n        if (!value) return;\r\n        var arr = value.split('=');\r\n        param[arr[0]] = typeof arr[1] !== 'undefined' ? arr[1] : '';\r\n    });\r\n    return param;\r\n};\r\n\r\n/**\r\n * 从参数对象中创建URL查询字符串\r\n * @param {{}} obj 参数对象\r\n * @returns {string} URL查询字符串\r\n */\r\nvar buildQueryStr = function (obj) {\r\n    var queryStr = '';\r\n    $.each(obj, function (key, value) {\r\n        queryStr += '/' + key + '/' + value;\r\n    });\r\n    return queryStr;\r\n};\r\n\r\n/**\r\n * 生成指定的URL\r\n * @param {string} action 控制器（小写）\r\n * @param {string} [param=''] 查询参数\r\n * @param {boolean} [includeOtherParam=false] 是否包括当前页面的其它查询参数\r\n * @returns {string} URL 最终的URL\r\n */\r\nvar makeUrl = function (action, param, includeOtherParam) {\r\n    var url = '';\r\n    var paramList = extractQueryStr(param ? param : '');\r\n    if (includeOtherParam) {\r\n        paramList = $.extend(extractQueryStr(pageInfo.urlParam), paramList);\r\n    }\r\n    var hasEntryFile = location.pathname.indexOf(pageInfo.baseFile) === 0;\r\n    if (hasEntryFile) url = pageInfo.baseFile;\r\n    else url = pageInfo.rootPath.substr(0, pageInfo.rootPath.length - 1);\r\n    var queryStr = '';\r\n    if (!$.isEmptyObject(paramList)) queryStr = buildQueryStr(paramList);\r\n    if (pageInfo.urlType === 2) url += '?s=' + '/' + action + queryStr;\r\n    else url += '/' + action + queryStr;\r\n    return url;\r\n};\r\n\r\n/**\r\n * 解码HTML特殊字符\r\n * @param {string} str 待解码的字符串\r\n * @returns {string} 解码后的字符串\r\n */\r\nvar decodeHtmlSpecialChar = function (str) {\r\n    if (str.length === 0) return '';\r\n    return str.replace(/<br\\s*\\/?>/gi, '\\n')\r\n        .replace(/&quot;/gi, '\\\"')\r\n        .replace(/&#39;/gi, '\\'')\r\n        .replace(/&nbsp;/gi, ' ')\r\n        .replace(/&gt;/gi, '>')\r\n        .replace(/&lt;/gi, '<')\r\n        .replace(/&amp;/gi, '&');\r\n};\r\n\r\n/**\r\n * 读取设置\r\n */\r\nvar readConfig = function () {\r\n    var options = null;\r\n    options = localStorage['configName'];\r\n    if (!options) return;\r\n    try {\r\n        options = JSON.parse(options);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!options || $.type(options) !== 'object' || $.isEmptyObject(options)) return;\r\n    config = options;\r\n};\r\n\r\n/**\r\n * 写入设置\r\n */\r\nvar writeConfig = function () {\r\n    localStorage['configName'] = JSON.stringify(config);\r\n};\r\n\r\n/**\r\n * 处理主菜单\r\n */\r\nvar handleMainMenu = function () {\r\n    $('#mainMenuTogglerBtn').click(function () {\r\n        $('#mainMenu').css('max-height', document.documentElement.clientHeight - 50 + 'px');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理回到顶部按钮\r\n */\r\nvar handleBackToTop = function () {\r\n    $(window).scroll(function () {\r\n        if ($(window).scrollTop() > 300)\r\n            $(\"#backToTop\").fadeIn();\r\n        else\r\n            $(\"#backToTop\").fadeOut();\r\n    });\r\n\r\n    $(\"#backToTop\").click(function () {\r\n        $('body, html').animate({scrollTop: 0});\r\n    });\r\n};\r\n\r\n/**\r\n * 处理搜索对话框\r\n */\r\nvar handleSearchDialog = function () {\r\n    var $searchDialog = $('#searchDialog');\r\n\r\n    $searchDialog.on('shown.bs.modal', function () {\r\n        $('#searchKeyword').focus();\r\n    }).find('form').submit(function () {\r\n        var $this = $(this);\r\n        var $searchKeyword = $this.find('#searchKeyword');\r\n        var searchType = $this.find('#searchType').val();\r\n        var keyword = $.trim($searchKeyword.val());\r\n        if (searchType === 'gjc') {\r\n            $this.attr('action', makeUrl('gjc/' + keyword));\r\n        }\r\n        else if (searchType === 'username') {\r\n            $this.attr('action', makeUrl('user/username/' + keyword));\r\n        }\r\n        else {\r\n            $this.attr('action', makeUrl('search'));\r\n            $searchKeyword.attr('name', searchType === 'author' ? 'pwuser' : 'keyword');\r\n            if (searchType === 'title') {\r\n                if (keyword.length && getStrLen(keyword) <= 2) {\r\n                    var $method = $this.find('input[name=\"method\"]');\r\n                    $method.val('OR');\r\n                    $searchKeyword.val(keyword + ' ' + Math.floor(new Date().getTime() / 1000));\r\n                    window.setTimeout(function () {\r\n                        $searchKeyword.val(keyword);\r\n                        $method.val('AND');\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    $searchDialog.find('input[name=\"searchRange\"]').on('click', function () {\r\n        var value = 'all';\r\n        if ($(this).val() === 'current') value = pageInfo.fid;\r\n        $searchDialog.find('input[name=\"f_fid\"]').val(value);\r\n    });\r\n\r\n    var $current = $searchDialog.find('input[name=\"searchRange\"][value=\"current\"]');\r\n    $searchDialog.find('#searchType').change(function () {\r\n        var searchType = $(this).val();\r\n        if (!$current.data('enabled')) return;\r\n        $current.prop('disabled', searchType === 'gjc' || searchType === 'username');\r\n    });\r\n\r\n    if (pageId === 'threadPage' || pageId === 'readPage') {\r\n        $current.prop('disabled', false).data('enabled', true).click();\r\n    }\r\n};\r\n\r\n/**\r\n * 处理登出按钮\r\n */\r\nvar handleLogoutButton = function () {\r\n    $(document).on('click', '#dropdownItemLogout', function () {\r\n        if (!window.confirm('是否登出账号？')) return false;\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页的@提醒按钮\r\n */\r\nvar handleAtTipsBtn = function () {\r\n    $('#atTips').click(function () {\r\n        var $this = $(this);\r\n        var time = $this.data('time');\r\n        var cookieValue = getCookie('at_tips_time');\r\n        if (!time || time === cookieValue) return;\r\n        if (!cookieValue) {\r\n            var currentDate = (new Date()).getDate();\r\n            setCookie('prev_at_tips_time', (currentDate < 10 ? '0' + currentDate : currentDate) + '日00时00分');\r\n        }\r\n        else if (cookieValue !== time) {\r\n            setCookie('prev_at_tips_time', cookieValue);\r\n        }\r\n        setCookie('at_tips_time', time, getDate('+3d'));\r\n        $this.removeClass('btn-outline-danger').addClass('btn-outline-primary');\r\n    });\r\n};\r\n\r\n/**\r\n * 高亮关键词页面中未读的消息\r\n */\r\nvar highlightUnReadAtTipsMsg = function () {\r\n    if (pageInfo.gjc !== pageInfo.userName) return;\r\n    var timeString = getCookie('prev_at_tips_time');\r\n    if (!timeString || !/^\\d+日\\d+时\\d+分$/.test(timeString)) return;\r\n    var prevString = '';\r\n    $('.thread-list-item time').each(function (index) {\r\n        var $this = $(this);\r\n        var curString = $.trim($this.text());\r\n        if (index === 0) prevString = curString;\r\n        if (timeString < curString && prevString >= curString) {\r\n            $this.addClass('text-danger');\r\n            prevString = curString;\r\n        }\r\n        else return false;\r\n    });\r\n\r\n    $(document).on('click', '.thread-list-item .thread-link-item a', function () {\r\n        setCookie('prev_at_tips_time', '', getDate('-1d'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页主题链接面板\r\n */\r\nvar handleIndexThreadPanel = function () {\r\n    if (config['activeNewReplyPanel']) {\r\n        $('a[data-toggle=\"tab\"][href=\"{0}\"]'.replace('{0}', config['activeNewReplyPanel'])).tab('show');\r\n    }\r\n    if (config['activeTopRecommendPanel']) {\r\n        $('a[data-toggle=\"tab\"][href=\"{0}\"]'.replace('{0}', config['activeTopRecommendPanel'])).tab('show');\r\n    }\r\n\r\n    $(document).on('shown.bs.tab', 'a[data-toggle=\"tab\"]', function (e) {\r\n        var $target = $(e.target);\r\n        readConfig();\r\n        var panelName = $target.attr('href');\r\n        var typeName = 'activeNewReplyPanel';\r\n        if (panelName.indexOf('TopRecommendPanel') > 0) typeName = 'activeTopRecommendPanel';\r\n        config[typeName] = $target.attr('href');\r\n        writeConfig();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理分页导航\r\n * @param {string} action 控制器\r\n */\r\nvar handlePageNav = function (action) {\r\n    $(document).on('click', '.page-item.active > .page-link', function (e) {\r\n        e.preventDefault();\r\n        var num = parseInt(window.prompt('要跳转到第几页？（共' + pageInfo.maxPageNum + '页）', pageInfo.currentPageNum));\r\n        if (num) {\r\n            location.href = makeUrl(action, 'page=' + num, true);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示楼层跳转链接\r\n */\r\nvar showFloorLink = function () {\r\n    $(document).on('click', '.floor-num', function (e) {\r\n        e.preventDefault();\r\n        window.prompt('本楼的跳转链接：', getHostNameUrl() + $(this).attr('href'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理快速回复按钮\r\n */\r\nvar handleFastReplyBtn = function () {\r\n    $(document).on('click', '.fast-reply-btn', function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        var floor = $this.data('floor');\r\n        var userName = $this.data('username');\r\n        $('#articleGjc').val(userName);\r\n        var replyContent = $('#articleContent').get(0);\r\n        replyContent.value = '[quote]回 {0}楼({1}) 的帖子[/quote]\\n'.replace('{0}', floor).replace('{1}', userName);\r\n        replyContent.selectionStart = replyContent.value.length;\r\n        replyContent.selectionEnd = replyContent.value.length;\r\n        replyContent.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理购买帖子按钮\r\n */\r\nvar handleBuyThreadBtn = function () {\r\n    $(document).on('click', '.buy-thread-btn', function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        var pid = $this.data('pid');\r\n        var price = $this.data('price');\r\n        if (price > 5 && !window.confirm('此贴售价{0}KFB，是否购买？'.replace('{0}', price))) return;\r\n        //location.href = '/job.php?action=buytopic&tid={0}&pid={1}&verify={2}'\r\n        location.href = makeUrl(\r\n            'job/buytopic',\r\n            'tid={0}&pid={1}&verify={2}'\r\n                .replace('{0}', pageInfo.tid)\r\n                .replace('{1}', pid)\r\n                .replace('{2}', pageInfo.verify)\r\n        );\r\n    });\r\n};\r\n\r\n/**\r\n * 插入表情代码\r\n */\r\nvar addSmileCode = function () {\r\n    $('.smile-panel').on('click', 'img', function () {\r\n        $('.smile-panel').addClass('open');\r\n        var textArea = $('#articleContent').get(0);\r\n        if (!textArea) return;\r\n        var code = '[s:' + $(this).data('id') + ']';\r\n        addCode(textArea, code, '');\r\n        textArea.blur();\r\n    }).parent().on('hide.bs.dropdown', function (e) {\r\n        var $relatedTarget = $(e.relatedTarget);\r\n        if (!$relatedTarget.data('open')) $relatedTarget.removeData('open');\r\n        else return e.preventDefault();\r\n    });\r\n\r\n    $('#smileDropdownBtn').click(function () {\r\n        var $this = $(this);\r\n        $this.data('open', !$this.data('open'));\r\n    });\r\n};\r\n\r\n/**\r\n * 发帖提醒\r\n */\r\nvar alertPostArticle = function () {\r\n    $('#articleForm').submit(function () {\r\n        var minLen = 12;\r\n        var $textArea = $('#articleContent');\r\n        if (getStrLen($.trim($textArea.val())) < minLen) {\r\n            alert('文章内容少于 ' + minLen + ' 个字节');\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 推帖子\r\n */\r\nvar tuiThread = function () {\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: '/diy_read_tui.php',\r\n            data: 'tid=' + pageInfo.tid + '&safeid=' + pageInfo.safeId,\r\n            success: function (msg) {\r\n                var matches = /<span.+?\\+\\d+!<\\/span>\\s*(\\d+)/i.exec(msg);\r\n                if (matches) {\r\n                    var $num = $this.find('span:first');\r\n                    $num.append('<span class=\"text-info\">+1</span>');\r\n                    window.setTimeout(function () {\r\n                        $num.text(matches[1]);\r\n                    }, 1000);\r\n                }\r\n                else if (/已推过/.test(msg)) {\r\n                    alert('已推过');\r\n                }\r\n                else {\r\n                    alert('操作失败');\r\n                }\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 复制代码\r\n */\r\nvar copyCode = function () {\r\n    $(document).on('click', '.copy-code', function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        var code = $this.data('code');\r\n        if (code) {\r\n            $this.text('复制代码').removeData('code');\r\n            $this.next('textarea').remove();\r\n            $this.after('<pre class=\"pre-scrollable\">' + code + '</pre>');\r\n        }\r\n        else {\r\n            var $pre = $this.next('pre');\r\n            var html = $pre.html();\r\n            $this.text('还原代码').data('code', html);\r\n            html = decodeHtmlSpecialChar(html);\r\n            var height = $pre.height();\r\n            if (height < 50) height = 50;\r\n            if (height > 340) height = 340;\r\n            $pre.remove();\r\n            $('<textarea class=\"form-control code-textarea\" style=\"height: ' + height + 'px\" wrap=\"off\">' + html + '</textarea>')\r\n                .insertAfter($this).select().focus();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\n$(function () {\r\n    if (pageId === 'loginPage') return;\r\n    readConfig();\r\n\r\n    handleMainMenu();\r\n    handleBackToTop();\r\n    handleSearchDialog();\r\n    handleLogoutButton();\r\n    if (pageId === 'indexPage') {\r\n        handleAtTipsBtn();\r\n        handleIndexThreadPanel();\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        handlePageNav('thread/index');\r\n    } else if (pageId === 'readPage') {\r\n        handlePageNav('read/index');\r\n        tuiThread();\r\n        showFloorLink();\r\n        handleFastReplyBtn();\r\n        handleBuyThreadBtn();\r\n        alertPostArticle();\r\n        copyCode();\r\n        addSmileCode();\r\n    } else if (pageId === 'gjcPage') {\r\n        highlightUnReadAtTipsMsg();\r\n    }\r\n\r\n    //$('[data-toggle=\"tooltip\"]').tooltip();\r\n});\r\n"],"sourceRoot":"/source/"}
!function e(t,a,n){function o(i,l){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!l&&c)return c(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return o(a?a:e)},u,u.exports,e,t,a,n)}return a[i].exports}for(var r="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,a){"use strict";var n=e("./module/config"),o=e("./module/public"),r=e("./module/index"),i=e("./module/read"),l=e("./module/post"),c=e("./module/other");window.pageId=$("body").attr("id"),$(function(){if("loginPage"!==pageId){if("registerPage"===pageId)return void(0,c.validateRegisterField)();(0,n.init)(),(0,o.handleMainMenu)(),(0,o.handleRollToTopOrBottomBtn)(),(0,o.handleSearchDialog)(),"indexPage"===pageId?((0,r.handleAtTipsBtn)(),(0,r.handleIndexThreadPanel)(),(0,r.handleSelectBgImage)(),(0,r.handleSelectBgColor)(),(0,r.handleCustomBgStyle)()):"threadPage"===pageId?(0,o.handlePageNav)("thread/index"):"readPage"===pageId?((0,i.fastGotoFloor)(),(0,o.handlePageNav)("read/index"),(0,i.tuiThread)(),(0,i.showFloorLink)(),(0,i.handleFastReplyBtn)(),(0,i.handleBlockFloorBtn)(),(0,i.handleBuyThreadBtn)(),(0,i.copyBuyThreadList)(),(0,i.handleFloorImage)(),(0,l.checkPostForm)(),(0,o.bindFastSubmitShortcutKey)($("#postContent")),(0,i.copyCode)(),(0,i.bindMultiQuoteCheckClick)(),(0,i.handleClearMultiQuoteDataBtn)(1),(0,l.addSmileCode)($("#postContent"))):"searchPage"===pageId?(0,o.handlePageNav)("search/index"):"gjcPage"===pageId?(0,c.highlightUnReadAtTipsMsg)():"myTopicPage"===pageId?(0,o.handlePageNav)("personal/topic"):"myReplyPage"===pageId?(0,o.handlePageNav)("personal/reply"):"gameIntroSearchPage"===pageId?((0,o.handlePageNav)("game_intro/search"),(0,c.handleGameIntroSearchArea)()):"gameIntroPage"===pageId?(0,c.tuiGameIntro)("game"):"gameIntroCompanyPage"===pageId?(0,c.tuiGameIntro)("company"):"gameIntroTypePage"===pageId?(0,c.tuiGameIntro)("type"):"gameIntroPropertyPage"===pageId?(0,c.tuiGameIntro)("property"):"smBoxPage"===pageId?(0,c.randomSelectSmBox)():"favorPage"===pageId?(0,c.bindFavorPageBtnsClick)():"friendPage"===pageId?(0,c.bindFriendPageBtnsClick)():"modifyPage"===pageId?((0,c.syncPerPageFloorNum)(),(0,c.assignBirthdayField)(),(0,c.handleUploadAvatarFileBtn)()):"bankPage"===pageId?(0,c.transferKfbAlert)():"bankLogPage"===pageId?(0,o.handlePageNav)("bank/log"):"messagePage"===pageId?((0,o.handlePageNav)("message/index"),(0,c.bindMessageActionBtnsClick)()):"readMessagePage"===pageId?((0,i.handleFloorImage)(),(0,i.copyCode)()):"writeMessagePage"===pageId?((0,o.bindFastSubmitShortcutKey)($("#msgContent")),(0,l.addSmileCode)($("#msgContent"))):"messageBannedPage"===pageId?(0,o.bindFastSubmitShortcutKey)($('[name="banidinfo"]')):"selfRateLatestPage"===pageId?(0,o.handlePageNav)("self_rate/latest"):"selfRateCompletePage"===pageId?(0,o.handlePageNav)("self_rate/complete"):"postPage"===pageId&&((0,l.checkPostForm)(),(0,o.bindFastSubmitShortcutKey)($("#postContent")),(0,l.handleEditorBtns)(),(0,l.addSmileCode)($("#postContent")),(0,l.handleAttachBtns)()),$('[data-toggle="tooltip"]').tooltip({container:"body"})}})},{"./module/config":2,"./module/index":4,"./module/other":5,"./module/post":6,"./module/public":7,"./module/read":8}],2:[function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Object.defineProperty(a,"__esModule",{value:!0}),a.clear=a.write=a.read=a.init=void 0;var o=e("./util"),r=n(o),i="kf_config",l={perPageFloorNum:0,activeNewReplyPanel:"#galgameNewReplyPanel",activeTopRecommendPanel:"#galgameTopRecommendPanel",activeForumPanel1:"",activeForumPanel2:""},c=(a.init=function(){window.Config=$.extend(!0,{},l),c()},a.read=function(){var e=localStorage[i];if(e){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=d(e),window.Config=$.extend(!0,{},l,e))}}),d=(a.write=function(){var e=r.getDifferenceSetOfObject(l,window.Config);localStorage[i]=JSON.stringify(e)},a.clear=function(){localStorage.removeItem(i)},function(e){var t={};return"object"!==$.type(e)?t:($.each(e,function(e,a){e in l&&(t[e]=a)}),t)})},{"./util":9}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n={multiQuoteStorageName:"kf_multi_quote",atTipsTimeCookieName:"at_tips_time",prevAtTipsTimeCookieName:"prev_at_tips_time",bgStyleCookieName:"bg_style"};a.default=n},{}],4:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Object.defineProperty(a,"__esModule",{value:!0}),a.handleCustomBgStyle=a.handleSelectBgColor=a.handleSelectBgImage=a.handleIndexThreadPanel=a.handleAtTipsBtn=void 0;var r=e("./util"),i=o(r),l=e("./const"),c=n(l),d=e("./config");a.handleAtTipsBtn=function(){$("#atTips").click(function(){var e=$(this),t=e.data("time"),a=i.getCookie(c.default.atTipsTimeCookieName);if(t&&t!==a){if(a)a!==t&&i.setCookie(c.default.prevAtTipsTimeCookieName,a);else{var n=(new Date).getDate();i.setCookie(c.default.prevAtTipsTimeCookieName,(n<10?"0"+n:n)+"日00时00分")}i.setCookie(c.default.atTipsTimeCookieName,t,i.getDate("+3d")),e.removeClass("btn-outline-danger").addClass("btn-outline-primary")}})},a.handleIndexThreadPanel=function(){Config.activeNewReplyPanel&&$('a[data-toggle="tab"][href="'+Config.activeNewReplyPanel+'"]').tab("show"),Config.activeTopRecommendPanel&&$('a[data-toggle="tab"][href="'+Config.activeTopRecommendPanel+'"]').tab("show"),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(e){var t=$(e.target),a=t.attr("href"),n="";a.includes("NewReplyPanel")?n="activeNewReplyPanel":a.includes("TopRecommendPanel")&&(n="activeTopRecommendPanel"),n&&Config[n]!==a&&((0,d.read)(),Config[n]=a,(0,d.write)())})},a.handleSelectBgImage=function(){$("#selectBgImage").on("click","[data-id]",function(){var e=$(this),t=e.data("id"),a=e.data("filename"),n=e.parent().data("path");t&&a&&n&&confirm("是否选择此背景图片？")&&(i.setCookie(c.default.bgStyleCookieName,t,i.getDate("+1y")),$("body, .modal-content").css("background-image",'url("'+n+a+'")'),alert("背景已更换（图片可能需要一定时间加载）"))})},a.handleSelectBgColor=function(){$("#selectBgImage").on("click","[data-color]",function(){var e=$(this),t=e.data("color");t&&confirm("是否选择此背景颜色？")&&(i.setCookie(c.default.bgStyleCookieName,t,i.getDate("+1y")),$("body, .modal-content").css("background",t),alert("背景已更换"))})},a.handleCustomBgStyle=function(){$("#customBgStyle").click(function(){var e=i.getCookie(c.default.bgStyleCookieName);e&&!parseInt(e)||(e=""),e=prompt("请输入背景图片URL、颜色代码或CSS样式：\n（例：http://xxx.com/abc.jpg 或 #fcfcfc，留空表示恢复默认背景）\n（注：建议选择简洁、不花哨、偏浅色系的背景图片或颜色）",e),null!==e&&(""===$.trim(e)?(i.setCookie(c.default.bgStyleCookieName,"",i.getDate("-1d")),alert("背景已恢复默认"),location.reload()):/^https?:\/\/[^"']+/.test(e)?(i.setCookie(c.default.bgStyleCookieName,e,i.getDate("+1y")),$("body, .modal-content").css("background-image",'url("'+e+'")'),alert("背景已更换（图片可能需要一定时间加载）")):/^#[0-9a-f]{6}$/i.test(e)?(i.setCookie(c.default.bgStyleCookieName,e,i.getDate("+1y")),$("body, .modal-content").css("background",e.toLowerCase()),alert("背景已更换")):/[<>{}]/.test(e)?alert("格式不正确"):(e=e.replace(";",""),i.setCookie(c.default.bgStyleCookieName,e,i.getDate("+1y")),$("body, .modal-content").css("background",e),alert("背景已更换（图片可能需要一定时间加载）")))})}},{"./config":2,"./const":3,"./util":9}],5:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Object.defineProperty(a,"__esModule",{value:!0}),a.validateRegisterField=a.bindMessageActionBtnsClick=a.transferKfbAlert=a.handleUploadAvatarFileBtn=a.syncPerPageFloorNum=a.assignBirthdayField=a.bindFriendPageBtnsClick=a.bindFavorPageBtnsClick=a.randomSelectSmBox=a.tuiGameIntro=a.handleGameIntroSearchArea=a.highlightUnReadAtTipsMsg=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./util"),l=o(i),c=e("./const"),d=n(c),u=e("./config");a.highlightUnReadAtTipsMsg=function(){if(pageInfo.gjc===pageInfo.userName){var e=l.getCookie(d.default.prevAtTipsTimeCookieName);if(e&&/^\d+日\d+时\d+分$/.test(e)){var t="";$(".thread-list-item time").each(function(a){var n=$(this),o=$.trim(n.text());return 0===a&&(t=o),e<o&&t>=o&&(n.addClass("text-danger"),void(t=o))}),$(document).on("click",".thread-list-item .thread-link-item a",function(){l.deleteCookie(d.default.prevAtTipsTimeCookieName)})}}},a.handleGameIntroSearchArea=function(){$("#gameSearchKeyword").val(pageInfo.keyword),$("#gameSearchType").val(pageInfo.searchType)},a.tuiGameIntro=function(e){var t="";t="company"===e?"g_intro_inc_tui_":"type"===e?"g_intro_adv_tui_":"property"===e?"g_intro_moe_tui_":"g_intro_tui_",t+=pageInfo.id;var a=l.makeUrl("game_intro/"+e,"id="+pageInfo.id+"&tui=1");$(".tui-btn").click(function(e){e.preventDefault();var n=$(this);if(!n.data("wait")){if(l.getCookie(t,""))return void alert("你在48小时内已经推过");n.data("wait",!0),$.ajax({type:"GET",url:a,success:function(){var e=n.find("span:first"),t=parseInt(e.text());e.text("+1"),setTimeout(function(){e.text(++t)},1e3)},error:function(){alert("操作失败")},complete:function(){n.removeData("wait")},dataType:"html"})}})},a.randomSelectSmBox=function(){$("#smBoxRandom").click(function(){var e=$("#smBoxPanel .table a"),t=Math.floor(Math.random()*e.length);$(this).html("你选择了<b>No. "+t+"</b>").off("click"),setTimeout(function(){location.href=e.eq(t).attr("href")},1e3)})},a.bindFavorPageBtnsClick=function(){var e=$('form[name="favorForm"]');$(document).on("click",".remove-catalog",function(){return confirm("是否删除该目录？")}),$("#addCatalog").click(function(t){t.preventDefault();var a=$.trim(prompt("请输入收藏夹目录名称："));a&&(e.find('[name="job"]').val("addtype"),e.find('[name="type"]').val(a),e.submit())}),$("#favorActionBtns").on("click","button",function(){var t=$(this).data("action");if("selectAll"===t)l.selectAll($('[name="delid[]"]'));else if("selectReverse"===t)l.selectReverse($('[name="delid[]"]'));else if("delete"===t){var a=$('[name="delid[]"]:checked');a.length>0&&confirm("是否删除这"+a.length+"项？")&&(e.find('[name="job"]').val("clear"),e.submit())}}),$("#convertCatalogDropdownMenu").on("click","a",function(t){t.preventDefault();var a=$(this).data("type"),n=$('[name="delid[]"]:checked');n.length>0&&confirm("是否将这"+n.length+"项转换到指定目录？")&&(e.find('[name="job"]').val("change"),e.find('[name="type"]').val(a),e.submit())})},a.bindFriendPageBtnsClick=function(){$("#friendActionBtns").on("click",'[type="button"]',function(){var e=$(this).data("action");"selectAll"===e?l.selectAll($('[name="selid[]"]')):"selectReverse"===e&&l.selectReverse($('[name="selid[]"]'))})},a.assignBirthdayField=function(){$("#birthday").change(function(){var e=$(this).val().trim(),t=/(\d{4})-(\d{1,2})-(\d{1,2})/.exec(e),a="",n="",o="";t&&(a=parseInt(t[1]),n=parseInt(t[2]),o=parseInt(t[3])),$('[name="proyear"]').val(a),$('[name="promonth"]').val(n),$('[name="proday"]').val(o)})},a.syncPerPageFloorNum=function(){var e=function(){var e=parseInt($('[name="p_num"]').val());0===e&&(e=10),isNaN(e)||e===Config.perPageFloorNum||(Config.perPageFloorNum=e,(0,u.write)())};e(),$("#creator").submit(function(){(0,u.read)(),e()})},a.handleUploadAvatarFileBtn=function(){$("#browseAvatar").change(function(){var e=$(this),t=/\.(\w+)$/.exec(e.val());t&&["jpg","gif","png"].includes(t[1].toLowerCase())||alert("头像图片类型不匹配")})},a.transferKfbAlert=function(){$("#transferKfbForm").submit(function(){var e=$(this),t=parseInt(e.find('[name="to_money"]').val()),a=parseInt($("#fixedDeposit").text()),n=parseInt($("#currentDeposit").text());if(t>0&&a>0&&t>n&&!confirm("你的活期存款不足，转账金额将从定期存款里扣除，是否继续？"))return!1})},a.bindMessageActionBtnsClick=function(){$("#messageActionBtns").on("click","button",function(){var e=$("#messageListForm"),t=$(this).data("action");if("selectAll"===t)l.selectAll($('[name="delid[]"]'));else if("selectReverse"===t)l.selectReverse($('[name="delid[]"]'));else if("selectCustom"===t){var a=function(){var e=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));return e?($('[name="delid[]"]').prop("checked",!1),void $("a.thread-link").each(function(){var t=$(this),a=!0,n=!1,o=void 0;try{for(var r,i=e.split("|")[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var l=r.value;t.text().toLowerCase().includes(l.toLowerCase())&&t.parent().find('[name="delid[]"]').prop("checked",!0)}}catch(e){n=!0,o=e}finally{try{!a&&i.return&&i.return()}finally{if(n)throw o}}})):{v:void 0}}();if("object"===("undefined"==typeof a?"undefined":r(a)))return a.v}else if("download"===t){var n=$('[name="delid[]"]:checked');n.length>0&&confirm("是否下载这"+n.length+"项？")&&(e.attr("action","/message.php").find('[name="action"]').val("down"),e.submit())}else if("delete"===t){var o=$('[name="delid[]"]:checked');o.length>0&&confirm("是否删除这"+o.length+"项？")&&(e.attr("action",l.makeUrl("message/job")).find('[name="action"]').val("del"),e.submit())}})},a.validateRegisterField=function(){$(document).on("change","input[name]",function(){var e=$(this),t=e.attr("name"),a=e.val();return a?void("regemail"===t?(l.showValidationMsg(e,"wait","检查中，请稍等&hellip;"),$.post(l.makeUrl("register/check"),"username="+a,function(t){var a=t.type,n=t.msg,o=t.username;e.val()===o&&l.showValidationMsg(e,a,n)}).fail(function(){l.showValidationMsg(e,"error","响应失败")})):"regpwd"===t?a.length>16||a.length<6?l.showValidationMsg(e,"error","密码长度不正确"):(l.showValidationMsg(e,"clear"),$('[name="regpwdrepeat"]').trigger("change")):"regpwdrepeat"===t&&(a!==$('[name="regpwd"]').val()?l.showValidationMsg(e,"error","两次输入的密码不相符"):l.showValidationMsg(e,"clear"))):void l.showValidationMsg(e,"clear")}),$("#registerForm").submit(function(){if($(this).find(".has-danger").length>0)return alert("请正确填写表单"),!1})}},{"./config":2,"./const":3,"./util":9}],6:[function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Object.defineProperty(a,"__esModule",{value:!0}),a.addSmileCode=a.handleAttachBtns=a.checkPostForm=a.handleEditorBtns=void 0;var o=e("./util"),r=n(o);a.handleEditorBtns=function(){var e=$("#postContent").get(0);$(document).on("click",".editor-btn-group button[data-action]",function(){var t=$(this).data("action"),a="",n=null;switch(t){case"link":a=prompt("请输入链接URL：","http://");break;case"img":a=prompt("请输入图片URL：","http://");break;case"sell":a=prompt("请输入出售金额：",1);break;case"hide":a=prompt("请输入神秘等级：",1);break;case"audio":a=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐或虾米的单曲地址，将自动转换为外链地址）","http://"),n=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(a),n&&(a="http://music.miaola.info/163/"+n[1]+".mp3"),n=/^https?:\/\/www\.xiami\.com\/song\/(\d+)/i.exec(a),n&&(a="http://music.miaola.info/xiami/"+n[1]+".mp3");break;case"video":a=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://"),n=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(a),n&&(a="http://video.miaola.info/youtube/"+n[1]),n=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(a),n&&(a="http://video.miaola.info/youtube/"+n[1])}if(null!==a){var o="",i="";switch(t){case"link":o=r.getSelText(e),i="[url="+a+"]"+o+"[/url]";break;case"img":i="[img]"+a+"[/img]";break;case"quote":o=r.getSelText(e),i="[quote]"+o+"[/quote]";break;case"code":o=r.getSelText(e),i="[code]"+o+"[/code]";break;case"sell":o=r.getSelText(e),i="[sell="+a+"]"+o+"[/sell]";break;case"hide":o=r.getSelText(e),i="[hide="+a+"]"+o+"[/hide]";break;case"bold":o=r.getSelText(e),i="[b]"+o+"[/b]";break;case"italic":o=r.getSelText(e),i="[i]"+o+"[/i]";break;case"underline":o=r.getSelText(e),i="[u]"+o+"[/u]";break;case"strike":o=r.getSelText(e),i="[strike]"+o+"[/strike]";break;case"super":o=r.getSelText(e),i="[sup]"+o+"[/sup]";break;case"sub":o=r.getSelText(e),i="[sub]"+o+"[/sub]";break;case"horizontal":i="[hr]";break;case"align-left":o=r.getSelText(e),i="[align=left]"+o+"[/align]";break;case"align-center":o=r.getSelText(e),i="[align=center]"+o+"[/align]";break;case"align-right":o=r.getSelText(e),i="[align=right]"+o+"[/align]";break;case"fly":o=r.getSelText(e),i="[fly]"+o+"[/fly]";break;case"audio":i="[audio]"+a+"[/audio]";break;case"video":i="[video]"+a+"[/video]"}i&&(r.addCode(e,i,o),e.focus())}}),$("#fontSizeDropdownMenu").on("click","a",function(t){t.preventDefault();var a=$(this).data("size"),n=r.getSelText(e),o="[size="+a+"]"+n+"[/size]";r.addCode(e,o,n),e.focus()}),$("#colorDropdownMenu, #bgColorDropdownMenu").on("click","span",function(){var t=$(this),a=t.parent().is("#bgColorDropdownMenu")?"backcolor":"color",n=t.data("color"),o=r.getSelText(e),i="["+a+"="+n+"]"+o+"[/"+a+"]";r.addCode(e,i,o),e.focus()})},a.checkPostForm=function(){$("#postForm").submit(function(){var e=$("#postType");if(e.length>0&&!e.val())return alert("没有选择主题分类"),e.focus(),!1;var t=$("#postTitle");if(t.length>0){var a=r.getStrByteLen(t.val());if(!a)return alert("标题不能为空"),t.focus(),!1;if(a>100)return alert("标题超过最大长度 100 个字节"),t.focus(),!1}var n=$("#voteItemContent");if(n.length>0&&!n.val().trim())return alert("投票选项不能为空"),n.focus(),!1;var o=$("#postContent");if(o.length>0){var i=r.getStrByteLen(o.val().trim());if(i<12)return alert("文章内容少于 12 个字节"),o.focus(),!1;if(i>5e4)return alert("文章内容大于 50000 个字节"),o.focus(),!1}var l=$("#postGjc");return l.length>0&&"new"===pageInfo.action&&!l.val().trim()?(alert("请在内容文本框的下方填写关键词，以方便搜索，也可以在标题中选择任意一个词填入"),l.focus(),!1):void 0})},a.handleAttachBtns=function(){$(document).on("click",".attach-area a[data-action]",function(e){e.preventDefault();var t=$(this),a=t.closest(".attach-area"),n=t.data("action"),o=a.data("id");if(o)if("insert"===n){var i=t.data("type"),l=$("#postContent").get(0),c="["+("new"===i?"upload":"attachment")+"="+o+"]";r.addCode(l,c),l.focus()}else"update"===n?(a.find(".attach-info").prop("hidden",!0).after('<label><input name="replace_'+o+'" type="file" aria-label="选择附件"></label>'),t.data("action","cancel").text("取消").blur(),$(document).data("attachUpdateAlert")||(alert("本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果"),$(document).data("attachUpdateAlert",!0))):"cancel"===n?(a.find(".attach-info").prop("hidden",!1).next("label").remove(),t.data("action","update").text("更新").blur()):"delete"===n&&a.remove()}),$(document).on("change",'[type="file"]',function(){var e=$(this),t=/\.(\w+)$/.exec(e.val());if(!t||!["jpg","gif","png","torrent"].includes(t[1].toLowerCase()))return void alert("附件类型不匹配");var a=e.data("type");if("new"===a){e.removeData("type").parent().next().prop("hidden",!1);var n=$("#newAttachArea"),o=n.find('[type="file"]').length;if(o>=5)return;var r=n.find('[type="file"]:last').closest(".attach-area"),i=parseInt(r.data("id"));if(!i)return;i++,$('\n<div class="form-group row font-size-sm attach-area" data-id="'+i+'">\n  <div class="col-xs-12 col-form-label">\n    <label>\n      <input name="attachment_'+i+'" data-type="new" type="file" aria-label="选择附件">\n    </label>\n    <span hidden>\n      <a data-action="insert" data-type="new" href="#">插入</a>&nbsp;\n      <a data-action="delete" href="#">删除</a>\n    </span>\n  </div>\n  <div class="col-xs-4">\n    <label class="sr-only" for="atc_downrvrc'+i+'">神秘系数</label>\n    <input class="form-control form-control-sm" id="atc_downrvrc'+i+'" name="atc_downrvrc'+i+'" data-toggle="tooltip" \ntype="number" value="0" min="0" title="神秘系数" placeholder="神秘系数">\n  </div>\n  <div class="col-xs-8">\n    <label class="sr-only" for="atc_desc'+i+'">描述</label>\n    <input class="form-control form-control-sm" id="atc_desc'+i+'" name="atc_desc'+i+'" data-toggle="tooltip" type="text" \ntitle="描述" placeholder="描述">\n  </div>\n</div>\n').insertAfter(r).find('[data-toggle="tooltip"]').tooltip({container:"body"})}})},a.addSmileCode=function(e){$(".smile-panel").on("click","img",function(){$(".smile-panel").addClass("open");var t=e.get(0);if(t){var a="[s:"+$(this).data("id")+"]";r.addCode(t,a,""),t.blur()}}).parent().on("shown.bs.dropdown",function(){$(".smile-panel img").each(function(){var e=$(this);e.attr("src")||e.attr("src",e.data("src"))})}).on("hide.bs.dropdown",function(e){var t=$(e.relatedTarget);return t.data("open")?e.preventDefault():void t.removeData("open")}),$("#smileDropdownBtn").click(function(){var e=$(this);e.data("open",!e.data("open"))})}},{"./util":9}],7:[function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Object.defineProperty(a,"__esModule",{value:!0}),a.bindFastSubmitShortcutKey=a.handlePageNav=a.handleForumPanel=a.handleSearchDialog=a.handleRollToTopOrBottomBtn=a.handleMainMenu=void 0;var o=e("./util"),r=n(o),i=e("./config");a.handleMainMenu=function(){$("#mainMenuTogglerBtn").click(function(){$("#mainMenu").css("max-height",document.documentElement.clientHeight-49+"px")})},a.handleRollToTopOrBottomBtn=function(){$(window).scroll(function(){var e=$("#rollToTopOrBottom");if($(window).scrollTop()>640){if("top"===e.data("direction"))return;e.data("direction","top").attr("aria-label","滚动到页顶").find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up")}else{if("bottom"===e.data("direction"))return;e.data("direction","bottom").attr("aria-label","滚动到页底").find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down")}}),$("#rollToTopOrBottom").click(function(){var e="bottom"===$(this).data("direction")?$("body").height():0;$("body, html").animate({scrollTop:e})})},a.handleSearchDialog=function(){var e=$("#searchDialog");e.on("shown.bs.modal",function(){$("#searchKeyword").select().focus()}).find("form").submit(function(){var e=$(this),t=e.find("#searchKeyword"),a=e.find("#searchType").val(),n=$.trim(t.val());"gjc"===a?e.attr("action",r.makeUrl("gjc/"+n)):"username"===a?e.attr("action",r.makeUrl("user/username/"+n)):(e.attr("action",r.makeUrl("search")),t.attr("name","author"===a?"pwuser":"keyword"),"title"===a&&n.length&&r.getStrByteLen(n)<=2&&!function(){var a=e.find('[name="method"]');a.val("OR"),t.val(n+" "+Math.floor((new Date).getTime()/1e3)),setTimeout(function(){t.val(n),a.val("AND")},200)}())}),e.find('[name="searchRange"]').on("click",function(){var t="all";"current"===$(this).val()&&(t=pageInfo.fid),e.find('[name="f_fid"]').val(t)});var t=e.find('[name="searchRange"][value="current"]');e.find("#searchType").change(function(){var e=$(this).val();t.data("enabled")&&t.prop("disabled","gjc"===e||"username"===e)}),"threadPage"!==pageId&&"readPage"!==pageId||t.prop("disabled",!1).data("enabled",!0).click()},a.handleForumPanel=function(){Config.activeForumPanel1&&$('a[data-toggle="tab"][href="'+Config.activeForumPanel1+'"]').tab("show"),Config.activeForumPanel2&&$('a[data-toggle="tab"][href="'+Config.activeForumPanel2+'"]').tab("show"),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(e){var t=$(e.target),a=t.attr("href");if(a.includes("ForumPanel")){var n="";"#galgameForumPanel"===a||"#resourceForumPanel"===a?n="activeForumPanel1":"#discussForumPanel"!==a&&"#acgForumPanel"!==a||(n="activeForumPanel2"),n&&Config[n]!==a&&((0,i.read)(),Config[n]=a,(0,i.write)())}})},a.handlePageNav=function(e){$(document).on("click",".page-item.active > .page-link",function(t){if(t.preventDefault(),!(pageInfo.maxPageNum&&pageInfo.maxPageNum<=1)){var a=parseInt(prompt("要跳转到第几页？"+(pageInfo.maxPageNum?"（共"+pageInfo.maxPageNum+"页）":""),pageInfo.currentPageNum));a&&a>0&&(location.href=r.makeUrl(e,"page="+a,!0))}})},a.bindFastSubmitShortcutKey=function(e){e.keydown(function(e){13===e.keyCode&&e.ctrlKey&&$(this).closest("form").submit()})}},{"./config":2,"./util":9}],8:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}Object.defineProperty(a,"__esModule",{value:!0}),a.handleClearMultiQuoteDataBtn=a.bindMultiQuoteCheckClick=a.copyCode=a.tuiThread=a.fastGotoFloor=a.handleFloorImage=a.copyBuyThreadList=a.handleBuyThreadBtn=a.handleBlockFloorBtn=a.handleFastReplyBtn=a.showFloorLink=void 0;var i=e("./util"),l=o(i),c=e("./const"),d=n(c),u=e("./config"),s=(a.showFloorLink=function(){$(document).on("click",".floor-num",function(e){e.preventDefault(),prompt("本楼的跳转链接：",l.getHostNameUrl()+$(this).attr("href"))})},a.handleFastReplyBtn=function(){$(document).on("click",".fast-reply-btn",function(e){e.preventDefault();var t=$(this).closest("article"),a=t.data("floor"),n=t.data("username");$("#postGjc").val(n);var o=$("#postContent").get(0);o.value="[quote]回 "+a+"楼("+n+") 的帖子[/quote]\n",o.selectionStart=o.value.length,o.selectionEnd=o.value.length,o.focus()})},a.handleBlockFloorBtn=function(){$(document).on("click",".block-floor",function(){return confirm("确认要屏蔽该回帖？本操作不可恢复！（屏蔽后该回帖将对大家不可见）")})},a.handleBuyThreadBtn=function(){$(document).on("click",".buy-thread-btn",function(e){e.preventDefault();var t=$(this),a=t.data("pid"),n=t.data("price");n>5&&!confirm("此贴售价"+n+"KFB，是否购买？")||(location.href=l.makeUrl("job/buytopic","tid="+pageInfo.tid+"&pid="+a+"&verify="+pageInfo.verify))})},a.copyBuyThreadList=function(){$(document).on("change",".buy-thread-list",function(){var e=$(this);if("copyList"===e.val()){var t=e.find("option").map(function(e){var t=$(this).text();return 0===e||1===e||t==="-".repeat(11)?null:t}).get().join("\n");if(!t)return alert("暂时无人购买"),void(e.get(0).selectedIndex=0);$("#buyThreadListContent").val(t),$("#buyThreadListDialog").modal("show"),e.get(0).selectedIndex=0}}),$("#buyThreadListDialog").on("shown.bs.modal",function(){$("#buyThreadListContent").select().focus()})},a.handleFloorImage=function(){$(document).on("click",".img",function(){var e=$(this);e.parent().is("a")||this.naturalWidth<=e.closest(".read-content").width()||(location.href=e.attr("src"))})},a.fastGotoFloor=function(){if($(".fast-goto-floor").click(function(e){if(e.preventDefault(),!Config.perPageFloorNum){var t=parseInt(prompt("你的论坛设置里“文章列表每页个数”为多少（10、20、30）？\n注：如修改了论坛中的此项设置，请访问账号设置页面即可自动同步本地设置",10));if(![10,20,30].includes(t))return;Config.perPageFloorNum=t,(0,u.write)()}var a=parseInt(prompt("你要跳转到哪一层楼？"));!a||a<=0||(location.href=l.makeUrl("read/index","tid="+pageInfo.tid+"&page="+(Math.floor(a/Config.perPageFloorNum)+1)+"&floor="+a))}),pageInfo.floor&&pageInfo.floor>0){var e=$('article[data-floor="'+pageInfo.floor+'"]').prev("a").attr("name");e&&(location.hash="#"+e)}},a.tuiThread=function(){$(".tui-btn").click(function(e){e.preventDefault();var t=$(this);t.data("wait")||(t.data("wait",!0),$.ajax({type:"POST",url:"/diy_read_tui.php",data:"tid="+pageInfo.tid+"&safeid="+pageInfo.safeId,success:function(e){var a=/<span.+?\+\d+!<\/span>\s*(\d+)/i.exec(e);a?!function(){var e=t.find("span:first");e.text("+1"),setTimeout(function(){e.text(a[1])},1e3)}():/已推过/.test(e)?alert("已推过"):alert("操作失败")},error:function(){alert("操作失败")},complete:function(){t.removeData("wait")}}))})},a.copyCode=function(){$(document).on("click",".copy-code",function(e){e.preventDefault();var t=$(this),a=t.data("code");if(a)t.text("复制代码").removeData("code"),t.next("textarea").remove(),t.after('<pre class="pre-scrollable">'+a+"</pre>");else{var n=t.next("pre"),o=n.html();t.text("还原代码").data("code",o),o=l.decodeHtmlSpecialChar(o);var r=n.height();r<50&&(r=50),r>340&&(r=340),n.remove(),$('<textarea class="form-control code-textarea" style="height: '+r+'px" wrap="off">'+o+"</textarea>").insertAfter(t).select().focus()}})},function(){var e=[];return $(".multi-quote-check:checked").each(function(){var t=$(this).closest("article");e.push({floor:t.data("floor"),pid:t.data("pid"),userName:t.data("username")})}),e}),f=(a.bindMultiQuoteCheckClick=function(){$(document).on("click",".multi-quote-check",function(){var e=localStorage[d.default.multiQuoteStorageName];if(e)try{e=JSON.parse(e),!e||"object"!==$.type(e)||$.isEmptyObject(e)?e=null:"tid"in e&&e.tid===pageInfo.tid&&"object"===$.type(e.quoteList)||(e=null)}catch(t){e=null}else e=null;var t=s();e||(localStorage.removeItem(d.default.multiQuoteStorageName),e={tid:pageInfo.tid,quoteList:{}}),t.length>0?e.quoteList[pageInfo.currentPageNum]=t:delete e.quoteList[pageInfo.currentPageNum],localStorage[d.default.multiQuoteStorageName]=JSON.stringify(e)}),$(".multi-reply-btn").click(function(e){e.preventDefault(),f(1)})},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=localStorage[d.default.multiQuoteStorageName];if(t){try{t=JSON.parse(t)}catch(e){return}if(t&&"object"===$.type(t)&&!$.isEmptyObject(t)){var a=t,n=a.tid,o=a.quoteList;if(pageInfo.tid&&n===pageInfo.tid&&"object"===$.type(o)&&(2!==e||pageInfo.fid)){var i=[],l=!0,c=!1,u=void 0;try{for(var s,f=Object.values(o)[Symbol.iterator]();!(l=(s=f.next()).done);l=!0){var g=s.value;if("array"===$.type(g)){var p=!0,m=!1,h=void 0;try{for(var v,y=g[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var b=v.value;i.push(b)}}catch(e){m=!0,h=e}finally{try{!p&&y.return&&y.return()}finally{if(m)throw h}}}}}catch(e){c=!0,u=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw u}}if(!i.length)return void localStorage.removeItem(d.default.multiQuoteStorageName);var k=new Set,C="",w=!0,S=!1,P=void 0;try{for(var I,x=i[Symbol.iterator]();!(w=(I=x.next()).done);w=!0){var T=I.value;"floor"in T&&"pid"in T&&(k.add(T.userName),2===e||(C+="[quote]回 "+T.floor+"楼("+T.userName+") 的帖子[/quote]\n"))}}catch(e){S=!0,P=e}finally{try{!w&&x.return&&x.return()}finally{if(S)throw P}}$('input[name="diy_guanjianci"]').val([].concat(r(k)).join(",")),$("#postForm").submit(function(){localStorage.removeItem(d.default.multiQuoteStorageName)}),1===e&&$("#postContent").val(C).focus()}}}});a.handleClearMultiQuoteDataBtn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;$(".clear-multi-quote-data-btn").click(function(t){t.preventDefault(),localStorage.removeItem(d.default.multiQuoteStorageName),$('[name="diy_guanjianci"]').val(""),2===e?$("#textarea").val(""):$("#postContent").val(""),alert("多重引用数据已被清除")})}},{"./config":2,"./const":3,"./util":9}],9:[function(e,t,a){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function e(e,t){var a=[],n=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=(a.setCookie=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pageInfo.cookiePrefix;document.cookie=""+n+e+"="+encodeURI(t)+(a?";expires="+a.toUTCString():"")+";path=/;"},a.getCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pageInfo.cookiePrefix,a=new RegExp("(^| )"+t+e+"=([^;]*)(;|$)"),n=document.cookie.match(a);return n?decodeURI(n[2]):null},a.deleteCookie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pageInfo.cookiePrefix;document.cookie=""+t+e+"=;expires="+r("-1d").toUTCString()+";path=/;"},a.getDate=function(e){var t=new Date,a=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!a)return null;var n="undefined"==typeof a[1]?0:"+"===a[1]?1:-1,o=n===-1?-parseInt(a[2]):parseInt(a[2]),r=a[3];
switch(r){case"Y":t.setFullYear(o);break;case"y":t.setFullYear(0===n?o:t.getFullYear()+o);break;case"M":t.setMonth(0===n?o:t.getMonth()+o);break;case"d":t.setDate(0===n?o:t.getDate()+o);break;case"h":t.setHours(0===n?o:t.getHours()+o);break;case"m":t.setMinutes(0===n?o:t.getMinutes()+o);break;case"s":t.setSeconds(0===n?o:t.getSeconds()+o);break;case"ms":t.setMilliseconds(0===n?o:t.getMilliseconds()+o);break;default:return null}return t}),i=(a.getStrByteLen=function(e){for(var t=0,a=e.includes("\n")?e.replace(/\r?\n/g,"_").length:e.length,n=2,o=0;o<a;o++)t+=e.charCodeAt(o)<0||e.charCodeAt(o)>255?n:1;return t},a.getHostNameUrl=function(){return location.protocol+"//"+location.host},a.addCode=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=""===a?t.indexOf("]")+1:t.indexOf(a);if("undefined"!=typeof e.selectionStart){var o=e.selectionStart;e.value=e.value.substr(0,o)+t+e.value.substr(e.selectionEnd),e.selectionStart=o+n,e.selectionEnd=o+n+a.length}else e.value+=t},a.getSelText=function(e){return e.value.substr(e.selectionStart,e.selectionEnd-e.selectionStart)},a.extractQueryStr=function(e){var t=new Map,a=!0,n=!1,o=void 0;try{for(var r,i=e.split("&")[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var l=r.value;if(l){var c=l.split("=");t.set(c[0],void 0!==c[1]?c[1]:"")}}}catch(e){n=!0,o=e}finally{try{!a&&i.return&&i.return()}finally{if(n)throw o}}return t}),l=a.buildQueryStr=function(e){var t="",a=!0,n=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var c=o(i.value,2),d=c[0],u=c[1];t+="/"+d+"/"+u}}catch(e){n=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw r}}return t},c=(a.makeUrl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o="",r=i(t);a&&(r=new Map([].concat(n(i(pageInfo.urlParam).entries()),n(r.entries())))),o=location.pathname.startsWith(pageInfo.baseFile)?pageInfo.baseFile:pageInfo.rootPath.substr(0,pageInfo.rootPath.length-1);var c="";return r.size>0&&(c=l(r)),o+=2===pageInfo.urlType?"?s=/"+e+c:"/"+e+c},a.decodeHtmlSpecialChar=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},a.selectAll=function(e){e.prop("checked",!0)},a.selectReverse=function(e){e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))})},a.showValidationMsg=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"error"===t&&(t="danger"),e.removeClass("form-control-success form-control-warning form-control-danger");var n=e.parent();n.removeClass("has-success has-warning has-danger"),$.inArray(t,["success","warning","danger"]>-1)&&e.addClass("form-control-"+t).parent().addClass("has-"+t);var o=n.find(".form-control-feedback");"wait"===t?o.html('<span class="text-muted"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+a+"</span>"):o.text(a)},a.getDifferenceSetOfObject=function(e,t){var a={};return"object"!==$.type(e)||"object"!==$.type(t)?a:($.each(t,function(t,n){t in e&&(c(e[t],n)||(a[t]=n))}),a)},a.deepEqual=function e(t,a){if(t===a)return!0;if($.type(t)!==$.type(a))return!1;if("number"==typeof t&&"number"==typeof a&&isNaN(t)&&isNaN(a))return!0;if($.isArray(t)&&$.isArray(a)||"object"===$.type(t)&&"object"===$.type(a)){if(t.length!==a.length)return!1;var n=$.extend($.isArray(t)?[]:{},t,a);return $.each(n,function(n){return"undefined"!=typeof t[n]&&"undefined"!=typeof a[n]&&(!!e(t[n],a[n])&&void 0)}),!0}return!1})},{}]},{},[1]);
//# sourceMappingURL=app.min.js.map

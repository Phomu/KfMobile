{"version":3,"sources":["/public/static/dist/js/node_modules/.6.0.2@browser-pack/_prelude.js","/public/static/dist/js/public/static/src/js/app.js","/public/static/dist/js/public/static/src/js/module/Config.js","/public/static/dist/js/public/static/src/js/module/Const.js","/public/static/dist/js/public/static/src/js/module/Dialog.js","/public/static/dist/js/public/static/src/js/module/Index.js","/public/static/dist/js/public/static/src/js/module/Msg.js","/public/static/dist/js/public/static/src/js/module/Other.js","/public/static/dist/js/public/static/src/js/module/Post.js","/public/static/dist/js/public/static/src/js/module/Public.js","/public/static/dist/js/public/static/src/js/module/Read.js","/public/static/dist/js/public/static/src/js/module/Util.js","/public/static/dist/js/public/static/src/js/module/config.js","/public/static/dist/js/public/static/src/js/module/configDialog.js","/public/static/dist/js/public/static/src/js/module/const.js","/public/static/dist/js/public/static/src/js/module/dialog.js","/public/static/dist/js/public/static/src/js/module/index.js","/public/static/dist/js/public/static/src/js/module/msg.js","/public/static/dist/js/public/static/src/js/module/other.js","/public/static/dist/js/public/static/src/js/module/post.js","/public/static/dist/js/public/static/src/js/module/public.js","/public/static/dist/js/public/static/src/js/module/read.js","/public/static/dist/js/public/static/src/js/module/util.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_Config","_util","_const","_msg","_dialog","_public","Public","_index","Index","_read","Read","_post","Post","_other","Other","_configDialog","window","pageId","$","attr","exportModule","Util","Const","default","Msg","Dialog","Conf","readConfig","read","writeConfig","write","ex","console","log","init","startTime","Date","validateRegisterField","Config","customCssEnabled","customCssContent","append","preventCloseWindow","handleMainMenu","handleMainMenuLink","showSidebarBtnGroupEnabled","showSidebarBtnGroup","handleSidebarRollBtn","handleSearchDialog","fillCommonForumPanel","showEditCommonForumDialog","handlePageInput","handleAtTipsBtn","handleIndexThreadPanel","handleSelectBgImage","handleSelectBgColor","handleCustomBgStyle","gotoFloor","threadContentFontSize","handleFastGotoFloorBtn","handleTuiThreadBtn","handleCopyFloorLinkBtn","handleFastReplyBtn","handleBlockFloorBtn","handleBuyThreadBtn","copyBuyThreadList","handleFloorImage","checkPostForm","bindFastSubmitShortcutKey","handleCopyCodeBtn","addSmileCode","bindMultiQuoteCheckClick","handleClearMultiQuoteDataBtn","click","handleMultiQuote","userMemoEnabled","addUserMemo","handleEditorBtns","handleAttachBtns","Info","multiQuote","highlightUnReadAtTipsMsg","handleUserPageBtns","handleGameIntroSearchArea","tuiGameIntro","bindFavorPageBtnsClick","bindFriendPageBtnsClick","syncPerPageFloorNum","assignBirthdayField","handleUploadAvatarFileBtn","transferKfbAlert","bindMessageActionBtnsClick","blockUserEnabled","blockUsers","blockThreadEnabled","blockThread","followUserEnabled","followUsers","kfSmileEnhanceExtensionEnabled","includes","resTimestamp","tooltip","container","document","ready","name","activeNewReplyPanel","activeTopRecommendPanel","commonForumList","showSidebarRollBtnEnabled","showSidebarMainMenuBtnEnabled","showSidebarForumListBtnEnabled","showSidebarSearchBtnEnabled","showSidebarHomePageBtnEnabled","perPageFloorNum","userMemoList","defShowMsgDuration","followUserList","highlightFollowUserThreadInHPEnabled","highlightFollowUserThreadLinkEnabled","blockUserDefaultType","blockUserAtTipsEnabled","blockUserForumType","blockUserFidList","blockUserList","blockThreadDefForumType","blockThreadDefFidList","blockThreadList","extend","options","localStorage","JSON","parse","type","isEmptyObject","normalize","getDifferenceSetOfObject","stringify","clear","removeItem","settings","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Object","entries","Symbol","iterator","next","done","_step$value","_slicedToArray","value","key","err","return","multiQuoteStorageName","atTipsTimeCookieName","prevAtTipsTimeCookieName","bgStyleCookieName","fid","availableForumList","resize","create","id","title","bodyContent","footerContent","arguments","html","$dialog","appendTo","on","close","keydown","keyCode","find","$this","this","checked","prop","isOpera","isEdge","closest","not","end","data","each","is","removeClass","addClass","$focus","show","triggerHandler","fadeIn","focus","css","height","outerHeight","fadeOut","parent","remove","off","_config","time","cookieValue","getCookie","_const2","setCookie","currentDate","getDate","tab","$target","target","targetPanel","typeName","fileName","path","confirm","alert","color","parseInt","prompt","$bg","trim","location","reload","test","toLowerCase","replace","duration","msg","clickable","preventable","$container","isFirst","destroy","$msg","preventDefault","text","hide","stopPropagation","slideDown","setTimeout","wait","slideUp","gjc","userName","timeString","prevString","index","curString","deleteCookie","val","keyword","searchType","cookieName","url","makeUrl","ajax","success","$num","num","error","complete","removeData","dataType","$form","submit","action","selectAll","selectInverse","$checked","change","matches","exec","year","month","day","syncConfig","isNaN","transferKfb","fixedDeposit","currentDeposit","_ret","split","v","_typeof","_$checked","showValidationMsg","post","_ref","username","fail","trigger","$area","str","userList","inFollowOrBlockUserList","splice","push","textArea","get","_matches","selText","getSelText","addCode","size","codeType","$postType","$postTitle","getStrByteLen","$voteItemContent","$postContent","_length","$postGjc","after","blur","$newAttachArea","totalNum","$lastAttachArea","insertAfter","$node","$relatedTarget","relatedTarget","_data","tid","quoteList","list","values","_data2","Array","isArray","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","quote","keywords","Set","content","clearQueue","floor","pid","add","queue","getTime","postContent","$countdownNum","dequeue","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_step2$value","concat","_toConsumableArray","join","ConfigDialog","maxHeight","documentElement","clientHeight","scroll","$btn","scrollTop","animate","$searchDialog","select","$searchKeyword","$method","Math","$current","$currentBox","disabled","maxPageNum","excludeParams","currentPageNum","href","ctrlKey","dialogName","commonForumListHtml","availableForumListHtml","_loop","elem","$dragulaScriptPath","dragulaScriptPath","getScript","dragula","revertOnSpill","children","_step3$value","_step3$value$","_fid","addEventListener","returnValue","showCommonImportOrExportConfigDialog","configName","callback","callbackAfterSubmit","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","regex1","RegExp","regex2","isBlock","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","_step5$value","keyWord","includeUser","excludeUser","includeFid","excludeFid","regex","eval","$topFloor","getCheckedMultiQuoteData","link","getHostNameUrl","copyText","$article","selectionStart","selectionEnd","price","$wait","verify","map","repeat","selectedIndex","modal","naturalWidth","width","hashName","prev","hash","safeId","$pre","decodeHtmlSpecialChar","keys","date","prefix","cookiePrefix","cookie","encodeURI","toUTCString","match","decodeURI","flag","increment","unit","setFullYear","getFullYear","setMonth","getMonth","setDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","setMilliseconds","getMilliseconds","extractQueryStr","len","cLen","charCodeAt","protocol","host","startPos","indexOf","prePos","substring","params","Map","param","_param$split","_param$split2","set","buildQueryStr","queryStr","urlType","deepEqual","includeOtherParam","paramList","urlParam","delete","startsWith","pathname","baseFile","rootPath","getQueryParam","$nodes","$parent","inArray","$feedback","b","c","$source","getSelection","selectAllChildren","result","execCommand","removeAllRanges","findIndex","opera","navigator","appVersion","getMainConfigValue","hasClass","showUserMemoDialog","showCustomCssDialog","showFollowUserDialog","showBlockUserDialog","showBlockThreadDialog","showImportOrExportSettingDialog","setMainConfigValue","Boolean","$userMemoList","line","_line$split","_line$split2","user","_line$split2$","memo","$content","$followUserList","addFollowUser","$addUser","$blockUserList","addBlockUser","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","$blockThreadList","addBlockThread","userType","fidType","fidList","$txtKeyWord","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","newObj","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11"],"mappings":"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","file":"app.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\r\nimport {init as initConfig} from './module/Config';\r\nimport * as Util from './module/util';\r\nimport Const from './module/const';\r\nimport * as Msg from './module/msg';\r\nimport * as Dialog from './module/dialog';\r\nimport * as Public from './module/public';\r\nimport * as Index from './module/index';\r\nimport * as Read from './module/read';\r\nimport * as Post from './module/post';\r\nimport * as Other from './module/other';\r\nimport * as ConfigDialog from './module/configDialog';\r\n\r\n// 页面ID\r\nwindow.pageId = $('body').attr('id');\r\n\r\n/**\r\n * 导出模块\r\n */\r\nconst exportModule = function () {\r\n    try {\r\n        window.Util = require('./module/Util');\r\n        window.Const = require('./module/Const').default;\r\n        window.Msg = require('./module/Msg');\r\n        window.Dialog = require('./module/Dialog');\r\n        window.Public = require('./module/Public');\r\n        window.Index = require('./module/Index');\r\n        window.Read = require('./module/Read');\r\n        window.Post = require('./module/Post');\r\n        window.Other = require('./module/Other');\r\n        const Conf = require('./module/Config');\r\n        window.readConfig = Conf.read;\r\n        window.writeConfig = Conf.write;\r\n    }\r\n    catch (ex) {\r\n        console.log(ex);\r\n    }\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\nconst init = function () {\r\n    if (pageId === 'loginPage') return;\r\n    let startTime = new Date();\r\n    exportModule();\r\n    if (pageId === 'registerPage') {\r\n        Other.validateRegisterField();\r\n        return;\r\n    }\r\n    initConfig();\r\n\r\n    if (Config.customCssEnabled && Config.customCssContent) $('head').append(`<style>${Config.customCssContent}</style>`);\r\n    Public.preventCloseWindow();\r\n    Public.handleMainMenu();\r\n    Public.handleMainMenuLink();\r\n    if (Config.showSidebarBtnGroupEnabled) Public.showSidebarBtnGroup();\r\n    Public.handleSidebarRollBtn();\r\n    Public.handleSearchDialog();\r\n    Public.fillCommonForumPanel();\r\n    Public.showEditCommonForumDialog();\r\n    if ($('.page-input').length > 0) {\r\n        Public.handlePageInput();\r\n    }\r\n    if (pageId === 'indexPage') {\r\n        Index.handleAtTipsBtn();\r\n        Index.handleIndexThreadPanel();\r\n        Index.handleSelectBgImage();\r\n        Index.handleSelectBgColor();\r\n        Index.handleCustomBgStyle();\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        Read.gotoFloor();\r\n        if (Config.threadContentFontSize > 0)\r\n            $('head').append(`<style>.read-content { font-size: ${Config.threadContentFontSize}px; }</style>`);\r\n        Read.handleFastGotoFloorBtn();\r\n        Read.handleTuiThreadBtn();\r\n        Read.handleCopyFloorLinkBtn();\r\n        Read.handleFastReplyBtn();\r\n        Read.handleBlockFloorBtn();\r\n        Read.handleBuyThreadBtn();\r\n        Read.copyBuyThreadList();\r\n        Read.handleFloorImage();\r\n        Post.checkPostForm();\r\n        Public.bindFastSubmitShortcutKey($('#postContent'));\r\n        Read.handleCopyCodeBtn();\r\n        Post.addSmileCode($('#postContent'));\r\n        Read.bindMultiQuoteCheckClick();\r\n        Post.handleClearMultiQuoteDataBtn();\r\n        $('.multi-reply-btn').click(() => Post.handleMultiQuote(1));\r\n        if (Config.userMemoEnabled) Read.addUserMemo();\r\n    }\r\n    else if (pageId === 'postPage') {\r\n        Post.checkPostForm();\r\n        Public.bindFastSubmitShortcutKey($('#postContent'));\r\n        Post.handleEditorBtns();\r\n        Post.addSmileCode($('#postContent'));\r\n        Post.handleAttachBtns();\r\n        Post.handleClearMultiQuoteDataBtn();\r\n        if (Info.multiQuote) Post.handleMultiQuote(2);\r\n    }\r\n    else if (pageId === 'gjcPage') {\r\n        Other.highlightUnReadAtTipsMsg();\r\n    }\r\n    else if (pageId === 'userPage') {\r\n        Other.handleUserPageBtns();\r\n    }\r\n    else if (pageId === 'gameIntroSearchPage') {\r\n        Other.handleGameIntroSearchArea();\r\n    }\r\n    else if (pageId === 'gameIntroPage') {\r\n        Other.tuiGameIntro('game');\r\n    }\r\n    else if (pageId === 'gameIntroCompanyPage') {\r\n        Other.tuiGameIntro('company');\r\n    }\r\n    else if (pageId === 'gameIntroTypePage') {\r\n        Other.tuiGameIntro('type');\r\n    }\r\n    else if (pageId === 'gameIntroPropertyPage') {\r\n        Other.tuiGameIntro('property');\r\n    }\r\n    else if (pageId === 'favorPage') {\r\n        Other.bindFavorPageBtnsClick();\r\n    }\r\n    else if (pageId === 'friendPage') {\r\n        Other.bindFriendPageBtnsClick();\r\n    }\r\n    else if (pageId === 'modifyPage') {\r\n        Other.syncPerPageFloorNum();\r\n        Other.assignBirthdayField();\r\n        Other.handleUploadAvatarFileBtn();\r\n    }\r\n    else if (pageId === 'bankPage') {\r\n        Other.transferKfbAlert();\r\n    }\r\n    else if (pageId === 'messagePage') {\r\n        Other.bindMessageActionBtnsClick();\r\n    }\r\n    else if (pageId === 'readMessagePage') {\r\n        Read.handleFloorImage();\r\n        Read.handleCopyCodeBtn();\r\n    }\r\n    else if (pageId === 'writeMessagePage') {\r\n        Public.bindFastSubmitShortcutKey($('#msgContent'));\r\n        Post.addSmileCode($('#msgContent'));\r\n    }\r\n    else if (pageId === 'messageBannedPage') {\r\n        Public.bindFastSubmitShortcutKey($('[name=\"banidinfo\"]'));\r\n    }\r\n    if (Config.blockUserEnabled) Public.blockUsers();\r\n    if (Config.blockThreadEnabled) Public.blockThread();\r\n    if (Config.followUserEnabled) Public.followUsers();\r\n    if (Config.kfSmileEnhanceExtensionEnabled && ['readPage', 'postPage', 'writeMessagePage'].includes(pageId)) {\r\n        $('body').append(\r\n            `<script src=\"/KfEmotion.min.user.js${Info.resTimestamp ? '?ts=' + Info.resTimestamp : ''}\"></script>`\r\n        );\r\n    }\r\n\r\n    $('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n    console.log(`脚本加载完毕，耗时：${new Date() - startTime}ms`);\r\n};\r\n\r\n$(document).ready(init);\r\n","/* 配置模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\n\r\n// 配置名称\r\nconst name = 'kf_config';\r\n\r\n/**\r\n * 配置类\r\n */\r\nexport const Config = {\r\n    // 当前激活的最新回复面板\r\n    activeNewReplyPanel: '#galgameNewReplyPanel',\r\n    // 当前激活的当前推荐面板\r\n    activeTopRecommendPanel: '#galgameTopRecommendPanel',\r\n    // 常用版块列表\r\n    commonForumList: [],\r\n\r\n    // 是否显示侧边栏按钮组，true：开启；false：关闭\r\n    showSidebarBtnGroupEnabled: true,\r\n    // 是否显示侧边栏的滚动到页顶/页底按钮，true：开启；false：关闭\r\n    showSidebarRollBtnEnabled: true,\r\n    // 是否显示侧边栏的主菜单按钮，true：开启；false：关闭\r\n    showSidebarMainMenuBtnEnabled: false,\r\n    // 是否显示侧边栏的版块列表按钮，true：开启；false：关闭\r\n    showSidebarForumListBtnEnabled: true,\r\n    // 是否显示侧边栏的搜索按钮，true：开启；false：关闭\r\n    showSidebarSearchBtnEnabled: false,\r\n    // 是否显示侧边栏的首页按钮，true：开启；false：关闭\r\n    showSidebarHomePageBtnEnabled: true,\r\n\r\n    // 主题每页楼层数量，用于电梯直达等功能，如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目\r\n    perPageFloorNum: 10,\r\n    // 主题内容字体大小，设为0表示使用默认大小，默认值：14px\r\n    threadContentFontSize: 0,\r\n    // 是否在楼层内的用户名旁显示该用户的自定义备注，true：开启；false：关闭\r\n    userMemoEnabled: false,\r\n    // 用户自定义备注列表，格式：{'用户名':'备注'}，例：{'李四':'张三的马甲','王五':'张三的另一个马甲'}\r\n    userMemoList: {},\r\n    // 是否在发帖框上显示绯月表情增强插件，true：开启；false：关闭\r\n    kfSmileEnhanceExtensionEnabled: false,\r\n\r\n    // 默认的消息显示时间（秒），设置为-1表示永久显示\r\n    defShowMsgDuration: -1,\r\n    // 是否为页面添加自定义的CSS内容，true：开启；false：关闭\r\n    customCssEnabled: false,\r\n    // 自定义CSS的内容\r\n    customCssContent: '',\r\n\r\n    // 是否开启关注用户的功能，true：开启；false：关闭\r\n    followUserEnabled: false,\r\n    // 关注用户列表，格式：[{name:'用户名'}]，例：[{name:'张三'}, {name:'李四'}]\r\n    followUserList: [],\r\n    // 是否高亮所关注用户在首页下的主题链接，true：开启；false：关闭\r\n    highlightFollowUserThreadInHPEnabled: true,\r\n    // 是否高亮所关注用户在主题列表页面下的主题链接，true：开启；false：关闭\r\n    highlightFollowUserThreadLinkEnabled: true,\r\n    // 是否开启屏蔽用户的功能，true：开启；false：关闭\r\n    blockUserEnabled: false,\r\n    // 屏蔽用户的默认屏蔽类型，0：屏蔽主题和回贴；1：仅屏蔽主题；2：仅屏蔽回贴\r\n    blockUserDefaultType: 0,\r\n    // 是否屏蔽被屏蔽用户的@提醒，true：开启；false：关闭\r\n    blockUserAtTipsEnabled: true,\r\n    // 屏蔽用户的版块屏蔽范围，0：所有版块；1：包括指定的版块；2：排除指定的版块\r\n    blockUserForumType: 0,\r\n    // 屏蔽用户的版块ID列表，例：[16, 41, 67, 57, 84, 92, 127, 68, 163, 182, 9]\r\n    blockUserFidList: [],\r\n    // 屏蔽用户列表，格式：[{name:'用户名', type:屏蔽类型}]，例：[{name:'张三', type:0}, {name:'李四', type:1}]\r\n    blockUserList: [],\r\n    // 是否开启屏蔽标题包含指定关键字的主题的功能，true：开启；false：关闭\r\n    blockThreadEnabled: false,\r\n    // 屏蔽主题的默认版块屏蔽范围，0：所有版块；1：包括指定的版块；2：排除指定的版块\r\n    blockThreadDefForumType: 0,\r\n    // 屏蔽主题的默认版块ID列表，例：[16, 41, 67, 57, 84, 92, 127, 68, 163, 182, 9]\r\n    blockThreadDefFidList: [],\r\n    // 屏蔽主题的关键字列表，格式：[{keyWord:'关键字', includeUser:['包括的用户名'], excludeUser:['排除的用户名'], includeFid:[包括指定的版块ID], excludeFid:[排除指定的版块ID]}]\r\n    // 关键字可使用普通字符串或正则表达式（正则表达式请使用'/abc/'的格式），includeUser、excludeUser、includeFid和excludeFid这三项为可选\r\n    // 例：[{keyWord: '标题1'}, {keyWord: '标题2', includeUser:['用户名1', '用户名2'], includeFid: [5, 56]}, {keyWord: '/关键字A.*关键字B/i', excludeFid: [92, 127, 68]}]\r\n    blockThreadList: [],\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\nexport const init = function () {\r\n    window.Config = $.extend(true, {}, Config);\r\n    read();\r\n};\r\n\r\n/**\r\n * 读取设置\r\n */\r\nexport const read = function () {\r\n    let options = localStorage[name];\r\n    if (!options) return;\r\n    try {\r\n        options = JSON.parse(options);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!options || $.type(options) !== 'object' || $.isEmptyObject(options)) return;\r\n    options = normalize(options);\r\n    window.Config = $.extend(true, {}, Config, options);\r\n};\r\n\r\n/**\r\n * 写入设置\r\n */\r\nexport const write = function () {\r\n    let options = Util.getDifferenceSetOfObject(Config, window.Config);\r\n    localStorage[name] = JSON.stringify(options);\r\n};\r\n\r\n/**\r\n * 清空设置\r\n */\r\nexport const clear = function () {\r\n    localStorage.removeItem(name);\r\n};\r\n\r\n/**\r\n * 获取经过规范化的Config对象\r\n * @param {{}} options 待处理的Config对象\r\n * @returns {{}} 经过规范化的Config对象\r\n */\r\nexport const normalize = function (options) {\r\n    let settings = {};\r\n    if ($.type(options) !== 'object') return settings;\r\n    for (let [key, value] of Object.entries(options)) {\r\n        if (key in Config && $.type(value) === $.type(Config[key])) {\r\n            settings[key] = value;\r\n        }\r\n    }\r\n    return settings;\r\n};\r\n","/* 常量模块 */\r\n'use strict';\r\n\r\n/**\r\n * 常量类\r\n */\r\nconst Const = {\r\n    // 存储多重引用数据的LocalStorage名称\r\n    multiQuoteStorageName: 'kf_multi_quote',\r\n    // at提醒时间的Cookie名称\r\n    atTipsTimeCookieName: 'at_tips_time',\r\n    // 上一次at提醒时间的Cookie名称\r\n    prevAtTipsTimeCookieName: 'prev_at_tips_time',\r\n    // 背景样式的Cookie名称\r\n    bgStyleCookieName: 'bg_style',\r\n    // 常用版块列表\r\n    commonForumList: [\r\n        {fid: 106, name: '新作动态'},\r\n        {fid: 41, name: '网盘下载'},\r\n        {fid: 16, name: '种子下载'},\r\n        {fid: 52, name: '游戏讨论'},\r\n        {fid: 84, name: '动漫讨论'},\r\n        {fid: 67, name: 'CG下载'},\r\n        {fid: 5, name: '自由讨论'},\r\n        {fid: 56, name: '个人日记'},\r\n        {fid: 57, name: '同人漫本'},\r\n    ],\r\n    // 可用版块列表\r\n    availableForumList: [\r\n        {fid: 106, name: '新作动态'},\r\n        {fid: 52, name: '游戏讨论'},\r\n        {fid: 16, name: '种子下载'},\r\n        {fid: 41, name: '网盘下载'},\r\n        {fid: 67, name: 'CG下载'},\r\n        {fid: 102, name: '游戏推荐'},\r\n        {fid: 24, name: '疑难互助'},\r\n        {fid: 57, name: '同人漫本'},\r\n        {fid: 84, name: '动漫讨论'},\r\n        {fid: 92, name: '动画共享'},\r\n        {fid: 127, name: '漫画小说'},\r\n        {fid: 68, name: '音乐共享'},\r\n        {fid: 163, name: 'LIVE共享'},\r\n        {fid: 182, name: '转载资源'},\r\n        {fid: 94, name: '原创绘画'},\r\n        {fid: 87, name: '宅物交流'},\r\n        {fid: 86, name: '电子产品'},\r\n        {fid: 115, name: '文字作品'},\r\n        {fid: 96, name: '图片来源'},\r\n        {fid: 36, name: '寻求资源'},\r\n        {fid: 5, name: '自由讨论'},\r\n        {fid: 56, name: '个人日记'},\r\n        {fid: 9, name: '我的关注'},\r\n        {fid: 4, name: '意见投诉'},\r\n        {fid: 93, name: '管理组区'},\r\n        {fid: 59, name: '原创组区'},\r\n        {fid: 125, name: '水楼林立'},\r\n        {fid: 181, name: '私人日记'},\r\n        {fid: 42, name: '旧期资料'},\r\n        {fid: 128, name: '作品判定'},\r\n        {fid: 98, name: '日本语版'},\r\n        {fid: 99, name: '意見箱'},\r\n        {fid: 112, name: '掲示板'},\r\n        {fid: 100, name: '創作感想'},\r\n    ],\r\n};\r\n\r\nexport default Const;\r\n","/* 对话框模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\n\r\n/**\r\n * 创建对话框\r\n * @param {string} id 对话框ID\r\n * @param {string} title 对话框标题\r\n * @param {string} bodyContent 对话框主体内容\r\n * @param {string} footerContent 对话框底部内容\r\n * @returns {jQuery} 对话框的jQuery对象\r\n */\r\nexport const create = function (id, title, bodyContent, footerContent = '') {\r\n    let html = `\r\n<form>\r\n<div class=\"dialog\" id=\"${id}\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\" aria-labelledby=\"${id}Title\">\r\n  <div class=\"container dialog-content\" role=\"document\">\r\n    <div class=\"dialog-header\">\r\n      <h5 class=\"dialog-title\" id=\"${id}Title\">${title}</h5>\r\n      <button class=\"close\" data-dismiss=\"dialog\" type=\"button\" aria-label=\"关闭\">\r\n        <span aria-hidden=\"true\">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"dialog-body\">${bodyContent}</div>\r\n    <div class=\"dialog-footer\" ${!footerContent ? 'hidden' : ''}>${footerContent}</div>\r\n  </div>\r\n</div>\r\n</form>`;\r\n    let $dialog = $(html).appendTo('body');\r\n    $dialog.on('click', '[data-dismiss=\"dialog\"]', () => close(id))\r\n        .on('click', '.tips', () => false)\r\n        .on('click', '.disabled-link', () => false)\r\n        .keydown(function (e) {\r\n            if (e.keyCode === 27) {\r\n                return close(id);\r\n            }\r\n        })\r\n        .find('legend [type=\"checkbox\"]')\r\n        .click(function () {\r\n            let $this = $(this);\r\n            let checked = $this.prop('checked');\r\n            if (Util.isOpera() || Util.isEdge())\r\n                $this.closest('fieldset').find('input, select, textarea, button').not('legend input').prop('disabled', !checked);\r\n            else $this.closest('fieldset').prop('disabled', !checked);\r\n        }).end()\r\n        .find('input[data-disabled]')\r\n        .click(function () {\r\n            let $this = $(this);\r\n            let checked = $this.prop('checked');\r\n            $($this.data('disabled')).each(function () {\r\n                let $this = $(this);\r\n                if ($this.is('a')) {\r\n                    if (checked) $this.removeClass('disabled-link');\r\n                    else $this.addClass('disabled-link');\r\n                }\r\n                else {\r\n                    $this.prop('disabled', !checked);\r\n                }\r\n            });\r\n        }).end().find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n    $(window).on('resize.' + id, function () {\r\n        let $focus = $(':focus');\r\n        if ($focus.length > 0) {\r\n            if ($focus.is('input') && !['checkbox', 'radio'].includes($focus.attr('type')) || $focus.is('textarea')) return;\r\n        }\r\n        resize(id);\r\n    });\r\n    return $dialog;\r\n};\r\n\r\n/**\r\n * 显示对话框\r\n * @param {string} id 对话框ID\r\n */\r\nexport const show = function (id) {\r\n    let $dialog = $('#' + id);\r\n    if (!$dialog.length) return;\r\n    $dialog.find('legend [type=\"checkbox\"]')\r\n        .each(function () {\r\n            $(this).triggerHandler('click');\r\n        }).end().find('input[data-disabled]')\r\n        .each(function () {\r\n            $(this).triggerHandler('click');\r\n        });\r\n    $dialog.fadeIn('normal').find('.close:first').focus();\r\n    resize(id);\r\n};\r\n\r\n/**\r\n * 调整对话框大小\r\n * @param {string} id 对话框ID\r\n */\r\nexport const resize = function (id) {\r\n    let $dialog = $('#' + id);\r\n    $dialog.find('.dialog-body')\r\n        .css('max-height', $(window).height() - $dialog.find('.dialog-header').outerHeight() - $dialog.find('.dialog-footer').outerHeight());\r\n};\r\n\r\n/**\r\n * 关闭对话框\r\n * @param {string} id 对话框ID\r\n * @returns {boolean} 返回false\r\n */\r\nexport const close = function (id) {\r\n    $('#' + id).fadeOut('normal', function () {\r\n        $(this).parent().remove();\r\n    });\r\n    $(window).off('resize.' + id);\r\n    return false;\r\n};\r\n","/* 首页模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n/**\r\n * 处理首页的@提醒按钮\r\n */\r\nexport const handleAtTipsBtn = function () {\r\n    $('#atTips').click(function () {\r\n        let $this = $(this);\r\n        let time = $this.data('time');\r\n        let cookieValue = Util.getCookie(Const.atTipsTimeCookieName);\r\n        if (!time || time === cookieValue) return;\r\n        if (!cookieValue) {\r\n            let currentDate = (new Date()).getDate();\r\n            Util.setCookie(Const.prevAtTipsTimeCookieName, (currentDate < 10 ? '0' + currentDate : currentDate) + '日00时00分');\r\n        }\r\n        else if (cookieValue !== time) {\r\n            Util.setCookie(Const.prevAtTipsTimeCookieName, cookieValue);\r\n        }\r\n        Util.setCookie(Const.atTipsTimeCookieName, time, Util.getDate('+3d'));\r\n        $this.removeClass('btn-outline-danger').addClass('btn-outline-primary');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页主题链接面板\r\n */\r\nexport const handleIndexThreadPanel = function () {\r\n    if (Config.activeNewReplyPanel) {\r\n        $(`a[data-toggle=\"tab\"][href=\"${Config.activeNewReplyPanel}\"]`).tab('show');\r\n    }\r\n    if (Config.activeTopRecommendPanel) {\r\n        $(`a[data-toggle=\"tab\"][href=\"${Config.activeTopRecommendPanel}\"]`).tab('show');\r\n    }\r\n\r\n    $(document).on('shown.bs.tab', 'a[data-toggle=\"tab\"]', function (e) {\r\n        let $target = $(e.target);\r\n        let targetPanel = $target.attr('href');\r\n        let typeName = '';\r\n        if (targetPanel.includes('NewReplyPanel')) typeName = 'activeNewReplyPanel';\r\n        else if (targetPanel.includes('TopRecommendPanel')) typeName = 'activeTopRecommendPanel';\r\n        if (typeName && Config[typeName] !== targetPanel) {\r\n            readConfig();\r\n            Config[typeName] = targetPanel;\r\n            writeConfig();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理选择页面背景图片\r\n */\r\nexport const handleSelectBgImage = function () {\r\n    $('#selectBgImage').on('click', '[data-id]', function () {\r\n        let $this = $(this);\r\n        let id = $this.data('id');\r\n        let fileName = $this.data('filename');\r\n        let path = $this.parent().data('path');\r\n        if (!id || !fileName || !path) return;\r\n        if (confirm('是否选择此背景图片？')) {\r\n            Util.setCookie(Const.bgStyleCookieName, id, Util.getDate('+1y'));\r\n            $('body, .modal-content').css('background-image', 'url(\"' + path + fileName + '\")');\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理选择页面背景颜色\r\n */\r\nexport const handleSelectBgColor = function () {\r\n    $('#selectBgImage').on('click', '[data-color]', function () {\r\n        let $this = $(this);\r\n        let color = $this.data('color');\r\n        if (!color) return;\r\n        if (confirm('是否选择此背景颜色？')) {\r\n            Util.setCookie(Const.bgStyleCookieName, color, Util.getDate('+1y'));\r\n            $('body, .modal-content').css('background', color);\r\n            alert('背景已更换');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理自定义背景样式\r\n */\r\nexport const handleCustomBgStyle = function () {\r\n    $('#customBgStyle').click(function () {\r\n        let value = Util.getCookie(Const.bgStyleCookieName);\r\n        if (!value || parseInt(value)) value = '';\r\n        value = prompt(\r\n            '请输入背景图片URL、颜色代码或CSS样式：\\n（例：http://xxx.com/abc.jpg 或 #fcfcfc，留空表示恢复默认背景）\\n' +\r\n            '（注：建议选择简洁、不花哨、偏浅色系的背景图片或颜色）',\r\n            value\r\n        );\r\n        if (value === null) return;\r\n        let $bg = $('body, .modal-content, .dialog-content');\r\n        if ($.trim(value) === '') {\r\n            Util.setCookie(Const.bgStyleCookieName, '', Util.getDate('-1d'));\r\n            alert('背景已恢复默认');\r\n            location.reload();\r\n        }\r\n        else if (/^https?:\\/\\/[^\"']+/.test(value)) {\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate('+1y'));\r\n            $bg.css('background-image', 'url(\"' + value + '\")');\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n        else if (/^#[0-9a-f]{6}$/i.test(value)) {\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate('+1y'));\r\n            $bg.css('background', value.toLowerCase());\r\n            alert('背景已更换');\r\n        }\r\n        else if (!/[<>{}]/.test(value)) {\r\n            value = value.replace(';', '');\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate('+1y'));\r\n            $bg.css('background', value);\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n        else {\r\n            alert('格式不正确');\r\n        }\r\n    });\r\n};\r\n","/* 消息模块 */\r\n'use strict';\r\n\r\n/**\r\n * 显示消息\r\n * @param {string|Object} options 消息或设置对象\r\n * @param {string} [options.msg] 消息\r\n * @param {number} [options.duration={@link Config.defShowMsgDuration}] 消息显示时间（秒），-1为永久显示\r\n * @param {boolean} [options.clickable=true] 消息框可否手动点击消除\r\n * @param {boolean} [options.preventable=false] 是否阻止点击网页上的其它元素\r\n * @param {number} [duration] 消息显示时间（秒），-1为永久显示\r\n * @example\r\n * show('<span class=\"mr-3\">使用道具</span><span class=\"text-item\">神秘系数<em class=\"text-warning\">+1</em></span>', -1);\r\n * show({\r\n *   msg: '<span class=\"mr-3\">抽取神秘盒子</span><span class=\"text-item\">KFB<em class=\"text-warning\">+8</em></span>',\r\n *   duration: 20,\r\n *   clickable: false,\r\n * });\r\n * @returns {jQuery} 消息框对象\r\n */\r\nexport const show = function (options, duration) {\r\n    let settings = {\r\n        msg: '',\r\n        duration: Config.defShowMsgDuration,\r\n        clickable: true,\r\n        preventable: false,\r\n    };\r\n    if ($.type(options) === 'object') {\r\n        $.extend(settings, options);\r\n    }\r\n    else {\r\n        settings.msg = options;\r\n        settings.duration = typeof duration === 'undefined' ? Config.defShowMsgDuration : duration;\r\n    }\r\n\r\n    let $container = $('.msg-container');\r\n    let isFirst = $container.length === 0;\r\n    if (!isFirst && !$('.mask').length) {\r\n        if ($container.height() >= $(window).height() * 0.8) {\r\n            destroy();\r\n            isFirst = true;\r\n        }\r\n    }\r\n    if (settings.preventable && !$('.mask').length) {\r\n        $('<div class=\"mask\"></div>').appendTo('body');\r\n    }\r\n    if (isFirst) {\r\n        $container = $('<div class=\"container msg-container\"></div>').appendTo('body');\r\n    }\r\n\r\n    let $msg = $(`<div class=\"msg\">${settings.msg}</div>`).appendTo($container);\r\n    $msg.on('click', '.stop-action', function (e) {\r\n        e.preventDefault();\r\n        $(this).text('正在停止&hellip;').closest('.msg').data('stop', true);\r\n    });\r\n    if (settings.clickable) {\r\n        $msg.css('cursor', 'pointer').click(function () {\r\n            hide($(this));\r\n        }).find('a').click(function (e) {\r\n            e.stopPropagation();\r\n        });\r\n    }\r\n    if (settings.preventable) $msg.attr('preventable', true);\r\n    $msg.slideDown('normal');\r\n    if (settings.duration > -1) {\r\n        setTimeout(() => {\r\n            hide($msg);\r\n        }, settings.duration * 1000);\r\n    }\r\n    return $msg;\r\n};\r\n\r\n/**\r\n * 显示等待消息\r\n * @param {string} msg 消息\r\n * @param {boolean} preventable 是否阻止点击网页上的其它元素\r\n * @returns {jQuery} 消息框对象\r\n */\r\nexport const wait = function (msg, preventable = true) {\r\n    msg += '<i class=\"fa fa-spinner fa-spin fa-lg fa-fw ml-3\" aria-label=\"等待中\" aria-hidden=\"true\"></i>';\r\n    return show({msg, duration: -1, clickable: false, preventable});\r\n};\r\n\r\n/**\r\n * 隐藏指定消息框\r\n * @param {jQuery} $msg 消息框对象\r\n */\r\nexport const hide = function ($msg) {\r\n    $msg.slideUp('normal', function () {\r\n        remove($(this));\r\n    });\r\n};\r\n\r\n/**\r\n * 移除指定消息框\r\n * @param {jQuery} $msg 消息框对象\r\n */\r\nexport const remove = function ($msg) {\r\n    let $container = $msg.parent();\r\n    $msg.remove();\r\n    if (!$('.msg').length) {\r\n        $container.remove();\r\n        $('.mask').remove();\r\n    }\r\n    else if (!$('.msg[preventable]').length) {\r\n        $('.mask').remove();\r\n    }\r\n};\r\n\r\n/**\r\n * 销毁所有消息框\r\n */\r\nexport const destroy = function () {\r\n    $('.msg-container').remove();\r\n    $('.mask').remove();\r\n};\r\n","/* 其它模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n/**\r\n * 高亮关键词页面中未读的消息\r\n */\r\nexport const highlightUnReadAtTipsMsg = function () {\r\n    if (Info.gjc !== Info.userName) return;\r\n    let timeString = Util.getCookie(Const.prevAtTipsTimeCookieName);\r\n    if (!timeString || !/^\\d+日\\d+时\\d+分$/.test(timeString)) return;\r\n    let prevString = '';\r\n    $('.thread-list-item time').each(function (index) {\r\n        let $this = $(this);\r\n        let curString = $.trim($this.text());\r\n        if (index === 0) prevString = curString;\r\n        if (timeString < curString && prevString >= curString) {\r\n            $this.addClass('text-danger');\r\n            prevString = curString;\r\n        }\r\n        else return false;\r\n    });\r\n\r\n    $(document).on('click', '.thread-list-item .thread-link-item a', function () {\r\n        Util.deleteCookie(Const.prevAtTipsTimeCookieName);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理游戏搜索区域\r\n */\r\nexport const handleGameIntroSearchArea = function () {\r\n    $('#gameSearchKeyword').val(Info.keyword);\r\n    $('#gameSearchType').val(Info.searchType);\r\n};\r\n\r\n/**\r\n * 推游戏介绍\r\n * @param {string} type 页面类型\r\n */\r\nexport const tuiGameIntro = function (type) {\r\n    let cookieName = '';\r\n    if (type === 'company') cookieName = 'g_intro_inc_tui_';\r\n    else if (type === 'type') cookieName = 'g_intro_adv_tui_';\r\n    else if (type === 'property') cookieName = 'g_intro_moe_tui_';\r\n    else cookieName = 'g_intro_tui_';\r\n    cookieName += Info.id;\r\n    let url = Util.makeUrl('game_intro/' + type, `id=${Info.id}&tui=1`);\r\n\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        if (Util.getCookie(cookieName, '')) {\r\n            alert('你在48小时内已经推过');\r\n            return;\r\n        }\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: url,\r\n            success: function () {\r\n                let $num = $this.find('span:first');\r\n                let num = parseInt($num.text());\r\n                $num.text('+1');\r\n                setTimeout(() => {\r\n                    $num.text(++num);\r\n                }, 1000);\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            },\r\n            dataType: 'html'\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定收藏夹页面按钮点击事件\r\n */\r\nexport const bindFavorPageBtnsClick = function () {\r\n    let $form = $('form[name=\"favorForm\"]');\r\n\r\n    $(document).on('click', '.remove-catalog', () => confirm('是否删除该目录？'));\r\n\r\n    $('#addCatalog').click(function (e) {\r\n        e.preventDefault();\r\n        let type = $.trim(prompt('请输入收藏夹目录名称：'));\r\n        if (!type) return;\r\n        $form.find('[name=\"job\"]').val('addtype');\r\n        $form.find('[name=\"type\"]').val(type);\r\n        $form.submit();\r\n    });\r\n\r\n    $('#favorActionBtns').on('click', 'button', function () {\r\n        let action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            Util.selectAll($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'delete') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否删除这${$checked.length}项？`)) {\r\n                $form.find('[name=\"job\"]').val('clear');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n\r\n    $('#convertCatalogDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let type = $(this).data('type');\r\n        let $checked = $('[name=\"delid[]\"]:checked');\r\n        if ($checked.length > 0 && confirm(`是否将这${$checked.length}项转换到指定目录？`)) {\r\n            $form.find('[name=\"job\"]').val('change');\r\n            $form.find('[name=\"type\"]').val(type);\r\n            $form.submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定好友列表页面按钮点击事件\r\n */\r\nexport const bindFriendPageBtnsClick = function () {\r\n    $('#friendActionBtns').on('click', '[type=\"button\"]', function () {\r\n        let action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            Util.selectAll($('[name=\"selid[]\"]'));\r\n        }\r\n        else if (action === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"selid[]\"]'));\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 在账号设置页面里为生日字段赋值\r\n */\r\nexport const assignBirthdayField = function () {\r\n    $('#birthday').change(function () {\r\n        let value = $(this).val().trim();\r\n        let matches = /(\\d{4})-(\\d{1,2})-(\\d{1,2})/.exec(value);\r\n        let year = '', month = '', day = '';\r\n        if (matches) {\r\n            year = parseInt(matches[1]);\r\n            month = parseInt(matches[2]);\r\n            day = parseInt(matches[3]);\r\n        }\r\n        $('[name=\"proyear\"]').val(year);\r\n        $('[name=\"promonth\"]').val(month);\r\n        $('[name=\"proday\"]').val(day);\r\n    });\r\n};\r\n\r\n/**\r\n * 同步主题每页楼层数量的设置\r\n */\r\nexport const syncPerPageFloorNum = function () {\r\n    /**\r\n     * 同步设置\r\n     */\r\n    const syncConfig = function () {\r\n        let perPageFloorNum = parseInt($('[name=\"p_num\"]').val());\r\n        if (perPageFloorNum === 0) perPageFloorNum = 10;\r\n        if (!isNaN(perPageFloorNum) && perPageFloorNum !== Config.perPageFloorNum) {\r\n            Config.perPageFloorNum = perPageFloorNum;\r\n            writeConfig();\r\n        }\r\n    };\r\n\r\n    syncConfig();\r\n    $('#creator').submit(function () {\r\n        readConfig();\r\n        syncConfig();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理上传头像文件浏览按钮\r\n */\r\nexport const handleUploadAvatarFileBtn = function () {\r\n    $('#browseAvatar').change(function () {\r\n        let $this = $(this);\r\n        let matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || !['jpg', 'gif', 'png'].includes(matches[1].toLowerCase())) {\r\n            alert('头像图片类型不匹配');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 转账提醒\r\n */\r\nexport const transferKfbAlert = function () {\r\n    $('#transferKfbForm').submit(function () {\r\n        let $this = $(this);\r\n        let transferKfb = parseInt($this.find('[name=\"to_money\"]').val());\r\n        let fixedDeposit = parseInt($('#fixedDeposit').text());\r\n        let currentDeposit = parseInt($('#currentDeposit').text());\r\n        if (transferKfb > 0 && fixedDeposit > 0 && transferKfb > currentDeposit) {\r\n            if (!confirm('你的活期存款不足，转账金额将从定期存款里扣除，是否继续？')) {\r\n                return false;\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定短消息页面操作按钮点击事件\r\n */\r\nexport const bindMessageActionBtnsClick = function () {\r\n    $('#messageActionBtns').on('click', 'button', function () {\r\n        let $form = $('#messageListForm');\r\n        let name = $(this).attr('name');\r\n        if (name === 'selectAll') {\r\n            Util.selectAll($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (name === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (name === 'selectCustom') {\r\n            let title = $.trim(\r\n                prompt('请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）', '收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除')\r\n            );\r\n            if (!title) return;\r\n            $('[name=\"delid[]\"]').prop('checked', false);\r\n            $('a.thread-link').each(function () {\r\n                let $this = $(this);\r\n                for (let key of title.split('|')) {\r\n                    if ($this.text().toLowerCase().includes(key.toLowerCase())) {\r\n                        $this.parent().find('[name=\"delid[]\"]').prop('checked', true);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        else if (name === 'download') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否下载这${$checked.length}项？`)) {\r\n                $form.attr('action', '/message.php').find('[name=\"action\"]').val('down');\r\n                $form.submit();\r\n            }\r\n        }\r\n        else if (name === 'delete') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否删除这${$checked.length}项？`)) {\r\n                $form.attr('action', Util.makeUrl('message/job')).find('[name=\"action\"]').val('del');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 验证注册页面字段\r\n */\r\nexport const validateRegisterField = function () {\r\n    $(document).on('change', 'input[name]', function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        let value = $this.val();\r\n        if (!value) {\r\n            Util.showValidationMsg($this, 'clear');\r\n            return;\r\n        }\r\n        if (name === 'regemail') {\r\n            Util.showValidationMsg($this, 'wait', '检查中，请稍等&hellip;');\r\n            $.post(Util.makeUrl('register/check'), 'username=' + value, ({type, msg, username}) => {\r\n                if ($this.val() === username) {\r\n                    Util.showValidationMsg($this, type, msg);\r\n                }\r\n            }).fail(() => {\r\n                Util.showValidationMsg($this, 'error', '响应失败');\r\n            });\r\n        }\r\n        else if (name === 'regpwd') {\r\n            if (value.length > 16 || value.length < 6) {\r\n                Util.showValidationMsg($this, 'error', '密码长度不正确');\r\n            }\r\n            else {\r\n                Util.showValidationMsg($this, 'clear');\r\n                $('[name=\"regpwdrepeat\"]').trigger('change');\r\n            }\r\n        }\r\n        else if (name === 'regpwdrepeat') {\r\n            if (value !== $('[name=\"regpwd\"]').val()) Util.showValidationMsg($this, 'error', '两次输入的密码不相符');\r\n            else Util.showValidationMsg($this, 'clear');\r\n        }\r\n    });\r\n\r\n    $('#registerForm').submit(function () {\r\n        if ($(this).find('.has-danger').length > 0) {\r\n            alert('请正确填写表单');\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理个人信息页面下的按钮\r\n */\r\nexport const handleUserPageBtns = function () {\r\n    let $area = $('#profileBtns');\r\n    let userName = $area.data('username');\r\n    $area.on('click', '[name=\"followUser\"], [name=\"blockUser\"]', function () {\r\n        readConfig();\r\n        let $this = $(this);\r\n        let str = '关注';\r\n        let userList = Config.followUserList;\r\n        if ($this.attr('name') === 'blockUser') {\r\n            str = '屏蔽';\r\n            userList = Config.blockUserList;\r\n            Config.blockUserEnabled = true;\r\n        }\r\n        else Config.followUserEnabled = true;\r\n        if ($this.text().includes('取消')) {\r\n            let index = Util.inFollowOrBlockUserList(userName, userList);\r\n            if (index > -1) {\r\n                userList.splice(index, 1);\r\n                writeConfig();\r\n            }\r\n            $this.removeClass('btn-outline-danger').addClass('btn-outline-primary').find('span').text(str + '用户');\r\n            alert('该用户已被取消' + str);\r\n        }\r\n        else {\r\n            if (Util.inFollowOrBlockUserList(userName, userList) === -1) {\r\n                if (str === '屏蔽') {\r\n                    let type = Config.blockUserDefaultType;\r\n                    type = prompt('请填写屏蔽类型，0：主题和回帖；1：主题；2：回帖', type);\r\n                    if (type === null) return;\r\n                    type = parseInt(type);\r\n                    if (isNaN(type) || type < 0 || type > 2) type = Config.blockUserDefaultType;\r\n                    userList.push({name: userName, type: type});\r\n                }\r\n                else {\r\n                    userList.push({name: userName});\r\n                }\r\n                writeConfig();\r\n            }\r\n            $this.removeClass('btn-outline-primary').addClass('btn-outline-danger').find('span').text('取消' + str);\r\n            alert('该用户已被' + str);\r\n        }\r\n    }).find('[name=\"followUser\"], [name=\"blockUser\"]').each(function () {\r\n        let $this = $(this);\r\n        let str = '关注';\r\n        let userList = Config.followUserList;\r\n        if ($this.attr('name') === 'blockUser') {\r\n            str = '屏蔽';\r\n            userList = Config.blockUserList;\r\n        }\r\n        if (Util.inFollowOrBlockUserList(userName, userList) > -1) {\r\n            $this.removeClass('btn-outline-primary').addClass('btn-outline-danger').find('span').text('取消' + str);\r\n        }\r\n    });\r\n};\r\n","/* 发帖模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Msg from './msg';\r\n\r\n/**\r\n * 处理编辑器按钮\r\n */\r\nexport const handleEditorBtns = function () {\r\n    let textArea = $('#postContent').get(0);\r\n\r\n    // 编辑器按钮\r\n    $(document).on('click', '.editor-btn-group button[data-action]', function () {\r\n        let action = $(this).data('action');\r\n        let value = '';\r\n        switch (action) {\r\n            case 'link':\r\n                value = prompt('请输入链接URL：', 'http://');\r\n                break;\r\n            case 'img':\r\n                value = prompt('请输入图片URL：', 'http://');\r\n                break;\r\n            case 'sell':\r\n                value = prompt('请输入出售金额：', 1);\r\n                break;\r\n            case 'hide':\r\n                value = prompt('请输入神秘等级：', 1);\r\n                break;\r\n            case 'audio': {\r\n                value = prompt('请输入HTML5音频实际地址：\\n（可直接输入网易云音乐或虾米的单曲地址，将自动转换为外链地址）', 'http://');\r\n                let matches = /^https?:\\/\\/music\\.163\\.com\\/(?:#\\/)?song\\?id=(\\d+)/i.exec(value);\r\n                if (matches) value = `http://music.miaola.info/163/${matches[1]}.mp3`;\r\n                matches = /^https?:\\/\\/www\\.xiami\\.com\\/song\\/(\\d+)/i.exec(value);\r\n                if (matches) value = `http://music.miaola.info/xiami/${matches[1]}.mp3`;\r\n            }\r\n                break;\r\n            case 'video': {\r\n                value = prompt('请输入HTML5视频实际地址：\\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）', 'http://');\r\n                let matches = /^https?:\\/\\/(?:www\\.)?youtube\\.com\\/watch\\?v=([\\w\\-]+)/i.exec(value);\r\n                if (matches) value = `http://video.miaola.info/youtube/${matches[1]}`;\r\n                matches = /^https?:\\/\\/youtu\\.be\\/([\\w\\-]+)$/i.exec(value);\r\n                if (matches) value = `http://video.miaola.info/youtube/${matches[1]}`;\r\n            }\r\n                break;\r\n        }\r\n        if (value === null) return;\r\n\r\n        let selText = '';\r\n        let code = '';\r\n        switch (action) {\r\n            case 'link':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[url=${value}]${selText}[/url]`;\r\n                break;\r\n            case 'img':\r\n                code = `[img]${value}[/img]`;\r\n                break;\r\n            case 'quote':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[quote]${selText}[/quote]`;\r\n                break;\r\n            case 'code':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[code]${selText}[/code]`;\r\n                break;\r\n            case 'sell':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sell=${value}]${selText}[/sell]`;\r\n                break;\r\n            case 'hide':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[hide=${value}]${selText}[/hide]`;\r\n                break;\r\n            case 'bold':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[b]${selText}[/b]`;\r\n                break;\r\n            case 'italic':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[i]${selText}[/i]`;\r\n                break;\r\n            case 'underline':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[u]${selText}[/u]`;\r\n                break;\r\n            case 'strike':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[strike]${selText}[/strike]`;\r\n                break;\r\n            case 'super':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sup]${selText}[/sup]`;\r\n                break;\r\n            case 'sub':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sub]${selText}[/sub]`;\r\n                break;\r\n            case 'horizontal':\r\n                code = `[hr]`;\r\n                break;\r\n            case 'align-left':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=left]${selText}[/align]`;\r\n                break;\r\n            case 'align-center':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=center]${selText}[/align]`;\r\n                break;\r\n            case 'align-right':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=right]${selText}[/align]`;\r\n                break;\r\n            case 'fly':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[fly]${selText}[/fly]`;\r\n                break;\r\n            case 'audio':\r\n                code = `[audio]${value}[/audio]`;\r\n                break;\r\n            case 'video':\r\n                code = `[video]${value}[/video]`;\r\n                break;\r\n        }\r\n        if (!code) return;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 字号下拉菜单\r\n    $('#fontSizeDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let size = $(this).data('size');\r\n        let selText = Util.getSelText(textArea);\r\n        let code = `[size=${size}]${selText}[/size]`;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 颜色、背景颜色下拉菜单\r\n    $('#colorDropdownMenu, #bgColorDropdownMenu').on('click', 'span', function () {\r\n        let $this = $(this);\r\n        let codeType = $this.parent().is('#bgColorDropdownMenu') ? 'backcolor' : 'color';\r\n        let color = $this.data('color');\r\n        let selText = Util.getSelText(textArea);\r\n        let code = `[${codeType}=${color}]${selText}[/${codeType}]`;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 检查发帖表单\r\n */\r\nexport const checkPostForm = function () {\r\n    $('#postForm').submit(function () {\r\n        let $postType = $('#postType');\r\n        if ($postType.length > 0 && !$postType.val()) {\r\n            alert('没有选择主题分类');\r\n            $postType.focus();\r\n            return false;\r\n        }\r\n\r\n        let $postTitle = $('#postTitle');\r\n        if ($postTitle.length > 0) {\r\n            let length = Util.getStrByteLen($postTitle.val());\r\n            if (!length) {\r\n                alert('标题不能为空');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n            else if (length > 100) {\r\n                alert('标题超过最大长度 100 个字节');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $voteItemContent = $('#voteItemContent');\r\n        if ($voteItemContent.length > 0) {\r\n            if (!$voteItemContent.val().trim()) {\r\n                alert('投票选项不能为空');\r\n                $voteItemContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $postContent = $('#postContent');\r\n        if ($postContent.length > 0) {\r\n            let length = Util.getStrByteLen($postContent.val().trim());\r\n            if (length < 12) {\r\n                alert('文章内容少于 12 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n            else if (length > 50000) {\r\n                alert('文章内容大于 50000 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $postGjc = $('#postGjc');\r\n        if ($postGjc.length > 0 && Info.action === 'new' && !$postGjc.val().trim()) {\r\n            alert('请在内容文本框的下方填写关键词，以方便搜索，也可以在标题中选择任意一个词填入');\r\n            $postGjc.focus();\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理附件按钮\r\n */\r\nexport const handleAttachBtns = function () {\r\n    $(document).on('click', '.attach-area a[data-action]', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let $area = $this.closest('.attach-area');\r\n        let action = $this.data('action');\r\n        let id = $area.data('id');\r\n        if (!id) return;\r\n        if (action === 'insert') {\r\n            let type = $this.data('type');\r\n            let textArea = $('#postContent').get(0);\r\n            let code = `[${type === 'new' ? 'upload' : 'attachment'}=${id}]`;\r\n            Util.addCode(textArea, code);\r\n            textArea.focus();\r\n        }\r\n        else if (action === 'update') {\r\n            $area.find('.attach-info').prop('hidden', true).after(\r\n                `<label><input name=\"replace_${id}\" type=\"file\" aria-label=\"选择附件\"></label>`\r\n            );\r\n            $this.data('action', 'cancel').text('取消').blur();\r\n            if (!$(document).data('attachUpdateAlert')) {\r\n                alert('本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果');\r\n                $(document).data('attachUpdateAlert', true);\r\n            }\r\n        }\r\n        else if (action === 'cancel') {\r\n            $area.find('.attach-info').prop('hidden', false).next('label').remove();\r\n            $this.data('action', 'update').text('更新').blur();\r\n        }\r\n        else if (action === 'delete') {\r\n            $area.remove();\r\n        }\r\n    });\r\n\r\n    $(document).on('change', '[type=\"file\"]', function () {\r\n        let $this = $(this);\r\n        let matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || !['jpg', 'gif', 'png', 'torrent'].includes(matches[1].toLowerCase())) {\r\n            alert('附件类型不匹配');\r\n            return;\r\n        }\r\n\r\n        let type = $this.data('type');\r\n        if (type === 'new') {\r\n            $this.removeData('type').parent().next().prop('hidden', false);\r\n\r\n            let $newAttachArea = $('#newAttachArea');\r\n            let totalNum = $newAttachArea.find('[type=\"file\"]').length;\r\n            if (totalNum >= 5) return;\r\n            let $lastAttachArea = $newAttachArea.find('[type=\"file\"]:last').closest('.attach-area');\r\n            let id = parseInt($lastAttachArea.data('id'));\r\n            if (!id) return;\r\n            id++;\r\n            $(`\r\n<div class=\"form-group row font-size-sm attach-area\" data-id=\"${id}\">\r\n  <div class=\"col-xs-12 col-form-label\">\r\n    <label>\r\n      <input name=\"attachment_${id}\" data-type=\"new\" type=\"file\" aria-label=\"选择附件\">\r\n    </label>\r\n    <span hidden>\r\n      <a data-action=\"insert\" data-type=\"new\" href=\"#\">插入</a>&nbsp;\r\n      <a data-action=\"delete\" href=\"#\">删除</a>\r\n    </span>\r\n  </div>\r\n  <div class=\"col-xs-4\">\r\n    <label class=\"sr-only\" for=\"atc_downrvrc${id}\">神秘系数</label>\r\n    <input class=\"form-control form-control-sm\" id=\"atc_downrvrc${id}\" name=\"atc_downrvrc${id}\" data-toggle=\"tooltip\" \r\ntype=\"number\" value=\"0\" min=\"0\" title=\"神秘系数\" placeholder=\"神秘系数\">\r\n  </div>\r\n  <div class=\"col-xs-8\">\r\n    <label class=\"sr-only\" for=\"atc_desc${id}\">描述</label>\r\n    <input class=\"form-control form-control-sm\" id=\"atc_desc${id}\" name=\"atc_desc${id}\" data-toggle=\"tooltip\" type=\"text\" \r\ntitle=\"描述\" placeholder=\"描述\">\r\n  </div>\r\n</div>\r\n`).insertAfter($lastAttachArea).find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 插入表情代码\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nexport const addSmileCode = function ($node) {\r\n    $('.smile-panel').on('click', 'img', function () {\r\n        $('.smile-panel').addClass('open');\r\n        let textArea = $node.get(0);\r\n        if (!textArea) return;\r\n        let code = `[s:${$(this).data('id')}]`;\r\n        Util.addCode(textArea, code, '');\r\n        textArea.blur();\r\n    }).parent().on('shown.bs.dropdown', function () {\r\n        $('.smile-panel img').each(function () {\r\n            let $this = $(this);\r\n            if (!$this.attr('src')) {\r\n                $this.attr('src', $this.data('src'));\r\n            }\r\n        });\r\n    }).on('hide.bs.dropdown', function (e) {\r\n        let $relatedTarget = $(e.relatedTarget);\r\n        if (!$relatedTarget.data('open')) $relatedTarget.removeData('open');\r\n        else return e.preventDefault();\r\n    });\r\n\r\n    $('#smileDropdownBtn').click(function () {\r\n        let $this = $(this);\r\n        $this.data('open', !$this.data('open'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理多重回复和多重引用\r\n * @param {number} type 处理类型，1：多重回复；2：多重引用\r\n */\r\nexport const handleMultiQuote = function (type = 1) {\r\n    let data = localStorage[Const.multiQuoteStorageName];\r\n    if (!data) return;\r\n    try {\r\n        data = JSON.parse(data);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) return;\r\n    let {tid, quoteList} = data;\r\n    if (!Info.tid || tid !== Info.tid || $.type(quoteList) !== 'object') return;\r\n    if (type === 2 && !Info.fid) return;\r\n    let list = [];\r\n    for (let data of Object.values(quoteList)) {\r\n        if (!Array.isArray(data)) continue;\r\n        for (let quote of data) {\r\n            list.push(quote);\r\n        }\r\n    }\r\n    if (!list.length) {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        return;\r\n    }\r\n\r\n    let keywords = new Set();\r\n    let content = '';\r\n    if (type === 2) {\r\n        Msg.wait(`<span class=\"mr-3\">正在获取引用内容中&hellip;</span>剩余：<em class=\"text-warning countdown-num\">${list.length}</em>`);\r\n        $(document).clearQueue('MultiQuote');\r\n    }\r\n    $.each(list, function (index, data) {\r\n        if (typeof data.floor === 'undefined' || typeof data.pid === 'undefined') return;\r\n        keywords.add(data.userName);\r\n        if (type === 2) {\r\n            $(document).queue('MultiQuote', function () {\r\n                $.get(Util.makeUrl(\r\n                    'post/index',\r\n                    `action=quote&fid=${Info.fid}&tid=${tid}&pid=${data.pid}&article=${data.floor}&t=${new Date().getTime()}`\r\n                ), function ({postContent}) {\r\n                    content += postContent ? postContent + (index === list.length - 1 ? '' : '\\n') : '';\r\n                    let $countdownNum = $('.countdown-num:last');\r\n                    $countdownNum.text(parseInt($countdownNum.text()) - 1);\r\n                    if (index === list.length - 1) {\r\n                        Msg.destroy();\r\n                        $('#postContent').val(content).focus();\r\n                    }\r\n                    else {\r\n                        setTimeout(() => $(document).dequeue('MultiQuote'), 100);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            content += `[quote]回 ${data.floor}楼(${data.userName}) 的帖子[/quote]\\n`;\r\n        }\r\n    });\r\n    for (let [index, quote] of list.entries()) {\r\n    }\r\n    $('[name=\"diy_guanjianci\"]').val([...keywords].join(','));\r\n    $('#postForm').submit(function () {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n    });\r\n    if (type === 2) $(document).dequeue('MultiQuote');\r\n    else $('#postContent').val(content).focus();\r\n};\r\n\r\n/**\r\n * 处理清除多重引用数据按钮\r\n */\r\nexport const handleClearMultiQuoteDataBtn = function () {\r\n    $('.clear-multi-quote-data-btn').click(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否清除多重引用数据？')) return;\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        $('[name=\"diy_guanjianci\"]').val('');\r\n        $('#postContent').val('');\r\n    });\r\n};\r\n","/* 公共模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Dialog from './dialog';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\nimport * as ConfigDialog from './configDialog';\r\n\r\n/**\r\n * 处理主菜单\r\n */\r\nexport const handleMainMenu = function () {\r\n    $('#mainMenuTogglerBtn').click(function () {\r\n        let maxHeight = document.documentElement.clientHeight - $(this).closest('.navbar').outerHeight();\r\n        if (maxHeight > 0) {\r\n            $('#mainMenu').css('max-height', maxHeight + 'px');\r\n        }\r\n    });\r\n    $('#sidebarMainMenuBtn').click(() => $('#mainMenuTogglerBtn').click());\r\n};\r\n\r\n/**\r\n * 处理主菜单链接\r\n */\r\nexport const handleMainMenuLink = function () {\r\n    $('#mainMenu').find('[data-name=\"openConfigDialog\"]').click(function (e) {\r\n        e.preventDefault();\r\n        $('#mainMenuTogglerBtn').click();\r\n        ConfigDialog.show();\r\n    });\r\n};\r\n\r\n/**\r\n * 显示侧边栏按钮组\r\n */\r\nexport const showSidebarBtnGroup = function () {\r\n    $('.sidebar-btn-group').prop('hidden', false);\r\n    if (Config.showSidebarRollBtnEnabled) $('#sidebarRollBtn').prop('hidden', false);\r\n    if (Config.showSidebarMainMenuBtnEnabled) $('#sidebarMainMenuBtn').prop('hidden', false);\r\n    if (Config.showSidebarForumListBtnEnabled) $('#sidebarForumListBtn').prop('hidden', false);\r\n    if (Config.showSidebarSearchBtnEnabled) $('#sidebarSearchBtn').prop('hidden', false);\r\n    if (Config.showSidebarHomePageBtnEnabled) $('#sidebarHomePageBtn').prop('hidden', false);\r\n};\r\n\r\n/**\r\n * 处理侧边栏的滚动到页顶/页底按钮\r\n */\r\nexport const handleSidebarRollBtn = function () {\r\n    $(window).scroll(function () {\r\n        let $btn = $('#sidebarRollBtn');\r\n        if ($(window).scrollTop() > 640) {\r\n            if ($btn.data('direction') === 'top') return;\r\n            $btn.data('direction', 'top').attr('aria-label', '滚动到页顶')\r\n                .find('i').removeClass('fa-chevron-down').addClass('fa-chevron-up');\r\n        }\r\n        else {\r\n            if ($btn.data('direction') === 'bottom') return;\r\n            $btn.data('direction', 'bottom').attr('aria-label', '滚动到页底')\r\n                .find('i').removeClass('fa-chevron-up').addClass('fa-chevron-down');\r\n        }\r\n    });\r\n\r\n    $('#sidebarRollBtn').click(function () {\r\n        let scrollTop = $(this).data('direction') === 'bottom' ? $('body').height() : 0;\r\n        $('body, html').animate({scrollTop: scrollTop});\r\n    });\r\n};\r\n\r\n/**\r\n * 处理搜索对话框\r\n */\r\nexport const handleSearchDialog = function () {\r\n    let $searchDialog = $('#searchDialog');\r\n\r\n    $searchDialog.on('shown.bs.modal', function () {\r\n        $('#searchKeyword').select().focus();\r\n    }).find('form').submit(function () {\r\n        let $this = $(this);\r\n        let $searchKeyword = $this.find('#searchKeyword');\r\n        let searchType = $this.find('#searchType').val();\r\n        let keyword = $.trim($searchKeyword.val());\r\n        if (searchType === 'gjc') {\r\n            $this.attr('action', Util.makeUrl('gjc/' + keyword));\r\n        }\r\n        else if (searchType === 'username') {\r\n            $this.attr('action', Util.makeUrl('user/username/' + keyword));\r\n        }\r\n        else {\r\n            $this.attr('action', Util.makeUrl('search'));\r\n            $searchKeyword.attr('name', searchType === 'author' ? 'pwuser' : 'keyword');\r\n            if (searchType === 'title') {\r\n                if (keyword.length && Util.getStrByteLen(keyword) <= 2) {\r\n                    let $method = $this.find('[name=\"method\"]');\r\n                    $method.val('OR');\r\n                    $searchKeyword.val(keyword + ' ' + Math.floor(new Date().getTime() / 1000));\r\n                    setTimeout(() => {\r\n                        $searchKeyword.val(keyword);\r\n                        $method.val('AND');\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    $searchDialog.find('[name=\"searchRange\"]').on('click', function () {\r\n        let value = 'all';\r\n        if ($(this).val() === 'current') value = Info.fid;\r\n        $searchDialog.find('[name=\"f_fid\"]').val(value);\r\n    });\r\n\r\n    let $current = $searchDialog.find('[name=\"searchRange\"][value=\"current\"]');\r\n    let $currentBox = $current.closest('.form-check-inline');\r\n    $searchDialog.find('#searchType').change(function () {\r\n        let searchType = $(this).val();\r\n        if (!$current.data('enabled')) return;\r\n        let disabled = searchType === 'gjc' || searchType === 'username';\r\n        $current.prop('disabled', disabled);\r\n        if (disabled) $currentBox.addClass('disabled');\r\n        else $currentBox.removeClass('disabled');\r\n    });\r\n\r\n    if (pageId === 'threadPage' || pageId === 'readPage') {\r\n        $current.prop('disabled', false).data('enabled', true).click();\r\n        $currentBox.removeClass('disabled');\r\n    }\r\n};\r\n\r\n/**\r\n * 处理分页导航\r\n */\r\nexport const handlePageInput = function () {\r\n    $(document).on('click', '.page-input', function (e) {\r\n        e.preventDefault();\r\n        if (Info.maxPageNum && Info.maxPageNum <= 1) return;\r\n        let action = $(this).data('url');\r\n        if (!action) return;\r\n        let excludeParams = $(this).data('exclude');\r\n        if (excludeParams) excludeParams = excludeParams.split(',');\r\n        else excludeParams = [];\r\n        let num = parseInt(\r\n            prompt(`要跳转到第几页？${Info.maxPageNum ? `（共${Info.maxPageNum}页）` : ''}`, Info.currentPageNum)\r\n        );\r\n        if (num && num > 0) {\r\n            location.href = Util.makeUrl(action, 'page=' + num, true, excludeParams);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定快速提交的快捷键\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nexport const bindFastSubmitShortcutKey = function ($node) {\r\n    $node.keydown(function (e) {\r\n        if (e.keyCode === 13 && e.ctrlKey) {\r\n            $(this).closest('form').submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示编辑常用版块对话框\r\n */\r\nexport const showEditCommonForumDialog = function () {\r\n    $(document).on('click', '.edit-common-forum-btn', function (e) {\r\n        e.preventDefault();\r\n        const dialogName = 'editCommonForumDialog';\r\n        if ($('#' + dialogName).length > 0) return;\r\n        readConfig();\r\n\r\n        let commonForumList = Config.commonForumList.length > 0 ? Config.commonForumList : Const.commonForumList;\r\n        let commonForumListHtml = '';\r\n        for (let {fid, name} of commonForumList) {\r\n            commonForumListHtml += `<span class=\"btn btn-outline-primary\" data-fid=\"${fid}\">${name}</span>`;\r\n        }\r\n        let availableForumListHtml = '';\r\n        for (let {fid, name} of Const.availableForumList) {\r\n            if (commonForumList.find(elem => elem.fid === fid)) continue;\r\n            availableForumListHtml += `<span class=\"btn btn-outline-primary\" data-fid=\"${fid}\">${name}</span>`;\r\n        }\r\n\r\n        let bodyContent = `\r\n<p class=\"font-size-sm text-muted\">\r\n  请将可用版块内的版块按钮拖拽到常用版块内（或相反）\r\n</p>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>常用版块</legend>\r\n  <div class=\"edit-forum-list d-flex flex-wrap\" id=\"editCommonForumList\">${commonForumListHtml}</div>\r\n</fieldset>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>可用版块</legend>\r\n  <div class=\"edit-forum-list d-flex flex-wrap\" id=\"editAvailableForumList\">${availableForumListHtml}</div>\r\n</fieldset>`;\r\n        let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>\r\n<button class=\"btn btn-danger\" name=\"reset\" type=\"button\">重置</button>`;\r\n        let $dialog = Dialog.create(dialogName, '编辑常用版块', bodyContent, footerContent);\r\n\r\n        let $dragulaScriptPath = $('[name=\"dragulaScriptPath\"]');\r\n        let dragulaScriptPath = $dragulaScriptPath.val();\r\n        if (dragulaScriptPath) {\r\n            $.getScript(dragulaScriptPath, () => dragula($dialog.find('.edit-forum-list').get(), {revertOnSpill: true}));\r\n            $dragulaScriptPath.val('');\r\n        }\r\n        else dragula($dialog.find('.edit-forum-list').get(), {revertOnSpill: true});\r\n\r\n        $dialog.submit(function (e) {\r\n            e.preventDefault();\r\n            Config.commonForumList = [];\r\n            $('#editCommonForumList').children('.btn').each(function () {\r\n                let $this = $(this);\r\n                let fid = parseInt($this.data('fid'));\r\n                let name = $this.text().trim();\r\n                if (!fid || !name) return;\r\n                Config.commonForumList.push({fid: fid, name: name});\r\n            });\r\n            writeConfig();\r\n            alert('设置已保存');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        }).find('[name=\"reset\"]').click(function () {\r\n            if (!confirm('是否重置？')) return;\r\n            Config.commonForumList = [];\r\n            writeConfig();\r\n            alert('设置已重置');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        });\r\n\r\n        Dialog.show(dialogName);\r\n    });\r\n};\r\n\r\n/**\r\n * 填充常用版块面板\r\n */\r\nexport const fillCommonForumPanel = function () {\r\n    let commonForumList = Config.commonForumList.length > 0 ? Config.commonForumList : Const.commonForumList;\r\n    let html = '';\r\n    for (let [index, {fid, name}] of commonForumList.entries()) {\r\n        if (index === 0 || index % 3 === 0) html += '<div class=\"row mb-3\">';\r\n        html += `\r\n<div class=\"col-4\">\r\n  <a class=\"btn btn-outline-primary btn-block\" href=\"${Util.makeUrl('thread')}/${fid}\">${name}</a>\r\n</div>`;\r\n        if (index === commonForumList.length - 1 || index % 3 === 2) html += '</div>';\r\n    }\r\n    $('.common-forum-panel').html(html);\r\n};\r\n\r\n/**\r\n * 在操作进行时阻止关闭页面\r\n */\r\nexport const preventCloseWindow = function () {\r\n    window.addEventListener(\"beforeunload\", function (e) {\r\n        if ($('.mask').length > 0) {\r\n            let msg = '正在进行操作中，确定要关闭页面吗？';\r\n            e.returnValue = msg;\r\n            return msg;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示通用的导入/导出设置对话框\r\n * @param {string} title 对话框标题\r\n * @param {string} configName 设置名称\r\n * @param {?function} [callback] 回调方法\r\n * @param {?function} [callbackAfterSubmit] 在提交之后的回调方法\r\n */\r\nexport const showCommonImportOrExportConfigDialog = function (title, configName, callback, callbackAfterSubmit) {\r\n    const dialogName = 'pdCommonImOrExConfigDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\r\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可\r\n</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control\" name=\"commonConfig\" rows=\"10\" aria-label=\"设置内容\" style=\"word-break: break-all;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, `导入或导出${title}`, bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否导入文本框中的设置？')) return;\r\n        let options = $.trim($dialog.find('[name=\"commonConfig\"]').val());\r\n        if (!options) return;\r\n        try {\r\n            options = JSON.parse(options);\r\n        }\r\n        catch (ex) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        if (!options || $.type(options) !== $.type(Config[configName])) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        Config[configName] = options;\r\n        writeConfig();\r\n        alert('设置已导入');\r\n        Dialog.close(dialogName);\r\n        if (typeof callbackAfterSubmit === 'function') callbackAfterSubmit();\r\n        else location.reload();\r\n    });\r\n    Dialog.show(dialogName);\r\n    $dialog.find('[name=\"commonConfig\"]').val(JSON.stringify(Config[configName])).select().focus();\r\n    if (typeof callback === 'function') callback($dialog);\r\n};\r\n\r\n/**\r\n * 关注用户\r\n */\r\nexport const followUsers = function () {\r\n    if (!Config.followUserList.length) return;\r\n    if (pageId === 'indexPage' && Config.highlightFollowUserThreadInHPEnabled) {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.closest('.thread-list-item').find('.thread-item-footer a:first').addClass('text-danger');\r\n                if (Config.highlightFollowUserThreadLinkEnabled) $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        $('.read-floor').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('username'), Config.followUserList) > -1) {\r\n                $this.find('.floor-num').addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'gjcPage' || pageId === 'sharePage' || pageId === 'searchPage') {\r\n        $('.thread-list-group').find('a[data-author]').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * 屏蔽用户\r\n */\r\nexport const blockUsers = function () {\r\n    if (!Config.blockUserList.length) return;\r\n    let num = 0;\r\n    if (pageId === 'indexPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList);\r\n            if (index > -1 && Config.blockUserList[index].type <= 1) {\r\n                num++;\r\n                $this.closest('.thread-link-group').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        if (Config.blockUserForumType === 1 && !Config.blockUserFidList.includes(Info.fid)) return;\r\n        else if (Config.blockUserForumType === 2 && Config.blockUserFidList.includes(Info.fid)) return;\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList);\r\n            if (index > -1 && Config.blockUserList[index].type <= 1) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        if (Config.blockUserForumType === 1 && !Config.blockUserFidList.includes(Info.fid)) return;\r\n        else if (Config.blockUserForumType === 2 && Config.blockUserFidList.includes(Info.fid)) return;\r\n        $('.read-floor').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('username'), Config.blockUserList);\r\n            if (index > -1) {\r\n                let floor = parseInt($this.data('floor'));\r\n                if (Config.blockUserList[index].type === 2 && floor === 0) return;\r\n                else if (Config.blockUserList[index].type === 1 && floor > 0) return;\r\n                num++;\r\n                $this.closest('.read-floor').remove();\r\n            }\r\n        });\r\n        $('.read-content').find('.blockquote > p').each(function () {\r\n            let $this = $(this);\r\n            let content = $this.text().trim();\r\n            for (let data of Config.blockUserList) {\r\n                if (data.type === 1) continue;\r\n                try {\r\n                    let regex1 = new RegExp(`^引用(第\\\\d+楼|楼主)${data.name}于`, 'i');\r\n                    let regex2 = new RegExp(`^回\\\\s*\\\\d+楼\\\\(${data.name}\\\\)\\\\s*的帖子`, 'i');\r\n                    if (regex1.test(content) || regex2.test(content)) {\r\n                        $this.html(`<mark class=\"help\" data-toggle=\"tooltip\" title=\"被屏蔽用户：${data.name}\">该用户已被屏蔽</mark>`);\r\n                    }\r\n                }\r\n                catch (ex) {\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'gjcPage' && Config.blockUserAtTipsEnabled) {\r\n        $('.thread-list-group').find('a[data-author]').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList) > -1) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    if (num > 0) console.log(`【屏蔽用户】共有${num}个主题或回复被屏蔽`);\r\n};\r\n\r\n/**\r\n * 屏蔽主题\r\n */\r\nexport const blockThread = function () {\r\n    if (!Config.blockThreadList.length) return;\r\n\r\n    /**\r\n     * 是否屏蔽主题\r\n     * @param {string} title 主题标题\r\n     * @param {string} userName 用户名\r\n     * @param {number} fid 版块ID\r\n     * @returns {boolean} 是否屏蔽\r\n     */\r\n    const isBlock = function (title, userName, fid = 0) {\r\n        for (let {keyWord, includeUser, excludeUser, includeFid, excludeFid} of Config.blockThreadList) {\r\n            let regex = null;\r\n            if (/^\\/.+\\/[gimuy]*$/.test(keyWord)) {\r\n                try {\r\n                    regex = eval(keyWord);\r\n                }\r\n                catch (ex) {\r\n                    console.log(ex);\r\n                    continue;\r\n                }\r\n            }\r\n            if (userName) {\r\n                if (includeUser) {\r\n                    if (!includeUser.includes(userName)) continue;\r\n                }\r\n                else if (excludeUser) {\r\n                    if (excludeUser.includes(userName)) continue;\r\n                }\r\n            }\r\n            if (fid) {\r\n                if (includeFid) {\r\n                    if (!includeFid.includes(fid)) continue;\r\n                }\r\n                else if (excludeFid) {\r\n                    if (excludeFid.includes(fid)) continue;\r\n                }\r\n            }\r\n            if (regex) {\r\n                if (regex.test(title)) return true;\r\n            }\r\n            else {\r\n                if (title.toLowerCase().includes(keyWord.toLowerCase())) return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    let num = 0;\r\n    if (pageId === 'indexPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (isBlock($this.text().trim(), $this.data('author'))) {\r\n                num++;\r\n                $this.closest('.thread-link-group').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (isBlock($this.text().trim(), $this.data('author'), Info.fid)) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        if (Info.currentPageNum !== 1) return;\r\n        let $topFloor = $('.read-floor[data-floor=\"0\"]');\r\n        if (!$topFloor.length) return;\r\n        if (isBlock($('.thread-title').text().trim(), $topFloor.data('username'), Info.fid)) {\r\n            num++;\r\n            $topFloor.remove();\r\n        }\r\n    }\r\n    if (num > 0) console.log(`【屏蔽主题】共有${num}个主题被屏蔽`);\r\n};\r\n","/* 主题模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {write as writeConfig} from './config';\r\nimport * as Msg from './msg';\r\n\r\n/**\r\n * 处理复制楼层跳转链接按钮\r\n */\r\nexport const handleCopyFloorLinkBtn = function () {\r\n    $(document).on('click', '.floor-num', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let link = Util.getHostNameUrl() + $this.attr('href');\r\n        $this.data('copy-text', link);\r\n        if (!Util.copyText($this, $this)) {\r\n            prompt('本楼的跳转链接：', link);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理快速回复按钮\r\n */\r\nexport const handleFastReplyBtn = function () {\r\n    $(document).on('click', '.fast-reply-btn', function () {\r\n        let $article = $(this).closest('article');\r\n        let floor = $article.data('floor');\r\n        let userName = $article.data('username');\r\n        $('#postGjc').val(userName);\r\n        let postContent = $('#postContent').get(0);\r\n        postContent.value = `[quote]回 ${floor}楼(${userName}) 的帖子[/quote]\\n`;\r\n        postContent.selectionStart = postContent.value.length;\r\n        postContent.selectionEnd = postContent.value.length;\r\n        postContent.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理屏蔽回帖按钮\r\n */\r\nexport const handleBlockFloorBtn = function () {\r\n    $(document).on('click', '.block-floor', () => confirm('确认要屏蔽该回帖？本操作不可恢复！（屏蔽后该回帖将对大家不可见）'));\r\n};\r\n\r\n/**\r\n * 处理购买帖子按钮\r\n */\r\nexport const handleBuyThreadBtn = function () {\r\n    $(document).on('click', '.buy-thread-btn', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let pid = $this.data('pid');\r\n        let price = $this.data('price');\r\n        if (price > 5 && !confirm(`此贴售价${price}KFB，是否购买？`)) return;\r\n        let $wait = Msg.wait('正在购买帖子&hellip;');\r\n        $.get(Util.makeUrl('job/buytopic', `tid=${Info.tid}&pid=${pid}&verify=${Info.verify}`),\r\n            function ({msg}) {\r\n                Msg.remove($wait);\r\n                if (msg === '操作完成') {\r\n                    location.reload();\r\n                }\r\n                else if (msg.includes('您已经购买此帖')) {\r\n                    alert('你已经购买过此帖');\r\n                    location.reload();\r\n                }\r\n                else {\r\n                    alert('帖子购买失败');\r\n                }\r\n            });\r\n    });\r\n};\r\n\r\n/**\r\n * 复制购买人名单\r\n */\r\nexport const copyBuyThreadList = function () {\r\n    $(document).on('change', '.buy-thread-list', function () {\r\n        let $this = $(this);\r\n        if ($this.val() !== 'copyList') return;\r\n        let list = $this.find('option').map(function (index) {\r\n            let name = $(this).text();\r\n            if (index === 0 || index === 1 || name.includes('-'.repeat(11))) return null;\r\n            else return name;\r\n        }).get().join('\\n');\r\n        $this.get(0).selectedIndex = 0;\r\n        if (!list) {\r\n            alert('暂时无人购买');\r\n            return;\r\n        }\r\n\r\n        let $dialog = $(`\r\n<div class=\"modal fade\" id=\"buyThreadListDialog\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"buyThreadListDialogTitle\"\r\n     aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-sm\" role=\"document\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\" id=\"buyThreadListDialogTitle\">购买人名单</h5>\r\n        <button class=\"close\" data-dismiss=\"modal\" type=\"button\" aria-label=\"关闭\">\r\n          <span aria-hidden=\"true\">&times;</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <textarea class=\"form-control\" name=\"buyThreadListContent\" rows=\"14\" aria-label=\"购买人名单\">${list}</textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n`).appendTo('body');\r\n        $dialog.on('shown.bs.modal', function () {\r\n            $dialog.find('[name=\"buyThreadListContent\"]').select().focus();\r\n        }).on('hidden.bs.modal', function () {\r\n            $dialog.remove();\r\n        }).modal('show');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理楼层内的图片\r\n */\r\nexport const handleFloorImage = function () {\r\n    $(document).on('click', '.img', function () {\r\n        let $this = $(this);\r\n        if ($this.parent().is('a') || this.naturalWidth <= $this.closest('.read-content').width()) return;\r\n        location.href = $this.attr('src');\r\n    });\r\n};\r\n\r\n/**\r\n * 跳转到指定楼层\r\n */\r\nexport const gotoFloor = function () {\r\n    if (Info.floor && Info.floor > 0) {\r\n        let hashName = $(`article[data-floor=\"${Info.floor}\"]`).prev('a').attr('name');\r\n        if (hashName) location.hash = '#' + hashName;\r\n    }\r\n};\r\n\r\n/**\r\n * 处理快速跳转到指定楼层按钮\r\n */\r\nexport const handleFastGotoFloorBtn = function () {\r\n    $('.fast-goto-floor').click(function (e) {\r\n        e.preventDefault();\r\n        let action = $(this).data('url');\r\n        if (!action) return;\r\n        let floor = parseInt(prompt('你要跳转到哪一层楼？'));\r\n        if (!floor || floor <= 0) return;\r\n        location.href = Util.makeUrl(action, `page=${Math.floor(floor / Config.perPageFloorNum) + 1}&floor=${floor}`);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理推帖子按钮\r\n */\r\nexport const handleTuiThreadBtn = function () {\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: '/diy_read_tui.php',\r\n            data: `tid=${Info.tid}&safeid=${Info.safeId}`,\r\n            success: function (msg) {\r\n                let matches = /<span.+?\\+\\d+!<\\/span>\\s*(\\d+)/i.exec(msg);\r\n                if (matches) {\r\n                    let $num = $this.find('span:first');\r\n                    $num.text('+1');\r\n                    setTimeout(() => {\r\n                        $num.text(matches[1]);\r\n                    }, 1000);\r\n                }\r\n                else if (/已推过/.test(msg)) {\r\n                    alert('已推过');\r\n                }\r\n                else {\r\n                    alert('操作失败');\r\n                }\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 处理复制代码按钮\r\n */\r\nexport const handleCopyCodeBtn = function () {\r\n    $(document).on('click', '.copy-code', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if (Util.copyText($this.next('pre'), $this)) return;\r\n\r\n        let code = $this.data('code');\r\n        if (code) {\r\n            $this.text('复制代码').removeData('code');\r\n            $this.next('textarea').remove();\r\n            $this.after(`<pre class=\"pre-scrollable\">${code}</pre>`);\r\n        }\r\n        else {\r\n            let $pre = $this.next('pre');\r\n            let html = $pre.html();\r\n            $this.text('还原代码').data('code', html);\r\n            html = Util.decodeHtmlSpecialChar(html);\r\n            let height = $pre.height();\r\n            if (height < 50) height = 50;\r\n            if (height > 340) height = 340;\r\n            $pre.remove();\r\n            $(`<textarea class=\"form-control code-textarea\" style=\"height: ${height}px\" wrap=\"off\">${html}</textarea>`)\r\n                .insertAfter($this).select().focus();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 获取当前页面选中的多重引用数据\r\n * @returns {{}[]} 多重引用数据列表\r\n */\r\nconst getCheckedMultiQuoteData = function () {\r\n    let quoteList = [];\r\n    $('.multi-quote-check:checked').each(function () {\r\n        let $article = $(this).closest('article');\r\n        quoteList.push({floor: $article.data('floor'), pid: $article.data('pid'), userName: $article.data('username')});\r\n    });\r\n    return quoteList;\r\n};\r\n\r\n/**\r\n * 绑定多重引用复选框点击事件\r\n */\r\nexport const bindMultiQuoteCheckClick = function () {\r\n    $(document).on('click', '.multi-quote-check', function () {\r\n        let data = localStorage[Const.multiQuoteStorageName];\r\n        if (data) {\r\n            try {\r\n                data = JSON.parse(data);\r\n                if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) data = null;\r\n                else if (!('tid' in data) || data.tid !== Info.tid || $.type(data.quoteList) !== 'object') data = null;\r\n            }\r\n            catch (ex) {\r\n                data = null;\r\n            }\r\n        }\r\n        else {\r\n            data = null;\r\n        }\r\n        let quoteList = getCheckedMultiQuoteData();\r\n        if (!data) {\r\n            localStorage.removeItem(Const.multiQuoteStorageName);\r\n            data = {tid: Info.tid, quoteList: {}};\r\n        }\r\n        if (quoteList.length > 0) data.quoteList[Info.currentPageNum] = quoteList;\r\n        else delete data.quoteList[Info.currentPageNum];\r\n        localStorage[Const.multiQuoteStorageName] = JSON.stringify(data);\r\n    });\r\n};\r\n\r\n/**\r\n * 添加用户自定义备注\r\n */\r\nexport const addUserMemo = function () {\r\n    if ($.isEmptyObject(Config.userMemoList)) return;\r\n    $('.read-floor').each(function () {\r\n        let $this = $(this);\r\n        let userName = $this.data('username');\r\n        let key = Object.keys(Config.userMemoList).find(name => name === userName);\r\n        if (!key) return;\r\n        $this.find('.floor-user').after(\r\n            `<span class=\"tips font-size-sm\" data-toggle=\"tooltip\" title=\"备注：${Config.userMemoList[key]}\">[?]</span>`\r\n        );\r\n    });\r\n};\r\n","/* 其它模块 */\r\n'use strict';\r\n\r\n/**\r\n * 设置Cookie\r\n * @param {string} name Cookie名称\r\n * @param {*} value Cookie值\r\n * @param {?Date} date Cookie有效期，留空则表示有效期为浏览器进程\r\n * @param {string} prefix Cookie名称前缀\r\n */\r\nexport const setCookie = function (name, value, date = null, prefix = Info.cookiePrefix) {\r\n    document.cookie = `${prefix}${name}=${encodeURI(value)}${!date ? '' : ';expires=' + date.toUTCString()};path=/;`;\r\n};\r\n\r\n/**\r\n * 获取Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} prefix Cookie名称前缀\r\n * @returns {?string} Cookie值\r\n */\r\nexport const getCookie = function (name, prefix = Info.cookiePrefix) {\r\n    let regex = new RegExp(`(^| )${prefix}${name}=([^;]*)(;|$)`);\r\n    let matches = document.cookie.match(regex);\r\n    if (!matches) return null;\r\n    else return decodeURI(matches[2]);\r\n};\r\n\r\n/**\r\n * 删除Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} prefix Cookie名称前缀\r\n */\r\nexport const deleteCookie = function (name, prefix = Info.cookiePrefix) {\r\n    document.cookie = `${prefix}${name}=;expires=${getDate('-1d').toUTCString()};path=/;`;\r\n};\r\n\r\n/**\r\n * 获取在当前时间的基础上的指定（相对）时间量的Date对象\r\n * @param {string} value 指定（相对）时间量，+或-：之后或之前（相对于当前时间）；无符号：绝对值；Y：完整年份；y：年；M：月；d：天；h：小时；m：分；s：秒；ms：毫秒\r\n * @returns {?Date} 指定（相对）时间量的Date对象\r\n * @example\r\n * Tools.getDate('+2y') 获取2年后的Date对象\r\n * Tools.getDate('+3M') 获取3个月后的Date对象\r\n * Tools.getDate('-4d') 获取4天前的Date对象\r\n * Tools.getDate('5h') 获取今天5点的Date对象（其它时间量与当前时间一致）\r\n * Tools.getDate('2015Y') 获取年份为2015年的Date对象\r\n */\r\nexport const getDate = function (value) {\r\n    let date = new Date();\r\n    let matches = /^(-|\\+)?(\\d+)([a-zA-Z]{1,2})$/.exec(value);\r\n    if (!matches) return null;\r\n    let flag = typeof matches[1] === 'undefined' ? 0 : (matches[1] === '+' ? 1 : -1);\r\n    let increment = flag === -1 ? -parseInt(matches[2]) : parseInt(matches[2]);\r\n    let unit = matches[3];\r\n    switch (unit) {\r\n        case 'Y':\r\n            date.setFullYear(increment);\r\n            break;\r\n        case 'y':\r\n            date.setFullYear(flag === 0 ? increment : date.getFullYear() + increment);\r\n            break;\r\n        case 'M':\r\n            date.setMonth(flag === 0 ? increment : date.getMonth() + increment);\r\n            break;\r\n        case 'd':\r\n            date.setDate(flag === 0 ? increment : date.getDate() + increment);\r\n            break;\r\n        case 'h':\r\n            date.setHours(flag === 0 ? increment : date.getHours() + increment);\r\n            break;\r\n        case 'm':\r\n            date.setMinutes(flag === 0 ? increment : date.getMinutes() + increment);\r\n            break;\r\n        case 's':\r\n            date.setSeconds(flag === 0 ? increment : date.getSeconds() + increment);\r\n            break;\r\n        case 'ms':\r\n            date.setMilliseconds(flag === 0 ? increment : date.getMilliseconds() + increment);\r\n            break;\r\n        default:\r\n            return null;\r\n    }\r\n    return date;\r\n};\r\n\r\n/**\r\n * 获取指定字符串的字节长度（1个GBK字符按2个字节来算）\r\n * @param {string} str 指定字符串\r\n * @returns {number} 字符串的长度\r\n */\r\nexport const getStrByteLen = function (str) {\r\n    let len = 0;\r\n    let cLen = 2;\r\n    for (let i = 0; i < str.length; i++) {\r\n        len += str.charCodeAt(i) < 0 || str.charCodeAt(i) > 255 ? cLen : 1;\r\n    }\r\n    return len;\r\n};\r\n\r\n/**\r\n * 获取当前域名的URL\r\n * @returns {string} 当前域名的URL\r\n */\r\nexport const getHostNameUrl = function () {\r\n    return location.protocol + '//' + location.host;\r\n};\r\n\r\n/**\r\n * 添加BBCode\r\n * @param textArea 文本框\r\n * @param {string} code BBCode\r\n * @param {string} selText 选择文本\r\n */\r\nexport const addCode = function (textArea, code, selText = '') {\r\n    let startPos = selText === '' ? code.indexOf(']') + 1 : code.indexOf(selText);\r\n    if (typeof textArea.selectionStart !== 'undefined') {\r\n        let prePos = textArea.selectionStart;\r\n        textArea.value = textArea.value.substring(0, prePos) + code + textArea.value.substring(textArea.selectionEnd);\r\n        textArea.selectionStart = prePos + startPos;\r\n        textArea.selectionEnd = prePos + startPos + selText.length;\r\n    }\r\n    else {\r\n        textArea.value += code;\r\n    }\r\n};\r\n\r\n/**\r\n * 获取选择文本\r\n * @param textArea 文本框\r\n * @returns {string} 选择文本\r\n */\r\nexport const getSelText = function (textArea) {\r\n    return textArea.value.substring(textArea.selectionStart, textArea.selectionEnd);\r\n};\r\n\r\n/**\r\n * 从URL查询字符串提取参数对象\r\n * @param {string} str URL查询字符串\r\n * @returns {Map} 参数集合\r\n */\r\nexport const extractQueryStr = function (str) {\r\n    let params = new Map();\r\n    for (let param of str.split('&')) {\r\n        if (!param) continue;\r\n        let [key, value] = param.split('=');\r\n        params.set(key, typeof value !== 'undefined' ? value : '');\r\n    }\r\n    return params;\r\n};\r\n\r\n/**\r\n * 从参数对象中创建URL查询字符串\r\n * @param {Map} map 参数集合\r\n * @returns {string} URL查询字符串\r\n */\r\nexport const buildQueryStr = function (map) {\r\n    let queryStr = '';\r\n    for (let [key, value] of map) {\r\n        if (Info.urlType === 2) {\r\n            queryStr += (queryStr ? '&' : '') + key + '=' + value;\r\n        }\r\n        else {\r\n            queryStr += (queryStr ? '/' : '') + key + '/' + value;\r\n        }\r\n    }\r\n    return queryStr;\r\n};\r\n\r\n/**\r\n * 生成指定的URL\r\n * @param {string} action 控制器（小写）\r\n * @param {string} param 查询参数\r\n * @param {boolean} includeOtherParam 是否包括当前页面的其它查询参数\r\n * @param {[]} excludeParams 要排除当前页面的查询参数列表\r\n * @returns {string} URL 最终的URL\r\n */\r\nexport const makeUrl = function (action, param = '', includeOtherParam = false, excludeParams = []) {\r\n    let url = '';\r\n    let paramList = extractQueryStr(param);\r\n    if (includeOtherParam) {\r\n        paramList = new Map([...extractQueryStr(Info.urlParam).entries(), ...paramList.entries()]);\r\n        for (let i in excludeParams) {\r\n            paramList.delete(excludeParams[i]);\r\n        }\r\n    }\r\n    if (!action.startsWith('/')) {\r\n        if (location.pathname.startsWith(Info.baseFile)) url = Info.baseFile + '/';\r\n        else url = Info.rootPath;\r\n    }\r\n    url += action;\r\n    if (paramList.size > 0) {\r\n        let queryStr = buildQueryStr(paramList);\r\n        if (queryStr) {\r\n            url += (Info.urlType === 2 ? '?' : '/') + queryStr;\r\n        }\r\n    }\r\n    return url;\r\n};\r\n\r\n/**\r\n * 获取URL查询字符串中的指定参数\r\n * @param {string} name 参数名称\r\n * @returns {?string} 参数值\r\n */\r\nexport const getQueryParam = function (name) {\r\n    return extractQueryStr(Info.urlParam).get(name);\r\n};\r\n\r\n/**\r\n * 解码HTML特殊字符\r\n * @param {string} str 待解码的字符串\r\n * @returns {string} 解码后的字符串\r\n */\r\nexport const decodeHtmlSpecialChar = function (str) {\r\n    if (!str.length) return '';\r\n    return str.replace(/<br\\s*\\/?>/gi, '\\n')\r\n        .replace(/&quot;/gi, '\\\"')\r\n        .replace(/&#39;/gi, '\\'')\r\n        .replace(/&nbsp;/gi, ' ')\r\n        .replace(/&gt;/gi, '>')\r\n        .replace(/&lt;/gi, '<')\r\n        .replace(/&amp;/gi, '&');\r\n};\r\n\r\n/**\r\n * 全选\r\n * @param {jQuery} $nodes 想要全选的节点的jQuery对象\r\n */\r\nexport const selectAll = function ($nodes) {\r\n    $nodes.prop('checked', true);\r\n};\r\n\r\n/**\r\n * 反选\r\n * @param {jQuery} $nodes 想要反选的节点的jQuery对象\r\n */\r\nexport const selectInverse = function ($nodes) {\r\n    $nodes.each(function () {\r\n        let $this = $(this);\r\n        $this.prop('checked', !$this.prop('checked'));\r\n    });\r\n};\r\n\r\n/**\r\n * 显示字段验证消息\r\n * @param {jQuery} $node 验证字段的jQuery对象\r\n * @param {string} type 验证类型\r\n * @param {string} msg 验证消息\r\n */\r\nexport const showValidationMsg = function ($node, type, msg = '') {\r\n    if (type === 'error') type = 'danger';\r\n    $node.removeClass('form-control-success form-control-warning form-control-danger');\r\n    let $parent = $node.parent();\r\n    $parent.removeClass('has-success has-warning has-danger');\r\n    if ($.inArray(type, ['success', 'warning', 'danger'] > -1)) {\r\n        $node.addClass('form-control-' + type).parent().addClass('has-' + type);\r\n    }\r\n    let $feedback = $parent.find('.form-control-feedback');\r\n    if (type === 'wait') {\r\n        $feedback.html(`<span class=\"text-muted\"><i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i> ${msg}</span>`);\r\n    }\r\n    else {\r\n        $feedback.text(msg);\r\n    }\r\n};\r\n\r\n/**\r\n * 获取对象A在对象B中的相对补集\r\n * @param {Object} a 对象A\r\n * @param {Object} b 对象B\r\n * @returns {Object} 相对补集\r\n */\r\nexport const getDifferenceSetOfObject = function (a, b) {\r\n    let c = {};\r\n    if ($.type(a) !== 'object' || $.type(b) !== 'object') return c;\r\n    $.each(b, (key, data) => {\r\n        if (key in a) {\r\n            if (!deepEqual(a[key], data)) c[key] = data;\r\n        }\r\n    });\r\n    return c;\r\n};\r\n\r\n/**\r\n * 深度比较两个对象是否相等\r\n * @param {*} a\r\n * @param {*} b\r\n * @returns {boolean} 是否相等\r\n */\r\nexport const deepEqual = function (a, b) {\r\n    if (a === b) return true;\r\n    if ($.type(a) !== $.type(b)) return false;\r\n    if (typeof a === 'number' && typeof b === 'number' && isNaN(a) && isNaN(b)) return true;\r\n    if ($.isArray(a) && $.isArray(b) || $.type(a) === 'object' && $.type(b) === 'object') {\r\n        if (a.length !== b.length) return false;\r\n        for (var i in $.extend($.isArray(a) ? [] : {}, a, b)) {\r\n            if (typeof a[i] === 'undefined' || typeof b[i] === 'undefined') return false;\r\n            if (!deepEqual(a[i], b[i])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * 复制文本\r\n * @param {jQuery} $target 要复制文本的目标元素\r\n * @param {?jQuery} $source 触发事件的源元素\r\n * @returns {boolean} 是否复制成功\r\n */\r\nexport const copyText = function ($target, $source = null) {\r\n    if (!('execCommand' in document) || !$target.length) return false;\r\n    let copyText = $target.data('copy-text');\r\n    if (copyText) {\r\n        $target = $(`<span class=\"text-hide\">${copyText}</span>`).insertAfter($target);\r\n    }\r\n    let s = window.getSelection();\r\n    s.selectAllChildren($target.get(0));\r\n    let result = document.execCommand('copy');\r\n    s.removeAllRanges();\r\n    if (copyText) $target.remove();\r\n    if (result && $source) {\r\n        let msg = $source.data('copy-msg');\r\n        $source.attr('title', msg ? msg : '已复制').on('hidden.bs.tooltip', function () {\r\n            $(this).tooltip('dispose');\r\n        }).tooltip('show');\r\n    }\r\n    return result;\r\n};\r\n\r\n/**\r\n * 获取指定用户名在关注或屏蔽列表中的索引号\r\n * @param {string} name 指定用户名\r\n * @param {Array} list 指定列表\r\n * @returns {number} 指定用户在列表中的索引号，-1表示不在该列表中\r\n */\r\nexport const inFollowOrBlockUserList = (name, list) => list.findIndex(data => data.name && data.name === name);\r\n\r\n/**\r\n * 检测浏览器是否为Opera\r\n * @returns {boolean} 是否为Opera\r\n */\r\nexport const isOpera = () => typeof window.opera !== 'undefined';\r\n\r\n/**\r\n * 检测浏览器是否为Edge\r\n * @returns {boolean} 是否为Edge\r\n */\r\nexport const isEdge = () => navigator.appVersion && navigator.appVersion.includes('Edge');\r\n","/* 配置模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\n\r\n// 配置名称\r\nconst name = 'kf_config';\r\n\r\n/**\r\n * 配置类\r\n */\r\nexport const Config = {\r\n    // 当前激活的最新回复面板\r\n    activeNewReplyPanel: '#galgameNewReplyPanel',\r\n    // 当前激活的当前推荐面板\r\n    activeTopRecommendPanel: '#galgameTopRecommendPanel',\r\n    // 常用版块列表\r\n    commonForumList: [],\r\n\r\n    // 是否显示侧边栏按钮组，true：开启；false：关闭\r\n    showSidebarBtnGroupEnabled: true,\r\n    // 是否显示侧边栏的滚动到页顶/页底按钮，true：开启；false：关闭\r\n    showSidebarRollBtnEnabled: true,\r\n    // 是否显示侧边栏的主菜单按钮，true：开启；false：关闭\r\n    showSidebarMainMenuBtnEnabled: false,\r\n    // 是否显示侧边栏的版块列表按钮，true：开启；false：关闭\r\n    showSidebarForumListBtnEnabled: true,\r\n    // 是否显示侧边栏的搜索按钮，true：开启；false：关闭\r\n    showSidebarSearchBtnEnabled: false,\r\n    // 是否显示侧边栏的首页按钮，true：开启；false：关闭\r\n    showSidebarHomePageBtnEnabled: true,\r\n\r\n    // 主题每页楼层数量，用于电梯直达等功能，如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目\r\n    perPageFloorNum: 10,\r\n    // 主题内容字体大小，设为0表示使用默认大小，默认值：14px\r\n    threadContentFontSize: 0,\r\n    // 是否在楼层内的用户名旁显示该用户的自定义备注，true：开启；false：关闭\r\n    userMemoEnabled: false,\r\n    // 用户自定义备注列表，格式：{'用户名':'备注'}，例：{'李四':'张三的马甲','王五':'张三的另一个马甲'}\r\n    userMemoList: {},\r\n    // 是否在发帖框上显示绯月表情增强插件，true：开启；false：关闭\r\n    kfSmileEnhanceExtensionEnabled: false,\r\n\r\n    // 默认的消息显示时间（秒），设置为-1表示永久显示\r\n    defShowMsgDuration: -1,\r\n    // 是否为页面添加自定义的CSS内容，true：开启；false：关闭\r\n    customCssEnabled: false,\r\n    // 自定义CSS的内容\r\n    customCssContent: '',\r\n\r\n    // 是否开启关注用户的功能，true：开启；false：关闭\r\n    followUserEnabled: false,\r\n    // 关注用户列表，格式：[{name:'用户名'}]，例：[{name:'张三'}, {name:'李四'}]\r\n    followUserList: [],\r\n    // 是否高亮所关注用户在首页下的主题链接，true：开启；false：关闭\r\n    highlightFollowUserThreadInHPEnabled: true,\r\n    // 是否高亮所关注用户在主题列表页面下的主题链接，true：开启；false：关闭\r\n    highlightFollowUserThreadLinkEnabled: true,\r\n    // 是否开启屏蔽用户的功能，true：开启；false：关闭\r\n    blockUserEnabled: false,\r\n    // 屏蔽用户的默认屏蔽类型，0：屏蔽主题和回贴；1：仅屏蔽主题；2：仅屏蔽回贴\r\n    blockUserDefaultType: 0,\r\n    // 是否屏蔽被屏蔽用户的@提醒，true：开启；false：关闭\r\n    blockUserAtTipsEnabled: true,\r\n    // 屏蔽用户的版块屏蔽范围，0：所有版块；1：包括指定的版块；2：排除指定的版块\r\n    blockUserForumType: 0,\r\n    // 屏蔽用户的版块ID列表，例：[16, 41, 67, 57, 84, 92, 127, 68, 163, 182, 9]\r\n    blockUserFidList: [],\r\n    // 屏蔽用户列表，格式：[{name:'用户名', type:屏蔽类型}]，例：[{name:'张三', type:0}, {name:'李四', type:1}]\r\n    blockUserList: [],\r\n    // 是否开启屏蔽标题包含指定关键字的主题的功能，true：开启；false：关闭\r\n    blockThreadEnabled: false,\r\n    // 屏蔽主题的默认版块屏蔽范围，0：所有版块；1：包括指定的版块；2：排除指定的版块\r\n    blockThreadDefForumType: 0,\r\n    // 屏蔽主题的默认版块ID列表，例：[16, 41, 67, 57, 84, 92, 127, 68, 163, 182, 9]\r\n    blockThreadDefFidList: [],\r\n    // 屏蔽主题的关键字列表，格式：[{keyWord:'关键字', includeUser:['包括的用户名'], excludeUser:['排除的用户名'], includeFid:[包括指定的版块ID], excludeFid:[排除指定的版块ID]}]\r\n    // 关键字可使用普通字符串或正则表达式（正则表达式请使用'/abc/'的格式），includeUser、excludeUser、includeFid和excludeFid这三项为可选\r\n    // 例：[{keyWord: '标题1'}, {keyWord: '标题2', includeUser:['用户名1', '用户名2'], includeFid: [5, 56]}, {keyWord: '/关键字A.*关键字B/i', excludeFid: [92, 127, 68]}]\r\n    blockThreadList: [],\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\nexport const init = function () {\r\n    window.Config = $.extend(true, {}, Config);\r\n    read();\r\n};\r\n\r\n/**\r\n * 读取设置\r\n */\r\nexport const read = function () {\r\n    let options = localStorage[name];\r\n    if (!options) return;\r\n    try {\r\n        options = JSON.parse(options);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!options || $.type(options) !== 'object' || $.isEmptyObject(options)) return;\r\n    options = normalize(options);\r\n    window.Config = $.extend(true, {}, Config, options);\r\n};\r\n\r\n/**\r\n * 写入设置\r\n */\r\nexport const write = function () {\r\n    let options = Util.getDifferenceSetOfObject(Config, window.Config);\r\n    localStorage[name] = JSON.stringify(options);\r\n};\r\n\r\n/**\r\n * 清空设置\r\n */\r\nexport const clear = function () {\r\n    localStorage.removeItem(name);\r\n};\r\n\r\n/**\r\n * 获取经过规范化的Config对象\r\n * @param {{}} options 待处理的Config对象\r\n * @returns {{}} 经过规范化的Config对象\r\n */\r\nexport const normalize = function (options) {\r\n    let settings = {};\r\n    if ($.type(options) !== 'object') return settings;\r\n    for (let [key, value] of Object.entries(options)) {\r\n        if (key in Config && $.type(value) === $.type(Config[key])) {\r\n            settings[key] = value;\r\n        }\r\n    }\r\n    return settings;\r\n};\r\n","/* 设置对话框模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport * as Dialog from './dialog';\r\nimport {\r\n    read as readConfig,\r\n    write as writeConfig,\r\n    clear as clearConfig,\r\n    normalize as normalizeConfig,\r\n    Config as defConfig,\r\n} from './config';\r\nimport * as Public from './public';\r\n\r\n/**\r\n * 显示设置对话框\r\n */\r\nexport const show = function () {\r\n    const dialogName = 'configDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"showSidebarBtnGroupEnabled\" type=\"checkbox\"> 显示侧边栏按钮组\r\n      <span class=\"tips\" data-toggle=\"tooltip\" title=\"显示侧边栏按钮组，可在下方设置要显示的按钮\">[?]</span>\r\n    </label>\r\n  </legend>\r\n  <div class=\"mb-2 d-sm-inline-block\">\r\n    <div class=\"form-check form-check-inline\">\r\n      <label class=\"form-check-label\">\r\n        <input class=\"form-check-input\" name=\"showSidebarRollBtnEnabled\" type=\"checkbox\"> 滚动到页顶/页底\r\n      </label>\r\n    </div>\r\n    <div class=\"form-check form-check-inline\">\r\n      <label class=\"form-check-label\">\r\n        <input class=\"form-check-input\" name=\"showSidebarMainMenuBtnEnabled\" type=\"checkbox\"> 主菜单\r\n      </label>\r\n    </div>\r\n  </div>\r\n  <div class=\"mb-2 d-sm-inline-block ml-sm-3\">\r\n    <div class=\"form-check form-check-inline\">\r\n      <label class=\"form-check-label\">\r\n        <input class=\"form-check-input\" name=\"showSidebarForumListBtnEnabled\" type=\"checkbox\"> 版块列表\r\n      </label>\r\n    </div>\r\n    <div class=\"form-check form-check-inline\">\r\n      <label class=\"form-check-label\">\r\n        <input class=\"form-check-input\" name=\"showSidebarSearchBtnEnabled\" type=\"checkbox\"> 搜索\r\n      </label>\r\n    </div>\r\n    <div class=\"form-check form-check-inline\">\r\n      <label class=\"form-check-label\">\r\n        <input class=\"form-check-input\" name=\"showSidebarHomePageBtnEnabled\" type=\"checkbox\"> 首页\r\n      </label>\r\n    </div>\r\n  </div>\r\n</fieldset>\r\n\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>主题页面相关</legend>\r\n  <div class=\"form-group mb-2\">\r\n    <label for=\"perPageFloorNum\">主题每页楼层数量</label>\r\n    <select class=\"custom-select custom-select-sm\" id=\"perPageFloorNum\" name=\"perPageFloorNum\">\r\n      <option value=\"10\">10</option><option value=\"20\">20</option><option value=\"30\">30</option>\r\n    </select>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"主题页面中每页的楼层数量（用于电梯直达等功能），如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目\">[?]</span>\r\n  </div>\r\n  <div class=\"input-group mb-2\">\r\n    <span class=\"input-group-addon\">主题内容字体大小</span>\r\n    <input class=\"form-control\" name=\"threadContentFontSize\" data-toggle=\"tooltip\" type=\"number\" min=\"8\" max=\"72\"\r\n           title=\"主题内容字体大小，留空表示使用默认大小，默认值：14px\">\r\n    <span class=\"input-group-addon\">px</span>\r\n  </div>\r\n  <div class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"userMemoEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openUserMemoDialog]\"> 显示用户备注\r\n    </label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"在楼层内的用户名旁显示该用户的自定义备注\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openUserMemoDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  <div class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"kfSmileEnhanceExtensionEnabled\" type=\"checkbox\"> 开启绯月表情增强插件\r\n    </label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"在发帖框上显示绯月表情增强插件，该插件由eddie32开发\">[?]</span>\r\n  </div>\r\n</fieldset>\r\n\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>其它设置</legend>\r\n  <div class=\"input-group mb-2\">\r\n    <span class=\"input-group-addon\">消息显示时间</span>\r\n    <input class=\"form-control\" name=\"defShowMsgDuration\" data-toggle=\"tooltip\" type=\"number\" min=\"-1\" required\r\n           title=\"默认的消息显示时间（秒），设置为-1表示永久显示，例：15\">\r\n    <span class=\"input-group-addon\">秒</span>\r\n  </div>\r\n  <div class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"customCssEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openCustomCssDialog]\"> 添加自定义CSS\r\n    </label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"为页面添加自定义的CSS内容，请点击详细设置填写自定义的CSS内容\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openCustomCssDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n</fieldset>\r\n\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>关注和屏蔽</legend>\r\n  <div class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"followUserEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openFollowUserDialog]\"> 关注用户\r\n    </label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openFollowUserDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  <div class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"blockUserEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openBlockUserDialog]\"> 屏蔽用户\r\n    </label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openBlockUserDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  <div class=\"form-check\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"blockThreadEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openBlockThreadDialog]\"> 屏蔽主题\r\n    </label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"开启屏蔽标题中包含指定关键字的主题的功能，请点击详细设置管理屏蔽关键字\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openBlockThreadDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n</fieldset>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImportOrExportSettingDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>\r\n<button class=\"btn btn-danger\" name=\"reset\" type=\"button\">重置</button>`;\r\n    let $dialog = Dialog.create(dialogName, '助手设置', bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        readConfig();\r\n        let options = getMainConfigValue($dialog);\r\n        options = normalizeConfig(options);\r\n        $.extend(Config, options);\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).on('click', 'a[data-name^=\"open\"][href=\"#\"]', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.hasClass('disabled-link')) return;\r\n        let name = $this.data('name');\r\n        if (name === 'openUserMemoDialog') showUserMemoDialog();\r\n        else if (name === 'openCustomCssDialog') showCustomCssDialog();\r\n        else if (name === 'openFollowUserDialog') showFollowUserDialog();\r\n        else if (name === 'openBlockUserDialog') showBlockUserDialog();\r\n        else if (name === 'openBlockThreadDialog') showBlockThreadDialog();\r\n    }).find('[name=\"reset\"]').click(function () {\r\n        if (confirm('是否重置所有设置？')) {\r\n            clearConfig();\r\n            alert('设置已重置');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        }\r\n    }).end().find('[name=\"openImportOrExportSettingDialog\"]').click(showImportOrExportSettingDialog);\r\n\r\n    setMainConfigValue($dialog);\r\n    Dialog.show(dialogName);\r\n};\r\n\r\n/**\r\n * 设置主对话框中的字段值\r\n * @param {jQuery} $dialog 助手设置对话框对象\r\n */\r\nconst setMainConfigValue = function ($dialog) {\r\n    $dialog.find('input[name], select[name]').each(function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        if (name in Config) {\r\n            if ($this.is('[type=\"checkbox\"]') && typeof Config[name] === 'boolean') $this.prop('checked', Config[name] === true);\r\n            else $this.val(Config[name]);\r\n        }\r\n    });\r\n    $dialog.find('[name=\"threadContentFontSize\"]').val(Config.threadContentFontSize > 0 ? Config.threadContentFontSize : '');\r\n};\r\n\r\n/**\r\n * 获取主对话框中字段值的Config对象\r\n * @param {jQuery} $dialog 助手设置对话框对象\r\n * @returns {{}} 字段值的Config对象\r\n */\r\nconst getMainConfigValue = function ($dialog) {\r\n    let options = {};\r\n    $dialog.find('input[name], select[name]').each(function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        if (name in Config) {\r\n            if ($this.is('[type=\"checkbox\"]') && typeof Config[name] === 'boolean')\r\n                options[name] = Boolean($this.prop('checked'));\r\n            else if (typeof Config[name] === 'number') {\r\n                options[name] = parseInt($this.val());\r\n                if (name === 'threadContentFontSize' && isNaN(options[name])) options[name] = 0;\r\n            }\r\n            else options[name] = $.trim($this.val());\r\n        }\r\n    });\r\n    return options;\r\n};\r\n\r\n/**\r\n * 显示导入或导出设置对话框\r\n */\r\nconst showImportOrExportSettingDialog = function () {\r\n    const dialogName = 'imOrExSettingDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\r\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可<br>\r\n  <span class=\"text-danger\">注：本设置与电脑版的KFOL助手并不完全通用</span>\r\n</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control\" name=\"setting\" rows=\"10\" aria-label=\"设置内容\" style=\"word-break: break-all;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, `导入或导出设置`, bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否导入文本框中的设置？')) return;\r\n        let options = $.trim($dialog.find('[name=\"setting\"]').val());\r\n        if (!options) return;\r\n        try {\r\n            options = JSON.parse(options);\r\n        }\r\n        catch (ex) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        if (!options || $.type(options) !== 'object') {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        options = normalizeConfig(options);\r\n        window.Config = $.extend(true, {}, defConfig, options);\r\n        writeConfig();\r\n        alert('设置已导入');\r\n        location.reload();\r\n    });\r\n    Dialog.show(dialogName);\r\n    $dialog.find('[name=\"setting\"]').val(JSON.stringify(Util.getDifferenceSetOfObject(defConfig, Config))).select().focus();\r\n};\r\n\r\n/**\r\n * 显示用户备注对话框\r\n */\r\nconst showUserMemoDialog = function () {\r\n    const dialogName = 'userMemoDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">按照<code>用户名:备注</code>的格式（注意是英文冒号），每行一个</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control\" name=\"userMemoList\" rows=\"13\" wrap=\"off\" aria-label=\"用户备注\" style=\"white-space: pre;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '用户备注', bodyContent, footerContent);\r\n    let $userMemoList = $dialog.find('[name=\"userMemoList\"]');\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        let content = $.trim($userMemoList.val());\r\n        Config.userMemoList = {};\r\n        for (let line of content.split('\\n')) {\r\n            line = $.trim(line);\r\n            if (!line) continue;\r\n            if (!/.+?:.+/.test(line)) {\r\n                alert('格式不正确');\r\n                $userMemoList.focus();\r\n                return;\r\n            }\r\n            let [user, memo = ''] = line.split(':');\r\n            if (!memo) continue;\r\n            Config.userMemoList[user.trim()] = memo.trim();\r\n        }\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    });\r\n\r\n    let content = '';\r\n    for (let [user, memo] of Object.entries(Config.userMemoList)) {\r\n        content += `${user}:${memo}\\n`;\r\n    }\r\n    Dialog.show(dialogName);\r\n    $userMemoList.val(content).focus();\r\n};\r\n\r\n/**\r\n * 显示自定义CSS对话框\r\n */\r\nconst showCustomCssDialog = function () {\r\n    const dialogName = 'customCssDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control\" name=\"customCssContent\" rows=\"15\" wrap=\"off\" aria-label=\"自定义CSS内容\" style=\"white-space: pre;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '自定义CSS', bodyContent, footerContent);\r\n    let $content = $dialog.find('[name=\"customCssContent\"]');\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.customCssContent = $.trim($content.val());\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n        alert('自定义CSS修改成功（需刷新页面后才可生效）');\r\n    });\r\n    Dialog.show(dialogName);\r\n    $content.val(Config.customCssContent).focus();\r\n};\r\n\r\n/**\r\n * 显示关注用户对话框\r\n */\r\nconst showFollowUserDialog = function () {\r\n    const dialogName = 'followUserDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<div class=\"form-check\">\r\n  <label class=\"form-check-label\">\r\n    <input class=\"form-check-input\" name=\"highlightFollowUserThreadInHpEnabled\" type=\"checkbox\"> 高亮所关注用户的首页主题链接\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"高亮所关注用户在首页下的主题链接\">[?]</span>\r\n  </label>\r\n</div>\r\n<div class=\"form-check mb-3\">\r\n  <label class=\"form-check-label\">\r\n    <input class=\"form-check-input\" name=\"highlightFollowUserThreadLinkEnabled\" type=\"checkbox\"> 高亮所关注用户的主题链接\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"高亮所关注用户在版块页面下的主题链接\">[?]</span>\r\n  </label>\r\n</div>\r\n<ul class=\"list-unstyled\" id=\"followUserList\"></ul>\r\n<div class=\"btn-group btn-group-sm mb-3\" role=\"group\">\r\n  <button class=\"btn btn-secondary\" name=\"selectAll\" type=\"button\">全选</button>\r\n  <button class=\"btn btn-secondary\" name=\"selectInverse\" type=\"button\">反选</button>\r\n  <button class=\"btn btn-danger\" name=\"deleteSelect\" type=\"button\">删除</button>\r\n</div>\r\n<div class=\"input-group mb-3\">\r\n  <input class=\"form-control\" name=\"addUser\" data-toggle=\"tooltip\" type=\"text\" title=\"添加多个用户请用英文逗号分隔\" aria-label=\"添加关注用户\">\r\n  <span class=\"input-group-btn\">\r\n    <button class=\"btn btn-success\" name=\"add\" type=\"button\">添加</button>\r\n  </span>\r\n</div>\r\n`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExFollowUserListDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '关注用户', bodyContent, footerContent);\r\n    let $followUserList = $dialog.find('#followUserList');\r\n\r\n    /**\r\n     * 添加关注用户\r\n     * @param {string} name 用户名\r\n     */\r\n    const addFollowUser = function (name) {\r\n        $(`\r\n<li class=\"input-group input-group-sm mb-2\">\r\n  <span class=\"input-group-addon\">\r\n    <input type=\"checkbox\" aria-label=\"选择用户\">\r\n  </span>\r\n  <input class=\"form-control\" name=\"userName\" type=\"text\" value=\"${name}\" maxlength=\"12\" aria-label=\"编辑关注用户\">\r\n  <span class=\"input-group-btn\">\r\n    <button class=\"btn btn-danger\" name=\"delete\" type=\"button\" aria-label=\"删除关注用户\">\r\n      <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\r\n    </button>\r\n  </span>\r\n</li>\r\n`).appendTo($followUserList);\r\n    };\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.highlightFollowUserThreadInHPEnabled = $dialog.find('[name=\"highlightFollowUserThreadInHpEnabled\"]').prop('checked');\r\n        Config.highlightFollowUserThreadLinkEnabled = $dialog.find('[name=\"highlightFollowUserThreadLinkEnabled\"]').prop('checked');\r\n        Config.followUserList = [];\r\n        $followUserList.find('li').each(function () {\r\n            let $this = $(this);\r\n            let name = $.trim($this.find('[name=\"userName\"]').val());\r\n            if (name !== '' && Util.inFollowOrBlockUserList(name, Config.followUserList) === -1) {\r\n                Config.followUserList.push({name});\r\n            }\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).find('[name=\"deleteSelect\"]').click(function () {\r\n        let $checked = $followUserList.find('li:has([type=\"checkbox\"]:checked)');\r\n        if (!$checked.length) return;\r\n        if (confirm('是否删除所选用户？')) $checked.remove();\r\n    }).end().find('[name=\"addUser\"]').keydown(function (e) {\r\n        if (e.keyCode === 13) {\r\n            e.preventDefault();\r\n            $(this).next().find('button').click();\r\n        }\r\n    }).end().find('[name=\"add\"]').click(function () {\r\n        let $addUser = $dialog.find('[name=\"addUser\"]');\r\n        for (let name of $.trim($addUser.val()).split(',')) {\r\n            name = $.trim(name);\r\n            if (!name) continue;\r\n            if (Util.inFollowOrBlockUserList(name, Config.followUserList) === -1) addFollowUser(name);\r\n        }\r\n        $addUser.val('');\r\n        $followUserList.find('li:last-child [type=\"checkbox\"]').focus();\r\n    }).end().find('[name=\"openImOrExFollowUserListDialog\"]').click(function (e) {\r\n        e.preventDefault();\r\n        Public.showCommonImportOrExportConfigDialog('关注用户', 'followUserList');\r\n    }).end().find('[name=\"selectAll\"]').click(() => Util.selectAll($followUserList.find('[type=\"checkbox\"]')))\r\n        .end().find('[name=\"selectInverse\"]').click(() => Util.selectInverse($followUserList.find('[type=\"checkbox\"]')));\r\n\r\n    $followUserList.on('click', '[name=\"delete\"]', function () {\r\n        $(this).closest('li').remove();\r\n    });\r\n\r\n    $dialog.find('[name=\"highlightFollowUserThreadInHpEnabled\"]').prop('checked', Config.highlightFollowUserThreadInHPEnabled);\r\n    $dialog.find('[name=\"highlightFollowUserThreadLinkEnabled\"]').prop('checked', Config.highlightFollowUserThreadLinkEnabled);\r\n    for (let user of Config.followUserList) {\r\n        addFollowUser(user.name);\r\n    }\r\n    Dialog.show(dialogName);\r\n};\r\n\r\n/**\r\n * 显示屏蔽用户对话框\r\n */\r\nconst showBlockUserDialog = function () {\r\n    const dialogName = 'blockUserDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<div class=\"form-group mb-2\">\r\n  <label for=\"blockUserDefaultType\">默认屏蔽类型</label>\r\n  <select class=\"custom-select custom-select-sm\" id=\"blockUserDefaultType\" name=\"blockUserDefaultType\">\r\n    <option value=\"0\">主题和回帖</option><option value=\"1\">主题</option><option value=\"2\">回帖</option>\r\n  </select>\r\n  <div class=\"form-check form-check-inline ml-3\">\r\n    <label class=\"form-check-label\">\r\n      <input class=\"form-check-input\" name=\"blockUserAtTipsEnabled\" type=\"checkbox\"> 屏蔽@提醒\r\n      <span class=\"tips\" data-toggle=\"tooltip\" title=\"屏蔽被屏蔽用户的@提醒\">[?]</span>\r\n    </label>\r\n  </div>\r\n</div>\r\n<div class=\"form-group mb-2\">\r\n  <label for=\"blockUserForumType\">版块屏蔽范围</label>\r\n  <select class=\"custom-select custom-select-sm\" id=\"blockUserForumType\" name=\"blockUserForumType\">\r\n    <option value=\"0\">所有版块</option><option value=\"1\">包括指定版块</option><option value=\"2\">排除指定版块</option>\r\n  </select>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>版块ID列表</label>\r\n  <span class=\"tips\" data-toggle=\"tooltip\" title=\"版块URL中的fid参数，多个ID请用英文逗号分隔\">[?]</span>\r\n  <input class=\"form-control form-control-sm\" name=\"blockUserFidList\" type=\"text\">\r\n</div>\r\n<ul class=\"list-unstyled\" id=\"blockUserList\"></ul>\r\n<div class=\"btn-group btn-group-sm mb-3\" role=\"group\">\r\n  <button class=\"btn btn-secondary\" name=\"selectAll\" type=\"button\">全选</button>\r\n  <button class=\"btn btn-secondary\" name=\"selectInverse\" type=\"button\">反选</button>\r\n  <div class=\"btn-group btn-group-sm dropup\">\r\n    <button class=\"btn btn-info dropdown-toggle\" data-toggle=\"dropdown\" type=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\">\r\n      修改为\r\n    </button>\r\n    <div class=\"dropdown-menu\" data-name=\"modifyMenu\">\r\n      <a class=\"dropdown-item\" data-value=\"0\" href=\"#\">主题和回帖</a>\r\n      <a class=\"dropdown-item\" data-value=\"1\" href=\"#\">主题</a>\r\n      <a class=\"dropdown-item\" data-value=\"2\" href=\"#\">回帖</a>\r\n    </div>\r\n  </div>\r\n  <button class=\"btn btn-danger\" name=\"deleteSelect\" type=\"button\">删除</button>\r\n</div>\r\n<div class=\"input-group mb-3\">\r\n  <input class=\"form-control\" name=\"addUser\" data-toggle=\"tooltip\" type=\"text\" title=\"添加多个用户请用英文逗号分隔\" aria-label=\"添加屏蔽用户\">\r\n  <span class=\"input-group-btn\">\r\n    <button class=\"btn btn-success\" name=\"add\" type=\"button\">添加</button>\r\n  </span>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExBlockUserListDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '屏蔽用户', bodyContent, footerContent);\r\n    let $blockUserList = $dialog.find('#blockUserList');\r\n\r\n    /**\r\n     * 添加屏蔽用户\r\n     * @param {string} name 用户名\r\n     * @param {number} type 屏蔽类型\r\n     */\r\n    const addBlockUser = function (name, type) {\r\n        $(`\r\n<li class=\"form-group row no-gutters mb-2\">\r\n  <div class=\"col-7 input-group input-group-sm\">\r\n    <span class=\"input-group-addon\">\r\n      <input type=\"checkbox\" aria-label=\"选择用户\">\r\n    </span>\r\n    <input class=\"form-control\" name=\"userName\" type=\"text\" value=\"${name}\" maxlength=\"12\" aria-label=\"编辑屏蔽用户\">\r\n  </div>\r\n  <div class=\"col-5 input-group input-group-sm\">\r\n    <select class=\"form-control\" name=\"blockType\">\r\n      <option value=\"0\">主题和回帖</option><option value=\"1\">主题</option><option value=\"2\">回帖</option>\r\n    </select>\r\n    <span class=\"input-group-btn\">\r\n      <button class=\"btn btn-danger\" name=\"delete\" type=\"button\" aria-label=\"删除屏蔽用户\">\r\n        <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\r\n      </button>\r\n    </span>\r\n  </div>\r\n</li>\r\n`).appendTo($blockUserList).find('[name=\"blockType\"]').val(type);\r\n    };\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.blockUserDefaultType = parseInt($dialog.find('[name=\"blockUserDefaultType\"]').val());\r\n        Config.blockUserAtTipsEnabled = $dialog.find('[name=\"blockUserAtTipsEnabled\"]').prop('checked');\r\n        Config.blockUserForumType = parseInt($dialog.find('[name=\"blockUserForumType\"]').val());\r\n        let blockUserFidList = new Set();\r\n        for (let fid of $.trim($dialog.find('[name=\"blockUserFidList\"]').val()).split(',')) {\r\n            fid = parseInt(fid);\r\n            if (!isNaN(fid) && fid > 0) blockUserFidList.add(fid);\r\n        }\r\n        Config.blockUserFidList = [...blockUserFidList];\r\n        Config.blockUserList = [];\r\n        $blockUserList.find('li').each(function () {\r\n            let $this = $(this);\r\n            let name = $.trim($this.find('[name=\"userName\"]').val());\r\n            if (name && Util.inFollowOrBlockUserList(name, Config.blockUserList) === -1) {\r\n                let type = parseInt($this.find('[name=\"blockType\"]').val());\r\n                Config.blockUserList.push({name, type});\r\n            }\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).find('[data-name=\"modifyMenu\"]').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let value = parseInt($(this).data('value'));\r\n        $blockUserList.find('li:has([type=\"checkbox\"]:checked) select').val(value);\r\n    }).end().find('[name=\"deleteSelect\"]').click(function () {\r\n        let $checked = $blockUserList.find('li:has([type=\"checkbox\"]:checked)');\r\n        if (!$checked.length) return;\r\n        if (confirm('是否删除所选用户？')) $checked.remove();\r\n    }).end().find('[name=\"addUser\"]').keydown(function (e) {\r\n        if (e.keyCode === 13) {\r\n            e.preventDefault();\r\n            $(this).next().find('button').click();\r\n        }\r\n    }).end().find('[name=\"add\"]').click(function () {\r\n        let $addUser = $dialog.find('[name=\"addUser\"]');\r\n        let type = parseInt($dialog.find('[name=\"blockUserDefaultType\"]').val());\r\n        for (let name of $.trim($addUser.val()).split(',')) {\r\n            name = $.trim(name);\r\n            if (!name) continue;\r\n            if (Util.inFollowOrBlockUserList(name, Config.blockUserList) === -1) addBlockUser(name, type);\r\n        }\r\n        $addUser.val('');\r\n        $blockUserList.find('li:last-child [type=\"checkbox\"]').focus();\r\n    }).end().find('[name=\"blockUserForumType\"]').change(function () {\r\n        $dialog.find('[name=\"blockUserFidList\"]').prop('disabled', parseInt($(this).val()) === 0);\r\n    }).end().find('[name=\"openImOrExBlockUserListDialog\"]').click(function (e) {\r\n        e.preventDefault();\r\n        Public.showCommonImportOrExportConfigDialog('屏蔽用户', 'blockUserList');\r\n    }).end().find('[name=\"selectAll\"]').click(() => Util.selectAll($blockUserList.find('[type=\"checkbox\"]')))\r\n        .end().find('[name=\"selectInverse\"]').click(() => Util.selectInverse($blockUserList.find('[type=\"checkbox\"]')));\r\n\r\n    $blockUserList.on('click', '[name=\"delete\"]', function () {\r\n        $(this).closest('li').remove();\r\n    });\r\n\r\n    $dialog.find('[name=\"blockUserDefaultType\"]').val(Config.blockUserDefaultType);\r\n    $dialog.find('[name=\"blockUserAtTipsEnabled\"]').prop('checked', Config.blockUserAtTipsEnabled);\r\n    $dialog.find('[name=\"blockUserForumType\"]').val(Config.blockUserForumType).triggerHandler('change');\r\n    $dialog.find('[name=\"blockUserFidList\"]').val(Config.blockUserFidList.join(','));\r\n    for (let user of Config.blockUserList) {\r\n        addBlockUser(user.name, user.type);\r\n    }\r\n    Dialog.show(dialogName);\r\n};\r\n\r\n/**\r\n * 显示屏蔽主题对话框\r\n */\r\nconst showBlockThreadDialog = function () {\r\n    const dialogName = 'blockThreadDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\r\n  用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\r\n</p>\r\n<div class=\"form-group mb-2\">\r\n  <label for=\"blockThreadDefForumType\">默认版块屏蔽范围</label>\r\n  <select class=\"custom-select custom-select-sm\" id=\"blockThreadDefForumType\" name=\"blockThreadDefForumType\">\r\n    <option value=\"0\">所有版块</option><option value=\"1\">包括指定版块</option><option value=\"2\">排除指定版块</option>\r\n  </select>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label for=\"blockThreadDefFidList\">默认版块ID列表</label>\r\n  <input class=\"form-control form-control-sm\" id=\"blockThreadDefFidList\" name=\"blockThreadDefFidList\" type=\"text\">\r\n</div>\r\n<div class=\"table-responsive\">\r\n  <table class=\"table table-sm table-hover table-center text-nowrap\">\r\n    <thead>\r\n      <tr>\r\n        <th>标题关键字(必填)</th>\r\n        <th>屏蔽用户</th>\r\n        <th>用户名</th>\r\n        <th>屏蔽范围</th>\r\n        <th>版块ID</th>\r\n        <th></th>\r\n      </tr>\r\n    </thead>\r\n    <tbody id=\"blockThreadList\"></tbody>\r\n  </table>\r\n</div>\r\n<div class=\"btn-group btn-group-sm mb-3\" role=\"group\">\r\n  <button class=\"btn btn-success\" name=\"add\" type=\"button\">增加</button>\r\n  <button class=\"btn btn-danger\" name=\"clear\" type=\"button\">清空</button>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExBlockThreadListDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '屏蔽主题', bodyContent, footerContent);\r\n    let $blockThreadList = $dialog.find('#blockThreadList');\r\n\r\n    /**\r\n     * 添加屏蔽主题\r\n     * @param {string} keyWord 标题关键字\r\n     * @param {number} userType 屏蔽用户，0：所有；1：包括；2：排除\r\n     * @param {string[]} userList 用户名\r\n     * @param {number} fidType 屏蔽范围，0：所有；1：包括；2：排除\r\n     * @param {number[]} fidList 版块ID列表\r\n     */\r\n    const addBlockThread = function (keyWord, userType, userList, fidType, fidList) {\r\n        $(`\r\n<tr>\r\n  <td>\r\n    <input class=\"form-control form-control-sm\" name=\"keyWord\" type=\"text\" value=\"${keyWord}\" aria-label=\"标题关键字\" style=\"min-width: 12rem;\">\r\n  </td>\r\n  <td>\r\n    <select class=\"form-control form-control-sm\" name=\"userType\" aria-label=\"屏蔽用户类型\" style=\"min-width: 4.5rem;\">\r\n      <option value=\"0\">所有</option><option value=\"1\">包括</option><option value=\"2\">排除</option>\r\n    </select>\r\n  </td>\r\n  <td>\r\n    <input class=\"form-control form-control-sm\" name=\"userList\" type=\"text\" value=\"${userList.join(',')}\" aria-label=\"用户名\"\r\n           ${userType === 0 ? 'disabled' : ''} style=\"min-width: 12rem;\">\r\n  </td>\r\n  <td>\r\n    <select class=\"form-control form-control-sm\" name=\"fidType\" aria-label=\"屏蔽范围\" style=\"min-width: 4.5rem;\">\r\n      <option value=\"0\">所有</option><option value=\"1\">包括</option><option value=\"2\">排除</option>\r\n    </select>\r\n  </td>\r\n  <td>\r\n    <input class=\"form-control form-control-sm\" name=\"fidList\" type=\"text\" value=\"${fidList.join(',')}\" aria-label=\"版块ID列表\"\r\n           ${fidType === 0 ? 'disabled' : ''} style=\"min-width: 9rem;\">\r\n  </td>\r\n  <td class=\"text-left\">\r\n    <button class=\"btn btn-danger btn-sm\" name=\"delete\" type=\"button\" aria-label=\"删除\">\r\n      <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\r\n    </button>\r\n  </td>\r\n</tr>\r\n`).appendTo($blockThreadList).find('[name=\"userType\"]').val(userType)\r\n            .end().find('[name=\"fidType\"]').val(fidType);\r\n    };\r\n\r\n    /**\r\n     * 验证设置是否正确\r\n     * @returns {boolean} 是否验证通过\r\n     */\r\n    const verify = function () {\r\n        let flag = true;\r\n        $blockThreadList.find('tr').each(function () {\r\n            let $this = $(this);\r\n            let $txtKeyWord = $this.find('[name=\"keyWord\"]');\r\n            let keyWord = $txtKeyWord.val();\r\n            if (!$.trim(keyWord)) return;\r\n            if (/^\\/.+\\/[gimuy]*$/.test(keyWord)) {\r\n                try {\r\n                    eval(keyWord);\r\n                }\r\n                catch (ex) {\r\n                    alert('正则表达式不正确');\r\n                    $txtKeyWord.select().focus();\r\n                    flag = false;\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n        return flag;\r\n    };\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!verify()) return;\r\n        Config.blockThreadDefForumType = parseInt($dialog.find('[name=\"blockThreadDefForumType\"]').val());\r\n        let blockThreadDefFidList = new Set();\r\n        for (let fid of $.trim($dialog.find('[name=\"blockThreadDefFidList\"]').val()).split(',')) {\r\n            fid = parseInt(fid);\r\n            if (!isNaN(fid) && fid > 0) blockThreadDefFidList.add(fid);\r\n        }\r\n        Config.blockThreadDefFidList = [...blockThreadDefFidList];\r\n        Config.blockThreadList = [];\r\n        $blockThreadList.find('tr').each(function () {\r\n            let $this = $(this);\r\n            let keyWord = $this.find('[name=\"keyWord\"]').val();\r\n            if (!$.trim(keyWord)) return;\r\n            let newObj = {keyWord};\r\n\r\n            let userType = parseInt($this.find('[name=\"userType\"]').val());\r\n            if (userType > 0) {\r\n                let userList = new Set();\r\n                for (let user of $.trim($this.find('[name=\"userList\"]').val()).split(',')) {\r\n                    user = $.trim(user);\r\n                    if (user) userList.add(user);\r\n                }\r\n                if (userList.size > 0) newObj[userType === 2 ? 'excludeUser' : 'includeUser'] = [...userList];\r\n            }\r\n\r\n            let fidType = parseInt($this.find('[name=\"fidType\"]').val());\r\n            if (fidType > 0) {\r\n                let fidList = new Set();\r\n                for (let fid of $.trim($this.find('[name=\"fidList\"]').val()).split(',')) {\r\n                    fid = parseInt(fid);\r\n                    if (!isNaN(fid) && fid > 0) fidList.add(fid);\r\n                }\r\n                if (fidList.size > 0) newObj[fidType === 2 ? 'excludeFid' : 'includeFid'] = [...fidList];\r\n            }\r\n            Config.blockThreadList.push(newObj);\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).find('[name=\"clear\"]').click(function () {\r\n        if (confirm('是否清除所有屏蔽关键字？')) $blockThreadList.html('');\r\n    }).end().find('[name=\"add\"]').click(function () {\r\n        addBlockThread(\r\n            '', 0, [],\r\n            parseInt($dialog.find('[name=\"blockThreadDefForumType\"]').val()),\r\n            $.trim($dialog.find('[name=\"blockThreadDefFidList\"]').val()).split(',')\r\n        );\r\n    }).end().find('[name=\"blockThreadDefForumType\"]').change(function () {\r\n        $dialog.find('[name=\"blockThreadDefFidList\"]').prop('disabled', parseInt($(this).val()) === 0);\r\n    }).end().find('[name=\"openImOrExBlockThreadListDialog\"]').click(function (e) {\r\n        e.preventDefault();\r\n        Public.showCommonImportOrExportConfigDialog('屏蔽主题', 'blockThreadList');\r\n    }).end().find('[name=\"selectAll\"]').click(() => Util.selectAll($blockThreadList.find('[type=\"checkbox\"]')))\r\n        .end().find('[name=\"selectInverse\"]').click(() => Util.selectInverse($blockThreadList.find('[type=\"checkbox\"]')));\r\n\r\n    $blockThreadList.on('change', 'select', function () {\r\n        let $this = $(this);\r\n        $this.closest('td').next('td').find('input').prop('disabled', parseInt($this.val()) === 0);\r\n    }).on('click', '[name=\"delete\"]', function () {\r\n        $(this).closest('tr').remove();\r\n    });\r\n\r\n    $dialog.find('[name=\"blockThreadDefForumType\"]').val(Config.blockThreadDefForumType).triggerHandler('change');\r\n    $dialog.find('[name=\"blockThreadDefFidList\"]').val(Config.blockThreadDefFidList.join(','));\r\n    for (let data of Config.blockThreadList) {\r\n        let {keyWord, includeUser, excludeUser, includeFid, excludeFid} = data;\r\n        let userType = 0;\r\n        let userList = [];\r\n        if (typeof includeUser !== 'undefined') {\r\n            userType = 1;\r\n            userList = includeUser;\r\n        }\r\n        else if (typeof excludeUser !== 'undefined') {\r\n            userType = 2;\r\n            userList = excludeUser;\r\n        }\r\n\r\n        let fidType = 0;\r\n        let fidList = [];\r\n        if (typeof includeFid !== 'undefined') {\r\n            fidType = 1;\r\n            fidList = includeFid;\r\n        }\r\n        else if (typeof excludeFid !== 'undefined') {\r\n            fidType = 2;\r\n            fidList = excludeFid;\r\n        }\r\n        addBlockThread(keyWord, userType, userList, fidType, fidList);\r\n    }\r\n    Dialog.show(dialogName);\r\n};\r\n","/* 常量模块 */\r\n'use strict';\r\n\r\n/**\r\n * 常量类\r\n */\r\nconst Const = {\r\n    // 存储多重引用数据的LocalStorage名称\r\n    multiQuoteStorageName: 'kf_multi_quote',\r\n    // at提醒时间的Cookie名称\r\n    atTipsTimeCookieName: 'at_tips_time',\r\n    // 上一次at提醒时间的Cookie名称\r\n    prevAtTipsTimeCookieName: 'prev_at_tips_time',\r\n    // 背景样式的Cookie名称\r\n    bgStyleCookieName: 'bg_style',\r\n    // 常用版块列表\r\n    commonForumList: [\r\n        {fid: 106, name: '新作动态'},\r\n        {fid: 41, name: '网盘下载'},\r\n        {fid: 16, name: '种子下载'},\r\n        {fid: 52, name: '游戏讨论'},\r\n        {fid: 84, name: '动漫讨论'},\r\n        {fid: 67, name: 'CG下载'},\r\n        {fid: 5, name: '自由讨论'},\r\n        {fid: 56, name: '个人日记'},\r\n        {fid: 57, name: '同人漫本'},\r\n    ],\r\n    // 可用版块列表\r\n    availableForumList: [\r\n        {fid: 106, name: '新作动态'},\r\n        {fid: 52, name: '游戏讨论'},\r\n        {fid: 16, name: '种子下载'},\r\n        {fid: 41, name: '网盘下载'},\r\n        {fid: 67, name: 'CG下载'},\r\n        {fid: 102, name: '游戏推荐'},\r\n        {fid: 24, name: '疑难互助'},\r\n        {fid: 57, name: '同人漫本'},\r\n        {fid: 84, name: '动漫讨论'},\r\n        {fid: 92, name: '动画共享'},\r\n        {fid: 127, name: '漫画小说'},\r\n        {fid: 68, name: '音乐共享'},\r\n        {fid: 163, name: 'LIVE共享'},\r\n        {fid: 182, name: '转载资源'},\r\n        {fid: 94, name: '原创绘画'},\r\n        {fid: 87, name: '宅物交流'},\r\n        {fid: 86, name: '电子产品'},\r\n        {fid: 115, name: '文字作品'},\r\n        {fid: 96, name: '图片来源'},\r\n        {fid: 36, name: '寻求资源'},\r\n        {fid: 5, name: '自由讨论'},\r\n        {fid: 56, name: '个人日记'},\r\n        {fid: 9, name: '我的关注'},\r\n        {fid: 4, name: '意见投诉'},\r\n        {fid: 93, name: '管理组区'},\r\n        {fid: 59, name: '原创组区'},\r\n        {fid: 125, name: '水楼林立'},\r\n        {fid: 181, name: '私人日记'},\r\n        {fid: 42, name: '旧期资料'},\r\n        {fid: 128, name: '作品判定'},\r\n        {fid: 98, name: '日本语版'},\r\n        {fid: 99, name: '意見箱'},\r\n        {fid: 112, name: '掲示板'},\r\n        {fid: 100, name: '創作感想'},\r\n    ],\r\n};\r\n\r\nexport default Const;\r\n","/* 对话框模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\n\r\n/**\r\n * 创建对话框\r\n * @param {string} id 对话框ID\r\n * @param {string} title 对话框标题\r\n * @param {string} bodyContent 对话框主体内容\r\n * @param {string} footerContent 对话框底部内容\r\n * @returns {jQuery} 对话框的jQuery对象\r\n */\r\nexport const create = function (id, title, bodyContent, footerContent = '') {\r\n    let html = `\r\n<form>\r\n<div class=\"dialog\" id=\"${id}\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\" aria-labelledby=\"${id}Title\">\r\n  <div class=\"container dialog-content\" role=\"document\">\r\n    <div class=\"dialog-header\">\r\n      <h5 class=\"dialog-title\" id=\"${id}Title\">${title}</h5>\r\n      <button class=\"close\" data-dismiss=\"dialog\" type=\"button\" aria-label=\"关闭\">\r\n        <span aria-hidden=\"true\">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"dialog-body\">${bodyContent}</div>\r\n    <div class=\"dialog-footer\" ${!footerContent ? 'hidden' : ''}>${footerContent}</div>\r\n  </div>\r\n</div>\r\n</form>`;\r\n    let $dialog = $(html).appendTo('body');\r\n    $dialog.on('click', '[data-dismiss=\"dialog\"]', () => close(id))\r\n        .on('click', '.tips', () => false)\r\n        .on('click', '.disabled-link', () => false)\r\n        .keydown(function (e) {\r\n            if (e.keyCode === 27) {\r\n                return close(id);\r\n            }\r\n        })\r\n        .find('legend [type=\"checkbox\"]')\r\n        .click(function () {\r\n            let $this = $(this);\r\n            let checked = $this.prop('checked');\r\n            if (Util.isOpera() || Util.isEdge())\r\n                $this.closest('fieldset').find('input, select, textarea, button').not('legend input').prop('disabled', !checked);\r\n            else $this.closest('fieldset').prop('disabled', !checked);\r\n        }).end()\r\n        .find('input[data-disabled]')\r\n        .click(function () {\r\n            let $this = $(this);\r\n            let checked = $this.prop('checked');\r\n            $($this.data('disabled')).each(function () {\r\n                let $this = $(this);\r\n                if ($this.is('a')) {\r\n                    if (checked) $this.removeClass('disabled-link');\r\n                    else $this.addClass('disabled-link');\r\n                }\r\n                else {\r\n                    $this.prop('disabled', !checked);\r\n                }\r\n            });\r\n        }).end().find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n    $(window).on('resize.' + id, function () {\r\n        let $focus = $(':focus');\r\n        if ($focus.length > 0) {\r\n            if ($focus.is('input') && !['checkbox', 'radio'].includes($focus.attr('type')) || $focus.is('textarea')) return;\r\n        }\r\n        resize(id);\r\n    });\r\n    return $dialog;\r\n};\r\n\r\n/**\r\n * 显示对话框\r\n * @param {string} id 对话框ID\r\n */\r\nexport const show = function (id) {\r\n    let $dialog = $('#' + id);\r\n    if (!$dialog.length) return;\r\n    $dialog.find('legend [type=\"checkbox\"]')\r\n        .each(function () {\r\n            $(this).triggerHandler('click');\r\n        }).end().find('input[data-disabled]')\r\n        .each(function () {\r\n            $(this).triggerHandler('click');\r\n        });\r\n    $dialog.fadeIn('normal').find('.close:first').focus();\r\n    resize(id);\r\n};\r\n\r\n/**\r\n * 调整对话框大小\r\n * @param {string} id 对话框ID\r\n */\r\nexport const resize = function (id) {\r\n    let $dialog = $('#' + id);\r\n    $dialog.find('.dialog-body')\r\n        .css('max-height', $(window).height() - $dialog.find('.dialog-header').outerHeight() - $dialog.find('.dialog-footer').outerHeight());\r\n};\r\n\r\n/**\r\n * 关闭对话框\r\n * @param {string} id 对话框ID\r\n * @returns {boolean} 返回false\r\n */\r\nexport const close = function (id) {\r\n    $('#' + id).fadeOut('normal', function () {\r\n        $(this).parent().remove();\r\n    });\r\n    $(window).off('resize.' + id);\r\n    return false;\r\n};\r\n","/* 首页模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n/**\r\n * 处理首页的@提醒按钮\r\n */\r\nexport const handleAtTipsBtn = function () {\r\n    $('#atTips').click(function () {\r\n        let $this = $(this);\r\n        let time = $this.data('time');\r\n        let cookieValue = Util.getCookie(Const.atTipsTimeCookieName);\r\n        if (!time || time === cookieValue) return;\r\n        if (!cookieValue) {\r\n            let currentDate = (new Date()).getDate();\r\n            Util.setCookie(Const.prevAtTipsTimeCookieName, (currentDate < 10 ? '0' + currentDate : currentDate) + '日00时00分');\r\n        }\r\n        else if (cookieValue !== time) {\r\n            Util.setCookie(Const.prevAtTipsTimeCookieName, cookieValue);\r\n        }\r\n        Util.setCookie(Const.atTipsTimeCookieName, time, Util.getDate('+3d'));\r\n        $this.removeClass('btn-outline-danger').addClass('btn-outline-primary');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页主题链接面板\r\n */\r\nexport const handleIndexThreadPanel = function () {\r\n    if (Config.activeNewReplyPanel) {\r\n        $(`a[data-toggle=\"tab\"][href=\"${Config.activeNewReplyPanel}\"]`).tab('show');\r\n    }\r\n    if (Config.activeTopRecommendPanel) {\r\n        $(`a[data-toggle=\"tab\"][href=\"${Config.activeTopRecommendPanel}\"]`).tab('show');\r\n    }\r\n\r\n    $(document).on('shown.bs.tab', 'a[data-toggle=\"tab\"]', function (e) {\r\n        let $target = $(e.target);\r\n        let targetPanel = $target.attr('href');\r\n        let typeName = '';\r\n        if (targetPanel.includes('NewReplyPanel')) typeName = 'activeNewReplyPanel';\r\n        else if (targetPanel.includes('TopRecommendPanel')) typeName = 'activeTopRecommendPanel';\r\n        if (typeName && Config[typeName] !== targetPanel) {\r\n            readConfig();\r\n            Config[typeName] = targetPanel;\r\n            writeConfig();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理选择页面背景图片\r\n */\r\nexport const handleSelectBgImage = function () {\r\n    $('#selectBgImage').on('click', '[data-id]', function () {\r\n        let $this = $(this);\r\n        let id = $this.data('id');\r\n        let fileName = $this.data('filename');\r\n        let path = $this.parent().data('path');\r\n        if (!id || !fileName || !path) return;\r\n        if (confirm('是否选择此背景图片？')) {\r\n            Util.setCookie(Const.bgStyleCookieName, id, Util.getDate('+1y'));\r\n            $('body, .modal-content').css('background-image', 'url(\"' + path + fileName + '\")');\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理选择页面背景颜色\r\n */\r\nexport const handleSelectBgColor = function () {\r\n    $('#selectBgImage').on('click', '[data-color]', function () {\r\n        let $this = $(this);\r\n        let color = $this.data('color');\r\n        if (!color) return;\r\n        if (confirm('是否选择此背景颜色？')) {\r\n            Util.setCookie(Const.bgStyleCookieName, color, Util.getDate('+1y'));\r\n            $('body, .modal-content').css('background', color);\r\n            alert('背景已更换');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理自定义背景样式\r\n */\r\nexport const handleCustomBgStyle = function () {\r\n    $('#customBgStyle').click(function () {\r\n        let value = Util.getCookie(Const.bgStyleCookieName);\r\n        if (!value || parseInt(value)) value = '';\r\n        value = prompt(\r\n            '请输入背景图片URL、颜色代码或CSS样式：\\n（例：http://xxx.com/abc.jpg 或 #fcfcfc，留空表示恢复默认背景）\\n' +\r\n            '（注：建议选择简洁、不花哨、偏浅色系的背景图片或颜色）',\r\n            value\r\n        );\r\n        if (value === null) return;\r\n        let $bg = $('body, .modal-content, .dialog-content');\r\n        if ($.trim(value) === '') {\r\n            Util.setCookie(Const.bgStyleCookieName, '', Util.getDate('-1d'));\r\n            alert('背景已恢复默认');\r\n            location.reload();\r\n        }\r\n        else if (/^https?:\\/\\/[^\"']+/.test(value)) {\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate('+1y'));\r\n            $bg.css('background-image', 'url(\"' + value + '\")');\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n        else if (/^#[0-9a-f]{6}$/i.test(value)) {\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate('+1y'));\r\n            $bg.css('background', value.toLowerCase());\r\n            alert('背景已更换');\r\n        }\r\n        else if (!/[<>{}]/.test(value)) {\r\n            value = value.replace(';', '');\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate('+1y'));\r\n            $bg.css('background', value);\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n        else {\r\n            alert('格式不正确');\r\n        }\r\n    });\r\n};\r\n","/* 消息模块 */\r\n'use strict';\r\n\r\n/**\r\n * 显示消息\r\n * @param {string|Object} options 消息或设置对象\r\n * @param {string} [options.msg] 消息\r\n * @param {number} [options.duration={@link Config.defShowMsgDuration}] 消息显示时间（秒），-1为永久显示\r\n * @param {boolean} [options.clickable=true] 消息框可否手动点击消除\r\n * @param {boolean} [options.preventable=false] 是否阻止点击网页上的其它元素\r\n * @param {number} [duration] 消息显示时间（秒），-1为永久显示\r\n * @example\r\n * show('<span class=\"mr-3\">使用道具</span><span class=\"text-item\">神秘系数<em class=\"text-warning\">+1</em></span>', -1);\r\n * show({\r\n *   msg: '<span class=\"mr-3\">抽取神秘盒子</span><span class=\"text-item\">KFB<em class=\"text-warning\">+8</em></span>',\r\n *   duration: 20,\r\n *   clickable: false,\r\n * });\r\n * @returns {jQuery} 消息框对象\r\n */\r\nexport const show = function (options, duration) {\r\n    let settings = {\r\n        msg: '',\r\n        duration: Config.defShowMsgDuration,\r\n        clickable: true,\r\n        preventable: false,\r\n    };\r\n    if ($.type(options) === 'object') {\r\n        $.extend(settings, options);\r\n    }\r\n    else {\r\n        settings.msg = options;\r\n        settings.duration = typeof duration === 'undefined' ? Config.defShowMsgDuration : duration;\r\n    }\r\n\r\n    let $container = $('.msg-container');\r\n    let isFirst = $container.length === 0;\r\n    if (!isFirst && !$('.mask').length) {\r\n        if ($container.height() >= $(window).height() * 0.8) {\r\n            destroy();\r\n            isFirst = true;\r\n        }\r\n    }\r\n    if (settings.preventable && !$('.mask').length) {\r\n        $('<div class=\"mask\"></div>').appendTo('body');\r\n    }\r\n    if (isFirst) {\r\n        $container = $('<div class=\"container msg-container\"></div>').appendTo('body');\r\n    }\r\n\r\n    let $msg = $(`<div class=\"msg\">${settings.msg}</div>`).appendTo($container);\r\n    $msg.on('click', '.stop-action', function (e) {\r\n        e.preventDefault();\r\n        $(this).text('正在停止&hellip;').closest('.msg').data('stop', true);\r\n    });\r\n    if (settings.clickable) {\r\n        $msg.css('cursor', 'pointer').click(function () {\r\n            hide($(this));\r\n        }).find('a').click(function (e) {\r\n            e.stopPropagation();\r\n        });\r\n    }\r\n    if (settings.preventable) $msg.attr('preventable', true);\r\n    $msg.slideDown('normal');\r\n    if (settings.duration > -1) {\r\n        setTimeout(() => {\r\n            hide($msg);\r\n        }, settings.duration * 1000);\r\n    }\r\n    return $msg;\r\n};\r\n\r\n/**\r\n * 显示等待消息\r\n * @param {string} msg 消息\r\n * @param {boolean} preventable 是否阻止点击网页上的其它元素\r\n * @returns {jQuery} 消息框对象\r\n */\r\nexport const wait = function (msg, preventable = true) {\r\n    msg += '<i class=\"fa fa-spinner fa-spin fa-lg fa-fw ml-3\" aria-label=\"等待中\" aria-hidden=\"true\"></i>';\r\n    return show({msg, duration: -1, clickable: false, preventable});\r\n};\r\n\r\n/**\r\n * 隐藏指定消息框\r\n * @param {jQuery} $msg 消息框对象\r\n */\r\nexport const hide = function ($msg) {\r\n    $msg.slideUp('normal', function () {\r\n        remove($(this));\r\n    });\r\n};\r\n\r\n/**\r\n * 移除指定消息框\r\n * @param {jQuery} $msg 消息框对象\r\n */\r\nexport const remove = function ($msg) {\r\n    let $container = $msg.parent();\r\n    $msg.remove();\r\n    if (!$('.msg').length) {\r\n        $container.remove();\r\n        $('.mask').remove();\r\n    }\r\n    else if (!$('.msg[preventable]').length) {\r\n        $('.mask').remove();\r\n    }\r\n};\r\n\r\n/**\r\n * 销毁所有消息框\r\n */\r\nexport const destroy = function () {\r\n    $('.msg-container').remove();\r\n    $('.mask').remove();\r\n};\r\n","/* 其它模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n/**\r\n * 高亮关键词页面中未读的消息\r\n */\r\nexport const highlightUnReadAtTipsMsg = function () {\r\n    if (Info.gjc !== Info.userName) return;\r\n    let timeString = Util.getCookie(Const.prevAtTipsTimeCookieName);\r\n    if (!timeString || !/^\\d+日\\d+时\\d+分$/.test(timeString)) return;\r\n    let prevString = '';\r\n    $('.thread-list-item time').each(function (index) {\r\n        let $this = $(this);\r\n        let curString = $.trim($this.text());\r\n        if (index === 0) prevString = curString;\r\n        if (timeString < curString && prevString >= curString) {\r\n            $this.addClass('text-danger');\r\n            prevString = curString;\r\n        }\r\n        else return false;\r\n    });\r\n\r\n    $(document).on('click', '.thread-list-item .thread-link-item a', function () {\r\n        Util.deleteCookie(Const.prevAtTipsTimeCookieName);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理游戏搜索区域\r\n */\r\nexport const handleGameIntroSearchArea = function () {\r\n    $('#gameSearchKeyword').val(Info.keyword);\r\n    $('#gameSearchType').val(Info.searchType);\r\n};\r\n\r\n/**\r\n * 推游戏介绍\r\n * @param {string} type 页面类型\r\n */\r\nexport const tuiGameIntro = function (type) {\r\n    let cookieName = '';\r\n    if (type === 'company') cookieName = 'g_intro_inc_tui_';\r\n    else if (type === 'type') cookieName = 'g_intro_adv_tui_';\r\n    else if (type === 'property') cookieName = 'g_intro_moe_tui_';\r\n    else cookieName = 'g_intro_tui_';\r\n    cookieName += Info.id;\r\n    let url = Util.makeUrl('game_intro/' + type, `id=${Info.id}&tui=1`);\r\n\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        if (Util.getCookie(cookieName, '')) {\r\n            alert('你在48小时内已经推过');\r\n            return;\r\n        }\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: url,\r\n            success: function () {\r\n                let $num = $this.find('span:first');\r\n                let num = parseInt($num.text());\r\n                $num.text('+1');\r\n                setTimeout(() => {\r\n                    $num.text(++num);\r\n                }, 1000);\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            },\r\n            dataType: 'html'\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定收藏夹页面按钮点击事件\r\n */\r\nexport const bindFavorPageBtnsClick = function () {\r\n    let $form = $('form[name=\"favorForm\"]');\r\n\r\n    $(document).on('click', '.remove-catalog', () => confirm('是否删除该目录？'));\r\n\r\n    $('#addCatalog').click(function (e) {\r\n        e.preventDefault();\r\n        let type = $.trim(prompt('请输入收藏夹目录名称：'));\r\n        if (!type) return;\r\n        $form.find('[name=\"job\"]').val('addtype');\r\n        $form.find('[name=\"type\"]').val(type);\r\n        $form.submit();\r\n    });\r\n\r\n    $('#favorActionBtns').on('click', 'button', function () {\r\n        let action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            Util.selectAll($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'delete') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否删除这${$checked.length}项？`)) {\r\n                $form.find('[name=\"job\"]').val('clear');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n\r\n    $('#convertCatalogDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let type = $(this).data('type');\r\n        let $checked = $('[name=\"delid[]\"]:checked');\r\n        if ($checked.length > 0 && confirm(`是否将这${$checked.length}项转换到指定目录？`)) {\r\n            $form.find('[name=\"job\"]').val('change');\r\n            $form.find('[name=\"type\"]').val(type);\r\n            $form.submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定好友列表页面按钮点击事件\r\n */\r\nexport const bindFriendPageBtnsClick = function () {\r\n    $('#friendActionBtns').on('click', '[type=\"button\"]', function () {\r\n        let action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            Util.selectAll($('[name=\"selid[]\"]'));\r\n        }\r\n        else if (action === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"selid[]\"]'));\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 在账号设置页面里为生日字段赋值\r\n */\r\nexport const assignBirthdayField = function () {\r\n    $('#birthday').change(function () {\r\n        let value = $(this).val().trim();\r\n        let matches = /(\\d{4})-(\\d{1,2})-(\\d{1,2})/.exec(value);\r\n        let year = '', month = '', day = '';\r\n        if (matches) {\r\n            year = parseInt(matches[1]);\r\n            month = parseInt(matches[2]);\r\n            day = parseInt(matches[3]);\r\n        }\r\n        $('[name=\"proyear\"]').val(year);\r\n        $('[name=\"promonth\"]').val(month);\r\n        $('[name=\"proday\"]').val(day);\r\n    });\r\n};\r\n\r\n/**\r\n * 同步主题每页楼层数量的设置\r\n */\r\nexport const syncPerPageFloorNum = function () {\r\n    /**\r\n     * 同步设置\r\n     */\r\n    const syncConfig = function () {\r\n        let perPageFloorNum = parseInt($('[name=\"p_num\"]').val());\r\n        if (perPageFloorNum === 0) perPageFloorNum = 10;\r\n        if (!isNaN(perPageFloorNum) && perPageFloorNum !== Config.perPageFloorNum) {\r\n            Config.perPageFloorNum = perPageFloorNum;\r\n            writeConfig();\r\n        }\r\n    };\r\n\r\n    syncConfig();\r\n    $('#creator').submit(function () {\r\n        readConfig();\r\n        syncConfig();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理上传头像文件浏览按钮\r\n */\r\nexport const handleUploadAvatarFileBtn = function () {\r\n    $('#browseAvatar').change(function () {\r\n        let $this = $(this);\r\n        let matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || !['jpg', 'gif', 'png'].includes(matches[1].toLowerCase())) {\r\n            alert('头像图片类型不匹配');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 转账提醒\r\n */\r\nexport const transferKfbAlert = function () {\r\n    $('#transferKfbForm').submit(function () {\r\n        let $this = $(this);\r\n        let transferKfb = parseInt($this.find('[name=\"to_money\"]').val());\r\n        let fixedDeposit = parseInt($('#fixedDeposit').text());\r\n        let currentDeposit = parseInt($('#currentDeposit').text());\r\n        if (transferKfb > 0 && fixedDeposit > 0 && transferKfb > currentDeposit) {\r\n            if (!confirm('你的活期存款不足，转账金额将从定期存款里扣除，是否继续？')) {\r\n                return false;\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定短消息页面操作按钮点击事件\r\n */\r\nexport const bindMessageActionBtnsClick = function () {\r\n    $('#messageActionBtns').on('click', 'button', function () {\r\n        let $form = $('#messageListForm');\r\n        let name = $(this).attr('name');\r\n        if (name === 'selectAll') {\r\n            Util.selectAll($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (name === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (name === 'selectCustom') {\r\n            let title = $.trim(\r\n                prompt('请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）', '收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除')\r\n            );\r\n            if (!title) return;\r\n            $('[name=\"delid[]\"]').prop('checked', false);\r\n            $('a.thread-link').each(function () {\r\n                let $this = $(this);\r\n                for (let key of title.split('|')) {\r\n                    if ($this.text().toLowerCase().includes(key.toLowerCase())) {\r\n                        $this.parent().find('[name=\"delid[]\"]').prop('checked', true);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        else if (name === 'download') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否下载这${$checked.length}项？`)) {\r\n                $form.attr('action', '/message.php').find('[name=\"action\"]').val('down');\r\n                $form.submit();\r\n            }\r\n        }\r\n        else if (name === 'delete') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否删除这${$checked.length}项？`)) {\r\n                $form.attr('action', Util.makeUrl('message/job')).find('[name=\"action\"]').val('del');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 验证注册页面字段\r\n */\r\nexport const validateRegisterField = function () {\r\n    $(document).on('change', 'input[name]', function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        let value = $this.val();\r\n        if (!value) {\r\n            Util.showValidationMsg($this, 'clear');\r\n            return;\r\n        }\r\n        if (name === 'regemail') {\r\n            Util.showValidationMsg($this, 'wait', '检查中，请稍等&hellip;');\r\n            $.post(Util.makeUrl('register/check'), 'username=' + value, ({type, msg, username}) => {\r\n                if ($this.val() === username) {\r\n                    Util.showValidationMsg($this, type, msg);\r\n                }\r\n            }).fail(() => {\r\n                Util.showValidationMsg($this, 'error', '响应失败');\r\n            });\r\n        }\r\n        else if (name === 'regpwd') {\r\n            if (value.length > 16 || value.length < 6) {\r\n                Util.showValidationMsg($this, 'error', '密码长度不正确');\r\n            }\r\n            else {\r\n                Util.showValidationMsg($this, 'clear');\r\n                $('[name=\"regpwdrepeat\"]').trigger('change');\r\n            }\r\n        }\r\n        else if (name === 'regpwdrepeat') {\r\n            if (value !== $('[name=\"regpwd\"]').val()) Util.showValidationMsg($this, 'error', '两次输入的密码不相符');\r\n            else Util.showValidationMsg($this, 'clear');\r\n        }\r\n    });\r\n\r\n    $('#registerForm').submit(function () {\r\n        if ($(this).find('.has-danger').length > 0) {\r\n            alert('请正确填写表单');\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理个人信息页面下的按钮\r\n */\r\nexport const handleUserPageBtns = function () {\r\n    let $area = $('#profileBtns');\r\n    let userName = $area.data('username');\r\n    $area.on('click', '[name=\"followUser\"], [name=\"blockUser\"]', function () {\r\n        readConfig();\r\n        let $this = $(this);\r\n        let str = '关注';\r\n        let userList = Config.followUserList;\r\n        if ($this.attr('name') === 'blockUser') {\r\n            str = '屏蔽';\r\n            userList = Config.blockUserList;\r\n            Config.blockUserEnabled = true;\r\n        }\r\n        else Config.followUserEnabled = true;\r\n        if ($this.text().includes('取消')) {\r\n            let index = Util.inFollowOrBlockUserList(userName, userList);\r\n            if (index > -1) {\r\n                userList.splice(index, 1);\r\n                writeConfig();\r\n            }\r\n            $this.removeClass('btn-outline-danger').addClass('btn-outline-primary').find('span').text(str + '用户');\r\n            alert('该用户已被取消' + str);\r\n        }\r\n        else {\r\n            if (Util.inFollowOrBlockUserList(userName, userList) === -1) {\r\n                if (str === '屏蔽') {\r\n                    let type = Config.blockUserDefaultType;\r\n                    type = prompt('请填写屏蔽类型，0：主题和回帖；1：主题；2：回帖', type);\r\n                    if (type === null) return;\r\n                    type = parseInt(type);\r\n                    if (isNaN(type) || type < 0 || type > 2) type = Config.blockUserDefaultType;\r\n                    userList.push({name: userName, type: type});\r\n                }\r\n                else {\r\n                    userList.push({name: userName});\r\n                }\r\n                writeConfig();\r\n            }\r\n            $this.removeClass('btn-outline-primary').addClass('btn-outline-danger').find('span').text('取消' + str);\r\n            alert('该用户已被' + str);\r\n        }\r\n    }).find('[name=\"followUser\"], [name=\"blockUser\"]').each(function () {\r\n        let $this = $(this);\r\n        let str = '关注';\r\n        let userList = Config.followUserList;\r\n        if ($this.attr('name') === 'blockUser') {\r\n            str = '屏蔽';\r\n            userList = Config.blockUserList;\r\n        }\r\n        if (Util.inFollowOrBlockUserList(userName, userList) > -1) {\r\n            $this.removeClass('btn-outline-primary').addClass('btn-outline-danger').find('span').text('取消' + str);\r\n        }\r\n    });\r\n};\r\n","/* 发帖模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Msg from './msg';\r\n\r\n/**\r\n * 处理编辑器按钮\r\n */\r\nexport const handleEditorBtns = function () {\r\n    let textArea = $('#postContent').get(0);\r\n\r\n    // 编辑器按钮\r\n    $(document).on('click', '.editor-btn-group button[data-action]', function () {\r\n        let action = $(this).data('action');\r\n        let value = '';\r\n        switch (action) {\r\n            case 'link':\r\n                value = prompt('请输入链接URL：', 'http://');\r\n                break;\r\n            case 'img':\r\n                value = prompt('请输入图片URL：', 'http://');\r\n                break;\r\n            case 'sell':\r\n                value = prompt('请输入出售金额：', 1);\r\n                break;\r\n            case 'hide':\r\n                value = prompt('请输入神秘等级：', 1);\r\n                break;\r\n            case 'audio': {\r\n                value = prompt('请输入HTML5音频实际地址：\\n（可直接输入网易云音乐或虾米的单曲地址，将自动转换为外链地址）', 'http://');\r\n                let matches = /^https?:\\/\\/music\\.163\\.com\\/(?:#\\/)?song\\?id=(\\d+)/i.exec(value);\r\n                if (matches) value = `http://music.miaola.info/163/${matches[1]}.mp3`;\r\n                matches = /^https?:\\/\\/www\\.xiami\\.com\\/song\\/(\\d+)/i.exec(value);\r\n                if (matches) value = `http://music.miaola.info/xiami/${matches[1]}.mp3`;\r\n            }\r\n                break;\r\n            case 'video': {\r\n                value = prompt('请输入HTML5视频实际地址：\\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）', 'http://');\r\n                let matches = /^https?:\\/\\/(?:www\\.)?youtube\\.com\\/watch\\?v=([\\w\\-]+)/i.exec(value);\r\n                if (matches) value = `http://video.miaola.info/youtube/${matches[1]}`;\r\n                matches = /^https?:\\/\\/youtu\\.be\\/([\\w\\-]+)$/i.exec(value);\r\n                if (matches) value = `http://video.miaola.info/youtube/${matches[1]}`;\r\n            }\r\n                break;\r\n        }\r\n        if (value === null) return;\r\n\r\n        let selText = '';\r\n        let code = '';\r\n        switch (action) {\r\n            case 'link':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[url=${value}]${selText}[/url]`;\r\n                break;\r\n            case 'img':\r\n                code = `[img]${value}[/img]`;\r\n                break;\r\n            case 'quote':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[quote]${selText}[/quote]`;\r\n                break;\r\n            case 'code':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[code]${selText}[/code]`;\r\n                break;\r\n            case 'sell':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sell=${value}]${selText}[/sell]`;\r\n                break;\r\n            case 'hide':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[hide=${value}]${selText}[/hide]`;\r\n                break;\r\n            case 'bold':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[b]${selText}[/b]`;\r\n                break;\r\n            case 'italic':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[i]${selText}[/i]`;\r\n                break;\r\n            case 'underline':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[u]${selText}[/u]`;\r\n                break;\r\n            case 'strike':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[strike]${selText}[/strike]`;\r\n                break;\r\n            case 'super':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sup]${selText}[/sup]`;\r\n                break;\r\n            case 'sub':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sub]${selText}[/sub]`;\r\n                break;\r\n            case 'horizontal':\r\n                code = `[hr]`;\r\n                break;\r\n            case 'align-left':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=left]${selText}[/align]`;\r\n                break;\r\n            case 'align-center':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=center]${selText}[/align]`;\r\n                break;\r\n            case 'align-right':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=right]${selText}[/align]`;\r\n                break;\r\n            case 'fly':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[fly]${selText}[/fly]`;\r\n                break;\r\n            case 'audio':\r\n                code = `[audio]${value}[/audio]`;\r\n                break;\r\n            case 'video':\r\n                code = `[video]${value}[/video]`;\r\n                break;\r\n        }\r\n        if (!code) return;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 字号下拉菜单\r\n    $('#fontSizeDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let size = $(this).data('size');\r\n        let selText = Util.getSelText(textArea);\r\n        let code = `[size=${size}]${selText}[/size]`;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 颜色、背景颜色下拉菜单\r\n    $('#colorDropdownMenu, #bgColorDropdownMenu').on('click', 'span', function () {\r\n        let $this = $(this);\r\n        let codeType = $this.parent().is('#bgColorDropdownMenu') ? 'backcolor' : 'color';\r\n        let color = $this.data('color');\r\n        let selText = Util.getSelText(textArea);\r\n        let code = `[${codeType}=${color}]${selText}[/${codeType}]`;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 检查发帖表单\r\n */\r\nexport const checkPostForm = function () {\r\n    $('#postForm').submit(function () {\r\n        let $postType = $('#postType');\r\n        if ($postType.length > 0 && !$postType.val()) {\r\n            alert('没有选择主题分类');\r\n            $postType.focus();\r\n            return false;\r\n        }\r\n\r\n        let $postTitle = $('#postTitle');\r\n        if ($postTitle.length > 0) {\r\n            let length = Util.getStrByteLen($postTitle.val());\r\n            if (!length) {\r\n                alert('标题不能为空');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n            else if (length > 100) {\r\n                alert('标题超过最大长度 100 个字节');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $voteItemContent = $('#voteItemContent');\r\n        if ($voteItemContent.length > 0) {\r\n            if (!$voteItemContent.val().trim()) {\r\n                alert('投票选项不能为空');\r\n                $voteItemContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $postContent = $('#postContent');\r\n        if ($postContent.length > 0) {\r\n            let length = Util.getStrByteLen($postContent.val().trim());\r\n            if (length < 12) {\r\n                alert('文章内容少于 12 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n            else if (length > 50000) {\r\n                alert('文章内容大于 50000 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $postGjc = $('#postGjc');\r\n        if ($postGjc.length > 0 && Info.action === 'new' && !$postGjc.val().trim()) {\r\n            alert('请在内容文本框的下方填写关键词，以方便搜索，也可以在标题中选择任意一个词填入');\r\n            $postGjc.focus();\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理附件按钮\r\n */\r\nexport const handleAttachBtns = function () {\r\n    $(document).on('click', '.attach-area a[data-action]', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let $area = $this.closest('.attach-area');\r\n        let action = $this.data('action');\r\n        let id = $area.data('id');\r\n        if (!id) return;\r\n        if (action === 'insert') {\r\n            let type = $this.data('type');\r\n            let textArea = $('#postContent').get(0);\r\n            let code = `[${type === 'new' ? 'upload' : 'attachment'}=${id}]`;\r\n            Util.addCode(textArea, code);\r\n            textArea.focus();\r\n        }\r\n        else if (action === 'update') {\r\n            $area.find('.attach-info').prop('hidden', true).after(\r\n                `<label><input name=\"replace_${id}\" type=\"file\" aria-label=\"选择附件\"></label>`\r\n            );\r\n            $this.data('action', 'cancel').text('取消').blur();\r\n            if (!$(document).data('attachUpdateAlert')) {\r\n                alert('本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果');\r\n                $(document).data('attachUpdateAlert', true);\r\n            }\r\n        }\r\n        else if (action === 'cancel') {\r\n            $area.find('.attach-info').prop('hidden', false).next('label').remove();\r\n            $this.data('action', 'update').text('更新').blur();\r\n        }\r\n        else if (action === 'delete') {\r\n            $area.remove();\r\n        }\r\n    });\r\n\r\n    $(document).on('change', '[type=\"file\"]', function () {\r\n        let $this = $(this);\r\n        let matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || !['jpg', 'gif', 'png', 'torrent'].includes(matches[1].toLowerCase())) {\r\n            alert('附件类型不匹配');\r\n            return;\r\n        }\r\n\r\n        let type = $this.data('type');\r\n        if (type === 'new') {\r\n            $this.removeData('type').parent().next().prop('hidden', false);\r\n\r\n            let $newAttachArea = $('#newAttachArea');\r\n            let totalNum = $newAttachArea.find('[type=\"file\"]').length;\r\n            if (totalNum >= 5) return;\r\n            let $lastAttachArea = $newAttachArea.find('[type=\"file\"]:last').closest('.attach-area');\r\n            let id = parseInt($lastAttachArea.data('id'));\r\n            if (!id) return;\r\n            id++;\r\n            $(`\r\n<div class=\"form-group row font-size-sm attach-area\" data-id=\"${id}\">\r\n  <div class=\"col-xs-12 col-form-label\">\r\n    <label>\r\n      <input name=\"attachment_${id}\" data-type=\"new\" type=\"file\" aria-label=\"选择附件\">\r\n    </label>\r\n    <span hidden>\r\n      <a data-action=\"insert\" data-type=\"new\" href=\"#\">插入</a>&nbsp;\r\n      <a data-action=\"delete\" href=\"#\">删除</a>\r\n    </span>\r\n  </div>\r\n  <div class=\"col-xs-4\">\r\n    <label class=\"sr-only\" for=\"atc_downrvrc${id}\">神秘系数</label>\r\n    <input class=\"form-control form-control-sm\" id=\"atc_downrvrc${id}\" name=\"atc_downrvrc${id}\" data-toggle=\"tooltip\" \r\ntype=\"number\" value=\"0\" min=\"0\" title=\"神秘系数\" placeholder=\"神秘系数\">\r\n  </div>\r\n  <div class=\"col-xs-8\">\r\n    <label class=\"sr-only\" for=\"atc_desc${id}\">描述</label>\r\n    <input class=\"form-control form-control-sm\" id=\"atc_desc${id}\" name=\"atc_desc${id}\" data-toggle=\"tooltip\" type=\"text\" \r\ntitle=\"描述\" placeholder=\"描述\">\r\n  </div>\r\n</div>\r\n`).insertAfter($lastAttachArea).find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 插入表情代码\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nexport const addSmileCode = function ($node) {\r\n    $('.smile-panel').on('click', 'img', function () {\r\n        $('.smile-panel').addClass('open');\r\n        let textArea = $node.get(0);\r\n        if (!textArea) return;\r\n        let code = `[s:${$(this).data('id')}]`;\r\n        Util.addCode(textArea, code, '');\r\n        textArea.blur();\r\n    }).parent().on('shown.bs.dropdown', function () {\r\n        $('.smile-panel img').each(function () {\r\n            let $this = $(this);\r\n            if (!$this.attr('src')) {\r\n                $this.attr('src', $this.data('src'));\r\n            }\r\n        });\r\n    }).on('hide.bs.dropdown', function (e) {\r\n        let $relatedTarget = $(e.relatedTarget);\r\n        if (!$relatedTarget.data('open')) $relatedTarget.removeData('open');\r\n        else return e.preventDefault();\r\n    });\r\n\r\n    $('#smileDropdownBtn').click(function () {\r\n        let $this = $(this);\r\n        $this.data('open', !$this.data('open'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理多重回复和多重引用\r\n * @param {number} type 处理类型，1：多重回复；2：多重引用\r\n */\r\nexport const handleMultiQuote = function (type = 1) {\r\n    let data = localStorage[Const.multiQuoteStorageName];\r\n    if (!data) return;\r\n    try {\r\n        data = JSON.parse(data);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) return;\r\n    let {tid, quoteList} = data;\r\n    if (!Info.tid || tid !== Info.tid || $.type(quoteList) !== 'object') return;\r\n    if (type === 2 && !Info.fid) return;\r\n    let list = [];\r\n    for (let data of Object.values(quoteList)) {\r\n        if (!Array.isArray(data)) continue;\r\n        for (let quote of data) {\r\n            list.push(quote);\r\n        }\r\n    }\r\n    if (!list.length) {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        return;\r\n    }\r\n\r\n    let keywords = new Set();\r\n    let content = '';\r\n    if (type === 2) {\r\n        Msg.wait(`<span class=\"mr-3\">正在获取引用内容中&hellip;</span>剩余：<em class=\"text-warning countdown-num\">${list.length}</em>`);\r\n        $(document).clearQueue('MultiQuote');\r\n    }\r\n    $.each(list, function (index, data) {\r\n        if (typeof data.floor === 'undefined' || typeof data.pid === 'undefined') return;\r\n        keywords.add(data.userName);\r\n        if (type === 2) {\r\n            $(document).queue('MultiQuote', function () {\r\n                $.get(Util.makeUrl(\r\n                    'post/index',\r\n                    `action=quote&fid=${Info.fid}&tid=${tid}&pid=${data.pid}&article=${data.floor}&t=${new Date().getTime()}`\r\n                ), function ({postContent}) {\r\n                    content += postContent ? postContent + (index === list.length - 1 ? '' : '\\n') : '';\r\n                    let $countdownNum = $('.countdown-num:last');\r\n                    $countdownNum.text(parseInt($countdownNum.text()) - 1);\r\n                    if (index === list.length - 1) {\r\n                        Msg.destroy();\r\n                        $('#postContent').val(content).focus();\r\n                    }\r\n                    else {\r\n                        setTimeout(() => $(document).dequeue('MultiQuote'), 100);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            content += `[quote]回 ${data.floor}楼(${data.userName}) 的帖子[/quote]\\n`;\r\n        }\r\n    });\r\n    for (let [index, quote] of list.entries()) {\r\n    }\r\n    $('[name=\"diy_guanjianci\"]').val([...keywords].join(','));\r\n    $('#postForm').submit(function () {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n    });\r\n    if (type === 2) $(document).dequeue('MultiQuote');\r\n    else $('#postContent').val(content).focus();\r\n};\r\n\r\n/**\r\n * 处理清除多重引用数据按钮\r\n */\r\nexport const handleClearMultiQuoteDataBtn = function () {\r\n    $('.clear-multi-quote-data-btn').click(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否清除多重引用数据？')) return;\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        $('[name=\"diy_guanjianci\"]').val('');\r\n        $('#postContent').val('');\r\n    });\r\n};\r\n","/* 公共模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Dialog from './dialog';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\nimport * as ConfigDialog from './configDialog';\r\n\r\n/**\r\n * 处理主菜单\r\n */\r\nexport const handleMainMenu = function () {\r\n    $('#mainMenuTogglerBtn').click(function () {\r\n        let maxHeight = document.documentElement.clientHeight - $(this).closest('.navbar').outerHeight();\r\n        if (maxHeight > 0) {\r\n            $('#mainMenu').css('max-height', maxHeight + 'px');\r\n        }\r\n    });\r\n    $('#sidebarMainMenuBtn').click(() => $('#mainMenuTogglerBtn').click());\r\n};\r\n\r\n/**\r\n * 处理主菜单链接\r\n */\r\nexport const handleMainMenuLink = function () {\r\n    $('#mainMenu').find('[data-name=\"openConfigDialog\"]').click(function (e) {\r\n        e.preventDefault();\r\n        $('#mainMenuTogglerBtn').click();\r\n        ConfigDialog.show();\r\n    });\r\n};\r\n\r\n/**\r\n * 显示侧边栏按钮组\r\n */\r\nexport const showSidebarBtnGroup = function () {\r\n    $('.sidebar-btn-group').prop('hidden', false);\r\n    if (Config.showSidebarRollBtnEnabled) $('#sidebarRollBtn').prop('hidden', false);\r\n    if (Config.showSidebarMainMenuBtnEnabled) $('#sidebarMainMenuBtn').prop('hidden', false);\r\n    if (Config.showSidebarForumListBtnEnabled) $('#sidebarForumListBtn').prop('hidden', false);\r\n    if (Config.showSidebarSearchBtnEnabled) $('#sidebarSearchBtn').prop('hidden', false);\r\n    if (Config.showSidebarHomePageBtnEnabled) $('#sidebarHomePageBtn').prop('hidden', false);\r\n};\r\n\r\n/**\r\n * 处理侧边栏的滚动到页顶/页底按钮\r\n */\r\nexport const handleSidebarRollBtn = function () {\r\n    $(window).scroll(function () {\r\n        let $btn = $('#sidebarRollBtn');\r\n        if ($(window).scrollTop() > 640) {\r\n            if ($btn.data('direction') === 'top') return;\r\n            $btn.data('direction', 'top').attr('aria-label', '滚动到页顶')\r\n                .find('i').removeClass('fa-chevron-down').addClass('fa-chevron-up');\r\n        }\r\n        else {\r\n            if ($btn.data('direction') === 'bottom') return;\r\n            $btn.data('direction', 'bottom').attr('aria-label', '滚动到页底')\r\n                .find('i').removeClass('fa-chevron-up').addClass('fa-chevron-down');\r\n        }\r\n    });\r\n\r\n    $('#sidebarRollBtn').click(function () {\r\n        let scrollTop = $(this).data('direction') === 'bottom' ? $('body').height() : 0;\r\n        $('body, html').animate({scrollTop: scrollTop});\r\n    });\r\n};\r\n\r\n/**\r\n * 处理搜索对话框\r\n */\r\nexport const handleSearchDialog = function () {\r\n    let $searchDialog = $('#searchDialog');\r\n\r\n    $searchDialog.on('shown.bs.modal', function () {\r\n        $('#searchKeyword').select().focus();\r\n    }).find('form').submit(function () {\r\n        let $this = $(this);\r\n        let $searchKeyword = $this.find('#searchKeyword');\r\n        let searchType = $this.find('#searchType').val();\r\n        let keyword = $.trim($searchKeyword.val());\r\n        if (searchType === 'gjc') {\r\n            $this.attr('action', Util.makeUrl('gjc/' + keyword));\r\n        }\r\n        else if (searchType === 'username') {\r\n            $this.attr('action', Util.makeUrl('user/username/' + keyword));\r\n        }\r\n        else {\r\n            $this.attr('action', Util.makeUrl('search'));\r\n            $searchKeyword.attr('name', searchType === 'author' ? 'pwuser' : 'keyword');\r\n            if (searchType === 'title') {\r\n                if (keyword.length && Util.getStrByteLen(keyword) <= 2) {\r\n                    let $method = $this.find('[name=\"method\"]');\r\n                    $method.val('OR');\r\n                    $searchKeyword.val(keyword + ' ' + Math.floor(new Date().getTime() / 1000));\r\n                    setTimeout(() => {\r\n                        $searchKeyword.val(keyword);\r\n                        $method.val('AND');\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    $searchDialog.find('[name=\"searchRange\"]').on('click', function () {\r\n        let value = 'all';\r\n        if ($(this).val() === 'current') value = Info.fid;\r\n        $searchDialog.find('[name=\"f_fid\"]').val(value);\r\n    });\r\n\r\n    let $current = $searchDialog.find('[name=\"searchRange\"][value=\"current\"]');\r\n    let $currentBox = $current.closest('.form-check-inline');\r\n    $searchDialog.find('#searchType').change(function () {\r\n        let searchType = $(this).val();\r\n        if (!$current.data('enabled')) return;\r\n        let disabled = searchType === 'gjc' || searchType === 'username';\r\n        $current.prop('disabled', disabled);\r\n        if (disabled) $currentBox.addClass('disabled');\r\n        else $currentBox.removeClass('disabled');\r\n    });\r\n\r\n    if (pageId === 'threadPage' || pageId === 'readPage') {\r\n        $current.prop('disabled', false).data('enabled', true).click();\r\n        $currentBox.removeClass('disabled');\r\n    }\r\n};\r\n\r\n/**\r\n * 处理分页导航\r\n */\r\nexport const handlePageInput = function () {\r\n    $(document).on('click', '.page-input', function (e) {\r\n        e.preventDefault();\r\n        if (Info.maxPageNum && Info.maxPageNum <= 1) return;\r\n        let action = $(this).data('url');\r\n        if (!action) return;\r\n        let excludeParams = $(this).data('exclude');\r\n        if (excludeParams) excludeParams = excludeParams.split(',');\r\n        else excludeParams = [];\r\n        let num = parseInt(\r\n            prompt(`要跳转到第几页？${Info.maxPageNum ? `（共${Info.maxPageNum}页）` : ''}`, Info.currentPageNum)\r\n        );\r\n        if (num && num > 0) {\r\n            location.href = Util.makeUrl(action, 'page=' + num, true, excludeParams);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定快速提交的快捷键\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nexport const bindFastSubmitShortcutKey = function ($node) {\r\n    $node.keydown(function (e) {\r\n        if (e.keyCode === 13 && e.ctrlKey) {\r\n            $(this).closest('form').submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示编辑常用版块对话框\r\n */\r\nexport const showEditCommonForumDialog = function () {\r\n    $(document).on('click', '.edit-common-forum-btn', function (e) {\r\n        e.preventDefault();\r\n        const dialogName = 'editCommonForumDialog';\r\n        if ($('#' + dialogName).length > 0) return;\r\n        readConfig();\r\n\r\n        let commonForumList = Config.commonForumList.length > 0 ? Config.commonForumList : Const.commonForumList;\r\n        let commonForumListHtml = '';\r\n        for (let {fid, name} of commonForumList) {\r\n            commonForumListHtml += `<span class=\"btn btn-outline-primary\" data-fid=\"${fid}\">${name}</span>`;\r\n        }\r\n        let availableForumListHtml = '';\r\n        for (let {fid, name} of Const.availableForumList) {\r\n            if (commonForumList.find(elem => elem.fid === fid)) continue;\r\n            availableForumListHtml += `<span class=\"btn btn-outline-primary\" data-fid=\"${fid}\">${name}</span>`;\r\n        }\r\n\r\n        let bodyContent = `\r\n<p class=\"font-size-sm text-muted\">\r\n  请将可用版块内的版块按钮拖拽到常用版块内（或相反）\r\n</p>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>常用版块</legend>\r\n  <div class=\"edit-forum-list d-flex flex-wrap\" id=\"editCommonForumList\">${commonForumListHtml}</div>\r\n</fieldset>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>可用版块</legend>\r\n  <div class=\"edit-forum-list d-flex flex-wrap\" id=\"editAvailableForumList\">${availableForumListHtml}</div>\r\n</fieldset>`;\r\n        let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>\r\n<button class=\"btn btn-danger\" name=\"reset\" type=\"button\">重置</button>`;\r\n        let $dialog = Dialog.create(dialogName, '编辑常用版块', bodyContent, footerContent);\r\n\r\n        let $dragulaScriptPath = $('[name=\"dragulaScriptPath\"]');\r\n        let dragulaScriptPath = $dragulaScriptPath.val();\r\n        if (dragulaScriptPath) {\r\n            $.getScript(dragulaScriptPath, () => dragula($dialog.find('.edit-forum-list').get(), {revertOnSpill: true}));\r\n            $dragulaScriptPath.val('');\r\n        }\r\n        else dragula($dialog.find('.edit-forum-list').get(), {revertOnSpill: true});\r\n\r\n        $dialog.submit(function (e) {\r\n            e.preventDefault();\r\n            Config.commonForumList = [];\r\n            $('#editCommonForumList').children('.btn').each(function () {\r\n                let $this = $(this);\r\n                let fid = parseInt($this.data('fid'));\r\n                let name = $this.text().trim();\r\n                if (!fid || !name) return;\r\n                Config.commonForumList.push({fid: fid, name: name});\r\n            });\r\n            writeConfig();\r\n            alert('设置已保存');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        }).find('[name=\"reset\"]').click(function () {\r\n            if (!confirm('是否重置？')) return;\r\n            Config.commonForumList = [];\r\n            writeConfig();\r\n            alert('设置已重置');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        });\r\n\r\n        Dialog.show(dialogName);\r\n    });\r\n};\r\n\r\n/**\r\n * 填充常用版块面板\r\n */\r\nexport const fillCommonForumPanel = function () {\r\n    let commonForumList = Config.commonForumList.length > 0 ? Config.commonForumList : Const.commonForumList;\r\n    let html = '';\r\n    for (let [index, {fid, name}] of commonForumList.entries()) {\r\n        if (index === 0 || index % 3 === 0) html += '<div class=\"row mb-3\">';\r\n        html += `\r\n<div class=\"col-4\">\r\n  <a class=\"btn btn-outline-primary btn-block\" href=\"${Util.makeUrl('thread')}/${fid}\">${name}</a>\r\n</div>`;\r\n        if (index === commonForumList.length - 1 || index % 3 === 2) html += '</div>';\r\n    }\r\n    $('.common-forum-panel').html(html);\r\n};\r\n\r\n/**\r\n * 在操作进行时阻止关闭页面\r\n */\r\nexport const preventCloseWindow = function () {\r\n    window.addEventListener(\"beforeunload\", function (e) {\r\n        if ($('.mask').length > 0) {\r\n            let msg = '正在进行操作中，确定要关闭页面吗？';\r\n            e.returnValue = msg;\r\n            return msg;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示通用的导入/导出设置对话框\r\n * @param {string} title 对话框标题\r\n * @param {string} configName 设置名称\r\n * @param {?function} [callback] 回调方法\r\n * @param {?function} [callbackAfterSubmit] 在提交之后的回调方法\r\n */\r\nexport const showCommonImportOrExportConfigDialog = function (title, configName, callback, callbackAfterSubmit) {\r\n    const dialogName = 'pdCommonImOrExConfigDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\r\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可\r\n</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control\" name=\"commonConfig\" rows=\"10\" aria-label=\"设置内容\" style=\"word-break: break-all;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, `导入或导出${title}`, bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否导入文本框中的设置？')) return;\r\n        let options = $.trim($dialog.find('[name=\"commonConfig\"]').val());\r\n        if (!options) return;\r\n        try {\r\n            options = JSON.parse(options);\r\n        }\r\n        catch (ex) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        if (!options || $.type(options) !== $.type(Config[configName])) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        Config[configName] = options;\r\n        writeConfig();\r\n        alert('设置已导入');\r\n        Dialog.close(dialogName);\r\n        if (typeof callbackAfterSubmit === 'function') callbackAfterSubmit();\r\n        else location.reload();\r\n    });\r\n    Dialog.show(dialogName);\r\n    $dialog.find('[name=\"commonConfig\"]').val(JSON.stringify(Config[configName])).select().focus();\r\n    if (typeof callback === 'function') callback($dialog);\r\n};\r\n\r\n/**\r\n * 关注用户\r\n */\r\nexport const followUsers = function () {\r\n    if (!Config.followUserList.length) return;\r\n    if (pageId === 'indexPage' && Config.highlightFollowUserThreadInHPEnabled) {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.closest('.thread-list-item').find('.thread-item-footer a:first').addClass('text-danger');\r\n                if (Config.highlightFollowUserThreadLinkEnabled) $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        $('.read-floor').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('username'), Config.followUserList) > -1) {\r\n                $this.find('.floor-num').addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'gjcPage' || pageId === 'sharePage' || pageId === 'searchPage') {\r\n        $('.thread-list-group').find('a[data-author]').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * 屏蔽用户\r\n */\r\nexport const blockUsers = function () {\r\n    if (!Config.blockUserList.length) return;\r\n    let num = 0;\r\n    if (pageId === 'indexPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList);\r\n            if (index > -1 && Config.blockUserList[index].type <= 1) {\r\n                num++;\r\n                $this.closest('.thread-link-group').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        if (Config.blockUserForumType === 1 && !Config.blockUserFidList.includes(Info.fid)) return;\r\n        else if (Config.blockUserForumType === 2 && Config.blockUserFidList.includes(Info.fid)) return;\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList);\r\n            if (index > -1 && Config.blockUserList[index].type <= 1) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        if (Config.blockUserForumType === 1 && !Config.blockUserFidList.includes(Info.fid)) return;\r\n        else if (Config.blockUserForumType === 2 && Config.blockUserFidList.includes(Info.fid)) return;\r\n        $('.read-floor').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('username'), Config.blockUserList);\r\n            if (index > -1) {\r\n                let floor = parseInt($this.data('floor'));\r\n                if (Config.blockUserList[index].type === 2 && floor === 0) return;\r\n                else if (Config.blockUserList[index].type === 1 && floor > 0) return;\r\n                num++;\r\n                $this.closest('.read-floor').remove();\r\n            }\r\n        });\r\n        $('.read-content').find('.blockquote > p').each(function () {\r\n            let $this = $(this);\r\n            let content = $this.text().trim();\r\n            for (let data of Config.blockUserList) {\r\n                if (data.type === 1) continue;\r\n                try {\r\n                    let regex1 = new RegExp(`^引用(第\\\\d+楼|楼主)${data.name}于`, 'i');\r\n                    let regex2 = new RegExp(`^回\\\\s*\\\\d+楼\\\\(${data.name}\\\\)\\\\s*的帖子`, 'i');\r\n                    if (regex1.test(content) || regex2.test(content)) {\r\n                        $this.html(`<mark class=\"help\" data-toggle=\"tooltip\" title=\"被屏蔽用户：${data.name}\">该用户已被屏蔽</mark>`);\r\n                    }\r\n                }\r\n                catch (ex) {\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'gjcPage' && Config.blockUserAtTipsEnabled) {\r\n        $('.thread-list-group').find('a[data-author]').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList) > -1) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    if (num > 0) console.log(`【屏蔽用户】共有${num}个主题或回复被屏蔽`);\r\n};\r\n\r\n/**\r\n * 屏蔽主题\r\n */\r\nexport const blockThread = function () {\r\n    if (!Config.blockThreadList.length) return;\r\n\r\n    /**\r\n     * 是否屏蔽主题\r\n     * @param {string} title 主题标题\r\n     * @param {string} userName 用户名\r\n     * @param {number} fid 版块ID\r\n     * @returns {boolean} 是否屏蔽\r\n     */\r\n    const isBlock = function (title, userName, fid = 0) {\r\n        for (let {keyWord, includeUser, excludeUser, includeFid, excludeFid} of Config.blockThreadList) {\r\n            let regex = null;\r\n            if (/^\\/.+\\/[gimuy]*$/.test(keyWord)) {\r\n                try {\r\n                    regex = eval(keyWord);\r\n                }\r\n                catch (ex) {\r\n                    console.log(ex);\r\n                    continue;\r\n                }\r\n            }\r\n            if (userName) {\r\n                if (includeUser) {\r\n                    if (!includeUser.includes(userName)) continue;\r\n                }\r\n                else if (excludeUser) {\r\n                    if (excludeUser.includes(userName)) continue;\r\n                }\r\n            }\r\n            if (fid) {\r\n                if (includeFid) {\r\n                    if (!includeFid.includes(fid)) continue;\r\n                }\r\n                else if (excludeFid) {\r\n                    if (excludeFid.includes(fid)) continue;\r\n                }\r\n            }\r\n            if (regex) {\r\n                if (regex.test(title)) return true;\r\n            }\r\n            else {\r\n                if (title.toLowerCase().includes(keyWord.toLowerCase())) return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    let num = 0;\r\n    if (pageId === 'indexPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (isBlock($this.text().trim(), $this.data('author'))) {\r\n                num++;\r\n                $this.closest('.thread-link-group').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (isBlock($this.text().trim(), $this.data('author'), Info.fid)) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        if (Info.currentPageNum !== 1) return;\r\n        let $topFloor = $('.read-floor[data-floor=\"0\"]');\r\n        if (!$topFloor.length) return;\r\n        if (isBlock($('.thread-title').text().trim(), $topFloor.data('username'), Info.fid)) {\r\n            num++;\r\n            $topFloor.remove();\r\n        }\r\n    }\r\n    if (num > 0) console.log(`【屏蔽主题】共有${num}个主题被屏蔽`);\r\n};\r\n","/* 主题模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {write as writeConfig} from './config';\r\nimport * as Msg from './msg';\r\n\r\n/**\r\n * 处理复制楼层跳转链接按钮\r\n */\r\nexport const handleCopyFloorLinkBtn = function () {\r\n    $(document).on('click', '.floor-num', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let link = Util.getHostNameUrl() + $this.attr('href');\r\n        $this.data('copy-text', link);\r\n        if (!Util.copyText($this, $this)) {\r\n            prompt('本楼的跳转链接：', link);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理快速回复按钮\r\n */\r\nexport const handleFastReplyBtn = function () {\r\n    $(document).on('click', '.fast-reply-btn', function () {\r\n        let $article = $(this).closest('article');\r\n        let floor = $article.data('floor');\r\n        let userName = $article.data('username');\r\n        $('#postGjc').val(userName);\r\n        let postContent = $('#postContent').get(0);\r\n        postContent.value = `[quote]回 ${floor}楼(${userName}) 的帖子[/quote]\\n`;\r\n        postContent.selectionStart = postContent.value.length;\r\n        postContent.selectionEnd = postContent.value.length;\r\n        postContent.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理屏蔽回帖按钮\r\n */\r\nexport const handleBlockFloorBtn = function () {\r\n    $(document).on('click', '.block-floor', () => confirm('确认要屏蔽该回帖？本操作不可恢复！（屏蔽后该回帖将对大家不可见）'));\r\n};\r\n\r\n/**\r\n * 处理购买帖子按钮\r\n */\r\nexport const handleBuyThreadBtn = function () {\r\n    $(document).on('click', '.buy-thread-btn', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let pid = $this.data('pid');\r\n        let price = $this.data('price');\r\n        if (price > 5 && !confirm(`此贴售价${price}KFB，是否购买？`)) return;\r\n        let $wait = Msg.wait('正在购买帖子&hellip;');\r\n        $.get(Util.makeUrl('job/buytopic', `tid=${Info.tid}&pid=${pid}&verify=${Info.verify}`),\r\n            function ({msg}) {\r\n                Msg.remove($wait);\r\n                if (msg === '操作完成') {\r\n                    location.reload();\r\n                }\r\n                else if (msg.includes('您已经购买此帖')) {\r\n                    alert('你已经购买过此帖');\r\n                    location.reload();\r\n                }\r\n                else {\r\n                    alert('帖子购买失败');\r\n                }\r\n            });\r\n    });\r\n};\r\n\r\n/**\r\n * 复制购买人名单\r\n */\r\nexport const copyBuyThreadList = function () {\r\n    $(document).on('change', '.buy-thread-list', function () {\r\n        let $this = $(this);\r\n        if ($this.val() !== 'copyList') return;\r\n        let list = $this.find('option').map(function (index) {\r\n            let name = $(this).text();\r\n            if (index === 0 || index === 1 || name.includes('-'.repeat(11))) return null;\r\n            else return name;\r\n        }).get().join('\\n');\r\n        $this.get(0).selectedIndex = 0;\r\n        if (!list) {\r\n            alert('暂时无人购买');\r\n            return;\r\n        }\r\n\r\n        let $dialog = $(`\r\n<div class=\"modal fade\" id=\"buyThreadListDialog\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"buyThreadListDialogTitle\"\r\n     aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-sm\" role=\"document\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\" id=\"buyThreadListDialogTitle\">购买人名单</h5>\r\n        <button class=\"close\" data-dismiss=\"modal\" type=\"button\" aria-label=\"关闭\">\r\n          <span aria-hidden=\"true\">&times;</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <textarea class=\"form-control\" name=\"buyThreadListContent\" rows=\"14\" aria-label=\"购买人名单\">${list}</textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n`).appendTo('body');\r\n        $dialog.on('shown.bs.modal', function () {\r\n            $dialog.find('[name=\"buyThreadListContent\"]').select().focus();\r\n        }).on('hidden.bs.modal', function () {\r\n            $dialog.remove();\r\n        }).modal('show');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理楼层内的图片\r\n */\r\nexport const handleFloorImage = function () {\r\n    $(document).on('click', '.img', function () {\r\n        let $this = $(this);\r\n        if ($this.parent().is('a') || this.naturalWidth <= $this.closest('.read-content').width()) return;\r\n        location.href = $this.attr('src');\r\n    });\r\n};\r\n\r\n/**\r\n * 跳转到指定楼层\r\n */\r\nexport const gotoFloor = function () {\r\n    if (Info.floor && Info.floor > 0) {\r\n        let hashName = $(`article[data-floor=\"${Info.floor}\"]`).prev('a').attr('name');\r\n        if (hashName) location.hash = '#' + hashName;\r\n    }\r\n};\r\n\r\n/**\r\n * 处理快速跳转到指定楼层按钮\r\n */\r\nexport const handleFastGotoFloorBtn = function () {\r\n    $('.fast-goto-floor').click(function (e) {\r\n        e.preventDefault();\r\n        let action = $(this).data('url');\r\n        if (!action) return;\r\n        let floor = parseInt(prompt('你要跳转到哪一层楼？'));\r\n        if (!floor || floor <= 0) return;\r\n        location.href = Util.makeUrl(action, `page=${Math.floor(floor / Config.perPageFloorNum) + 1}&floor=${floor}`);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理推帖子按钮\r\n */\r\nexport const handleTuiThreadBtn = function () {\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: '/diy_read_tui.php',\r\n            data: `tid=${Info.tid}&safeid=${Info.safeId}`,\r\n            success: function (msg) {\r\n                let matches = /<span.+?\\+\\d+!<\\/span>\\s*(\\d+)/i.exec(msg);\r\n                if (matches) {\r\n                    let $num = $this.find('span:first');\r\n                    $num.text('+1');\r\n                    setTimeout(() => {\r\n                        $num.text(matches[1]);\r\n                    }, 1000);\r\n                }\r\n                else if (/已推过/.test(msg)) {\r\n                    alert('已推过');\r\n                }\r\n                else {\r\n                    alert('操作失败');\r\n                }\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 处理复制代码按钮\r\n */\r\nexport const handleCopyCodeBtn = function () {\r\n    $(document).on('click', '.copy-code', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if (Util.copyText($this.next('pre'), $this)) return;\r\n\r\n        let code = $this.data('code');\r\n        if (code) {\r\n            $this.text('复制代码').removeData('code');\r\n            $this.next('textarea').remove();\r\n            $this.after(`<pre class=\"pre-scrollable\">${code}</pre>`);\r\n        }\r\n        else {\r\n            let $pre = $this.next('pre');\r\n            let html = $pre.html();\r\n            $this.text('还原代码').data('code', html);\r\n            html = Util.decodeHtmlSpecialChar(html);\r\n            let height = $pre.height();\r\n            if (height < 50) height = 50;\r\n            if (height > 340) height = 340;\r\n            $pre.remove();\r\n            $(`<textarea class=\"form-control code-textarea\" style=\"height: ${height}px\" wrap=\"off\">${html}</textarea>`)\r\n                .insertAfter($this).select().focus();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 获取当前页面选中的多重引用数据\r\n * @returns {{}[]} 多重引用数据列表\r\n */\r\nconst getCheckedMultiQuoteData = function () {\r\n    let quoteList = [];\r\n    $('.multi-quote-check:checked').each(function () {\r\n        let $article = $(this).closest('article');\r\n        quoteList.push({floor: $article.data('floor'), pid: $article.data('pid'), userName: $article.data('username')});\r\n    });\r\n    return quoteList;\r\n};\r\n\r\n/**\r\n * 绑定多重引用复选框点击事件\r\n */\r\nexport const bindMultiQuoteCheckClick = function () {\r\n    $(document).on('click', '.multi-quote-check', function () {\r\n        let data = localStorage[Const.multiQuoteStorageName];\r\n        if (data) {\r\n            try {\r\n                data = JSON.parse(data);\r\n                if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) data = null;\r\n                else if (!('tid' in data) || data.tid !== Info.tid || $.type(data.quoteList) !== 'object') data = null;\r\n            }\r\n            catch (ex) {\r\n                data = null;\r\n            }\r\n        }\r\n        else {\r\n            data = null;\r\n        }\r\n        let quoteList = getCheckedMultiQuoteData();\r\n        if (!data) {\r\n            localStorage.removeItem(Const.multiQuoteStorageName);\r\n            data = {tid: Info.tid, quoteList: {}};\r\n        }\r\n        if (quoteList.length > 0) data.quoteList[Info.currentPageNum] = quoteList;\r\n        else delete data.quoteList[Info.currentPageNum];\r\n        localStorage[Const.multiQuoteStorageName] = JSON.stringify(data);\r\n    });\r\n};\r\n\r\n/**\r\n * 添加用户自定义备注\r\n */\r\nexport const addUserMemo = function () {\r\n    if ($.isEmptyObject(Config.userMemoList)) return;\r\n    $('.read-floor').each(function () {\r\n        let $this = $(this);\r\n        let userName = $this.data('username');\r\n        let key = Object.keys(Config.userMemoList).find(name => name === userName);\r\n        if (!key) return;\r\n        $this.find('.floor-user').after(\r\n            `<span class=\"tips font-size-sm\" data-toggle=\"tooltip\" title=\"备注：${Config.userMemoList[key]}\">[?]</span>`\r\n        );\r\n    });\r\n};\r\n","/* 其它模块 */\r\n'use strict';\r\n\r\n/**\r\n * 设置Cookie\r\n * @param {string} name Cookie名称\r\n * @param {*} value Cookie值\r\n * @param {?Date} date Cookie有效期，留空则表示有效期为浏览器进程\r\n * @param {string} prefix Cookie名称前缀\r\n */\r\nexport const setCookie = function (name, value, date = null, prefix = Info.cookiePrefix) {\r\n    document.cookie = `${prefix}${name}=${encodeURI(value)}${!date ? '' : ';expires=' + date.toUTCString()};path=/;`;\r\n};\r\n\r\n/**\r\n * 获取Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} prefix Cookie名称前缀\r\n * @returns {?string} Cookie值\r\n */\r\nexport const getCookie = function (name, prefix = Info.cookiePrefix) {\r\n    let regex = new RegExp(`(^| )${prefix}${name}=([^;]*)(;|$)`);\r\n    let matches = document.cookie.match(regex);\r\n    if (!matches) return null;\r\n    else return decodeURI(matches[2]);\r\n};\r\n\r\n/**\r\n * 删除Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} prefix Cookie名称前缀\r\n */\r\nexport const deleteCookie = function (name, prefix = Info.cookiePrefix) {\r\n    document.cookie = `${prefix}${name}=;expires=${getDate('-1d').toUTCString()};path=/;`;\r\n};\r\n\r\n/**\r\n * 获取在当前时间的基础上的指定（相对）时间量的Date对象\r\n * @param {string} value 指定（相对）时间量，+或-：之后或之前（相对于当前时间）；无符号：绝对值；Y：完整年份；y：年；M：月；d：天；h：小时；m：分；s：秒；ms：毫秒\r\n * @returns {?Date} 指定（相对）时间量的Date对象\r\n * @example\r\n * Tools.getDate('+2y') 获取2年后的Date对象\r\n * Tools.getDate('+3M') 获取3个月后的Date对象\r\n * Tools.getDate('-4d') 获取4天前的Date对象\r\n * Tools.getDate('5h') 获取今天5点的Date对象（其它时间量与当前时间一致）\r\n * Tools.getDate('2015Y') 获取年份为2015年的Date对象\r\n */\r\nexport const getDate = function (value) {\r\n    let date = new Date();\r\n    let matches = /^(-|\\+)?(\\d+)([a-zA-Z]{1,2})$/.exec(value);\r\n    if (!matches) return null;\r\n    let flag = typeof matches[1] === 'undefined' ? 0 : (matches[1] === '+' ? 1 : -1);\r\n    let increment = flag === -1 ? -parseInt(matches[2]) : parseInt(matches[2]);\r\n    let unit = matches[3];\r\n    switch (unit) {\r\n        case 'Y':\r\n            date.setFullYear(increment);\r\n            break;\r\n        case 'y':\r\n            date.setFullYear(flag === 0 ? increment : date.getFullYear() + increment);\r\n            break;\r\n        case 'M':\r\n            date.setMonth(flag === 0 ? increment : date.getMonth() + increment);\r\n            break;\r\n        case 'd':\r\n            date.setDate(flag === 0 ? increment : date.getDate() + increment);\r\n            break;\r\n        case 'h':\r\n            date.setHours(flag === 0 ? increment : date.getHours() + increment);\r\n            break;\r\n        case 'm':\r\n            date.setMinutes(flag === 0 ? increment : date.getMinutes() + increment);\r\n            break;\r\n        case 's':\r\n            date.setSeconds(flag === 0 ? increment : date.getSeconds() + increment);\r\n            break;\r\n        case 'ms':\r\n            date.setMilliseconds(flag === 0 ? increment : date.getMilliseconds() + increment);\r\n            break;\r\n        default:\r\n            return null;\r\n    }\r\n    return date;\r\n};\r\n\r\n/**\r\n * 获取指定字符串的字节长度（1个GBK字符按2个字节来算）\r\n * @param {string} str 指定字符串\r\n * @returns {number} 字符串的长度\r\n */\r\nexport const getStrByteLen = function (str) {\r\n    let len = 0;\r\n    let cLen = 2;\r\n    for (let i = 0; i < str.length; i++) {\r\n        len += str.charCodeAt(i) < 0 || str.charCodeAt(i) > 255 ? cLen : 1;\r\n    }\r\n    return len;\r\n};\r\n\r\n/**\r\n * 获取当前域名的URL\r\n * @returns {string} 当前域名的URL\r\n */\r\nexport const getHostNameUrl = function () {\r\n    return location.protocol + '//' + location.host;\r\n};\r\n\r\n/**\r\n * 添加BBCode\r\n * @param textArea 文本框\r\n * @param {string} code BBCode\r\n * @param {string} selText 选择文本\r\n */\r\nexport const addCode = function (textArea, code, selText = '') {\r\n    let startPos = selText === '' ? code.indexOf(']') + 1 : code.indexOf(selText);\r\n    if (typeof textArea.selectionStart !== 'undefined') {\r\n        let prePos = textArea.selectionStart;\r\n        textArea.value = textArea.value.substring(0, prePos) + code + textArea.value.substring(textArea.selectionEnd);\r\n        textArea.selectionStart = prePos + startPos;\r\n        textArea.selectionEnd = prePos + startPos + selText.length;\r\n    }\r\n    else {\r\n        textArea.value += code;\r\n    }\r\n};\r\n\r\n/**\r\n * 获取选择文本\r\n * @param textArea 文本框\r\n * @returns {string} 选择文本\r\n */\r\nexport const getSelText = function (textArea) {\r\n    return textArea.value.substring(textArea.selectionStart, textArea.selectionEnd);\r\n};\r\n\r\n/**\r\n * 从URL查询字符串提取参数对象\r\n * @param {string} str URL查询字符串\r\n * @returns {Map} 参数集合\r\n */\r\nexport const extractQueryStr = function (str) {\r\n    let params = new Map();\r\n    for (let param of str.split('&')) {\r\n        if (!param) continue;\r\n        let [key, value] = param.split('=');\r\n        params.set(key, typeof value !== 'undefined' ? value : '');\r\n    }\r\n    return params;\r\n};\r\n\r\n/**\r\n * 从参数对象中创建URL查询字符串\r\n * @param {Map} map 参数集合\r\n * @returns {string} URL查询字符串\r\n */\r\nexport const buildQueryStr = function (map) {\r\n    let queryStr = '';\r\n    for (let [key, value] of map) {\r\n        if (Info.urlType === 2) {\r\n            queryStr += (queryStr ? '&' : '') + key + '=' + value;\r\n        }\r\n        else {\r\n            queryStr += (queryStr ? '/' : '') + key + '/' + value;\r\n        }\r\n    }\r\n    return queryStr;\r\n};\r\n\r\n/**\r\n * 生成指定的URL\r\n * @param {string} action 控制器（小写）\r\n * @param {string} param 查询参数\r\n * @param {boolean} includeOtherParam 是否包括当前页面的其它查询参数\r\n * @param {[]} excludeParams 要排除当前页面的查询参数列表\r\n * @returns {string} URL 最终的URL\r\n */\r\nexport const makeUrl = function (action, param = '', includeOtherParam = false, excludeParams = []) {\r\n    let url = '';\r\n    let paramList = extractQueryStr(param);\r\n    if (includeOtherParam) {\r\n        paramList = new Map([...extractQueryStr(Info.urlParam).entries(), ...paramList.entries()]);\r\n        for (let i in excludeParams) {\r\n            paramList.delete(excludeParams[i]);\r\n        }\r\n    }\r\n    if (!action.startsWith('/')) {\r\n        if (location.pathname.startsWith(Info.baseFile)) url = Info.baseFile + '/';\r\n        else url = Info.rootPath;\r\n    }\r\n    url += action;\r\n    if (paramList.size > 0) {\r\n        let queryStr = buildQueryStr(paramList);\r\n        if (queryStr) {\r\n            url += (Info.urlType === 2 ? '?' : '/') + queryStr;\r\n        }\r\n    }\r\n    return url;\r\n};\r\n\r\n/**\r\n * 获取URL查询字符串中的指定参数\r\n * @param {string} name 参数名称\r\n * @returns {?string} 参数值\r\n */\r\nexport const getQueryParam = function (name) {\r\n    return extractQueryStr(Info.urlParam).get(name);\r\n};\r\n\r\n/**\r\n * 解码HTML特殊字符\r\n * @param {string} str 待解码的字符串\r\n * @returns {string} 解码后的字符串\r\n */\r\nexport const decodeHtmlSpecialChar = function (str) {\r\n    if (!str.length) return '';\r\n    return str.replace(/<br\\s*\\/?>/gi, '\\n')\r\n        .replace(/&quot;/gi, '\\\"')\r\n        .replace(/&#39;/gi, '\\'')\r\n        .replace(/&nbsp;/gi, ' ')\r\n        .replace(/&gt;/gi, '>')\r\n        .replace(/&lt;/gi, '<')\r\n        .replace(/&amp;/gi, '&');\r\n};\r\n\r\n/**\r\n * 全选\r\n * @param {jQuery} $nodes 想要全选的节点的jQuery对象\r\n */\r\nexport const selectAll = function ($nodes) {\r\n    $nodes.prop('checked', true);\r\n};\r\n\r\n/**\r\n * 反选\r\n * @param {jQuery} $nodes 想要反选的节点的jQuery对象\r\n */\r\nexport const selectInverse = function ($nodes) {\r\n    $nodes.each(function () {\r\n        let $this = $(this);\r\n        $this.prop('checked', !$this.prop('checked'));\r\n    });\r\n};\r\n\r\n/**\r\n * 显示字段验证消息\r\n * @param {jQuery} $node 验证字段的jQuery对象\r\n * @param {string} type 验证类型\r\n * @param {string} msg 验证消息\r\n */\r\nexport const showValidationMsg = function ($node, type, msg = '') {\r\n    if (type === 'error') type = 'danger';\r\n    $node.removeClass('form-control-success form-control-warning form-control-danger');\r\n    let $parent = $node.parent();\r\n    $parent.removeClass('has-success has-warning has-danger');\r\n    if ($.inArray(type, ['success', 'warning', 'danger'] > -1)) {\r\n        $node.addClass('form-control-' + type).parent().addClass('has-' + type);\r\n    }\r\n    let $feedback = $parent.find('.form-control-feedback');\r\n    if (type === 'wait') {\r\n        $feedback.html(`<span class=\"text-muted\"><i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i> ${msg}</span>`);\r\n    }\r\n    else {\r\n        $feedback.text(msg);\r\n    }\r\n};\r\n\r\n/**\r\n * 获取对象A在对象B中的相对补集\r\n * @param {Object} a 对象A\r\n * @param {Object} b 对象B\r\n * @returns {Object} 相对补集\r\n */\r\nexport const getDifferenceSetOfObject = function (a, b) {\r\n    let c = {};\r\n    if ($.type(a) !== 'object' || $.type(b) !== 'object') return c;\r\n    $.each(b, (key, data) => {\r\n        if (key in a) {\r\n            if (!deepEqual(a[key], data)) c[key] = data;\r\n        }\r\n    });\r\n    return c;\r\n};\r\n\r\n/**\r\n * 深度比较两个对象是否相等\r\n * @param {*} a\r\n * @param {*} b\r\n * @returns {boolean} 是否相等\r\n */\r\nexport const deepEqual = function (a, b) {\r\n    if (a === b) return true;\r\n    if ($.type(a) !== $.type(b)) return false;\r\n    if (typeof a === 'number' && typeof b === 'number' && isNaN(a) && isNaN(b)) return true;\r\n    if ($.isArray(a) && $.isArray(b) || $.type(a) === 'object' && $.type(b) === 'object') {\r\n        if (a.length !== b.length) return false;\r\n        for (var i in $.extend($.isArray(a) ? [] : {}, a, b)) {\r\n            if (typeof a[i] === 'undefined' || typeof b[i] === 'undefined') return false;\r\n            if (!deepEqual(a[i], b[i])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * 复制文本\r\n * @param {jQuery} $target 要复制文本的目标元素\r\n * @param {?jQuery} $source 触发事件的源元素\r\n * @returns {boolean} 是否复制成功\r\n */\r\nexport const copyText = function ($target, $source = null) {\r\n    if (!('execCommand' in document) || !$target.length) return false;\r\n    let copyText = $target.data('copy-text');\r\n    if (copyText) {\r\n        $target = $(`<span class=\"text-hide\">${copyText}</span>`).insertAfter($target);\r\n    }\r\n    let s = window.getSelection();\r\n    s.selectAllChildren($target.get(0));\r\n    let result = document.execCommand('copy');\r\n    s.removeAllRanges();\r\n    if (copyText) $target.remove();\r\n    if (result && $source) {\r\n        let msg = $source.data('copy-msg');\r\n        $source.attr('title', msg ? msg : '已复制').on('hidden.bs.tooltip', function () {\r\n            $(this).tooltip('dispose');\r\n        }).tooltip('show');\r\n    }\r\n    return result;\r\n};\r\n\r\n/**\r\n * 获取指定用户名在关注或屏蔽列表中的索引号\r\n * @param {string} name 指定用户名\r\n * @param {Array} list 指定列表\r\n * @returns {number} 指定用户在列表中的索引号，-1表示不在该列表中\r\n */\r\nexport const inFollowOrBlockUserList = (name, list) => list.findIndex(data => data.name && data.name === name);\r\n\r\n/**\r\n * 检测浏览器是否为Opera\r\n * @returns {boolean} 是否为Opera\r\n */\r\nexport const isOpera = () => typeof window.opera !== 'undefined';\r\n\r\n/**\r\n * 检测浏览器是否为Edge\r\n * @returns {boolean} 是否为Edge\r\n */\r\nexport const isEdge = () => navigator.appVersion && navigator.appVersion.includes('Edge');\r\n"]}
{"version":3,"sources":["node_modules/_browser-pack@6.1.0@browser-pack/_prelude.js","public/static/src/js/app.js","public/static/src/js/module/config.js","public/static/src/js/module/configDialog.js","public/static/src/js/module/const.js","public/static/src/js/module/dialog.js","public/static/src/js/module/index.js","public/static/src/js/module/msg.js","public/static/src/js/module/other.js","public/static/src/js/module/post.js","public/static/src/js/module/public.js","public/static/src/js/module/read.js","public/static/src/js/module/script.js","public/static/src/js/module/util.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","_config","_const","Script","Public","Index","Read","Post","Other","window","pageId","$","attr","document","ready","startTime","Date","Util","Const","default","Msg","Dialog","Conf","readConfig","read","writeConfig","write","ex","console","log","exportModule","init","Config","customCssEnabled","customCssContent","append","customScriptEnabled","runCustomScript","preventCloseWindow","handleMainMenu","handleMainMenuLink","showSidebarBtnGroupEnabled","showSidebarBtnGroup","handleSidebarRollBtn","handleSearchDialog","fillCommonForumPanel","showEditCommonForumDialog","handlePageInput","bindFastSubmitShortcutKey","handleAtTipsBtn","handleIndexThreadPanel","handleSelectBg","gotoFloor","threadContentFontSize","handleFastGotoFloorBtn","handleTuiThreadBtn","handleCopyFloorLinkBtn","handleFastReplyBtn","handleGoodPostBtn","handleBlockFloorBtn","handleBuyThreadBtn","copyBuyThreadList","replaceAttachLabel","handleFloorImage","checkPostForm","handleCopyCodeBtn","addSmileCode","addRedundantKeywordWarning","bindMultiQuoteCheckClick","handleClearMultiQuoteDataBtn","handleMoveThreadBtn","click","handleMultiQuote","userMemoEnabled","addUserMemo","handleInstallScriptLink","handleEditorBtns","handleAttachBtns","Info","multiQuote","on","specialPostTitleChange","highlightUnReadAtTipsMsg","handleUserPageBtns","handleProfilePage","handleGameIntroSearchArea","includes","tuiGame","bindFavorPageBtnsClick","bindFriendPageBtnsClick","syncPerPageFloorNum","assignBirthdayField","handleUploadAvatarFileBtn","transferKfbAlert","bindMessageActionBtnsClick","showSelfRateErrorSizeSubmitWarning","confirm","this","text","trim","localStorage","removeItem","uid","handleBuyItemBtns","showMyInfoInItemShop","blockUserEnabled","blockUsers","blockThreadEnabled","blockThread","followUserEnabled","followUsers","kfSmileEnhanceExtensionEnabled","rootPath","staticPath","resTimestamp","adminMemberEnabled","removeClass","tooltip","container","handleRegisterPage","name","activeNewReplyPanel","activeTopRecommendPanel","commonForumList","showSidebarRollBtnEnabled","showSidebarMainMenuBtnEnabled","showSidebarForumListBtnEnabled","showSidebarSearchBtnEnabled","showSidebarHomePageBtnEnabled","perPageFloorNum","userMemoList","defShowMsgDuration","customScriptList","followUserList","highlightFollowUserThreadInHPEnabled","highlightFollowUserThreadLinkEnabled","blockUserDefaultType","blockUserAtTipsEnabled","blockUserForumType","blockUserFidList","blockUserList","blockThreadDefForumType","blockThreadDefFidList","blockThreadList","extend","options","JSON","parse","type","isEmptyObject","normalize","getDifferenceSetOfObject","stringify","clear","settings","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Object","entries","Symbol","iterator","next","done","_step$value","_slicedToArray","value","key","err","return","_util","_dialog","_script","_public","show","dialogName","$dialog","create","submit","preventDefault","getMainConfigValue","close","$this","hasClass","data","showRunCommandDialog","showUserMemoDialog","showCustomCssDialog","showDialog","showFollowUserDialog","showBlockUserDialog","showBlockThreadDialog","find","prompt","parseInt","isNaN","clearTmpData","alert","end","location","reload","showImportOrExportSettingDialog","setMainConfigValue","each","is","prop","val","Boolean","arguments","_const2","test","deleteCookie","multiQuoteStorageName","$cmd","$result","content","response","runCmd","focus","keydown","ctrlKey","keyCode","select","$userMemoList","split","line","_line$split","_line$split2","user","_line$split2$","memo","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_step2$value","$content","$followUserList","addFollowUser","appendTo","inFollowOrBlockUserList","push","$checked","remove","$addUser","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","showCommonImportOrExportConfigDialog","selectAll","selectInverse","closest","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","$blockUserList","addBlockUser","Set","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","fid","add","concat","_toConsumableArray","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","change","triggerHandler","join","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","bodyContent","footerContent","$blockThreadList","addBlockThread","keyWord","userType","userList","fidType","fidList","verify","flag","$txtKeyWord","eval","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","newObj","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","size","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","html","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","includeUser","excludeUser","includeFid","excludeFid","atTipsTimeExpires","bgStyleExpires","storagePrefix","atTipsTimeCookieName","prevAtTipsTimeCookieName","bgStyleCookieName","availableForumList","id","title","target","checked","isOpera","isEdge","not","addClass","resize","fadeIn","css","height","outerHeight","fadeOut","parent","off","time","cookieValue","getCookie","setCookie","curDate","getDate","toString","padStart","tab","targetPanel","typeName","fileName","path","color","$bg","toLowerCase","replace","duration","msg","clickable","preventable","$container","isFirst","destroy","$msg","hide","stopPropagation","slideDown","setTimeout","wait","slideUp","gjc","userName","timeString","prevString","index","curString","keyword","searchType","cookieName","ajax","url","success","$num","num","error","complete","removeData","$form","action","matches","exec","year","month","day","syncConfig","_$checked","makeUrl","showValidationMsg","trigger","namecheck","$response","post","serialize","_ref","fail","$area","str","splice","$registerDate","now","_matches","getMonth","getFullYear","ratingSize","parseFloat","titleSize","toLocaleString","get","kfbMatches","gxMatches","kfb","gx","itemId","safeId","removeHtmlTag","always","textArea","selText","getSelText","addCode","codeType","$postType","$postTitle","getStrByteLen","$voteItemContent","$postContent","_length","$postGjc","after","blur","$newAttachArea","$lastAttachArea","insertAfter","$node","$relatedTarget","relatedTarget","_data","tid","quoteList","list","values","_data2","Array","isArray","quote","keywords","$keywords","clearQueue","floor","pid","queue","getTime","postContent","$countdownNum","dequeue","filter","wangPanType","fileSize","expiryDate","fileFormat","ziGou","xinZuo","fileTitle","previewTitle","realTitle","titleLength","_configDialog","ConfigDialog","maxHeight","documentElement","clientHeight","scroll","$btn","scrollTop","animate","$searchDialog","$searchKeyword","$method","Math","$current","$currentBox","disabled","maxPageNum","excludeParams","currentPageNum","href","commonForumListHtml","availableForumListHtml","_loop","elem","dragulaInit","dragula","revertOnSpill","$dragulaScriptPath","dragulaScriptPath","getScript","children","_step3$value","_step3$value$","_fid","addEventListener","returnValue","configName","callback","callbackAfterSubmit","regex1","RegExp","regex2","isBlock","_step5$value","regex","$topFloor","link","getHostNameUrl","copyText","$article","selectionStart","selectionEnd","goodPostTips","$floor","prepend","price","$wait","map","repeat","selectedIndex","modal","naturalWidth","width","hashName","prev","hash","$pre","decodeHtmlSpecialChar","keys","aid","replaceWith","defScriptName","metaRegex","cmd","isOutput","isError","String","enabled","getScriptMeta","meta","version","homepage","author","metaContent","showIndex","$customScriptList","addCustomScript","_ref$enabled","_ref$name","_ref$version","_ref$homepage","_ref$trigger","_ref$content","count","startsWith","collapse","_getScriptMeta","nextAll","eq","htmlDecode","findIndex","script","isUpdate","date","prefix","cookie","encodeURI","toUTCString","match","decodeURI","increment","setFullYear","setMonth","setDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","setMilliseconds","getMilliseconds","extractQueryStr","len","charCodeAt","protocol","host","startPos","indexOf","prePos","substring","params","Map","param","_param$split","_param$split2","set","buildQueryStr","queryStr","urlType","deepEqual","includeOtherParam","paramList","urlParam","delete","pathname","baseFile","getQueryParam","$nodes","$parent","inArray","$feedback","b","$target","$source","s","getSelection","selectAllChildren","result","execCommand","removeAllRanges","opera","navigator","appVersion","htmlEncode","getUrlParam","removeUnpairedBBCodeContent","startCodeList","endCodeList","startMatches","endMatches"],"mappings":"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","file":"app.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","'use strict';\r\nimport {init as initConfig} from './module/config';\r\nimport * as Util from './module/util';\r\nimport Const from './module/const';\r\nimport * as Msg from './module/msg';\r\nimport * as Dialog from './module/dialog';\r\nimport * as Script from './module/script';\r\nimport * as Public from './module/public';\r\nimport * as Index from './module/index';\r\nimport * as Read from './module/read';\r\nimport * as Post from './module/post';\r\nimport * as Other from './module/other';\r\nimport * as ConfigDialog from './module/configDialog';\r\n\r\n// 页面ID\r\nwindow.pageId = $('body').attr('id');\r\n\r\n/**\r\n * 导出模块\r\n */\r\nconst exportModule = function () {\r\n    try {\r\n        window.Util = require('./module/util');\r\n        window.Const = require('./module/const').default;\r\n        window.Msg = require('./module/msg');\r\n        window.Dialog = require('./module/dialog');\r\n        window.Script = require('./module/script');\r\n        window.Public = require('./module/public');\r\n        window.Index = require('./module/index');\r\n        window.Read = require('./module/read');\r\n        window.Post = require('./module/post');\r\n        window.Other = require('./module/other');\r\n        const Conf = require('./module/config');\r\n        window.readConfig = Conf.read;\r\n        window.writeConfig = Conf.write;\r\n    }\r\n    catch (ex) {\r\n        console.log(ex);\r\n    }\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\nconst init = function () {\r\n    if (pageId === 'loginPage') return;\r\n    let startTime = new Date();\r\n    exportModule();\r\n    if (pageId === 'registerPage') {\r\n        Other.handleRegisterPage();\r\n        return;\r\n    }\r\n    initConfig();\r\n\r\n    if (Config.customCssEnabled && Config.customCssContent) {\r\n        $('head').append(`<style>${Config.customCssContent}</style>`);\r\n    }\r\n    if (Config.customScriptEnabled) {\r\n        Script.runCustomScript('start');\r\n    }\r\n\r\n    Public.preventCloseWindow();\r\n    Public.handleMainMenu();\r\n    Public.handleMainMenuLink();\r\n    if (Config.showSidebarBtnGroupEnabled) {\r\n        Public.showSidebarBtnGroup();\r\n    }\r\n    Public.handleSidebarRollBtn();\r\n    Public.handleSearchDialog();\r\n    Public.fillCommonForumPanel();\r\n    Public.showEditCommonForumDialog();\r\n    if ($('.page-input').length > 0) {\r\n        Public.handlePageInput();\r\n    }\r\n    Public.bindFastSubmitShortcutKey();\r\n\r\n    if (pageId === 'indexPage') {\r\n        Index.handleAtTipsBtn();\r\n        Index.handleIndexThreadPanel();\r\n        Index.handleSelectBg();\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        Read.gotoFloor();\r\n        if (Config.threadContentFontSize > 0) {\r\n            $('head').append(`<style>.read-content { font-size: ${Config.threadContentFontSize}px; }</style>`);\r\n        }\r\n        Read.handleFastGotoFloorBtn();\r\n        Read.handleTuiThreadBtn();\r\n        Read.handleCopyFloorLinkBtn();\r\n        Read.handleFastReplyBtn();\r\n        Read.handleGoodPostBtn();\r\n        Read.handleBlockFloorBtn();\r\n        Read.handleBuyThreadBtn();\r\n        Read.copyBuyThreadList();\r\n        Read.replaceAttachLabel();\r\n        Read.handleFloorImage();\r\n        Post.checkPostForm();\r\n        Read.handleCopyCodeBtn();\r\n        Post.addSmileCode($('#postContent'));\r\n        Post.addRedundantKeywordWarning();\r\n        Read.bindMultiQuoteCheckClick();\r\n        Post.handleClearMultiQuoteDataBtn();\r\n        Read.handleMoveThreadBtn();\r\n        $('.multi-reply-btn').click(() => Post.handleMultiQuote(1));\r\n        if (Config.userMemoEnabled) {\r\n            Read.addUserMemo();\r\n        }\r\n        Script.handleInstallScriptLink();\r\n    }\r\n    else if (pageId === 'postPage') {\r\n        Post.addRedundantKeywordWarning();\r\n        Post.checkPostForm();\r\n        Post.handleEditorBtns();\r\n        Post.addSmileCode($('#postContent'));\r\n        Post.handleAttachBtns();\r\n        Post.handleClearMultiQuoteDataBtn();\r\n        if (Info.multiQuote) Post.handleMultiQuote(2);\r\n        $('#postTitleFormatArea').on('change', '[type=\"text\"], [type=\"checkbox\"]', () => Post.specialPostTitleChange());\r\n    }\r\n    else if (pageId === 'gjcPage') {\r\n        Other.highlightUnReadAtTipsMsg();\r\n    }\r\n    else if (pageId === 'userPage') {\r\n        Other.handleUserPageBtns();\r\n        Other.handleProfilePage();\r\n    }\r\n    else if (pageId === 'gameIntroSearchPage') {\r\n        Other.handleGameIntroSearchArea();\r\n    }\r\n    else if (['gameIntroPage', 'gameIntroCompanyPage', 'gameIntroTypePage', 'gameIntroPropertyPage'].includes(pageId)) {\r\n        Other.tuiGame();\r\n    }\r\n    else if (pageId === 'favorPage') {\r\n        Other.bindFavorPageBtnsClick();\r\n    }\r\n    else if (pageId === 'friendPage') {\r\n        Other.bindFriendPageBtnsClick();\r\n    }\r\n    else if (pageId === 'modifyPage') {\r\n        Other.syncPerPageFloorNum();\r\n        Other.assignBirthdayField();\r\n        Other.handleUploadAvatarFileBtn();\r\n    }\r\n    else if (pageId === 'bankPage') {\r\n        Other.transferKfbAlert();\r\n    }\r\n    else if (pageId === 'messagePage') {\r\n        Other.bindMessageActionBtnsClick();\r\n    }\r\n    else if (pageId === 'readMessagePage') {\r\n        Read.handleFloorImage();\r\n        Read.handleCopyCodeBtn();\r\n    }\r\n    else if (pageId === 'writeMessagePage') {\r\n        Post.addSmileCode($('#msgContent'));\r\n    }\r\n    else if (pageId === 'selfRateRatingPage') {\r\n        Other.showSelfRateErrorSizeSubmitWarning();\r\n    }\r\n    else if (pageId === 'haloPage') {\r\n        $('#buyHaloBtns').on('click', 'a', function () {\r\n            if (!confirm(`是否${$(this).text().trim()}提升一次战力光环？`)) return false;\r\n            localStorage.removeItem('pd_tmp_log_' + Info.uid);\r\n        });\r\n    }\r\n    else if (pageId === 'itemShopPage') {\r\n        Other.handleBuyItemBtns();\r\n        Other.showMyInfoInItemShop();\r\n    }\r\n\r\n    if (Config.blockUserEnabled) Public.blockUsers();\r\n    if (Config.blockThreadEnabled) Public.blockThread();\r\n    if (Config.followUserEnabled) Public.followUsers();\r\n    if (Config.kfSmileEnhanceExtensionEnabled && ['readPage', 'postPage', 'writeMessagePage'].includes(pageId)) {\r\n        $('body').append(\r\n            `<script src=\"${Info.rootPath}${Info.staticPath}js/userScript/KfEmotion.min.user.js?ts=${Info.resTimestamp}\"></script>`\r\n        );\r\n    }\r\n    if(Config.adminMemberEnabled) {\r\n        $('a[data-not-click=\"true\"]').removeClass('not-click-link');\r\n    }\r\n\r\n    if (Config.customScriptEnabled) {\r\n        Script.runCustomScript('end');\r\n    }\r\n    $('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n    console.log(`脚本加载完毕，耗时：${new Date() - startTime}ms`);\r\n};\r\n\r\n$(document).ready(init);\r\n","/* 配置模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\n\r\n// 配置名称\r\nconst name = 'kf_config';\r\n\r\n/**\r\n * 配置类\r\n */\r\nexport const Config = {\r\n    // 当前激活的最新回复面板\r\n    activeNewReplyPanel: '#galgameNewReplyPanel',\r\n    // 当前激活的当前推荐面板\r\n    activeTopRecommendPanel: '#galgameTopRecommendPanel',\r\n    // 常用版块列表\r\n    commonForumList: [],\r\n\r\n    // 是否显示侧边栏按钮组，true：开启；false：关闭\r\n    showSidebarBtnGroupEnabled: true,\r\n    // 是否显示侧边栏的滚动到页顶/页底按钮，true：开启；false：关闭\r\n    showSidebarRollBtnEnabled: true,\r\n    // 是否显示侧边栏的主菜单按钮，true：开启；false：关闭\r\n    showSidebarMainMenuBtnEnabled: false,\r\n    // 是否显示侧边栏的版块列表按钮，true：开启；false：关闭\r\n    showSidebarForumListBtnEnabled: true,\r\n    // 是否显示侧边栏的搜索按钮，true：开启；false：关闭\r\n    showSidebarSearchBtnEnabled: false,\r\n    // 是否显示侧边栏的首页按钮，true：开启；false：关闭\r\n    showSidebarHomePageBtnEnabled: true,\r\n\r\n    // 主题每页楼层数量，用于电梯直达等功能，如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目\r\n    perPageFloorNum: 10,\r\n    // 主题内容字体大小，设为0表示使用默认大小，默认值：14px\r\n    threadContentFontSize: 0,\r\n    // 是否在楼层内的用户名旁显示该用户的自定义备注，true：开启；false：关闭\r\n    userMemoEnabled: false,\r\n    // 用户自定义备注列表，格式：{'用户名':'备注'}，例：{'李四':'张三的马甲','王五':'张三的另一个马甲'}\r\n    userMemoList: {},\r\n    // 是否在发帖框上显示绯月表情增强插件，true：开启；false：关闭\r\n    kfSmileEnhanceExtensionEnabled: false,\r\n\r\n    // 默认的消息显示时间（秒），设置为-1表示永久显示\r\n    defShowMsgDuration: -1,\r\n    // 是否为页面添加自定义的CSS内容，true：开启；false：关闭\r\n    customCssEnabled: false,\r\n    // 自定义CSS的内容\r\n    customCssContent: '',\r\n    // 是否执行自定义的脚本，true：开启；false：关闭\r\n    customScriptEnabled: false,\r\n    // 自定义脚本列表\r\n    customScriptList: [],\r\n    // 是否为管理成员，true：开启；false：关闭\r\n    adminMemberEnabled: false,\r\n\r\n    // 是否开启关注用户的功能，true：开启；false：关闭\r\n    followUserEnabled: false,\r\n    // 关注用户列表，格式：[{name:'用户名'}]，例：[{name:'张三'}, {name:'李四'}]\r\n    followUserList: [],\r\n    // 是否高亮所关注用户在首页下的主题链接，true：开启；false：关闭\r\n    highlightFollowUserThreadInHPEnabled: true,\r\n    // 是否高亮所关注用户在主题列表页面下的主题链接，true：开启；false：关闭\r\n    highlightFollowUserThreadLinkEnabled: true,\r\n    // 是否开启屏蔽用户的功能，true：开启；false：关闭\r\n    blockUserEnabled: false,\r\n    // 屏蔽用户的默认屏蔽类型，0：屏蔽主题和回贴；1：仅屏蔽主题；2：仅屏蔽回贴\r\n    blockUserDefaultType: 0,\r\n    // 是否屏蔽被屏蔽用户的@提醒，true：开启；false：关闭\r\n    blockUserAtTipsEnabled: true,\r\n    // 屏蔽用户的版块屏蔽范围，0：所有版块；1：包括指定的版块；2：排除指定的版块\r\n    blockUserForumType: 0,\r\n    // 屏蔽用户的版块ID列表，例：[16, 41, 67, 57, 84, 92, 127, 68, 163, 182, 9]\r\n    blockUserFidList: [],\r\n    // 屏蔽用户列表，格式：[{name:'用户名', type:屏蔽类型}]，例：[{name:'张三', type:0}, {name:'李四', type:1}]\r\n    blockUserList: [],\r\n    // 是否开启屏蔽标题包含指定关键字的主题的功能，true：开启；false：关闭\r\n    blockThreadEnabled: false,\r\n    // 屏蔽主题的默认版块屏蔽范围，0：所有版块；1：包括指定的版块；2：排除指定的版块\r\n    blockThreadDefForumType: 0,\r\n    // 屏蔽主题的默认版块ID列表，例：[16, 41, 67, 57, 84, 92, 127, 68, 163, 182, 9]\r\n    blockThreadDefFidList: [],\r\n    // 屏蔽主题的关键字列表，格式：[{keyWord:'关键字', includeUser:['包括的用户名'], excludeUser:['排除的用户名'], includeFid:[包括指定的版块ID], excludeFid:[排除指定的版块ID]}]\r\n    // 关键字可使用普通字符串或正则表达式（正则表达式请使用'/abc/'的格式），includeUser、excludeUser、includeFid和excludeFid这三项为可选\r\n    // 例：[{keyWord: '标题1'}, {keyWord: '标题2', includeUser:['用户名1', '用户名2'], includeFid: [5, 56]}, {keyWord: '/关键字A.*关键字B/i', excludeFid: [92, 127, 68]}]\r\n    blockThreadList: [],\r\n};\r\n\r\n/**\r\n * 初始化\r\n */\r\nexport const init = function () {\r\n    window.Config = $.extend(true, {}, Config);\r\n    read();\r\n};\r\n\r\n/**\r\n * 读取设置\r\n */\r\nexport const read = function () {\r\n    let options = localStorage[name];\r\n    if (!options) return;\r\n    try {\r\n        options = JSON.parse(options);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!options || $.type(options) !== 'object' || $.isEmptyObject(options)) return;\r\n    options = normalize(options);\r\n    window.Config = $.extend(true, {}, Config, options);\r\n};\r\n\r\n/**\r\n * 写入设置\r\n */\r\nexport const write = function () {\r\n    let options = Util.getDifferenceSetOfObject(Config, window.Config);\r\n    localStorage[name] = JSON.stringify(options);\r\n};\r\n\r\n/**\r\n * 清空设置\r\n */\r\nexport const clear = function () {\r\n    localStorage.removeItem(name);\r\n};\r\n\r\n/**\r\n * 获取经过规范化的Config对象\r\n * @param {{}} options 待处理的Config对象\r\n * @returns {{}} 经过规范化的Config对象\r\n */\r\nexport const normalize = function (options) {\r\n    let settings = {};\r\n    if ($.type(options) !== 'object') return settings;\r\n    for (let [key, value] of Object.entries(options)) {\r\n        if (key in Config && $.type(value) === $.type(Config[key])) {\r\n            settings[key] = value;\r\n        }\r\n    }\r\n    return settings;\r\n};\r\n","/* 设置对话框模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Dialog from './dialog';\r\nimport {\r\n    read as readConfig,\r\n    write as writeConfig,\r\n    clear as clearConfig,\r\n    normalize as normalizeConfig,\r\n    Config as defConfig,\r\n} from './config';\r\nimport * as Script from './script';\r\nimport * as Public from './public';\r\n\r\n/**\r\n * 显示设置对话框\r\n */\r\nexport const show = function () {\r\n    const dialogName = 'configDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<div class=\"btn-group-sm text-right mb-1\">\r\n  <a class=\"btn btn-link text-danger\" data-name=\"clearTmpData\" href=\"#\">清除临时数据</a>\r\n  <a class=\"btn btn-link\" data-name=\"openRunCommandDialog\" href=\"#\">运行命令</a>\r\n</div>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_showSidebarBtnGroupEnabled\" name=\"showSidebarBtnGroupEnabled\" type=\"checkbox\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_showSidebarBtnGroupEnabled\">显示侧边栏按钮组</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"显示侧边栏按钮组，可在下方设置要显示的按钮\">[?]</span>\r\n  </legend>\r\n  \r\n  <div class=\"mb-2 d-sm-inline-block\">\r\n    <div class=\"form-check form-check-inline\">\r\n      <input class=\"form-check-input\" id=\"${dialogName}_showSidebarRollBtnEnabled\" name=\"showSidebarRollBtnEnabled\" type=\"checkbox\">\r\n      <label class=\"form-check-label\" for=\"${dialogName}_showSidebarRollBtnEnabled\">滚动到页顶/页底</label>\r\n    </div>\r\n    <div class=\"form-check form-check-inline\">\r\n      <input class=\"form-check-input\" id=\"${dialogName}_showSidebarMainMenuBtnEnabled\" name=\"showSidebarMainMenuBtnEnabled\" type=\"checkbox\">\r\n      <label class=\"form-check-label\" for=\"${dialogName}_showSidebarMainMenuBtnEnabled\">主菜单</label>\r\n    </div>\r\n  </div>\r\n  \r\n  <div class=\"mb-2 d-sm-inline-block\">\r\n    <div class=\"form-check form-check-inline\">\r\n      <input class=\"form-check-input\" id=\"${dialogName}_showSidebarForumListBtnEnabled\" name=\"showSidebarForumListBtnEnabled\" type=\"checkbox\">\r\n      <label class=\"form-check-label\" for=\"${dialogName}_showSidebarForumListBtnEnabled\">版块列表</label>\r\n    </div>\r\n    <div class=\"form-check form-check-inline\">\r\n      <input class=\"form-check-input\" id=\"${dialogName}_showSidebarSearchBtnEnabled\" name=\"showSidebarSearchBtnEnabled\" type=\"checkbox\">\r\n      <label class=\"form-check-label\" for=\"${dialogName}_showSidebarSearchBtnEnabled\">搜索</label>\r\n    </div>\r\n    <div class=\"form-check form-check-inline\">\r\n      <input class=\"form-check-input\" id=\"${dialogName}_showSidebarHomePageBtnEnabled\" name=\"showSidebarHomePageBtnEnabled\" type=\"checkbox\">\r\n      <label class=\"form-check-label\" for=\"${dialogName}_showSidebarHomePageBtnEnabled\">首页</label>\r\n    </div>\r\n  </div>\r\n</fieldset>\r\n\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>主题页面相关</legend>\r\n  \r\n  <div class=\"form-group mb-2\">\r\n    <label for=\"perPageFloorNum\">主题每页楼层数量</label>\r\n    <select class=\"custom-select custom-select-sm w-auto\" id=\"perPageFloorNum\" name=\"perPageFloorNum\">\r\n      <option value=\"10\">10</option><option value=\"20\">20</option><option value=\"30\">30</option>\r\n    </select>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"主题页面中每页的楼层数量（用于电梯直达等功能），如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目\">[?]</span>\r\n  </div>\r\n  \r\n  <div class=\"input-group mb-2\">\r\n    <div class=\"input-group-prepend\">\r\n      <span class=\"input-group-text\">主题内容字体大小</span>\r\n    </div>\r\n    <input class=\"form-control\" name=\"threadContentFontSize\" data-toggle=\"tooltip\" type=\"number\" min=\"8\" max=\"72\"\r\n           title=\"主题内容字体大小，留空表示使用默认大小，默认值：14px\">\r\n    <div class=\"input-group-append\">\r\n      <span class=\"input-group-text\">px</span>\r\n    </div>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_userMemoEnabled\" name=\"userMemoEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openUserMemoDialog]\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_userMemoEnabled\">显示用户备注</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"在楼层内的用户名旁显示该用户的自定义备注\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openUserMemoDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_kfSmileEnhanceExtensionEnabled\" name=\"kfSmileEnhanceExtensionEnabled\" type=\"checkbox\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_kfSmileEnhanceExtensionEnabled\">开启绯月表情增强插件</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"在发帖框上显示绯月表情增强插件，该插件由eddie32开发\">[?]</span>\r\n  </div>\r\n</fieldset>\r\n\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>其它设置</legend>\r\n  \r\n  <div class=\"input-group mb-2\">\r\n    <div class=\"input-group-prepend\">\r\n      <span class=\"input-group-text\">消息显示时间</span>\r\n    </div>\r\n    <input class=\"form-control\" name=\"defShowMsgDuration\" data-toggle=\"tooltip\" type=\"number\" min=\"-1\" required\r\n           title=\"默认的消息显示时间（秒），设置为-1表示永久显示，例：15\">\r\n    <div class=\"input-group-append\">\r\n      <span class=\"input-group-text\">秒</span>\r\n    </div>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_customCssEnabled\" name=\"customCssEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openCustomCssDialog]\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_customCssEnabled\">添加自定义CSS</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"为页面添加自定义的CSS内容，请点击详细设置填写自定义的CSS内容\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openCustomCssDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_customScriptEnabled\" name=\"customScriptEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openCustomScriptDialog]\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_customScriptEnabled\">执行自定义脚本</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"执行自定义的javascript脚本，请点击详细设置填入自定义脚本内容\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openCustomScriptDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_adminMemberEnabled\" name=\"adminMemberEnabled\" type=\"checkbox\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_adminMemberEnabled\">我是管理成员</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"管理成员可开启此功能，助手会开启部分只有管理成员才能使用的功能，非管理成员开启此功能无效\">[?]</span>\r\n  </div>\r\n</fieldset>\r\n\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>关注和屏蔽</legend>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_followUserEnabled\" name=\"followUserEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openFollowUserDialog]\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_followUserEnabled\">关注用户</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openFollowUserDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_blockUserEnabled\" name=\"blockUserEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openBlockUserDialog]\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_blockUserEnabled\">屏蔽用户</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openBlockUserDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n  \r\n  <div class=\"form-check\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_blockThreadEnabled\" name=\"blockThreadEnabled\" type=\"checkbox\" data-disabled=\"[data-name=openBlockThreadDialog]\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_blockThreadEnabled\">屏蔽主题</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"开启屏蔽标题中包含指定关键字的主题的功能，请点击详细设置管理屏蔽关键字\">[?]</span>\r\n    <a class=\"ml-3\" data-name=\"openBlockThreadDialog\" href=\"#\" role=\"button\">详细设置&raquo;</a>\r\n  </div>\r\n</fieldset>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImportOrExportSettingDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>\r\n<button class=\"btn btn-danger\" name=\"reset\" type=\"button\">重置</button>`;\r\n    let $dialog = Dialog.create(dialogName, '助手设置', bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        readConfig();\r\n        let options = getMainConfigValue($dialog);\r\n        options = normalizeConfig(options);\r\n        $.extend(Config, options);\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).on('click', 'a[data-name^=\"open\"][href=\"#\"]', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.hasClass('disabled-link')) return;\r\n        let name = $this.data('name');\r\n        if (name === 'openRunCommandDialog') showRunCommandDialog();\r\n        else if (name === 'openUserMemoDialog') showUserMemoDialog();\r\n        else if (name === 'openCustomCssDialog') showCustomCssDialog();\r\n        else if (name === 'openCustomScriptDialog') Script.showDialog();\r\n        else if (name === 'openFollowUserDialog') showFollowUserDialog();\r\n        else if (name === 'openBlockUserDialog') showBlockUserDialog();\r\n        else if (name === 'openBlockThreadDialog') showBlockThreadDialog();\r\n    }).find('[data-name=\"clearTmpData\"]').click(function (e) {\r\n        e.preventDefault();\r\n        let type = prompt(\r\n            '可清除与助手有关的Cookies和本地临时数据（不包括助手设置和日志）\\n请填写清除类型，0：全部清除；1：清除Cookies；2：清除本地临时数据', 0\r\n        );\r\n        if (type === null) return;\r\n        type = parseInt(type);\r\n        if (!isNaN(type) && type >= 0) {\r\n            clearTmpData(type);\r\n            alert('缓存已清除');\r\n        }\r\n    }).end().find('[name=\"reset\"]').click(function () {\r\n        if (confirm('是否重置所有设置？')) {\r\n            clearConfig();\r\n            alert('设置已重置');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        }\r\n    }).end().find('[name=\"openImportOrExportSettingDialog\"]').click(showImportOrExportSettingDialog);\r\n\r\n    setMainConfigValue($dialog);\r\n    Dialog.show(dialogName);\r\n};\r\n\r\n/**\r\n * 设置主对话框中的字段值\r\n * @param {jQuery} $dialog 助手设置对话框对象\r\n */\r\nconst setMainConfigValue = function ($dialog) {\r\n    $dialog.find('input[name], select[name]').each(function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        if (name in Config) {\r\n            if ($this.is('[type=\"checkbox\"]') && typeof Config[name] === 'boolean') $this.prop('checked', Config[name] === true);\r\n            else $this.val(Config[name]);\r\n        }\r\n    });\r\n    $dialog.find('[name=\"threadContentFontSize\"]').val(Config.threadContentFontSize > 0 ? Config.threadContentFontSize : '');\r\n};\r\n\r\n/**\r\n * 获取主对话框中字段值的Config对象\r\n * @param {jQuery} $dialog 助手设置对话框对象\r\n * @returns {{}} 字段值的Config对象\r\n */\r\nconst getMainConfigValue = function ($dialog) {\r\n    let options = {};\r\n    $dialog.find('input[name], select[name]').each(function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        if (name in Config) {\r\n            if ($this.is('[type=\"checkbox\"]') && typeof Config[name] === 'boolean')\r\n                options[name] = Boolean($this.prop('checked'));\r\n            else if (typeof Config[name] === 'number') {\r\n                options[name] = parseInt($this.val());\r\n                if (name === 'threadContentFontSize' && isNaN(options[name])) options[name] = 0;\r\n            }\r\n            else options[name] = $.trim($this.val());\r\n        }\r\n    });\r\n    return options;\r\n};\r\n\r\n/**\r\n * 清除临时数据\r\n * @param {number} type 清除类别，0：全部清除；1：清除Cookies；2：清除本地临时数据\r\n */\r\nconst clearTmpData = function (type = 0) {\r\n    if (type === 0 || type === 1) {\r\n        for (let key in Const) {\r\n            if (/CookieName$/.test(key)) {\r\n                Util.deleteCookie(Const[key]);\r\n            }\r\n        }\r\n    }\r\n    if (type === 0 || type === 2) {\r\n        //TmpLog.clear();\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n    }\r\n};\r\n\r\n/**\r\n * 显示运行命令对话框\r\n */\r\nconst showRunCommandDialog = function () {\r\n    const dialogName = 'runCommandDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  运行命令快捷键：<kbd>Ctrl+Enter</kbd>；清除命令快捷键：<kbd>Ctrl+退格键</kbd>\r\n</p>\r\n<div class=\"form-group\">\r\n  <label for=\"cfgCmd\">命令内容：</label>\r\n  <textarea class=\"form-control\" name=\"cmd\" id=\"cfgCmd\" rows=\"6\" wrap=\"off\" aria-label=\"命令内容\" style=\"white-space: pre;\"></textarea>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label for=\"cfgResult\">运行结果：</label>\r\n  <textarea class=\"form-control font-size-sm\" name=\"result\" id=\"cfgResult\" rows=\"6\" wrap=\"off\" aria-label=\"运行结果\" style=\"white-space: pre;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">运行</button>\r\n<button class=\"btn btn-danger\" name=\"clear\" type=\"button\">清除</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">关闭</button>`;\r\n    let $dialog = Dialog.create(dialogName, '运行命令', bodyContent, footerContent);\r\n    let $cmd = $dialog.find('[name=\"cmd\"]');\r\n    let $result = $dialog.find('[name=\"result\"]');\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        let content = $cmd.val();\r\n        if (!$.trim(content)) return;\r\n        let {response} = Script.runCmd(content, true);\r\n        $result.val(response);\r\n    }).end().find('[name=\"clear\"]').click(function () {\r\n        $cmd.val('').focus();\r\n    });\r\n\r\n    $cmd.keydown(function (e) {\r\n        if (e.ctrlKey && e.keyCode === 13) {\r\n            $dialog.submit();\r\n        }\r\n        else if (e.ctrlKey && e.keyCode === 8) {\r\n            $dialog.find('[name=\"clear\"]').click();\r\n        }\r\n    });\r\n\r\n    Dialog.show(dialogName);\r\n    $cmd.focus();\r\n};\r\n\r\n/**\r\n * 显示导入或导出设置对话框\r\n */\r\nconst showImportOrExportSettingDialog = function () {\r\n    const dialogName = 'imOrExSettingDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\r\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可<br>\r\n  <span class=\"text-danger\">注：本设置与电脑版的KFOL助手并不完全通用</span>\r\n</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control font-size-sm font-monospace\" name=\"setting\" rows=\"10\" aria-label=\"设置内容\" style=\"word-break: break-all;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '导入或导出设置', bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否导入文本框中的设置？')) return;\r\n        let options = $.trim($dialog.find('[name=\"setting\"]').val());\r\n        if (!options) return;\r\n        try {\r\n            options = JSON.parse(options);\r\n        }\r\n        catch (ex) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        if (!options || $.type(options) !== 'object') {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        options = normalizeConfig(options);\r\n        window.Config = $.extend(true, {}, defConfig, options);\r\n        writeConfig();\r\n        alert('设置已导入');\r\n        location.reload();\r\n    });\r\n    Dialog.show(dialogName);\r\n    $dialog.find('[name=\"setting\"]').val(JSON.stringify(Util.getDifferenceSetOfObject(defConfig, Config))).select().focus();\r\n};\r\n\r\n/**\r\n * 显示用户备注对话框\r\n */\r\nconst showUserMemoDialog = function () {\r\n    const dialogName = 'userMemoDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">按照<code>用户名:备注</code>的格式（注意是英文冒号），每行一个</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control\" name=\"userMemoList\" rows=\"13\" wrap=\"off\" aria-label=\"用户备注\" style=\"white-space: pre;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '用户备注', bodyContent, footerContent);\r\n    let $userMemoList = $dialog.find('[name=\"userMemoList\"]');\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        let content = $.trim($userMemoList.val());\r\n        Config.userMemoList = {};\r\n        for (let line of content.split('\\n')) {\r\n            line = $.trim(line);\r\n            if (!line) continue;\r\n            if (!/.+?:.+/.test(line)) {\r\n                alert('格式不正确');\r\n                $userMemoList.focus();\r\n                return;\r\n            }\r\n            let [user, memo = ''] = line.split(':');\r\n            if (!memo) continue;\r\n            Config.userMemoList[user.trim()] = memo.trim();\r\n        }\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    });\r\n\r\n    let content = '';\r\n    for (let [user, memo] of Object.entries(Config.userMemoList)) {\r\n        content += `${user}:${memo}\\n`;\r\n    }\r\n    Dialog.show(dialogName);\r\n    $userMemoList.val(content).focus();\r\n};\r\n\r\n/**\r\n * 显示自定义CSS对话框\r\n */\r\nconst showCustomCssDialog = function () {\r\n    const dialogName = 'customCssDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control font-size-sm font-monospace\" name=\"customCssContent\" rows=\"15\" wrap=\"off\" aria-label=\"自定义CSS内容\" style=\"white-space: pre;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '自定义CSS', bodyContent, footerContent);\r\n    let $content = $dialog.find('[name=\"customCssContent\"]');\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.customCssContent = $.trim($content.val());\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n        alert('自定义CSS修改成功（需刷新页面后才可生效）');\r\n    });\r\n    Dialog.show(dialogName);\r\n    $content.val(Config.customCssContent).focus();\r\n};\r\n\r\n/**\r\n * 显示关注用户对话框\r\n */\r\nconst showFollowUserDialog = function () {\r\n    const dialogName = 'followUserDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<div class=\"form-check\">\r\n  <input class=\"form-check-input\" id=\"${dialogName}_highlightFollowUserThreadInHpEnabled\" name=\"highlightFollowUserThreadInHpEnabled\" type=\"checkbox\">\r\n  <label class=\"form-check-label\" for=\"${dialogName}_highlightFollowUserThreadInHpEnabled\">高亮所关注用户的首页主题链接</label>\r\n  <span class=\"tips\" data-toggle=\"tooltip\" title=\"高亮所关注用户在首页下的主题链接\">[?]</span>\r\n</div>\r\n<div class=\"form-check mb-3\">\r\n  <input class=\"form-check-input\" id=\"${dialogName}_highlightFollowUserThreadLinkEnabled\" name=\"highlightFollowUserThreadLinkEnabled\" type=\"checkbox\">\r\n  <label class=\"form-check-label\" for=\"${dialogName}_highlightFollowUserThreadLinkEnabled\">高亮所关注用户的主题链接</label>\r\n  <span class=\"tips\" data-toggle=\"tooltip\" title=\"高亮所关注用户在版块页面下的主题链接\">[?]</span>\r\n</div>\r\n<ul class=\"list-unstyled\" id=\"followUserList\"></ul>\r\n<div class=\"btn-group btn-group-sm mb-3\" role=\"group\">\r\n  <button class=\"btn btn-secondary\" name=\"selectAll\" type=\"button\">全选</button>\r\n  <button class=\"btn btn-secondary\" name=\"selectInverse\" type=\"button\">反选</button>\r\n  <button class=\"btn btn-danger\" name=\"deleteSelect\" type=\"button\">删除</button>\r\n</div>\r\n<div class=\"input-group mb-3\">\r\n  <input class=\"form-control\" name=\"addUser\" data-toggle=\"tooltip\" type=\"text\" title=\"添加多个用户请用英文逗号分隔\" aria-label=\"添加关注用户\">\r\n  <div class=\"input-group-append\">\r\n    <button class=\"btn btn-success\" name=\"add\" type=\"button\">添加</button>\r\n  </div>\r\n</div>\r\n`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExFollowUserListDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '关注用户', bodyContent, footerContent);\r\n    let $followUserList = $dialog.find('#followUserList');\r\n\r\n    /**\r\n     * 添加关注用户\r\n     * @param {string} name 用户名\r\n     */\r\n    const addFollowUser = function (name) {\r\n        $(`\r\n<li class=\"input-group input-group-sm mb-2\">\r\n  <div class=\"input-group-prepend\">\r\n    <div class=\"input-group-text\">\r\n      <input type=\"checkbox\" aria-label=\"选择用户\">\r\n    </div>\r\n  </div>\r\n  <input class=\"form-control\" name=\"userName\" type=\"text\" value=\"${name}\" maxlength=\"12\" aria-label=\"编辑关注用户\">\r\n  <div class=\"input-group-append\">\r\n    <button class=\"btn btn-danger\" name=\"delete\" type=\"button\" aria-label=\"删除关注用户\">\r\n      <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\r\n    </button>\r\n  </div>\r\n</li>\r\n`).appendTo($followUserList);\r\n    };\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.highlightFollowUserThreadInHPEnabled = $dialog.find('[name=\"highlightFollowUserThreadInHpEnabled\"]').prop('checked');\r\n        Config.highlightFollowUserThreadLinkEnabled = $dialog.find('[name=\"highlightFollowUserThreadLinkEnabled\"]').prop('checked');\r\n        Config.followUserList = [];\r\n        $followUserList.find('li').each(function () {\r\n            let $this = $(this);\r\n            let name = $.trim($this.find('[name=\"userName\"]').val());\r\n            if (name !== '' && Util.inFollowOrBlockUserList(name, Config.followUserList) === -1) {\r\n                Config.followUserList.push({name});\r\n            }\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).find('[name=\"deleteSelect\"]').click(function () {\r\n        let $checked = $followUserList.find('li:has([type=\"checkbox\"]:checked)');\r\n        if (!$checked.length) return;\r\n        if (confirm('是否删除所选用户？')) $checked.remove();\r\n    }).end().find('[name=\"addUser\"]').keydown(function (e) {\r\n        if (e.keyCode === 13) {\r\n            e.preventDefault();\r\n            $(this).next().find('button').click();\r\n        }\r\n    }).end().find('[name=\"add\"]').click(function () {\r\n        let $addUser = $dialog.find('[name=\"addUser\"]');\r\n        for (let name of $.trim($addUser.val()).split(',')) {\r\n            name = $.trim(name);\r\n            if (!name) continue;\r\n            if (Util.inFollowOrBlockUserList(name, Config.followUserList) === -1) addFollowUser(name);\r\n        }\r\n        $addUser.val('');\r\n        $followUserList.find('li:last-child [type=\"checkbox\"]').focus();\r\n    }).end().find('[name=\"openImOrExFollowUserListDialog\"]').click(function () {\r\n        Public.showCommonImportOrExportConfigDialog('关注用户', 'followUserList');\r\n    }).end().find('[name=\"selectAll\"]').click(() => Util.selectAll($followUserList.find('[type=\"checkbox\"]')))\r\n        .end().find('[name=\"selectInverse\"]').click(() => Util.selectInverse($followUserList.find('[type=\"checkbox\"]')));\r\n\r\n    $followUserList.on('click', '[name=\"delete\"]', function () {\r\n        $(this).closest('li').remove();\r\n    });\r\n\r\n    $dialog.find('[name=\"highlightFollowUserThreadInHpEnabled\"]').prop('checked', Config.highlightFollowUserThreadInHPEnabled);\r\n    $dialog.find('[name=\"highlightFollowUserThreadLinkEnabled\"]').prop('checked', Config.highlightFollowUserThreadLinkEnabled);\r\n    for (let user of Config.followUserList) {\r\n        addFollowUser(user.name);\r\n    }\r\n    Dialog.show(dialogName);\r\n};\r\n\r\n/**\r\n * 显示屏蔽用户对话框\r\n */\r\nconst showBlockUserDialog = function () {\r\n    const dialogName = 'blockUserDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<div class=\"form-group mb-2\">\r\n  <label for=\"blockUserDefaultType\">默认屏蔽类型</label>\r\n  <select class=\"custom-select custom-select-sm w-auto\" id=\"blockUserDefaultType\" name=\"blockUserDefaultType\">\r\n    <option value=\"0\">主题和回帖</option><option value=\"1\">主题</option><option value=\"2\">回帖</option>\r\n  </select>\r\n  <div class=\"form-check form-check-inline ml-3\">\r\n    <input class=\"form-check-input\" id=\"${dialogName}_blockUserAtTipsEnabled\" name=\"blockUserAtTipsEnabled\" type=\"checkbox\">\r\n    <label class=\"form-check-label\" for=\"${dialogName}_blockUserAtTipsEnabled\">屏蔽@提醒</label>\r\n    <span class=\"tips\" data-toggle=\"tooltip\" title=\"屏蔽被屏蔽用户的@提醒\">[?]</span>\r\n  </div>\r\n</div>\r\n<div class=\"form-group mb-2\">\r\n  <label for=\"blockUserForumType\">版块屏蔽范围</label>\r\n  <select class=\"custom-select custom-select-sm w-auto\" id=\"blockUserForumType\" name=\"blockUserForumType\">\r\n    <option value=\"0\">所有版块</option><option value=\"1\">包括指定版块</option><option value=\"2\">排除指定版块</option>\r\n  </select>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>版块ID列表</label>\r\n  <span class=\"tips\" data-toggle=\"tooltip\" title=\"版块URL中的fid参数，多个ID请用英文逗号分隔\">[?]</span>\r\n  <input class=\"form-control form-control-sm\" name=\"blockUserFidList\" type=\"text\">\r\n</div>\r\n<ul class=\"list-unstyled\" id=\"blockUserList\"></ul>\r\n<div class=\"btn-group btn-group-sm mb-3\" role=\"group\">\r\n  <button class=\"btn btn-secondary\" name=\"selectAll\" type=\"button\">全选</button>\r\n  <button class=\"btn btn-secondary\" name=\"selectInverse\" type=\"button\">反选</button>\r\n  <div class=\"btn-group btn-group-sm dropup\">\r\n    <button class=\"btn btn-info dropdown-toggle\" data-toggle=\"dropdown\" type=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\">\r\n      修改为\r\n    </button>\r\n    <div class=\"dropdown-menu\" data-name=\"modifyMenu\">\r\n      <a class=\"dropdown-item\" data-value=\"0\" href=\"#\">主题和回帖</a>\r\n      <a class=\"dropdown-item\" data-value=\"1\" href=\"#\">主题</a>\r\n      <a class=\"dropdown-item\" data-value=\"2\" href=\"#\">回帖</a>\r\n    </div>\r\n  </div>\r\n  <button class=\"btn btn-danger\" name=\"deleteSelect\" type=\"button\">删除</button>\r\n</div>\r\n<div class=\"input-group mb-3\">\r\n  <input class=\"form-control\" name=\"addUser\" data-toggle=\"tooltip\" type=\"text\" title=\"添加多个用户请用英文逗号分隔\" aria-label=\"添加屏蔽用户\">\r\n  <div class=\"input-group-append\">\r\n    <button class=\"btn btn-success\" name=\"add\" type=\"button\">添加</button>\r\n  </div>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExBlockUserListDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '屏蔽用户', bodyContent, footerContent);\r\n    let $blockUserList = $dialog.find('#blockUserList');\r\n\r\n    /**\r\n     * 添加屏蔽用户\r\n     * @param {string} name 用户名\r\n     * @param {number} type 屏蔽类型\r\n     */\r\n    const addBlockUser = function (name, type) {\r\n        $(`\r\n<li class=\"form-group row no-gutters mb-2\">\r\n  <div class=\"col-7 input-group input-group-sm\">\r\n    <div class=\"input-group-prepend\">\r\n      <div class=\"input-group-text\">\r\n        <input type=\"checkbox\" aria-label=\"选择用户\">\r\n      </div>\r\n    </div>\r\n    <input class=\"form-control\" name=\"userName\" type=\"text\" value=\"${name}\" maxlength=\"12\" aria-label=\"编辑屏蔽用户\">\r\n  </div>\r\n  <div class=\"col-5 input-group input-group-sm\">\r\n    <select class=\"form-control\" name=\"blockType\">\r\n      <option value=\"0\">主题和回帖</option><option value=\"1\">主题</option><option value=\"2\">回帖</option>\r\n    </select>\r\n    <div class=\"input-group-append\">\r\n      <button class=\"btn btn-danger\" name=\"delete\" type=\"button\" aria-label=\"删除屏蔽用户\">\r\n        <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</li>\r\n`).appendTo($blockUserList).find('[name=\"blockType\"]').val(type);\r\n    };\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.blockUserDefaultType = parseInt($dialog.find('[name=\"blockUserDefaultType\"]').val());\r\n        Config.blockUserAtTipsEnabled = $dialog.find('[name=\"blockUserAtTipsEnabled\"]').prop('checked');\r\n        Config.blockUserForumType = parseInt($dialog.find('[name=\"blockUserForumType\"]').val());\r\n        let blockUserFidList = new Set();\r\n        for (let fid of $.trim($dialog.find('[name=\"blockUserFidList\"]').val()).split(',')) {\r\n            fid = parseInt(fid);\r\n            if (!isNaN(fid) && fid > 0) blockUserFidList.add(fid);\r\n        }\r\n        Config.blockUserFidList = [...blockUserFidList];\r\n        Config.blockUserList = [];\r\n        $blockUserList.find('li').each(function () {\r\n            let $this = $(this);\r\n            let name = $.trim($this.find('[name=\"userName\"]').val());\r\n            if (name && Util.inFollowOrBlockUserList(name, Config.blockUserList) === -1) {\r\n                let type = parseInt($this.find('[name=\"blockType\"]').val());\r\n                Config.blockUserList.push({name, type});\r\n            }\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).find('[data-name=\"modifyMenu\"]').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let value = parseInt($(this).data('value'));\r\n        $blockUserList.find('li:has([type=\"checkbox\"]:checked) select').val(value);\r\n    }).end().find('[name=\"deleteSelect\"]').click(function () {\r\n        let $checked = $blockUserList.find('li:has([type=\"checkbox\"]:checked)');\r\n        if (!$checked.length) return;\r\n        if (confirm('是否删除所选用户？')) $checked.remove();\r\n    }).end().find('[name=\"addUser\"]').keydown(function (e) {\r\n        if (e.keyCode === 13) {\r\n            e.preventDefault();\r\n            $(this).next().find('button').click();\r\n        }\r\n    }).end().find('[name=\"add\"]').click(function () {\r\n        let $addUser = $dialog.find('[name=\"addUser\"]');\r\n        let type = parseInt($dialog.find('[name=\"blockUserDefaultType\"]').val());\r\n        for (let name of $.trim($addUser.val()).split(',')) {\r\n            name = $.trim(name);\r\n            if (!name) continue;\r\n            if (Util.inFollowOrBlockUserList(name, Config.blockUserList) === -1) addBlockUser(name, type);\r\n        }\r\n        $addUser.val('');\r\n        $blockUserList.find('li:last-child [type=\"checkbox\"]').focus();\r\n    }).end().find('[name=\"blockUserForumType\"]').change(function () {\r\n        $dialog.find('[name=\"blockUserFidList\"]').prop('disabled', parseInt($(this).val()) === 0);\r\n    }).end().find('[name=\"openImOrExBlockUserListDialog\"]').click(function () {\r\n        Public.showCommonImportOrExportConfigDialog('屏蔽用户', 'blockUserList');\r\n    }).end().find('[name=\"selectAll\"]').click(() => Util.selectAll($blockUserList.find('[type=\"checkbox\"]')))\r\n        .end().find('[name=\"selectInverse\"]').click(() => Util.selectInverse($blockUserList.find('[type=\"checkbox\"]')));\r\n\r\n    $blockUserList.on('click', '[name=\"delete\"]', function () {\r\n        $(this).closest('li').remove();\r\n    });\r\n\r\n    $dialog.find('[name=\"blockUserDefaultType\"]').val(Config.blockUserDefaultType);\r\n    $dialog.find('[name=\"blockUserAtTipsEnabled\"]').prop('checked', Config.blockUserAtTipsEnabled);\r\n    $dialog.find('[name=\"blockUserForumType\"]').val(Config.blockUserForumType).triggerHandler('change');\r\n    $dialog.find('[name=\"blockUserFidList\"]').val(Config.blockUserFidList.join(','));\r\n    for (let user of Config.blockUserList) {\r\n        addBlockUser(user.name, user.type);\r\n    }\r\n    Dialog.show(dialogName);\r\n};\r\n\r\n/**\r\n * 显示屏蔽主题对话框\r\n */\r\nconst showBlockThreadDialog = function () {\r\n    const dialogName = 'blockThreadDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\r\n  用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\r\n</p>\r\n<div class=\"form-group mb-2\">\r\n  <label for=\"blockThreadDefForumType\">默认版块屏蔽范围</label>\r\n  <select class=\"custom-select custom-select-sm w-auto\" id=\"blockThreadDefForumType\" name=\"blockThreadDefForumType\">\r\n    <option value=\"0\">所有版块</option><option value=\"1\">包括指定版块</option><option value=\"2\">排除指定版块</option>\r\n  </select>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label for=\"blockThreadDefFidList\">默认版块ID列表</label>\r\n  <input class=\"form-control form-control-sm\" id=\"blockThreadDefFidList\" name=\"blockThreadDefFidList\" type=\"text\">\r\n</div>\r\n<div class=\"table-responsive\">\r\n  <table class=\"table table-sm table-hover table-center text-nowrap\">\r\n    <thead>\r\n      <tr>\r\n        <th>标题关键字(必填)</th>\r\n        <th>屏蔽用户</th>\r\n        <th>用户名</th>\r\n        <th>屏蔽范围</th>\r\n        <th>版块ID</th>\r\n        <th></th>\r\n      </tr>\r\n    </thead>\r\n    <tbody id=\"blockThreadList\"></tbody>\r\n  </table>\r\n</div>\r\n<div class=\"btn-group btn-group-sm mb-3\" role=\"group\">\r\n  <button class=\"btn btn-success\" name=\"add\" type=\"button\">增加</button>\r\n  <button class=\"btn btn-danger\" name=\"clear\" type=\"button\">清空</button>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExBlockThreadListDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, '屏蔽主题', bodyContent, footerContent);\r\n    let $blockThreadList = $dialog.find('#blockThreadList');\r\n\r\n    /**\r\n     * 添加屏蔽主题\r\n     * @param {string} keyWord 标题关键字\r\n     * @param {number} userType 屏蔽用户，0：所有；1：包括；2：排除\r\n     * @param {string[]} userList 用户名\r\n     * @param {number} fidType 屏蔽范围，0：所有；1：包括；2：排除\r\n     * @param {number[]} fidList 版块ID列表\r\n     */\r\n    const addBlockThread = function (keyWord, userType, userList, fidType, fidList) {\r\n        $(`\r\n<tr>\r\n  <td>\r\n    <input class=\"form-control form-control-sm\" name=\"keyWord\" type=\"text\" value=\"${keyWord}\" aria-label=\"标题关键字\" style=\"min-width: 12rem;\">\r\n  </td>\r\n  <td>\r\n    <select class=\"form-control form-control-sm\" name=\"userType\" aria-label=\"屏蔽用户类型\" style=\"min-width: 4.5rem;\">\r\n      <option value=\"0\">所有</option><option value=\"1\">包括</option><option value=\"2\">排除</option>\r\n    </select>\r\n  </td>\r\n  <td>\r\n    <input class=\"form-control form-control-sm\" name=\"userList\" type=\"text\" value=\"${userList.join(',')}\" aria-label=\"用户名\"\r\n           ${userType === 0 ? 'disabled' : ''} style=\"min-width: 12rem;\">\r\n  </td>\r\n  <td>\r\n    <select class=\"form-control form-control-sm\" name=\"fidType\" aria-label=\"屏蔽范围\" style=\"min-width: 4.5rem;\">\r\n      <option value=\"0\">所有</option><option value=\"1\">包括</option><option value=\"2\">排除</option>\r\n    </select>\r\n  </td>\r\n  <td>\r\n    <input class=\"form-control form-control-sm\" name=\"fidList\" type=\"text\" value=\"${fidList.join(',')}\" aria-label=\"版块ID列表\"\r\n           ${fidType === 0 ? 'disabled' : ''} style=\"min-width: 9rem;\">\r\n  </td>\r\n  <td class=\"text-left\">\r\n    <button class=\"btn btn-danger btn-sm\" name=\"delete\" type=\"button\" aria-label=\"删除\">\r\n      <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\r\n    </button>\r\n  </td>\r\n</tr>\r\n`).appendTo($blockThreadList).find('[name=\"userType\"]').val(userType)\r\n            .end().find('[name=\"fidType\"]').val(fidType);\r\n    };\r\n\r\n    /**\r\n     * 验证设置是否正确\r\n     * @returns {boolean} 是否验证通过\r\n     */\r\n    const verify = function () {\r\n        let flag = true;\r\n        $blockThreadList.find('tr').each(function () {\r\n            let $this = $(this);\r\n            let $txtKeyWord = $this.find('[name=\"keyWord\"]');\r\n            let keyWord = $txtKeyWord.val();\r\n            if (!$.trim(keyWord)) return;\r\n            if (/^\\/.+\\/[gimuy]*$/.test(keyWord)) {\r\n                try {\r\n                    eval(keyWord);\r\n                }\r\n                catch (ex) {\r\n                    alert('正则表达式不正确');\r\n                    $txtKeyWord.select().focus();\r\n                    flag = false;\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n        return flag;\r\n    };\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!verify()) return;\r\n        Config.blockThreadDefForumType = parseInt($dialog.find('[name=\"blockThreadDefForumType\"]').val());\r\n        let blockThreadDefFidList = new Set();\r\n        for (let fid of $.trim($dialog.find('[name=\"blockThreadDefFidList\"]').val()).split(',')) {\r\n            fid = parseInt(fid);\r\n            if (!isNaN(fid) && fid > 0) blockThreadDefFidList.add(fid);\r\n        }\r\n        Config.blockThreadDefFidList = [...blockThreadDefFidList];\r\n        Config.blockThreadList = [];\r\n        $blockThreadList.find('tr').each(function () {\r\n            let $this = $(this);\r\n            let keyWord = $this.find('[name=\"keyWord\"]').val();\r\n            if (!$.trim(keyWord)) return;\r\n            let newObj = {keyWord};\r\n\r\n            let userType = parseInt($this.find('[name=\"userType\"]').val());\r\n            if (userType > 0) {\r\n                let userList = new Set();\r\n                for (let user of $.trim($this.find('[name=\"userList\"]').val()).split(',')) {\r\n                    user = $.trim(user);\r\n                    if (user) userList.add(user);\r\n                }\r\n                if (userList.size > 0) newObj[userType === 2 ? 'excludeUser' : 'includeUser'] = [...userList];\r\n            }\r\n\r\n            let fidType = parseInt($this.find('[name=\"fidType\"]').val());\r\n            if (fidType > 0) {\r\n                let fidList = new Set();\r\n                for (let fid of $.trim($this.find('[name=\"fidList\"]').val()).split(',')) {\r\n                    fid = parseInt(fid);\r\n                    if (!isNaN(fid) && fid > 0) fidList.add(fid);\r\n                }\r\n                if (fidList.size > 0) newObj[fidType === 2 ? 'excludeFid' : 'includeFid'] = [...fidList];\r\n            }\r\n            Config.blockThreadList.push(newObj);\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n    }).find('[name=\"clear\"]').click(function () {\r\n        if (confirm('是否清除所有屏蔽关键字？')) $blockThreadList.html('');\r\n    }).end().find('[name=\"add\"]').click(function () {\r\n        addBlockThread(\r\n            '', 0, [],\r\n            parseInt($dialog.find('[name=\"blockThreadDefForumType\"]').val()),\r\n            $.trim($dialog.find('[name=\"blockThreadDefFidList\"]').val()).split(',')\r\n        );\r\n    }).end().find('[name=\"blockThreadDefForumType\"]').change(function () {\r\n        $dialog.find('[name=\"blockThreadDefFidList\"]').prop('disabled', parseInt($(this).val()) === 0);\r\n    }).end().find('[name=\"openImOrExBlockThreadListDialog\"]').click(function () {\r\n        Public.showCommonImportOrExportConfigDialog('屏蔽主题', 'blockThreadList');\r\n    }).end().find('[name=\"selectAll\"]').click(() => Util.selectAll($blockThreadList.find('[type=\"checkbox\"]')))\r\n        .end().find('[name=\"selectInverse\"]').click(() => Util.selectInverse($blockThreadList.find('[type=\"checkbox\"]')));\r\n\r\n    $blockThreadList.on('change', 'select', function () {\r\n        let $this = $(this);\r\n        $this.closest('td').next('td').find('input').prop('disabled', parseInt($this.val()) === 0);\r\n    }).on('click', '[name=\"delete\"]', function () {\r\n        $(this).closest('tr').remove();\r\n    });\r\n\r\n    $dialog.find('[name=\"blockThreadDefForumType\"]').val(Config.blockThreadDefForumType).triggerHandler('change');\r\n    $dialog.find('[name=\"blockThreadDefFidList\"]').val(Config.blockThreadDefFidList.join(','));\r\n    for (let data of Config.blockThreadList) {\r\n        let {keyWord, includeUser, excludeUser, includeFid, excludeFid} = data;\r\n        let userType = 0;\r\n        let userList = [];\r\n        if (typeof includeUser !== 'undefined') {\r\n            userType = 1;\r\n            userList = includeUser;\r\n        }\r\n        else if (typeof excludeUser !== 'undefined') {\r\n            userType = 2;\r\n            userList = excludeUser;\r\n        }\r\n\r\n        let fidType = 0;\r\n        let fidList = [];\r\n        if (typeof includeFid !== 'undefined') {\r\n            fidType = 1;\r\n            fidList = includeFid;\r\n        }\r\n        else if (typeof excludeFid !== 'undefined') {\r\n            fidType = 2;\r\n            fidList = excludeFid;\r\n        }\r\n        addBlockThread(keyWord, userType, userList, fidType, fidList);\r\n    }\r\n    Dialog.show(dialogName);\r\n};\r\n","/* 常量模块 */\r\n'use strict';\r\n\r\n// 通用存储数据名称前缀\r\nconst storagePrefix = 'kf_';\r\n\r\n/**\r\n * 常量类\r\n */\r\nconst Const = {\r\n    // at提醒时间的Cookie有效期（天）\r\n    atTipsTimeExpires: 3,\r\n    // 页面背景样式的Cookie有效期（天）\r\n    bgStyleExpires: 365,\r\n\r\n    // 通用存储数据名称前缀\r\n    storagePrefix: storagePrefix,\r\n    // 存储多重引用数据的LocalStorage名称\r\n    multiQuoteStorageName: storagePrefix + 'multiQuote',\r\n    // at提醒时间的Cookie名称\r\n    atTipsTimeCookieName: 'atTipsTime',\r\n    // 上一次at提醒时间的Cookie名称\r\n    prevAtTipsTimeCookieName: 'prevAtTipsTime',\r\n    // 页面背景样式的Cookie名称\r\n    bgStyleCookieName: 'bgStyle',\r\n\r\n    // 常用版块列表\r\n    commonForumList: [\r\n        {fid: 106, name: '新作动态'},\r\n        {fid: 41, name: '网盘下载'},\r\n        {fid: 16, name: 'BT下载'},\r\n        {fid: 52, name: '游戏讨论'},\r\n        {fid: 84, name: '动漫讨论'},\r\n        {fid: 67, name: 'CG下载'},\r\n        {fid: 5, name: '自由讨论'},\r\n        {fid: 56, name: '个人日记'},\r\n        {fid: 57, name: '同人漫本'},\r\n    ],\r\n    // 可用版块列表\r\n    availableForumList: [\r\n        {fid: 106, name: '新作动态'},\r\n        {fid: 52, name: '游戏讨论'},\r\n        {fid: 41, name: '网盘下载'},\r\n        {fid: 67, name: 'CG下载'},\r\n        {fid: 16, name: 'BT下载'},\r\n        {fid: 9, name: '无限资源'},\r\n        {fid: 102, name: '游戏推荐'},\r\n        {fid: 24, name: '疑难互助'},\r\n        {fid: 57, name: '同人漫本'},\r\n        {fid: 84, name: '动漫讨论'},\r\n        {fid: 92, name: '动画下载'},\r\n        {fid: 127, name: '漫画小说'},\r\n        {fid: 68, name: 'ACG音乐'},\r\n        {fid: 163, name: 'LIVE资源'},\r\n        {fid: 94, name: '原创绘画'},\r\n        {fid: 87, name: '宅物交流'},\r\n        {fid: 86, name: '电子产品'},\r\n        {fid: 115, name: '文字作品'},\r\n        {fid: 96, name: '图片来源'},\r\n        {fid: 36, name: '寻求资源'},\r\n        {fid: 5, name: '自由讨论'},\r\n        {fid: 56, name: '个人日记'},\r\n        {fid: 4, name: '论坛管理'},\r\n        {fid: 93, name: '管理组区'},\r\n        {fid: 59, name: '原创组区'},\r\n        {fid: 125, name: '水楼林立'},\r\n        {fid: 181, name: '私人日记'},\r\n        {fid: 98, name: '日本语版'},\r\n        {fid: 99, name: '意見箱'},\r\n        {fid: 112, name: '掲示板'},\r\n        {fid: 100, name: '創作感想'},\r\n    ],\r\n};\r\n\r\nexport default Const;\r\n","/* 对话框模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\n\r\n/**\r\n * 创建对话框\r\n * @param {string} id 对话框ID\r\n * @param {string} title 对话框标题\r\n * @param {string} bodyContent 对话框主体内容\r\n * @param {string} footerContent 对话框底部内容\r\n * @returns {jQuery} 对话框的jQuery对象\r\n */\r\nexport const create = function (id, title, bodyContent, footerContent = '') {\r\n    let html = `\r\n<form>\r\n<div class=\"dialog\" id=\"${id}\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\" aria-labelledby=\"${id}Title\">\r\n  <div class=\"container dialog-content\" role=\"document\">\r\n    <div class=\"dialog-header\">\r\n      <h5 class=\"dialog-title\" id=\"${id}Title\">${title}</h5>\r\n      <button class=\"close\" data-dismiss=\"dialog\" type=\"button\" aria-label=\"关闭\">\r\n        <span aria-hidden=\"true\">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"dialog-body\">${bodyContent}</div>\r\n    <div class=\"dialog-footer\" ${!footerContent ? 'hidden' : ''}>${footerContent}</div>\r\n  </div>\r\n</div>\r\n</form>`;\r\n    let $dialog = $(html).appendTo('body');\r\n    $dialog\r\n        .on('click', '[data-dismiss=\"dialog\"]', () => close(id))\r\n        .on('click', '.tips', () => false)\r\n        .on('click', '.disabled-link', () => false)\r\n        .on('click', '.dialog', function (e) {\r\n            if($(e.target).hasClass('dialog')) {\r\n                close(id);\r\n            }\r\n        })\r\n        .keydown(function (e) {\r\n            if (e.keyCode === 27) {\r\n                return close(id);\r\n            }\r\n        })\r\n        .find('legend [type=\"checkbox\"]')\r\n        .click(function () {\r\n            let $this = $(this);\r\n            let checked = $this.prop('checked');\r\n            if (Util.isOpera() || Util.isEdge())\r\n                $this.closest('fieldset').find('input, select, textarea, button').not('legend input').prop('disabled', !checked);\r\n            else $this.closest('fieldset').prop('disabled', !checked);\r\n        }).end()\r\n        .find('input[data-disabled]')\r\n        .click(function () {\r\n            let $this = $(this);\r\n            let checked = $this.prop('checked');\r\n            $($this.data('disabled')).each(function () {\r\n                let $this = $(this);\r\n                if ($this.is('a')) {\r\n                    if (checked) $this.removeClass('disabled-link');\r\n                    else $this.addClass('disabled-link');\r\n                }\r\n                else {\r\n                    $this.prop('disabled', !checked);\r\n                }\r\n            });\r\n        }).end().find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n    $(window).on('resize.' + id, () => resize(id));\r\n    return $dialog;\r\n};\r\n\r\n/**\r\n * 显示对话框\r\n * @param {string} id 对话框ID\r\n */\r\nexport const show = function (id) {\r\n    let $dialog = $('#' + id);\r\n    if (!$dialog.length) return;\r\n    $dialog.find('legend [type=\"checkbox\"]')\r\n        .each(function () {\r\n            $(this).triggerHandler('click');\r\n        }).end().find('input[data-disabled]')\r\n        .each(function () {\r\n            $(this).triggerHandler('click');\r\n        });\r\n    $dialog.fadeIn('normal').find('.close:first').focus();\r\n    resize(id);\r\n    $('body').addClass('modal-open');\r\n};\r\n\r\n/**\r\n * 调整对话框大小\r\n * @param {string} id 对话框ID\r\n */\r\nexport const resize = function (id) {\r\n    let $dialog = $('#' + id);\r\n    $dialog.find('.dialog-body')\r\n        .css('max-height', $(window).height() - $dialog.find('.dialog-header').outerHeight() - $dialog.find('.dialog-footer').outerHeight());\r\n};\r\n\r\n/**\r\n * 关闭对话框\r\n * @param {string} id 对话框ID\r\n * @returns {boolean} 返回false\r\n */\r\nexport const close = function (id) {\r\n    $('#' + id).fadeOut('normal', function () {\r\n        $(this).parent().remove();\r\n        if(!$('.dialog').length) {\r\n            $('body').removeClass('modal-open');\r\n        }\r\n    });\r\n    $(window).off('resize.' + id);\r\n    return false;\r\n};\r\n","/* 首页模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n/**\r\n * 处理首页的@提醒按钮\r\n */\r\nexport const handleAtTipsBtn = function () {\r\n    $('#atTips').click(function () {\r\n        let $this = $(this);\r\n        let time = $this.data('time');\r\n        let cookieValue = Util.getCookie(Const.atTipsTimeCookieName);\r\n        if (!time || time === cookieValue) return;\r\n        if (!cookieValue) {\r\n            let curDate = new Date().getDate().toString();\r\n            Util.setCookie(Const.prevAtTipsTimeCookieName, curDate.padStart(2, '0') + '日00时00分');\r\n        }\r\n        else if (cookieValue !== time) {\r\n            Util.setCookie(Const.prevAtTipsTimeCookieName, cookieValue);\r\n        }\r\n        Util.setCookie(Const.atTipsTimeCookieName, time, Util.getDate(`+${Const.atTipsTimeExpires}d`));\r\n        $this.removeClass('btn-outline-danger').addClass('btn-outline-primary');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理首页主题链接面板\r\n */\r\nexport const handleIndexThreadPanel = function () {\r\n    if (Config.activeNewReplyPanel) $(`a[data-toggle=\"tab\"][href=\"${Config.activeNewReplyPanel}\"]`).tab('show');\r\n    if (Config.activeTopRecommendPanel) $(`a[data-toggle=\"tab\"][href=\"${Config.activeTopRecommendPanel}\"]`).tab('show');\r\n\r\n    $(document).on('shown.bs.tab', '[data-toggle=\"tab\"]', function (e) {\r\n        let $target = $(e.target);\r\n        let targetPanel = $target.attr('href');\r\n        let typeName = '';\r\n        if (targetPanel.includes('NewReplyPanel')) typeName = 'activeNewReplyPanel';\r\n        else if (targetPanel.includes('TopRecommendPanel')) typeName = 'activeTopRecommendPanel';\r\n        if (typeName && Config[typeName] !== targetPanel) {\r\n            readConfig();\r\n            Config[typeName] = targetPanel;\r\n            writeConfig();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理选择页面背景\r\n */\r\nexport const handleSelectBg = function () {\r\n    $('#selectBgImage').on('click', '[data-id]', function () {\r\n        let $this = $(this);\r\n        let id = $this.data('id');\r\n        let fileName = $this.data('filename');\r\n        let path = $this.parent().data('path');\r\n        if (!id || !fileName || !path) return;\r\n        if (confirm('是否选择此背景图片？')) {\r\n            Util.setCookie(Const.bgStyleCookieName, id, Util.getDate(`+${Const.bgStyleExpires}d`), Const.storagePrefix);\r\n            $('body, .modal-content').css('background-image', 'url(\"' + path + fileName + '\")');\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n    }).on('click', '[data-color]', function () {\r\n        let $this = $(this);\r\n        let color = $this.data('color');\r\n        if (!color) return;\r\n        if (confirm('是否选择此背景颜色？')) {\r\n            Util.setCookie(Const.bgStyleCookieName, color, Util.getDate(`+${Const.bgStyleExpires}d`), Const.storagePrefix);\r\n            $('body, .modal-content').css('background', color);\r\n            alert('背景已更换');\r\n        }\r\n    });\r\n\r\n    $('#customBgStyle').click(function () {\r\n        let value = Util.getCookie(Const.bgStyleCookieName, Const.storagePrefix);\r\n        if (!value || parseInt(value)) value = '';\r\n        value = prompt(\r\n            '请输入背景图片URL、颜色代码或CSS样式：\\n（例：http://xxx.com/abc.jpg 或 #fcfcfc，留空表示恢复默认背景）\\n' +\r\n            '（注：建议选择简洁、不花哨、偏浅色系的背景图片或颜色）',\r\n            value\r\n        );\r\n        if (value === null) return;\r\n        let $bg = $('body, .modal-content, .dialog-content');\r\n        if ($.trim(value) === '') {\r\n            Util.deleteCookie(Const.bgStyleCookieName, Const.storagePrefix);\r\n            alert('背景已恢复默认');\r\n            location.reload();\r\n        }\r\n        else if (/^https?:\\/\\/[^\"']+/.test(value)) {\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate(`+${Const.bgStyleExpires}d`), Const.storagePrefix);\r\n            $bg.css('background-image', 'url(\"' + value + '\")');\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n        else if (/^#[0-9a-f]{6}$/i.test(value)) {\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate(`+${Const.bgStyleExpires}d`), Const.storagePrefix);\r\n            $bg.css('background', value.toLowerCase());\r\n            alert('背景已更换');\r\n        }\r\n        else if (!/[<>{}]/.test(value)) {\r\n            value = value.replace(';', '');\r\n            Util.setCookie(Const.bgStyleCookieName, value, Util.getDate(`+${Const.bgStyleExpires}d`), Const.storagePrefix);\r\n            $bg.css('background', value);\r\n            alert('背景已更换（图片可能需要一定时间加载）');\r\n        }\r\n        else {\r\n            alert('格式不正确');\r\n        }\r\n    });\r\n};\r\n","/* 消息模块 */\r\n'use strict';\r\n\r\n/**\r\n * 显示消息\r\n * @param {string|Object} options 消息或设置对象\r\n * @param {string} [options.msg] 消息\r\n * @param {number} [options.duration={@link Config.defShowMsgDuration}] 消息显示时间（秒），-1为永久显示\r\n * @param {boolean} [options.clickable=true] 消息框可否手动点击消除\r\n * @param {boolean} [options.preventable=false] 是否阻止点击网页上的其它元素\r\n * @param {number} [duration] 消息显示时间（秒），-1为永久显示\r\n * @example\r\n * show('<span class=\"mr-3\">使用道具</span><span class=\"text-item\">神秘系数<em class=\"text-warning\">+1</em></span>', -1);\r\n * show({\r\n *   msg: '<span class=\"mr-3\">抽取神秘盒子</span><span class=\"text-item\">KFB<em class=\"text-warning\">+8</em></span>',\r\n *   duration: 20,\r\n *   clickable: false,\r\n * });\r\n * @returns {jQuery} 消息框对象\r\n */\r\nexport const show = function (options, duration) {\r\n    let settings = {\r\n        msg: '',\r\n        duration: Config.defShowMsgDuration,\r\n        clickable: true,\r\n        preventable: false,\r\n    };\r\n    if ($.type(options) === 'object') {\r\n        $.extend(settings, options);\r\n    }\r\n    else {\r\n        settings.msg = options;\r\n        settings.duration = typeof duration === 'undefined' ? Config.defShowMsgDuration : duration;\r\n    }\r\n\r\n    let $container = $('.msg-container');\r\n    let isFirst = $container.length === 0;\r\n    if (!isFirst && !$('.mask').length) {\r\n        if ($container.height() >= $(window).height() * 0.8) {\r\n            destroy();\r\n            isFirst = true;\r\n        }\r\n    }\r\n    if (settings.preventable && !$('.mask').length) {\r\n        $('<div class=\"mask\"></div>').appendTo('body');\r\n    }\r\n    if (isFirst) {\r\n        $container = $('<div class=\"container msg-container\"></div>').appendTo('body');\r\n    }\r\n\r\n    let $msg = $(`<div class=\"msg\">${settings.msg}</div>`).appendTo($container);\r\n    $msg.on('click', '.stop-action', function (e) {\r\n        e.preventDefault();\r\n        $(this).text('正在停止&hellip;').closest('.msg').data('stop', true);\r\n    });\r\n    if (settings.clickable) {\r\n        $msg.css('cursor', 'pointer').click(function () {\r\n            hide($(this));\r\n        }).find('a').click(function (e) {\r\n            e.stopPropagation();\r\n        });\r\n    }\r\n    if (settings.preventable) $msg.attr('preventable', true);\r\n    $msg.slideDown('normal');\r\n    if (settings.duration > -1) {\r\n        setTimeout(() => {\r\n            hide($msg);\r\n        }, settings.duration * 1000);\r\n    }\r\n    return $msg;\r\n};\r\n\r\n/**\r\n * 显示等待消息\r\n * @param {string} msg 消息\r\n * @param {boolean} preventable 是否阻止点击网页上的其它元素\r\n * @returns {jQuery} 消息框对象\r\n */\r\nexport const wait = function (msg, preventable = true) {\r\n    msg += '<i class=\"fa fa-spinner fa-spin fa-lg fa-fw ml-3\" aria-label=\"等待中\" aria-hidden=\"true\"></i>';\r\n    return show({msg, duration: -1, clickable: false, preventable});\r\n};\r\n\r\n/**\r\n * 隐藏指定消息框\r\n * @param {jQuery} $msg 消息框对象\r\n */\r\nexport const hide = function ($msg) {\r\n    $msg.slideUp('normal', function () {\r\n        remove($(this));\r\n    });\r\n};\r\n\r\n/**\r\n * 移除指定消息框\r\n * @param {jQuery} $msg 消息框对象\r\n */\r\nexport const remove = function ($msg) {\r\n    let $container = $msg.parent();\r\n    $msg.remove();\r\n    if (!$('.msg').length) {\r\n        $container.remove();\r\n        $('.mask').remove();\r\n    }\r\n    else if (!$('.msg[preventable]').length) {\r\n        $('.mask').remove();\r\n    }\r\n};\r\n\r\n/**\r\n * 销毁所有消息框\r\n */\r\nexport const destroy = function () {\r\n    $('.msg-container').remove();\r\n    $('.mask').remove();\r\n};\r\n","/* 其它模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n/**\r\n * 高亮关键词页面中未读的消息\r\n */\r\nexport const highlightUnReadAtTipsMsg = function () {\r\n    if (Info.gjc !== Info.userName) return;\r\n    let timeString = Util.getCookie(Const.prevAtTipsTimeCookieName);\r\n    if (!timeString || !/^\\d+日\\d+时\\d+分$/.test(timeString)) return;\r\n    let prevString = '';\r\n    $('.thread-list-item time').each(function (index) {\r\n        let $this = $(this);\r\n        let curString = $.trim($this.text());\r\n        if (index === 0) prevString = curString;\r\n        if (timeString < curString && prevString >= curString) {\r\n            $this.addClass('text-danger');\r\n            prevString = curString;\r\n        }\r\n        else return false;\r\n    });\r\n\r\n    $(document).on('click', '.thread-list-item .thread-link-item a', function () {\r\n        Util.deleteCookie(Const.prevAtTipsTimeCookieName);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理游戏搜索区域\r\n */\r\nexport const handleGameIntroSearchArea = function () {\r\n    $('#gameSearchKeyword').val(Info.keyword);\r\n    $('#gameSearchType').val(Info.searchType);\r\n};\r\n\r\n/**\r\n * 推游戏\r\n */\r\nexport const tuiGame = function () {\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.data('wait')) return;\r\n\r\n        let type = $this.data('type');\r\n        let cookieName = '';\r\n        if (type === 'company') cookieName = 'g_intro_inc_tui_';\r\n        else if (type === 'type') cookieName = 'g_intro_adv_tui_';\r\n        else if (type === 'property') cookieName = 'g_intro_moe_tui_';\r\n        else cookieName = 'g_intro_tui_';\r\n        cookieName += Info.id;\r\n        if (Util.getCookie(cookieName, '')) {\r\n            alert('你在48小时内已经推过');\r\n            return;\r\n        }\r\n\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: $this.data('url'),\r\n            success: function () {\r\n                let $num = $this.find('span:first');\r\n                let num = parseInt($num.text());\r\n                $num.text('+1');\r\n                setTimeout(() => {\r\n                    $num.text(++num);\r\n                }, 1000);\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定收藏夹页面按钮点击事件\r\n */\r\nexport const bindFavorPageBtnsClick = function () {\r\n    let $form = $('form[name=\"favorForm\"]');\r\n\r\n    $(document).on('click', '.remove-catalog', () => confirm('是否删除该目录？'));\r\n\r\n    $('#addCatalog').click(function (e) {\r\n        e.preventDefault();\r\n        let type = $.trim(prompt('请输入收藏夹目录名称：'));\r\n        if (!type) return;\r\n        $form.find('[name=\"job\"]').val('addtype');\r\n        $form.find('[name=\"type\"]').val(type);\r\n        $form.submit();\r\n    });\r\n\r\n    $('#favorActionBtns').on('click', 'button', function () {\r\n        let action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            Util.selectAll($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (action === 'delete') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否删除这${$checked.length}项？`)) {\r\n                $form.find('[name=\"job\"]').val('clear');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n\r\n    $('#convertCatalogDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let type = $(this).data('type');\r\n        let $checked = $('[name=\"delid[]\"]:checked');\r\n        if ($checked.length > 0 && confirm(`是否将这${$checked.length}项转换到指定目录？`)) {\r\n            $form.find('[name=\"job\"]').val('change');\r\n            $form.find('[name=\"type\"]').val(type);\r\n            $form.submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定好友列表页面按钮点击事件\r\n */\r\nexport const bindFriendPageBtnsClick = function () {\r\n    $('#friendActionBtns').on('click', '[type=\"button\"]', function () {\r\n        let action = $(this).data('action');\r\n        if (action === 'selectAll') {\r\n            Util.selectAll($('[name=\"selid[]\"]'));\r\n        }\r\n        else if (action === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"selid[]\"]'));\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 在账号设置页面里为生日字段赋值\r\n */\r\nexport const assignBirthdayField = function () {\r\n    $('#birthday').change(function () {\r\n        let value = $(this).val().trim();\r\n        let matches = /(\\d{4})-(\\d{1,2})-(\\d{1,2})/.exec(value);\r\n        let year = '', month = '', day = '';\r\n        if (matches) {\r\n            year = parseInt(matches[1]);\r\n            month = parseInt(matches[2]);\r\n            day = parseInt(matches[3]);\r\n        }\r\n        $('[name=\"proyear\"]').val(year);\r\n        $('[name=\"promonth\"]').val(month);\r\n        $('[name=\"proday\"]').val(day);\r\n    });\r\n};\r\n\r\n/**\r\n * 同步主题每页楼层数量的设置\r\n */\r\nexport const syncPerPageFloorNum = function () {\r\n    /**\r\n     * 同步设置\r\n     */\r\n    const syncConfig = function () {\r\n        let perPageFloorNum = parseInt($('[name=\"p_num\"]').val());\r\n        if (perPageFloorNum === 0) perPageFloorNum = 10;\r\n        if (!isNaN(perPageFloorNum) && perPageFloorNum !== Config.perPageFloorNum) {\r\n            Config.perPageFloorNum = perPageFloorNum;\r\n            writeConfig();\r\n        }\r\n    };\r\n\r\n    syncConfig();\r\n    $('#creator').submit(function () {\r\n        readConfig();\r\n        syncConfig();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理上传头像文件浏览按钮\r\n */\r\nexport const handleUploadAvatarFileBtn = function () {\r\n    $('#browseAvatar').change(function () {\r\n        let $this = $(this);\r\n        let matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || !['jpg', 'gif', 'png'].includes(matches[1].toLowerCase())) {\r\n            alert('头像图片类型不匹配');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定短消息页面操作按钮点击事件\r\n */\r\nexport const bindMessageActionBtnsClick = function () {\r\n    $('#messageActionBtns').on('click', 'button', function () {\r\n        let $form = $('#messageListForm');\r\n        let name = $(this).attr('name');\r\n        if (name === 'selectAll') {\r\n            Util.selectAll($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (name === 'selectInverse') {\r\n            Util.selectInverse($('[name=\"delid[]\"]'));\r\n        }\r\n        else if (name === 'selectCustom') {\r\n            let title = $.trim(\r\n                prompt('请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）', '收到了他人转账的贡献|收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除')\r\n            );\r\n            if (!title) return;\r\n            $('[name=\"delid[]\"]').prop('checked', false);\r\n            $('a.thread-link').each(function () {\r\n                let $this = $(this);\r\n                for (let key of title.split('|')) {\r\n                    if ($this.text().toLowerCase().includes(key.toLowerCase())) {\r\n                        $this.parent().find('[name=\"delid[]\"]').prop('checked', true);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        else if (name === 'download') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否下载这${$checked.length}项？`)) {\r\n                $form.attr('action', '/message.php').find('[name=\"action\"]').val('down');\r\n                $form.submit();\r\n            }\r\n        }\r\n        else if (name === 'delete') {\r\n            let $checked = $('[name=\"delid[]\"]:checked');\r\n            if ($checked.length > 0 && confirm(`是否删除这${$checked.length}项？`)) {\r\n                $form.attr('action', Util.makeUrl('message/job')).find('[name=\"action\"]').val('del');\r\n                $form.submit();\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理注册页面\r\n */\r\nexport const handleRegisterPage = function () {\r\n    $(document).on('change', 'input[name]', function () {\r\n        let $this = $(this);\r\n        let name = $this.attr('name');\r\n        let value = $this.val();\r\n        if (!value) {\r\n            Util.showValidationMsg($this, 'clear');\r\n            return;\r\n        }\r\n        Util.showValidationMsg($('#response'), 'clear');\r\n        if (name === 'regpwd') {\r\n            if (value.length > 16 || value.length < 6) {\r\n                Util.showValidationMsg($this, 'error', '密码长度不正确');\r\n            }\r\n            else {\r\n                Util.showValidationMsg($this, 'clear');\r\n                $('[name=\"regpwdrepeat\"]').trigger('change');\r\n            }\r\n        }\r\n        else if (name === 'regpwdrepeat') {\r\n            if (value !== $('[name=\"regpwd\"]').val()) Util.showValidationMsg($this, 'error', '两次输入的密码不相符');\r\n            else Util.showValidationMsg($this, 'clear');\r\n        }\r\n    });\r\n\r\n    $('#registerBtn').click(function () {\r\n        let $this = $(this);\r\n        let $form = $this.closest('form');\r\n        if ($form.find('.has-danger').length > 0) {\r\n            alert('请正确填写表单');\r\n            return false;\r\n        }\r\n\r\n        let action = $this.data('action');\r\n        if (action === 'check') {\r\n            if (typeof window.namecheck !== 'function') return;\r\n            if (!window.namecheck()) return;\r\n            let $response = $('#response');\r\n            $this.prop('disabled', true);\r\n            Util.showValidationMsg($response, 'wait', '检查中，请稍等&hellip;');\r\n            $.post(Util.makeUrl('register/check'), $('[name=\"checkForm\"]').serialize(), ({type, msg}) => {\r\n                $this.prop('disabled', false);\r\n                Util.showValidationMsg($response, type, msg);\r\n                if (type === 'success') $this.data('action', 'register').find('span:last-child').text('注册');\r\n            }).fail(() => {\r\n                Util.showValidationMsg($response, 'error', '响应失败');\r\n            });\r\n        }\r\n        else {\r\n            $form.submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理个人信息页面下的按钮\r\n */\r\nexport const handleUserPageBtns = function () {\r\n    let $area = $('#profileBtns');\r\n    let userName = $area.data('username');\r\n    $area.on('click', '[name=\"followUser\"], [name=\"blockUser\"]', function () {\r\n        readConfig();\r\n        let $this = $(this);\r\n        let str = '关注';\r\n        let userList = Config.followUserList;\r\n        if ($this.attr('name') === 'blockUser') {\r\n            str = '屏蔽';\r\n            userList = Config.blockUserList;\r\n            Config.blockUserEnabled = true;\r\n        }\r\n        else Config.followUserEnabled = true;\r\n        if ($this.text().includes('取消')) {\r\n            let index = Util.inFollowOrBlockUserList(userName, userList);\r\n            if (index > -1) {\r\n                userList.splice(index, 1);\r\n                writeConfig();\r\n            }\r\n            $this.removeClass('btn-outline-danger').addClass('btn-outline-primary').find('span').text(str + '用户');\r\n            alert('该用户已被取消' + str);\r\n        }\r\n        else {\r\n            if (Util.inFollowOrBlockUserList(userName, userList) === -1) {\r\n                if (str === '屏蔽') {\r\n                    let type = Config.blockUserDefaultType;\r\n                    type = prompt('请填写屏蔽类型，0：主题和回帖；1：主题；2：回帖', type);\r\n                    if (type === null) return;\r\n                    type = parseInt(type);\r\n                    if (isNaN(type) || type < 0 || type > 2) type = Config.blockUserDefaultType;\r\n                    userList.push({name: userName, type: type});\r\n                }\r\n                else {\r\n                    userList.push({name: userName});\r\n                }\r\n                writeConfig();\r\n            }\r\n            $this.removeClass('btn-outline-primary').addClass('btn-outline-danger').find('span').text('取消' + str);\r\n            alert('该用户已被' + str);\r\n        }\r\n    }).find('[name=\"followUser\"], [name=\"blockUser\"]').each(function () {\r\n        let $this = $(this);\r\n        let str = '关注';\r\n        let userList = Config.followUserList;\r\n        if ($this.attr('name') === 'blockUser') {\r\n            str = '屏蔽';\r\n            userList = Config.blockUserList;\r\n        }\r\n        if (Util.inFollowOrBlockUserList(userName, userList) > -1) {\r\n            $this.removeClass('btn-outline-primary').addClass('btn-outline-danger').find('span').text('取消' + str);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理个人信息页面上的元素\r\n */\r\nexport const handleProfilePage = function () {\r\n    let $registerDate = $('#registerDate');\r\n    let matches = /(\\d{4})-(\\d{2})-(\\d{2})/.exec($registerDate.text());\r\n    if (matches) {\r\n        let now = new Date();\r\n        let [, year, month, day] = matches;\r\n        if (parseInt(month) === now.getMonth() + 1 && parseInt(day) === now.getDate() && parseInt(year) <= now.getFullYear()) {\r\n            $registerDate.attr('title', `今天是该用户注册${now.getFullYear() - parseInt(year)}周年纪念日`).addClass('text-danger help');\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * 在提交自助评分时显示错标文件大小警告\r\n */\r\nexport const showSelfRateErrorSizeSubmitWarning = function () {\r\n    $('form[name=\"selfRate\"]').submit(function () {\r\n        let $this = $(this);\r\n        let ratingSize = parseFloat($this.find('[name=\"psize\"]').val());\r\n        if (isNaN(ratingSize) || ratingSize <= 0) return;\r\n        if (parseInt($this.find('[name=\"psizegb\"]').val()) === 2) ratingSize *= 1024;\r\n        let titleSize = parseInt($this.find('a[data-title-size]').data('title-size'));\r\n        if (titleSize && (titleSize > ratingSize * (100 + 3) / 100 + 1 || titleSize < ratingSize * (100 - 3) / 100 - 1)) {\r\n            return confirm(`标题文件大小(${titleSize.toLocaleString()}M)与认定文件大小(${ratingSize.toLocaleString()}M)不一致，是否继续？`);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 在物品商店显示当前持有的KFB和贡献\r\n */\r\nexport const showMyInfoInItemShop = function () {\r\n    $.get(`/profile.php?action=show&uid=${Info.uid}&t=${$.now()}`, function (html) {\r\n        let kfbMatches = /论坛货币：(\\d+)\\s*KFB/.exec(html);\r\n        let gxMatches = /贡献数值：(\\d+(?:\\.\\d+)?)/.exec(html);\r\n        if (!kfbMatches && !gxMatches) return;\r\n        let kfb = parseInt(kfbMatches[1]);\r\n        let gx = parseFloat(gxMatches[1]);\r\n        $('#myInfo').html(`当前持有 <b>${kfb.toLocaleString()}</b> KFB 和 <b>${gx}</b> 贡献`);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理购买物品按钮\r\n */\r\nexport const handleBuyItemBtns = function () {\r\n    $('#itemList').on('click', 'button[name=\"buy\"]', function () {\r\n        let $this = $(this);\r\n        let itemId = $this.data('id');\r\n        if (!confirm('是否购买此物品？')) return;\r\n        $this.prop('disabled', true);\r\n        $.post('/kf_fw_ig_shop.php', `buy=${itemId}&safeid=${Info.safeId}`).done(function (html) {\r\n            let msg = Util.removeHtmlTag(html);\r\n            alert(msg);\r\n        }).fail(() => alert('连接超时')).always(() => $this.prop('disabled', false));\r\n    });\r\n};","/* 发帖模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Msg from './msg';\r\n\r\n/**\r\n * 处理编辑器按钮\r\n */\r\nexport const handleEditorBtns = function () {\r\n    let textArea = $('#postContent').get(0);\r\n\r\n    // 编辑器按钮\r\n    $(document).on('click', '.editor-btn-group button[data-action]', function () {\r\n        let action = $(this).data('action');\r\n        let value = '';\r\n        switch (action) {\r\n            case 'link':\r\n                value = prompt('请输入链接URL：', 'http://');\r\n                break;\r\n            case 'img':\r\n                value = prompt('请输入图片URL：', 'http://');\r\n                break;\r\n            case 'sell':\r\n                value = prompt('请输入出售金额：', 1);\r\n                break;\r\n            case 'hide':\r\n                value = prompt('请输入神秘等级：', 1);\r\n                break;\r\n            case 'audio': {\r\n                value = prompt('请输入HTML5音频实际地址：\\n（可直接输入网易云音乐的单曲地址，将自动转换为外链地址）', 'http://');\r\n                let matches = /^https?:\\/\\/music\\.163\\.com\\/(?:#\\/)?song\\?id=(\\d+)/i.exec(value);\r\n                if (matches) value = `https://music.miaola.info/163/${matches[1]}.mp3`;\r\n                matches = /^https?:\\/\\/www\\.xiami\\.com\\/song\\/(\\w+)/i.exec(value);\r\n                if (matches) value = `https://music.miaola.info/xiami/${matches[1]}.mp3`;\r\n            }\r\n                break;\r\n            case 'video': {\r\n                value = prompt('请输入HTML5视频实际地址：\\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）', 'http://');\r\n                let matches = /^https?:\\/\\/(?:www\\.)?youtube\\.com\\/watch\\?v=([\\w\\-]+)/i.exec(value);\r\n                if (matches) value = `https://video.miaola.info/youtube/${matches[1]}`;\r\n                matches = /^https?:\\/\\/youtu\\.be\\/([\\w\\-]+)$/i.exec(value);\r\n                if (matches) value = `https://video.miaola.info/youtube/${matches[1]}`;\r\n            }\r\n                break;\r\n        }\r\n        if (value === null) return;\r\n\r\n        let selText = '';\r\n        let code = '';\r\n        switch (action) {\r\n            case 'link':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[url=${value}]${selText}[/url]`;\r\n                break;\r\n            case 'img':\r\n                code = `[img]${value}[/img]`;\r\n                break;\r\n            case 'quote':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[quote]${selText}[/quote]`;\r\n                break;\r\n            case 'code':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[code]${selText}[/code]`;\r\n                break;\r\n            case 'sell':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sell=${value}]${selText}[/sell]`;\r\n                break;\r\n            case 'hide':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[hide=${value}]${selText}[/hide]`;\r\n                break;\r\n            case 'bold':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[b]${selText}[/b]`;\r\n                break;\r\n            case 'italic':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[i]${selText}[/i]`;\r\n                break;\r\n            case 'underline':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[u]${selText}[/u]`;\r\n                break;\r\n            case 'strike':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[strike]${selText}[/strike]`;\r\n                break;\r\n            case 'super':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sup]${selText}[/sup]`;\r\n                break;\r\n            case 'sub':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[sub]${selText}[/sub]`;\r\n                break;\r\n            case 'horizontal':\r\n                code = `[hr]`;\r\n                break;\r\n            case 'align-left':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=left]${selText}[/align]`;\r\n                break;\r\n            case 'align-center':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=center]${selText}[/align]`;\r\n                break;\r\n            case 'align-right':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[align=right]${selText}[/align]`;\r\n                break;\r\n            case 'fly':\r\n                selText = Util.getSelText(textArea);\r\n                code = `[fly]${selText}[/fly]`;\r\n                break;\r\n            case 'audio':\r\n                code = `[audio]${value}[/audio]`;\r\n                break;\r\n            case 'video':\r\n                code = `[video]${value}[/video]`;\r\n                break;\r\n        }\r\n        if (!code) return;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 字号下拉菜单\r\n    $('#fontSizeDropdownMenu').on('click', 'a', function (e) {\r\n        e.preventDefault();\r\n        let size = $(this).data('size');\r\n        let selText = Util.getSelText(textArea);\r\n        let code = `[size=${size}]${selText}[/size]`;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n\r\n    // 颜色、背景颜色下拉菜单\r\n    $('#colorDropdownMenu, #bgColorDropdownMenu').on('click', 'span', function () {\r\n        let $this = $(this);\r\n        let codeType = $this.parent().is('#bgColorDropdownMenu') ? 'backcolor' : 'color';\r\n        let color = $this.data('color');\r\n        let selText = Util.getSelText(textArea);\r\n        let code = `[${codeType}=${color}]${selText}[/${codeType}]`;\r\n        Util.addCode(textArea, code, selText);\r\n        textArea.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 检查发帖表单\r\n */\r\nexport const checkPostForm = function () {\r\n    $('#postForm').submit(function () {\r\n        let $postType = $('#postType');\r\n        if ($postType.length > 0 && !$postType.val()) {\r\n            alert('没有选择主题分类');\r\n            $postType.focus();\r\n            return false;\r\n        }\r\n\r\n        let $postTitle = $('[name=\"atc_title\"]');\r\n        if ($postTitle.length > 0) {\r\n            let length = Util.getStrByteLen($postTitle.val());\r\n            if (!length) {\r\n                alert('标题不能为空');\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n            else if (length > 100) {\r\n                alert(`标题长度为 ${length} 字节(不可超过 100 字节)，请减少标题长度`);\r\n                $postTitle.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $voteItemContent = $('#voteItemContent');\r\n        if ($voteItemContent.length > 0) {\r\n            if (!$voteItemContent.val().trim()) {\r\n                alert('投票选项不能为空');\r\n                $voteItemContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $postContent = $('#postContent');\r\n        if ($postContent.length > 0) {\r\n            let length = Util.getStrByteLen($postContent.val().trim());\r\n            if (length < 12) {\r\n                alert('文章内容少于 12 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n            else if (length > 50000) {\r\n                alert('文章内容大于 50000 个字节');\r\n                $postContent.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let $postGjc = $('#postGjc');\r\n        if ($postGjc.length > 0 && Info.action === 'new' && !$postGjc.val().trim()) {\r\n            alert('请在内容文本框的下方填写关键词，以方便搜索，也可以在标题中选择任意一个词填入');\r\n            $postGjc.focus();\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理附件按钮\r\n */\r\nexport const handleAttachBtns = function () {\r\n    $(document).on('click', '.attach-area a[data-action]', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let $area = $this.closest('.attach-area');\r\n        let action = $this.data('action');\r\n        let id = $area.data('id');\r\n        if (!id) return;\r\n        if (action === 'insert') {\r\n            let type = $this.data('type');\r\n            let textArea = $('#postContent').get(0);\r\n            let code = `[${type === 'new' ? 'upload' : 'attachment'}=${id}]`;\r\n            Util.addCode(textArea, code);\r\n            textArea.focus();\r\n        }\r\n        else if (action === 'update') {\r\n            $area.find('.attach-info').prop('hidden', true).after(\r\n                `<label><input name=\"replace_${id}\" type=\"file\" aria-label=\"选择附件\"></label>`\r\n            );\r\n            $this.data('action', 'cancel').text('取消').blur();\r\n            if (!$(document).data('attachUpdateAlert')) {\r\n                alert('本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果');\r\n                $(document).data('attachUpdateAlert', true);\r\n            }\r\n        }\r\n        else if (action === 'cancel') {\r\n            $area.find('.attach-info').prop('hidden', false).next('label').remove();\r\n            $this.data('action', 'update').text('更新').blur();\r\n        }\r\n        else if (action === 'delete') {\r\n            $area.remove();\r\n        }\r\n    });\r\n\r\n    $(document).on('change', '[type=\"file\"]', function () {\r\n        let $this = $(this);\r\n        let matches = /\\.(\\w+)$/.exec($this.val());\r\n        if (!matches || !['jpg', 'gif', 'png', 'torrent'].includes(matches[1].toLowerCase())) {\r\n            alert('附件类型不匹配');\r\n            return;\r\n        }\r\n\r\n        let type = $this.data('type');\r\n        if (type === 'new') {\r\n            $this.removeData('type').parent().next().prop('hidden', false);\r\n\r\n            let $newAttachArea = $('#newAttachArea');\r\n            let totalNum = $newAttachArea.find('[type=\"file\"]').length;\r\n            if (totalNum >= 5) return;\r\n            let $lastAttachArea = $newAttachArea.find('[type=\"file\"]:last').closest('.attach-area');\r\n            let id = parseInt($lastAttachArea.data('id'));\r\n            if (!id) return;\r\n            id++;\r\n            $(`\r\n<div class=\"form-group row font-size-sm attach-area\" data-id=\"${id}\">\r\n  <div class=\"col-12 col-form-label\">\r\n    <label>\r\n      <input name=\"attachment_${id}\" data-type=\"new\" type=\"file\" aria-label=\"选择附件\">\r\n    </label>\r\n    <span hidden>\r\n      <a data-action=\"insert\" data-type=\"new\" href=\"#\">插入</a>&nbsp;\r\n      <a data-action=\"delete\" href=\"#\">删除</a>\r\n    </span>\r\n  </div>\r\n  <div class=\"col-4\">\r\n    <label class=\"sr-only\" for=\"atc_downrvrc${id}\">神秘系数</label>\r\n    <input class=\"form-control form-control-sm\" id=\"atc_downrvrc${id}\" name=\"atc_downrvrc${id}\" data-toggle=\"tooltip\" \r\ntype=\"number\" value=\"0\" min=\"0\" title=\"神秘系数\" placeholder=\"神秘系数\">\r\n  </div>\r\n  <div class=\"col-8\">\r\n    <label class=\"sr-only\" for=\"atc_desc${id}\">描述</label>\r\n    <input class=\"form-control form-control-sm\" id=\"atc_desc${id}\" name=\"atc_desc${id}\" data-toggle=\"tooltip\" type=\"text\" \r\ntitle=\"描述\" placeholder=\"描述\">\r\n  </div>\r\n</div>\r\n`).insertAfter($lastAttachArea).find('[data-toggle=\"tooltip\"]').tooltip({'container': 'body'});\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 插入表情代码\r\n * @param {jQuery} $node 想要绑定的节点的jQuery对象\r\n */\r\nexport const addSmileCode = function ($node) {\r\n    $('.smile-panel').on('click', 'img', function () {\r\n        $('.smile-panel').addClass('open');\r\n        let textArea = $node.get(0);\r\n        if (!textArea) return;\r\n        let code = `[s:${$(this).data('id')}]`;\r\n        Util.addCode(textArea, code, '');\r\n        textArea.blur();\r\n    }).parent().on('shown.bs.dropdown', function () {\r\n        $('.smile-panel img').each(function () {\r\n            let $this = $(this);\r\n            if (!$this.attr('src')) {\r\n                $this.attr('src', $this.data('src'));\r\n            }\r\n        });\r\n    }).on('hide.bs.dropdown', function (e) {\r\n        let $relatedTarget = $(e.relatedTarget);\r\n        if (!$relatedTarget.data('open')) $relatedTarget.removeData('open');\r\n        else return e.preventDefault();\r\n    });\r\n\r\n    $('#smileDropdownBtn').click(function () {\r\n        let $this = $(this);\r\n        $this.data('open', !$this.data('open'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理多重回复和多重引用\r\n * @param {number} type 处理类型，1：多重回复；2：多重引用\r\n */\r\nexport const handleMultiQuote = function (type = 1) {\r\n    let data = localStorage[Const.multiQuoteStorageName];\r\n    if (!data) return;\r\n    try {\r\n        data = JSON.parse(data);\r\n    }\r\n    catch (ex) {\r\n        return;\r\n    }\r\n    if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) return;\r\n    let {tid, quoteList} = data;\r\n    if (!Info.tid || tid !== Info.tid || $.type(quoteList) !== 'object') return;\r\n    if (type === 2 && !Info.fid) return;\r\n    let list = [];\r\n    for (let data of Object.values(quoteList)) {\r\n        if (!Array.isArray(data)) continue;\r\n        for (let quote of data) {\r\n            list.push(quote);\r\n        }\r\n    }\r\n    if (!list.length) {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        return;\r\n    }\r\n\r\n    let keywords = new Set();\r\n    let content = '';\r\n    let $keywords = $('[name=\"diy_guanjianci\"]');\r\n    if (type === 2) {\r\n        Msg.wait(`<span class=\"mr-3\">正在获取引用内容中&hellip;</span>剩余：<em class=\"text-warning countdown-num\">${list.length}</em>`);\r\n        $(document).clearQueue('MultiQuote');\r\n    }\r\n    $.each(list, function (index, data) {\r\n        if (typeof data.floor === 'undefined' || typeof data.pid === 'undefined') return;\r\n        keywords.add(data.userName);\r\n        if (type === 2) {\r\n            $(document).queue('MultiQuote', function () {\r\n                $.get(Util.makeUrl(\r\n                    'post/index',\r\n                    `action=quote&fid=${Info.fid}&tid=${tid}&pid=${data.pid}&article=${data.floor}&t=${new Date().getTime()}`\r\n                ), function ({postContent}) {\r\n                    content += postContent ? postContent + (index === list.length - 1 ? '' : '\\n') : '';\r\n                    let $countdownNum = $('.countdown-num:last');\r\n                    $countdownNum.text(parseInt($countdownNum.text()) - 1);\r\n                    if (index === list.length - 1) {\r\n                        Msg.destroy();\r\n                        $('#postContent').val(content).focus();\r\n                        $keywords.trigger('change');\r\n                    }\r\n                    else {\r\n                        setTimeout(() => $(document).dequeue('MultiQuote'), 100);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            content += `[quote]回 ${data.floor}楼(${data.userName}) 的帖子[/quote]\\n`;\r\n        }\r\n    });\r\n    for (let [index, quote] of list.entries()) {\r\n    }\r\n    $keywords.val([...keywords].join(','));\r\n    $('#postForm').submit(function () {\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n    });\r\n    if (type === 2) {\r\n        $(document).dequeue('MultiQuote');\r\n    }\r\n    else {\r\n        $('#postContent').val(content).focus();\r\n        $keywords.trigger('change');\r\n    }\r\n};\r\n\r\n/**\r\n * 处理清除多重引用数据按钮\r\n */\r\nexport const handleClearMultiQuoteDataBtn = function () {\r\n    $('.clear-multi-quote-data-btn').click(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否清除多重引用数据？')) return;\r\n        localStorage.removeItem(Const.multiQuoteStorageName);\r\n        $('[name=\"diy_guanjianci\"]').val('');\r\n        $('#postContent').val('');\r\n    });\r\n};\r\n\r\n/**\r\n * 添加多余关键词警告\r\n */\r\nexport const addRedundantKeywordWarning = function () {\r\n    $('input[name=\"diy_guanjianci\"]').change(function () {\r\n        let $this = $(this);\r\n        let keywords = $.trim($this.val()).split(',').filter(str => str);\r\n        if (keywords.length > 5) {\r\n            alert('所填关键词已超过5个，多余的关键词将被忽略');\r\n            $this.select().focus();\r\n        }\r\n    });\r\n};\r\n\r\n\r\n/**\r\n * 特殊发帖标题格式变化\r\n */\r\nexport const specialPostTitleChange = function () {\r\n    let wangPanType = $.trim($('#wangPanType').val());\r\n    let fileSize = $.trim($('#fileSize').val());\r\n    let expiryDate = $.trim($('#expiryDate').val());\r\n    let fileFormat = $.trim($('#fileFormat').val());\r\n    let ziGou = $('#ziGou').prop('checked') ? '[自购]' : '';\r\n    let xinZuo = $('#xinZuo').prop('checked') ? '[新作]' : '';\r\n    let fileTitle = $.trim($('#fileTitle').val());\r\n    let now = new Date();\r\n    let month = (now.getMonth() + 1).toString().padStart(2, '0');\r\n    let day = now.getDate().toString().padStart(2, '0');\r\n\r\n    let previewTitle = `[${month}.${day}]${ziGou}${xinZuo}${fileTitle}[${wangPanType}${expiryDate}][${fileSize}]${fileFormat ? `[${fileFormat}]` : ''}`;\r\n    let realTitle = `[${month}.${day}]${ziGou}${fileTitle}[${wangPanType}${expiryDate}][${fileSize}]${fileFormat ? `[${fileFormat}]` : ''}`;\r\n\r\n    let titleLength = Util.getStrByteLen(realTitle);\r\n    if(titleLength > 100) {\r\n        $('#previewTitle').text(`标题总长度为${titleLength}字节(不可超过100字节)，请减少标题长度`).addClass('text-danger');\r\n    }\r\n    else {\r\n        $('#previewTitle').text(previewTitle).removeClass('text-danger');\r\n    }\r\n    $('#realTitle').val(realTitle);\r\n};","/* 公共模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport * as Dialog from './dialog';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\nimport * as ConfigDialog from './configDialog';\r\n\r\n/**\r\n * 处理主菜单\r\n */\r\nexport const handleMainMenu = function () {\r\n    $('#mainMenuTogglerBtn').click(function () {\r\n        let maxHeight = document.documentElement.clientHeight - $(this).closest('.navbar').outerHeight();\r\n        if (maxHeight > 0) {\r\n            $('#mainMenu').css('max-height', maxHeight + 'px');\r\n        }\r\n    });\r\n    $('#sidebarMainMenuBtn').click(() => $('#mainMenuTogglerBtn').click());\r\n};\r\n\r\n/**\r\n * 处理主菜单链接\r\n */\r\nexport const handleMainMenuLink = function () {\r\n    $('#mainMenu').find('[data-name=\"openConfigDialog\"]').click(function (e) {\r\n        e.preventDefault();\r\n        $('#mainMenuTogglerBtn').click();\r\n        ConfigDialog.show();\r\n    });\r\n};\r\n\r\n/**\r\n * 显示侧边栏按钮组\r\n */\r\nexport const showSidebarBtnGroup = function () {\r\n    $('.sidebar-btn-group').prop('hidden', false);\r\n    if (Config.showSidebarRollBtnEnabled) $('#sidebarRollBtn').prop('hidden', false);\r\n    if (Config.showSidebarMainMenuBtnEnabled) $('#sidebarMainMenuBtn').prop('hidden', false);\r\n    if (Config.showSidebarForumListBtnEnabled) $('#sidebarForumListBtn').prop('hidden', false);\r\n    if (Config.showSidebarSearchBtnEnabled) $('#sidebarSearchBtn').prop('hidden', false);\r\n    if (Config.showSidebarHomePageBtnEnabled) $('#sidebarHomePageBtn').prop('hidden', false);\r\n};\r\n\r\n/**\r\n * 处理侧边栏的滚动到页顶/页底按钮\r\n */\r\nexport const handleSidebarRollBtn = function () {\r\n    $(window).scroll(function () {\r\n        let $btn = $('#sidebarRollBtn');\r\n        if ($(window).scrollTop() > 640) {\r\n            if ($btn.data('direction') === 'top') return;\r\n            $btn.data('direction', 'top').attr('aria-label', '滚动到页顶')\r\n                .find('i').removeClass('fa-chevron-down').addClass('fa-chevron-up');\r\n        }\r\n        else {\r\n            if ($btn.data('direction') === 'bottom') return;\r\n            $btn.data('direction', 'bottom').attr('aria-label', '滚动到页底')\r\n                .find('i').removeClass('fa-chevron-up').addClass('fa-chevron-down');\r\n        }\r\n    });\r\n\r\n    $('#sidebarRollBtn').click(function () {\r\n        let scrollTop = $(this).data('direction') === 'bottom' ? $('body').height() : 0;\r\n        $('body, html').animate({scrollTop: scrollTop});\r\n    });\r\n};\r\n\r\n/**\r\n * 处理搜索对话框\r\n */\r\nexport const handleSearchDialog = function () {\r\n    let $searchDialog = $('#searchDialog');\r\n    $searchDialog.find('#searchType > option[value=\"username\"]').prop('hidden', !Config.adminMemberEnabled);\r\n\r\n    $searchDialog.on('shown.bs.modal', function () {\r\n        $('#searchKeyword').select().focus();\r\n    }).find('form').submit(function () {\r\n        let $this = $(this);\r\n        let $searchKeyword = $this.find('#searchKeyword');\r\n        let searchType = $this.find('#searchType').val();\r\n        let keyword = $.trim($searchKeyword.val());\r\n        if (searchType === 'gjc') {\r\n            $this.attr('action', Util.makeUrl('gjc/' + keyword));\r\n        }\r\n        else if (searchType === 'username') {\r\n            $this.attr('action', Util.makeUrl('user/username/' + keyword));\r\n        }\r\n        else {\r\n            $this.attr('action', Util.makeUrl('search'));\r\n            $searchKeyword.attr('name', searchType === 'author' ? 'pwuser' : 'keyword');\r\n            if (searchType === 'title') {\r\n                if (keyword.length && Util.getStrByteLen(keyword) <= 2) {\r\n                    let $method = $this.find('[name=\"method\"]');\r\n                    $method.val('OR');\r\n                    $searchKeyword.val(keyword + ' ' + Math.floor(new Date().getTime() / 1000));\r\n                    setTimeout(() => {\r\n                        $searchKeyword.val(keyword);\r\n                        $method.val('AND');\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    $searchDialog.find('[name=\"searchRange\"]').on('click', function () {\r\n        let value = 'all';\r\n        if ($(this).val() === 'current') value = Info.fid;\r\n        $searchDialog.find('[name=\"f_fid\"]').val(value);\r\n    });\r\n\r\n    let $current = $searchDialog.find('[name=\"searchRange\"][value=\"current\"]');\r\n    let $currentBox = $current.closest('.form-check-inline');\r\n    $searchDialog.find('#searchType').change(function () {\r\n        let searchType = $(this).val();\r\n        if (!$current.data('enabled')) return;\r\n        let disabled = searchType === 'gjc' || searchType === 'username';\r\n        $current.prop('disabled', disabled);\r\n        if (disabled) $currentBox.addClass('disabled');\r\n        else $currentBox.removeClass('disabled');\r\n    });\r\n\r\n    if (pageId === 'threadPage' || pageId === 'readPage') {\r\n        $current.prop('disabled', false).data('enabled', true).click();\r\n        $currentBox.removeClass('disabled');\r\n    }\r\n};\r\n\r\n/**\r\n * 处理分页导航\r\n */\r\nexport const handlePageInput = function () {\r\n    $(document).on('click', '.page-input', function (e) {\r\n        e.preventDefault();\r\n        if (Info.maxPageNum && Info.maxPageNum <= 1) return;\r\n        let action = $(this).data('url');\r\n        if (!action) return;\r\n        let excludeParams = $(this).data('exclude');\r\n        if (excludeParams) excludeParams = excludeParams.split(',');\r\n        else excludeParams = [];\r\n        let num = parseInt(\r\n            prompt(`要跳转到第几页？${Info.maxPageNum ? `（共${Info.maxPageNum}页）` : ''}`, Info.currentPageNum)\r\n        );\r\n        if (num && num > 0) {\r\n            location.href = Util.makeUrl(action, 'page=' + num, true, excludeParams);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 绑定快速提交的快捷键\r\n */\r\nexport const bindFastSubmitShortcutKey = function () {\r\n    $('[data-fast-submit=\"true\"]').keydown(function (e) {\r\n        if (e.keyCode === 13 && e.ctrlKey) {\r\n            $(this).closest('form').submit();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示编辑常用版块对话框\r\n */\r\nexport const showEditCommonForumDialog = function () {\r\n    $(document).on('click', '.edit-common-forum-btn', function (e) {\r\n        e.preventDefault();\r\n        const dialogName = 'editCommonForumDialog';\r\n        if ($('#' + dialogName).length > 0) return;\r\n        readConfig();\r\n\r\n        let commonForumList = Config.commonForumList.length > 0 ? Config.commonForumList : Const.commonForumList;\r\n        let commonForumListHtml = '';\r\n        for (let {fid, name} of commonForumList) {\r\n            commonForumListHtml += `<span class=\"btn btn-outline-primary\" data-fid=\"${fid}\">${name}</span>`;\r\n        }\r\n        let availableForumListHtml = '';\r\n        for (let {fid, name} of Const.availableForumList) {\r\n            if (commonForumList.find(elem => elem.fid === fid)) continue;\r\n            availableForumListHtml += `<span class=\"btn btn-outline-primary\" data-fid=\"${fid}\">${name}</span>`;\r\n        }\r\n\r\n        let bodyContent = `\r\n<p class=\"font-size-sm text-muted\">\r\n  请将可用版块内的版块按钮拖拽到常用版块内（或相反）\r\n</p>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>常用版块</legend>\r\n  <div class=\"edit-forum-list d-flex flex-wrap\" id=\"editCommonForumList\">${commonForumListHtml}</div>\r\n</fieldset>\r\n<fieldset class=\"fieldset mb-3 py-2\">\r\n  <legend>可用版块</legend>\r\n  <div class=\"edit-forum-list d-flex flex-wrap\" id=\"editAvailableForumList\">${availableForumListHtml}</div>\r\n</fieldset>`;\r\n        let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>\r\n<button class=\"btn btn-danger\" name=\"reset\" type=\"button\">重置</button>`;\r\n        let $dialog = Dialog.create(dialogName, '编辑常用版块', bodyContent, footerContent);\r\n\r\n        const dragulaInit = function () {\r\n            let drake = dragula($dialog.find('.edit-forum-list').get(), {revertOnSpill: true});\r\n            drake.on('drag', function () {\r\n                $dialog.find('.dialog-body').css('overflow-y', 'hidden');\r\n            }).on('drop', function () {\r\n                $dialog.find('.dialog-body').css('overflow-y', 'auto');\r\n            }).on('cancel', function () {\r\n                $dialog.find('.dialog-body').css('overflow-y', 'auto');\r\n            });\r\n        };\r\n\r\n        let $dragulaScriptPath = $('[name=\"dragulaScriptPath\"]');\r\n        let dragulaScriptPath = $dragulaScriptPath.val();\r\n        if (dragulaScriptPath) {\r\n            $.getScript(dragulaScriptPath, dragulaInit);\r\n            $dragulaScriptPath.val('');\r\n        }\r\n        else {\r\n            dragulaInit();\r\n        }\r\n\r\n        $dialog.submit(function (e) {\r\n            e.preventDefault();\r\n            Config.commonForumList = [];\r\n            $('#editCommonForumList').children('.btn').each(function () {\r\n                let $this = $(this);\r\n                let fid = parseInt($this.data('fid'));\r\n                let name = $this.text().trim();\r\n                if (!fid || !name) return;\r\n                Config.commonForumList.push({fid: fid, name: name});\r\n            });\r\n            writeConfig();\r\n            alert('设置已保存');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        }).find('[name=\"reset\"]').click(function () {\r\n            if (!confirm('是否重置？')) return;\r\n            Config.commonForumList = [];\r\n            writeConfig();\r\n            alert('设置已重置');\r\n            Dialog.close(dialogName);\r\n            location.reload();\r\n        });\r\n\r\n        Dialog.show(dialogName);\r\n    });\r\n};\r\n\r\n/**\r\n * 填充常用版块面板\r\n */\r\nexport const fillCommonForumPanel = function () {\r\n    let commonForumList = Config.commonForumList.length > 0 ? Config.commonForumList : Const.commonForumList;\r\n    let html = '';\r\n    for (let [index, {fid, name}] of commonForumList.entries()) {\r\n        if (index === 0 || index % 3 === 0) html += '<div class=\"row mb-3\">';\r\n        html += `\r\n<div class=\"col-4\">\r\n  <a class=\"btn btn-outline-primary btn-block\" href=\"${Util.makeUrl('thread')}/${fid}\">${name}</a>\r\n</div>`;\r\n        if (index === commonForumList.length - 1 || index % 3 === 2) html += '</div>';\r\n    }\r\n    $('.common-forum-panel').html(html);\r\n};\r\n\r\n/**\r\n * 在操作进行时阻止关闭页面\r\n */\r\nexport const preventCloseWindow = function () {\r\n    window.addEventListener(\"beforeunload\", function (e) {\r\n        if ($('.mask').length > 0) {\r\n            let msg = '正在进行操作中，确定要关闭页面吗？';\r\n            e.returnValue = msg;\r\n            return msg;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 显示通用的导入/导出设置对话框\r\n * @param {string} title 对话框标题\r\n * @param {string} configName 设置名称\r\n * @param {?function} [callback] 回调方法\r\n * @param {?function} [callbackAfterSubmit] 在提交之后的回调方法\r\n */\r\nexport const showCommonImportOrExportConfigDialog = function (title, configName, callback, callbackAfterSubmit) {\r\n    const dialogName = 'pdCommonImOrExConfigDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n    let bodyContent = `\r\n<p class=\"font-size-sm\">\r\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\r\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可\r\n</p>\r\n<div class=\"form-group\">\r\n  <textarea class=\"form-control font-size-sm\" name=\"commonConfig\" rows=\"10\" aria-label=\"设置内容\" style=\"word-break: break-all;\"></textarea>\r\n</div>`;\r\n    let footerContent = `\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>`;\r\n    let $dialog = Dialog.create(dialogName, `导入或导出${title}`, bodyContent, footerContent);\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否导入文本框中的设置？')) return;\r\n        let options = $.trim($dialog.find('[name=\"commonConfig\"]').val());\r\n        if (!options) return;\r\n        try {\r\n            options = JSON.parse(options);\r\n        }\r\n        catch (ex) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        if (!options || $.type(options) !== $.type(Config[configName])) {\r\n            alert('设置有错误');\r\n            return;\r\n        }\r\n        Config[configName] = options;\r\n        writeConfig();\r\n        alert('设置已导入');\r\n        Dialog.close(dialogName);\r\n        if (typeof callbackAfterSubmit === 'function') callbackAfterSubmit();\r\n        else location.reload();\r\n    });\r\n    Dialog.show(dialogName);\r\n    $dialog.find('[name=\"commonConfig\"]').val(JSON.stringify(Config[configName])).select().focus();\r\n    if (typeof callback === 'function') callback($dialog);\r\n};\r\n\r\n/**\r\n * 关注用户\r\n */\r\nexport const followUsers = function () {\r\n    if (!Config.followUserList.length) return;\r\n    if (pageId === 'indexPage' && Config.highlightFollowUserThreadInHPEnabled) {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.closest('.thread-list-item').find('.thread-footer-column a:first').addClass('text-danger');\r\n                if (Config.highlightFollowUserThreadLinkEnabled) $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        $('.read-floor').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('username'), Config.followUserList) > -1) {\r\n                $this.find('.floor-num').addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'gjcPage' || pageId === 'sharePage' || pageId === 'searchPage') {\r\n        $('.thread-list-group').find('a[data-author]').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.followUserList) > -1) {\r\n                $this.addClass('text-danger');\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * 屏蔽用户\r\n */\r\nexport const blockUsers = function () {\r\n    if (!Config.blockUserList.length) return;\r\n    let num = 0;\r\n    if (pageId === 'indexPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList);\r\n            if (index > -1 && Config.blockUserList[index].type <= 1) {\r\n                num++;\r\n                $this.closest('.thread-link-group').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        if (Config.blockUserForumType === 1 && !Config.blockUserFidList.includes(Info.fid)) return;\r\n        else if (Config.blockUserForumType === 2 && Config.blockUserFidList.includes(Info.fid)) return;\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList);\r\n            if (index > -1 && Config.blockUserList[index].type <= 1) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        if (Config.blockUserForumType === 1 && !Config.blockUserFidList.includes(Info.fid)) return;\r\n        else if (Config.blockUserForumType === 2 && Config.blockUserFidList.includes(Info.fid)) return;\r\n        $('.read-floor').each(function () {\r\n            let $this = $(this);\r\n            let index = Util.inFollowOrBlockUserList($this.data('username'), Config.blockUserList);\r\n            if (index > -1) {\r\n                let floor = parseInt($this.data('floor'));\r\n                if (Config.blockUserList[index].type === 2 && floor === 0) return;\r\n                else if (Config.blockUserList[index].type === 1 && floor > 0) return;\r\n                num++;\r\n                $this.closest('.read-floor').remove();\r\n            }\r\n        });\r\n        $('.read-content').find('.blockquote > p').each(function () {\r\n            let $this = $(this);\r\n            let content = $this.text().trim();\r\n            for (let data of Config.blockUserList) {\r\n                if (data.type === 1) continue;\r\n                try {\r\n                    let regex1 = new RegExp(`^引用(第\\\\d+楼|楼主)${data.name}于`, 'i');\r\n                    let regex2 = new RegExp(`^回\\\\s*\\\\d+楼\\\\(${data.name}\\\\)\\\\s*的帖子`, 'i');\r\n                    if (regex1.test(content) || regex2.test(content)) {\r\n                        $this.html(`<mark class=\"help\" data-toggle=\"tooltip\" title=\"被屏蔽用户：${data.name}\">该用户已被屏蔽</mark>`);\r\n                    }\r\n                }\r\n                catch (ex) {\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'gjcPage' && Config.blockUserAtTipsEnabled) {\r\n        $('.thread-list-group').find('a[data-author]').each(function () {\r\n            let $this = $(this);\r\n            if (Util.inFollowOrBlockUserList($this.data('author'), Config.blockUserList) > -1) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    if (num > 0) console.log(`【屏蔽用户】共有${num}个主题或回复被屏蔽`);\r\n};\r\n\r\n/**\r\n * 屏蔽主题\r\n */\r\nexport const blockThread = function () {\r\n    if (!Config.blockThreadList.length) return;\r\n\r\n    /**\r\n     * 是否屏蔽主题\r\n     * @param {string} title 主题标题\r\n     * @param {string} userName 用户名\r\n     * @param {number} fid 版块ID\r\n     * @returns {boolean} 是否屏蔽\r\n     */\r\n    const isBlock = function (title, userName, fid = 0) {\r\n        for (let {keyWord, includeUser, excludeUser, includeFid, excludeFid} of Config.blockThreadList) {\r\n            let regex = null;\r\n            if (/^\\/.+\\/[gimuy]*$/.test(keyWord)) {\r\n                try {\r\n                    regex = eval(keyWord);\r\n                }\r\n                catch (ex) {\r\n                    console.log(ex);\r\n                    continue;\r\n                }\r\n            }\r\n            if (userName) {\r\n                if (includeUser) {\r\n                    if (!includeUser.includes(userName)) continue;\r\n                }\r\n                else if (excludeUser) {\r\n                    if (excludeUser.includes(userName)) continue;\r\n                }\r\n            }\r\n            if (fid) {\r\n                if (includeFid) {\r\n                    if (!includeFid.includes(fid)) continue;\r\n                }\r\n                else if (excludeFid) {\r\n                    if (excludeFid.includes(fid)) continue;\r\n                }\r\n            }\r\n            if (regex) {\r\n                if (regex.test(title)) return true;\r\n            }\r\n            else {\r\n                if (title.toLowerCase().includes(keyWord.toLowerCase())) return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    let num = 0;\r\n    if (pageId === 'indexPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (isBlock($this.text().trim(), $this.data('author'))) {\r\n                num++;\r\n                $this.closest('.thread-link-group').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'threadPage') {\r\n        $('.thread-link').each(function () {\r\n            let $this = $(this);\r\n            if (isBlock($this.attr('title'), $this.data('author'), Info.fid)) {\r\n                num++;\r\n                $this.closest('.thread-list-item').remove();\r\n            }\r\n        });\r\n    }\r\n    else if (pageId === 'readPage') {\r\n        if (Info.currentPageNum !== 1) return;\r\n        let $topFloor = $('.read-floor[data-floor=\"0\"]');\r\n        if (!$topFloor.length) return;\r\n        if (isBlock($('.thread-title').text().trim(), $topFloor.data('username'), Info.fid)) {\r\n            num++;\r\n            $topFloor.remove();\r\n        }\r\n    }\r\n    if (num > 0) console.log(`【屏蔽主题】共有${num}个主题被屏蔽`);\r\n};\r\n","/* 主题模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport Const from './const';\r\nimport {write as writeConfig} from './config';\r\nimport * as Msg from './msg';\r\n\r\n/**\r\n * 处理复制楼层跳转链接按钮\r\n */\r\nexport const handleCopyFloorLinkBtn = function () {\r\n    $(document).on('click', '.floor-num', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let link = Util.getHostNameUrl() + $this.attr('href');\r\n        $this.data('copy-text', link);\r\n        if (!Util.copyText($this, $this)) {\r\n            prompt('本楼的跳转链接：', link);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 处理快速回复按钮\r\n */\r\nexport const handleFastReplyBtn = function () {\r\n    $(document).on('click', '.fast-reply-btn', function () {\r\n        let $article = $(this).closest('article');\r\n        let floor = $article.data('floor');\r\n        let userName = $article.data('username');\r\n        $('#postGjc').val(userName);\r\n        let postContent = $('#postContent').get(0);\r\n        postContent.value = `[quote]回 ${floor}楼(${userName}) 的帖子[/quote]\\n`;\r\n        postContent.selectionStart = postContent.value.length;\r\n        postContent.selectionEnd = postContent.value.length;\r\n        postContent.focus();\r\n    });\r\n};\r\n\r\n/**\r\n * 处理提交优秀帖按钮\r\n */\r\nexport const handleGoodPostBtn = function () {\r\n    $(document).on('click', '.handle-post-btn', function () {\r\n        let $this = $(this);\r\n        if (!Info.goodPostTips || $this.data('wait')) return;\r\n        let $floor = $(this).closest('.read-floor');\r\n        let pid = $floor.data('pid');\r\n        let userName = $floor.data('username');\r\n        $floor.addClass('good-post-mark');\r\n        if (!confirm(`是否提交本楼层为优秀帖子？\\n（${Info.goodPostTips}）`)) {\r\n            $floor.removeClass('good-post-mark');\r\n            return;\r\n        }\r\n        let $sameUserNameFloors = $(`.read-floor[data-username=\"${userName}\"]`).not($floor);\r\n        if ($sameUserNameFloors.find('.fieldset-alert:contains(\"本帖为优秀帖\")').length > 0) {\r\n            if (!confirm('在当前页面中该会员已经有回帖被评为优秀帖，是否继续？')) {\r\n                $floor.removeClass('good-post-mark');\r\n                return;\r\n            }\r\n        }\r\n\r\n        $this.data('wait', true);\r\n        $.post('/diy_read_cztz.php', `tid=${Info.tid}&pid=${pid}&safeid=${Info.safeId}`)\r\n            .done(function (html) {\r\n                if (/已将本帖操作为优秀帖|该楼层已经是优秀帖/.test(html)) {\r\n                    let $content = $floor.find('.read-content');\r\n                    if (!$content.find('.fieldset-alert:contains(\"本帖为优秀帖\")').length) {\r\n                        $content.prepend('<fieldset class=\"fieldset fieldset-alert\"><legend>↓</legend>本帖为优秀帖</fieldset>');\r\n                    }\r\n                }\r\n                if (!/已将本楼层提交为优秀帖申请/.test(html)) {\r\n                    $floor.removeClass('good-post-mark');\r\n                }\r\n                alert(html);\r\n            }).always(() => $this.removeData('wait'));\r\n    });\r\n};\r\n\r\n/**\r\n * 处理屏蔽回帖按钮\r\n */\r\nexport const handleBlockFloorBtn = function () {\r\n    $(document).on('click', '.block-floor', () => confirm('确认要屏蔽该回帖？本操作不可恢复！（屏蔽后该回帖将对大家不可见）'));\r\n};\r\n\r\n/**\r\n * 处理购买帖子按钮\r\n */\r\nexport const handleBuyThreadBtn = function () {\r\n    $(document).on('click', '.buy-thread-btn', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let pid = $this.data('pid');\r\n        let price = $this.data('price');\r\n        if (price > 5 && !confirm(`此贴售价${price}KFB，是否购买？`)) return;\r\n        let $wait = Msg.wait('正在购买帖子&hellip;');\r\n        $.get(Util.makeUrl('job/buytopic', `tid=${Info.tid}&pid=${pid}&verify=${Info.verify}&t=${new Date().getTime()}`),\r\n            function ({msg}) {\r\n                Msg.remove($wait);\r\n                if (msg === '操作完成') {\r\n                    location.reload();\r\n                }\r\n                else if (msg.includes('您已经购买此帖')) {\r\n                    alert('你已经购买过此帖');\r\n                    location.reload();\r\n                }\r\n                else {\r\n                    alert('帖子购买失败');\r\n                }\r\n            });\r\n    });\r\n};\r\n\r\n/**\r\n * 复制购买人名单\r\n */\r\nexport const copyBuyThreadList = function () {\r\n    $(document).on('change', '.buy-thread-list', function () {\r\n        let $this = $(this);\r\n        if ($this.val() !== 'copyList') return;\r\n        let list = $this.find('option').map(function (index) {\r\n            let name = $(this).text();\r\n            if (index === 0 || index === 1 || name.includes('-'.repeat(11))) return null;\r\n            else return name;\r\n        }).get().join('\\n');\r\n        $this.get(0).selectedIndex = 0;\r\n        if (!list) {\r\n            alert('暂时无人购买');\r\n            return;\r\n        }\r\n\r\n        let $dialog = $(`\r\n<div class=\"modal fade\" id=\"buyThreadListDialog\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"buyThreadListDialogTitle\"\r\n     aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-sm\" role=\"document\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\" id=\"buyThreadListDialogTitle\">购买人名单</h5>\r\n        <button class=\"close\" data-dismiss=\"modal\" type=\"button\" aria-label=\"关闭\">\r\n          <span aria-hidden=\"true\">&times;</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <textarea class=\"form-control\" name=\"buyThreadListContent\" rows=\"14\" aria-label=\"购买人名单\">${list}</textarea>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n`).appendTo('body');\r\n        $dialog.on('shown.bs.modal', function () {\r\n            $dialog.find('[name=\"buyThreadListContent\"]').select().focus();\r\n        }).on('hidden.bs.modal', function () {\r\n            $dialog.remove();\r\n        }).modal('show');\r\n    });\r\n};\r\n\r\n/**\r\n * 处理楼层内的图片\r\n */\r\nexport const handleFloorImage = function () {\r\n    $(document).on('click', '.img', function () {\r\n        let $this = $(this);\r\n        if ($this.parent().is('a') || this.naturalWidth <= $this.closest('.read-content').width()) return;\r\n        location.href = $this.attr('src');\r\n    });\r\n};\r\n\r\n/**\r\n * 跳转到指定楼层\r\n */\r\nexport const gotoFloor = function () {\r\n    if (Info.floor && Info.floor > 0) {\r\n        let hashName = $(`article[data-floor=\"${Info.floor}\"]`).prev('a').attr('name');\r\n        if (hashName) location.hash = '#' + hashName;\r\n    }\r\n};\r\n\r\n/**\r\n * 处理快速跳转到指定楼层按钮\r\n */\r\nexport const handleFastGotoFloorBtn = function () {\r\n    $('.fast-goto-floor').click(function (e) {\r\n        e.preventDefault();\r\n        let action = $(this).data('url');\r\n        if (!action) return;\r\n        let floor = parseInt(prompt('你要跳转到哪一层楼？'));\r\n        if (!floor || floor <= 0) return;\r\n        location.href = Util.makeUrl(action, `page=${Math.floor(floor / Config.perPageFloorNum) + 1}&floor=${floor}`);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理推帖子按钮\r\n */\r\nexport const handleTuiThreadBtn = function () {\r\n    $('.tui-btn').click(function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if ($this.data('wait')) return;\r\n        $this.data('wait', true);\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: '/diy_read_tui.php',\r\n            data: `tid=${Info.tid}&safeid=${Info.safeId}`,\r\n            success: function (msg) {\r\n                let matches = /<span.+?\\+\\d+!<\\/span>\\s*(\\d+)/i.exec(msg);\r\n                if (matches) {\r\n                    let $num = $this.find('span:first');\r\n                    $num.text('+1');\r\n                    setTimeout(() => {\r\n                        $num.text(matches[1]);\r\n                    }, 1000);\r\n                }\r\n                else if (/已推过/.test(msg)) {\r\n                    alert('已推过');\r\n                }\r\n                else {\r\n                    alert('操作失败');\r\n                }\r\n            },\r\n            error: function () {\r\n                alert('操作失败');\r\n            },\r\n            complete: function () {\r\n                $this.removeData('wait');\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 处理复制代码按钮\r\n */\r\nexport const handleCopyCodeBtn = function () {\r\n    $(document).on('click', '.copy-code', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        if (Util.copyText($this.next('pre'), $this)) return;\r\n\r\n        let code = $this.data('code');\r\n        if (code) {\r\n            $this.text('复制代码').removeData('code');\r\n            $this.next('textarea').remove();\r\n            $this.after(`<pre class=\"pre-scrollable\">${code}</pre>`);\r\n        }\r\n        else {\r\n            let $pre = $this.next('pre');\r\n            let html = $pre.html();\r\n            $this.text('还原代码').data('code', html);\r\n            html = Util.decodeHtmlSpecialChar(html);\r\n            let height = $pre.height();\r\n            if (height < 50) height = 50;\r\n            if (height > 340) height = 340;\r\n            $pre.remove();\r\n            $(`<textarea class=\"form-control code-textarea\" style=\"height: ${height}px\" wrap=\"off\">${html}</textarea>`)\r\n                .insertAfter($this).select().focus();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 获取当前页面选中的多重引用数据\r\n * @returns {{}[]} 多重引用数据列表\r\n */\r\nconst getCheckedMultiQuoteData = function () {\r\n    let quoteList = [];\r\n    $('.multi-quote-check:checked').each(function () {\r\n        let $article = $(this).closest('article');\r\n        quoteList.push({floor: $article.data('floor'), pid: $article.data('pid'), userName: $article.data('username')});\r\n    });\r\n    return quoteList;\r\n};\r\n\r\n/**\r\n * 绑定多重引用复选框点击事件\r\n */\r\nexport const bindMultiQuoteCheckClick = function () {\r\n    $(document).on('click', '.multi-quote-check', function () {\r\n        let data = localStorage[Const.multiQuoteStorageName];\r\n        if (data) {\r\n            try {\r\n                data = JSON.parse(data);\r\n                if (!data || $.type(data) !== 'object' || $.isEmptyObject(data)) data = null;\r\n                else if (!('tid' in data) || data.tid !== Info.tid || $.type(data.quoteList) !== 'object') data = null;\r\n            }\r\n            catch (ex) {\r\n                data = null;\r\n            }\r\n        }\r\n        else {\r\n            data = null;\r\n        }\r\n        let quoteList = getCheckedMultiQuoteData();\r\n        if (!data) {\r\n            localStorage.removeItem(Const.multiQuoteStorageName);\r\n            data = {tid: Info.tid, quoteList: {}};\r\n        }\r\n        if (quoteList.length > 0) data.quoteList[Info.currentPageNum] = quoteList;\r\n        else delete data.quoteList[Info.currentPageNum];\r\n        localStorage[Const.multiQuoteStorageName] = JSON.stringify(data);\r\n    });\r\n};\r\n\r\n/**\r\n * 添加用户自定义备注\r\n */\r\nexport const addUserMemo = function () {\r\n    if ($.isEmptyObject(Config.userMemoList)) return;\r\n    $('.read-floor').each(function () {\r\n        let $this = $(this);\r\n        let userName = $this.data('username');\r\n        let key = Object.keys(Config.userMemoList).find(name => name === userName);\r\n        if (!key) return;\r\n        $this.find('.floor-user').after(\r\n            `<span class=\"tips font-size-sm\" data-toggle=\"tooltip\" title=\"备注：${Config.userMemoList[key]}\">[?]</span>`\r\n        );\r\n    });\r\n};\r\n\r\n/**\r\n * 替换附件标签\r\n */\r\nexport const replaceAttachLabel = function () {\r\n    $('.attach-label').each(function () {\r\n        let $this = $(this);\r\n        if ($this.closest('.blockquote').length > 0) return;\r\n        let aid = $this.data('aid');\r\n        let pid = $this.closest('.read-floor').data('pid');\r\n        $this.replaceWith(`<img class=\"img\" src=\"/job.php?action=download&pid=${pid}&tid=${Info.tid}&aid=${aid}\" alt=\"[附件图片]\">`);\r\n    });\r\n};\r\n\r\n/**\r\n * 处理一键移动主题按钮\r\n */\r\nexport const handleMoveThreadBtn = function () {\r\n    $('#moveThreadBtn').click(function (e) {\r\n        e.preventDefault();\r\n        if (!confirm('是否将该主题移到[无限制资源区]？')) return;\r\n        $.post('/diy_admin_read.php', `tid=${Info.tid}&safeid=${Info.safeId}`, function (msg) {\r\n            alert(msg);\r\n            location.reload();\r\n        });\r\n    });\r\n};","/* 自定义脚本模块 */\r\n'use strict';\r\nimport * as Util from './util';\r\nimport * as Dialog from './dialog';\r\nimport {read as readConfig, write as writeConfig} from './config';\r\n\r\n// 默认脚本名称\r\nconst defScriptName = '未命名脚本';\r\n// 脚本meta信息的正则表达式\r\nconst metaRegex = /\\/\\/\\s*==UserScript==((?:.|\\n)+?)\\/\\/\\s*==\\/UserScript==/i;\r\n\r\n/**\r\n * 运行命令\r\n * @param {string} cmd 命令\r\n * @param {boolean} isOutput 是否在控制台上显示结果\r\n * @returns {{isError: boolean, response: string}} isError：是否出错；response：执行结果\r\n */\r\nexport const runCmd = function (cmd, isOutput = false) {\r\n    let isError = false;\r\n    let response = '';\r\n    try {\r\n        response = eval(cmd);\r\n        if (isOutput) console.log(response);\r\n    }\r\n    catch (ex) {\r\n        isError = true;\r\n        response = ex;\r\n        console.log(ex);\r\n    }\r\n    return {isError, response: String(response)};\r\n};\r\n\r\n/**\r\n * 执行自定义脚本\r\n * @param {string} type 脚本执行时机，start：在脚本开始时执行；end：在脚本结束时执行\r\n */\r\nexport const runCustomScript = function (type = 'end') {\r\n    for (let {enabled, trigger, content} of Config.customScriptList) {\r\n        if (enabled && trigger === type && content) {\r\n            runCmd(content);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * 获取脚本meta信息\r\n * @param {string} content 脚本内容\r\n * @returns {{}} 脚本meta信息\r\n */\r\nexport const getScriptMeta = function (content) {\r\n    let meta = {\r\n        name: defScriptName,\r\n        version: '',\r\n        trigger: 'end',\r\n        homepage: '',\r\n        author: '',\r\n    };\r\n    let matches = metaRegex.exec(content);\r\n    if (!matches) return meta;\r\n    let metaContent = matches[1];\r\n    matches = /@name[ \\t]+(.*)/i.exec(metaContent);\r\n    if (matches) meta.name = matches[1];\r\n    matches = /@version[ \\t]+(.*)/i.exec(metaContent);\r\n    if (matches) meta.version = matches[1];\r\n    matches = /@trigger[ \\t]+(.*)/i.exec(metaContent);\r\n    if (matches) meta.trigger = matches[1].toLowerCase() === 'start' ? 'start' : 'end';\r\n    matches = /@homepage[ \\t]+(.*)/i.exec(metaContent);\r\n    if (matches) meta.homepage = matches[1];\r\n    matches = /@author[ \\t]+(.*)/i.exec(metaContent);\r\n    if (matches) meta.author = matches[1];\r\n    return meta;\r\n};\r\n\r\n/**\r\n * 显示自定义脚本对话框\r\n * @param {?number} showIndex 要显示的脚本的序号（-1表示最后一个）\r\n */\r\nexport const showDialog = function (showIndex = null) {\r\n    const dialogName = 'customScriptDialog';\r\n    if ($('#' + dialogName).length > 0) return;\r\n    readConfig();\r\n\r\n    let bodyContent = `\r\n<div class=\"d-flex mb-3\">\r\n  <div class=\"btn-group btn-group-sm\">\r\n    <button class=\"btn btn-success\" name=\"add\" type=\"button\">添加脚本</button>\r\n    <button class=\"btn btn-secondary\" name=\"insertSample\" type=\"button\">插入范例</button>\r\n  </div>\r\n  \r\n  <div class=\"btn-group btn-group-sm ml-auto\">\r\n    <a class=\"btn btn-link\" href=\"${window.Info.rootPath}read/682170/sf/6d7\" target=\"_blank\">脚本收集贴</a>\r\n  </div>\r\n</div>\r\n<div id=\"customScriptList\"></div>\r\n`;\r\n    let footerContent = `\r\n<button class=\"btn btn-warning mr-auto\" name=\"openImOrExCustomScriptDialog\" type=\"button\">导入/导出</button>\r\n<button class=\"btn btn-primary\" type=\"submit\">保存</button>\r\n<button class=\"btn btn-secondary\" data-dismiss=\"dialog\" type=\"button\">取消</button>\r\n<button class=\"btn btn-danger\" name=\"clear\" type=\"button\">清空</button>`;\r\n    let $dialog = Dialog.create(dialogName, '自定义脚本', bodyContent, footerContent);\r\n    let $customScriptList = $dialog.find('#customScriptList');\r\n\r\n    $dialog.submit(function (e) {\r\n        e.preventDefault();\r\n        Config.customScriptList = [];\r\n        $customScriptList.find('textarea[name=\"customScriptContent\"]').each(function () {\r\n            let $this = $(this);\r\n            let content = $this.val();\r\n            if (!$.trim(content)) return;\r\n            let enabled = $this.closest('.custom-script-container').find('[name=\"enabled\"]').prop('checked');\r\n            Config.customScriptList.push($.extend(getScriptMeta(content), {enabled, content}));\r\n        });\r\n        writeConfig();\r\n        Dialog.close(dialogName);\r\n        alert('自定义脚本修改成功\\n（需刷新页面后才可生效）');\r\n    }).end().find('[name=\"clear\"]').click(function () {\r\n        if (confirm('是否清空所有脚本？')) {\r\n            $customScriptList.html('');\r\n            Dialog.resize(dialogName);\r\n        }\r\n    });\r\n\r\n    /**\r\n     * 添加自定义脚本\r\n     * @param {boolean} enabled 是否启用脚本\r\n     * @param {string} name 脚本名称\r\n     * @param {string} version 版本号\r\n     * @param {string} homepage 首页\r\n     * @param {string} trigger 脚本执行时机\r\n     * @param {string} content 脚本内容\r\n     */\r\n    const addCustomScript = function ({\r\n                                          enabled = true,\r\n                                          name = defScriptName,\r\n                                          version = '',\r\n                                          homepage = '',\r\n                                          trigger = 'end',\r\n                                          content = '',\r\n                                      } = {}) {\r\n        let count = $customScriptList.find('.custom-script-container').length;\r\n        $customScriptList.append(`\r\n<div class=\"card custom-script-container\">\r\n  <div class=\"card-header d-flex p-1\" id=\"customScriptHeader${count}\">\r\n    <div class=\"form-check form-check-inline mx-1\">\r\n      <input class=\"form-check-input position-static\" name=\"enabled\" type=\"checkbox\" ${enabled ? 'checked' : ''} title=\"是否启用\" aria-label=\"是否启用\">\r\n    </div>\r\n\r\n    <button class=\"btn btn-link btn-sm mx-1 px-0 text-truncate custom-script-name\" data-toggle=\"collapse\" data-target=\"#customScriptContent${count}\" type=\"button\"\r\n            title=\"${name}\" aria-expanded=\"true\" aria-controls=\"customScriptContent${count}\">${name}</button>\r\n\r\n    <div class=\"ml-auto col-auto px-0\">\r\n      <a class=\"badge badge-primary align-middle custom-script-homepage\" ${!homepage ? 'hidden' : ''}\r\n         href=\"${homepage.startsWith('http') ? '' : Info.rootPath}${homepage}\" target=\"_blank\">主页</a>\r\n      <span class=\"badge badge-warning align-middle custom-script-version\" ${!version ? 'hidden' : ''}>${version}</span>\r\n      <span class=\"badge badge-${trigger === 'start' ? 'danger' : 'info'} align-middle custom-script-trigger\" title=\"脚本执行时机\">${trigger === 'start' ? '开' : '结'}</span>\r\n      <button class=\"btn btn-link btn-sm text-danger\" name=\"delete\" type=\"button\">删</button>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"collapse custom-script-content\" id=\"customScriptContent${count}\" aria-labelledby=\"customScriptHeader${count}\" data-parent=\"#customScriptList\">\r\n    <div class=\"card-body p-0\">\r\n      <textarea class=\"form-control border-0 font-size-sm font-monospace\" name=\"customScriptContent\" rows=\"12\" style=\"white-space: pre;\" wrap=\"off\">${content}</textarea>\r\n    </div>\r\n  </div>\r\n</div>\r\n`);\r\n    };\r\n\r\n    $dialog.find('[name=\"add\"]').click(function () {\r\n        $customScriptList.find('.custom-script-content.show').collapse();\r\n        addCustomScript();\r\n        $customScriptList.find('.custom-script-content:last').collapse();\r\n        //Dialog.resize(dialogName);\r\n    }).end().find('[name=\"insertSample\"]').click(function () {\r\n        let $content = $customScriptList.find('.custom-script-content.show textarea[name=\"customScriptContent\"]');\r\n        $content.val(`\r\n// ==UserScript==\r\n// @name        ${defScriptName}\r\n// @version     1.0\r\n// @author      ${Info.userName}\r\n// @trigger     end\r\n// @homepage    read/682170/spid/14034074/sf/6d7\r\n// @description 这是一个未命名脚本\r\n// ==/UserScript==\r\n`.trim() + '\\n' + $content.val()).focus();\r\n    }).end().find('[name=\"openImOrExCustomScriptDialog\"]').click(function () {\r\n        Public.showCommonImportOrExportConfigDialog('自定义脚本', 'customScriptList');\r\n    });\r\n\r\n    $customScriptList.on('click', '[name=\"delete\"]', function () {\r\n        if (!confirm('是否删除此脚本？')) return;\r\n        $(this).closest('.custom-script-container').remove();\r\n    }).on('change', 'textarea[name=\"customScriptContent\"]', function () {\r\n        let $this = $(this);\r\n        let {name, version, homepage, trigger} = getScriptMeta($this.val());\r\n        let $container = $this.closest('.custom-script-container');\r\n        $container.find('.custom-script-name').text(name ? name : defScriptName);\r\n        $container.find('.custom-script-homepage').attr('href', homepage ? homepage : '').prop('hidden', !homepage);\r\n        $container.find('.custom-script-version').text(version).prop('hidden', !version);\r\n        $container.find('.custom-script-trigger').text(trigger === 'start' ? '开' : '结')\r\n            .removeClass(`badge-${trigger === 'start' ? 'info' : 'danger'}`)\r\n            .addClass(`badge-${trigger === 'start' ? 'danger' : 'info'}`);\r\n    });\r\n\r\n    for (let data of Config.customScriptList) {\r\n        addCustomScript(data);\r\n    }\r\n\r\n    Dialog.show(dialogName);\r\n    if (typeof showIndex === 'number') {\r\n        $customScriptList.find('#customScriptContent' + showIndex).collapse();\r\n    }\r\n};\r\n\r\n/**\r\n * 处理安装自定义脚本按钮\r\n */\r\nexport const handleInstallScriptLink = function () {\r\n    $('main').on('click', 'a[href$=\"#install-mobile-script\"]', function (e) {\r\n        e.preventDefault();\r\n        let $this = $(this);\r\n        let $area = $this.nextAll('.code-area').eq(0).find('pre');\r\n        if (!$area.length) return;\r\n        let content = Util.htmlDecode($area.html().replace(/<legend>.+?<\\/legend>/i, '')).trim();\r\n        if (!metaRegex.test(content)) return;\r\n\r\n        readConfig();\r\n        let meta = getScriptMeta(content);\r\n        let index = Config.customScriptList.findIndex(script => script.name === meta.name && script.author === meta.author);\r\n        let isUpdate = index > -1;\r\n        if (!confirm(`是否${isUpdate ? '更新' : '安装'}此脚本？`)) return;\r\n        Config.customScriptEnabled = true;\r\n        let script = $.extend(meta, {enabled: true, content});\r\n        if (isUpdate) {\r\n            Config.customScriptList[index] = script;\r\n        }\r\n        else {\r\n            Config.customScriptList.push(script);\r\n        }\r\n        writeConfig();\r\n        Dialog.close('customScriptDialog');\r\n        showDialog(index);\r\n    }).on('click', 'a[href$=\"#install-script\"]', function (e) {\r\n        e.preventDefault();\r\n        alert('无法安装适用于电脑版论坛的自定义脚本');\r\n    });\r\n};","/* 其它模块 */\r\n'use strict';\r\n\r\n/**\r\n * 设置Cookie\r\n * @param {string} name Cookie名称\r\n * @param {*} value Cookie值\r\n * @param {?Date} date Cookie有效期，留空则表示有效期为浏览器进程\r\n * @param {string} prefix Cookie名称前缀\r\n */\r\nexport const setCookie = function (name, value, date = null, prefix = Info.uid + '_' + Const.storagePrefix) {\r\n    document.cookie = `${prefix}${name}=${encodeURI(value)}${!date ? '' : ';expires=' + date.toUTCString()};path=/;`;\r\n};\r\n\r\n/**\r\n * 获取Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} prefix Cookie名称前缀\r\n * @returns {?string} Cookie值\r\n */\r\nexport const getCookie = function (name, prefix = Info.uid + '_' + Const.storagePrefix) {\r\n    let regex = new RegExp(`(^| )${prefix}${name}=([^;]*)(;|$)`);\r\n    let matches = document.cookie.match(regex);\r\n    if (!matches) return null;\r\n    else return decodeURI(matches[2]);\r\n};\r\n\r\n/**\r\n * 删除Cookie\r\n * @param {string} name Cookie名称\r\n * @param {string} prefix Cookie名称前缀\r\n */\r\nexport const deleteCookie = function (name, prefix = Info.uid + '_' + Const.storagePrefix) {\r\n    document.cookie = `${prefix}${name}=;expires=${getDate('-1d').toUTCString()};path=/;`;\r\n};\r\n\r\n/**\r\n * 获取在当前时间的基础上的指定（相对）时间量的Date对象\r\n * @param {string} value 指定（相对）时间量，+或-：之后或之前（相对于当前时间）；无符号：绝对值；Y：完整年份；y：年；M：月；d：天；h：小时；m：分；s：秒；ms：毫秒\r\n * @returns {?Date} 指定（相对）时间量的Date对象\r\n * @example\r\n * Tools.getDate('+2y') 获取2年后的Date对象\r\n * Tools.getDate('+3M') 获取3个月后的Date对象\r\n * Tools.getDate('-4d') 获取4天前的Date对象\r\n * Tools.getDate('5h') 获取今天5点的Date对象（其它时间量与当前时间一致）\r\n * Tools.getDate('2015Y') 获取年份为2015年的Date对象\r\n */\r\nexport const getDate = function (value) {\r\n    let date = new Date();\r\n    let matches = /^(-|\\+)?(\\d+)([a-zA-Z]{1,2})$/.exec(value);\r\n    if (!matches) return null;\r\n    let flag = typeof matches[1] === 'undefined' ? 0 : (matches[1] === '+' ? 1 : -1);\r\n    let increment = flag === -1 ? -parseInt(matches[2]) : parseInt(matches[2]);\r\n    let unit = matches[3];\r\n    switch (unit) {\r\n        case 'Y':\r\n            date.setFullYear(increment);\r\n            break;\r\n        case 'y':\r\n            date.setFullYear(flag === 0 ? increment : date.getFullYear() + increment);\r\n            break;\r\n        case 'M':\r\n            date.setMonth(flag === 0 ? increment : date.getMonth() + increment);\r\n            break;\r\n        case 'd':\r\n            date.setDate(flag === 0 ? increment : date.getDate() + increment);\r\n            break;\r\n        case 'h':\r\n            date.setHours(flag === 0 ? increment : date.getHours() + increment);\r\n            break;\r\n        case 'm':\r\n            date.setMinutes(flag === 0 ? increment : date.getMinutes() + increment);\r\n            break;\r\n        case 's':\r\n            date.setSeconds(flag === 0 ? increment : date.getSeconds() + increment);\r\n            break;\r\n        case 'ms':\r\n            date.setMilliseconds(flag === 0 ? increment : date.getMilliseconds() + increment);\r\n            break;\r\n        default:\r\n            return null;\r\n    }\r\n    return date;\r\n};\r\n\r\n/**\r\n * 获取指定字符串的字节长度（1个GBK字符按2个字节来算）\r\n * @param {string} str 指定字符串\r\n * @returns {number} 字符串的长度\r\n */\r\nexport const getStrByteLen = function (str) {\r\n    let len = 0;\r\n    let cLen = 2;\r\n    for (let i = 0; i < str.length; i++) {\r\n        len += str.charCodeAt(i) < 0 || str.charCodeAt(i) > 255 ? cLen : 1;\r\n    }\r\n    return len;\r\n};\r\n\r\n/**\r\n * 获取当前域名的URL\r\n * @returns {string} 当前域名的URL\r\n */\r\nexport const getHostNameUrl = function () {\r\n    return location.protocol + '//' + location.host;\r\n};\r\n\r\n/**\r\n * 添加BBCode\r\n * @param textArea 文本框\r\n * @param {string} code BBCode\r\n * @param {string} selText 选择文本\r\n */\r\nexport const addCode = function (textArea, code, selText = '') {\r\n    let startPos = selText === '' ? code.indexOf(']') + 1 : code.indexOf(selText);\r\n    if (typeof textArea.selectionStart !== 'undefined') {\r\n        let prePos = textArea.selectionStart;\r\n        textArea.value = textArea.value.substring(0, prePos) + code + textArea.value.substring(textArea.selectionEnd);\r\n        textArea.selectionStart = prePos + startPos;\r\n        textArea.selectionEnd = prePos + startPos + selText.length;\r\n    }\r\n    else {\r\n        textArea.value += code;\r\n    }\r\n};\r\n\r\n/**\r\n * 获取选择文本\r\n * @param textArea 文本框\r\n * @returns {string} 选择文本\r\n */\r\nexport const getSelText = function (textArea) {\r\n    return textArea.value.substring(textArea.selectionStart, textArea.selectionEnd);\r\n};\r\n\r\n/**\r\n * 从URL查询字符串提取参数对象\r\n * @param {string} str URL查询字符串\r\n * @returns {Map} 参数集合\r\n */\r\nexport const extractQueryStr = function (str) {\r\n    let params = new Map();\r\n    for (let param of str.split('&')) {\r\n        if (!param) continue;\r\n        let [key, value] = param.split('=');\r\n        params.set(key, typeof value !== 'undefined' ? value : '');\r\n    }\r\n    return params;\r\n};\r\n\r\n/**\r\n * 从参数对象中创建URL查询字符串\r\n * @param {Map} map 参数集合\r\n * @returns {string} URL查询字符串\r\n */\r\nexport const buildQueryStr = function (map) {\r\n    let queryStr = '';\r\n    for (let [key, value] of map) {\r\n        if (Info.urlType === 2) {\r\n            queryStr += (queryStr ? '&' : '') + key + '=' + value;\r\n        }\r\n        else {\r\n            queryStr += (queryStr ? '/' : '') + key + '/' + value;\r\n        }\r\n    }\r\n    return queryStr;\r\n};\r\n\r\n/**\r\n * 生成指定的URL\r\n * @param {string} action 控制器（小写）\r\n * @param {string} param 查询参数\r\n * @param {boolean} includeOtherParam 是否包括当前页面的其它查询参数\r\n * @param {[]} excludeParams 要排除当前页面的查询参数列表\r\n * @returns {string} URL 最终的URL\r\n */\r\nexport const makeUrl = function (action, param = '', includeOtherParam = false, excludeParams = []) {\r\n    let url = '';\r\n    let paramList = extractQueryStr(param);\r\n    if (includeOtherParam) {\r\n        paramList = new Map([...extractQueryStr(Info.urlParam).entries(), ...paramList.entries()]);\r\n        for (let i in excludeParams) {\r\n            paramList.delete(excludeParams[i]);\r\n        }\r\n    }\r\n    if (!action.startsWith('/')) {\r\n        if (location.pathname.startsWith(Info.baseFile)) url = Info.baseFile + '/';\r\n        else url = Info.rootPath;\r\n    }\r\n    url += action;\r\n    if (paramList.size > 0) {\r\n        let queryStr = buildQueryStr(paramList);\r\n        if (queryStr) {\r\n            url += (Info.urlType === 2 ? '?' : '/') + queryStr;\r\n        }\r\n    }\r\n    return url;\r\n};\r\n\r\n/**\r\n * 获取URL查询字符串中的指定参数\r\n * @param {string} name 参数名称\r\n * @returns {?string} 参数值\r\n */\r\nexport const getQueryParam = function (name) {\r\n    return extractQueryStr(Info.urlParam).get(name);\r\n};\r\n\r\n/**\r\n * 解码HTML特殊字符\r\n * @param {string} str 待解码的字符串\r\n * @returns {string} 解码后的字符串\r\n */\r\nexport const decodeHtmlSpecialChar = function (str) {\r\n    if (!str.length) return '';\r\n    return str.replace(/<br\\s*\\/?>/gi, '\\n')\r\n        .replace(/&quot;/gi, '\\\"')\r\n        .replace(/&#39;/gi, '\\'')\r\n        .replace(/&nbsp;/gi, ' ')\r\n        .replace(/&gt;/gi, '>')\r\n        .replace(/&lt;/gi, '<')\r\n        .replace(/&amp;/gi, '&');\r\n};\r\n\r\n/**\r\n * 去除HTML标签\r\n * @param html HTML代码\r\n * @returns {string} 去除HTML标签的文本\r\n */\r\nexport const removeHtmlTag = html => html ? html.replace(/<br\\s*\\/?>/g, '\\n').replace(/<[^>]+>/g, '') : '';\r\n\r\n/**\r\n * 全选\r\n * @param {jQuery} $nodes 想要全选的节点的jQuery对象\r\n */\r\nexport const selectAll = function ($nodes) {\r\n    $nodes.prop('checked', true);\r\n};\r\n\r\n/**\r\n * 反选\r\n * @param {jQuery} $nodes 想要反选的节点的jQuery对象\r\n */\r\nexport const selectInverse = function ($nodes) {\r\n    $nodes.each(function () {\r\n        let $this = $(this);\r\n        $this.prop('checked', !$this.prop('checked'));\r\n    });\r\n};\r\n\r\n/**\r\n * 显示字段验证消息\r\n * @param {jQuery} $node 验证字段的jQuery对象\r\n * @param {string} type 验证类型\r\n * @param {string} msg 验证消息\r\n */\r\nexport const showValidationMsg = function ($node, type, msg = '') {\r\n    if (type === 'error') type = 'danger';\r\n    $node.removeClass('form-control-success form-control-warning form-control-danger');\r\n    let $parent = $node.parent();\r\n    $parent.removeClass('has-success has-warning has-danger');\r\n    if ($.inArray(type, ['success', 'warning', 'danger'] > -1)) {\r\n        $node.addClass('form-control-' + type).parent().addClass('has-' + type);\r\n    }\r\n    let $feedback = $parent.find('.form-control-feedback');\r\n    if (type === 'wait') {\r\n        $feedback.html(`<span class=\"text-muted\"><i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i> ${msg}</span>`);\r\n    }\r\n    else {\r\n        $feedback.text(msg);\r\n    }\r\n};\r\n\r\n/**\r\n * 获取对象A在对象B中的相对补集\r\n * @param {Object} a 对象A\r\n * @param {Object} b 对象B\r\n * @returns {Object} 相对补集\r\n */\r\nexport const getDifferenceSetOfObject = function (a, b) {\r\n    let c = {};\r\n    if ($.type(a) !== 'object' || $.type(b) !== 'object') return c;\r\n    $.each(b, (key, data) => {\r\n        if (key in a) {\r\n            if (!deepEqual(a[key], data)) c[key] = data;\r\n        }\r\n    });\r\n    return c;\r\n};\r\n\r\n/**\r\n * 深度比较两个对象是否相等\r\n * @param {*} a\r\n * @param {*} b\r\n * @returns {boolean} 是否相等\r\n */\r\nexport const deepEqual = function (a, b) {\r\n    if (a === b) return true;\r\n    if ($.type(a) !== $.type(b)) return false;\r\n    if (typeof a === 'number' && typeof b === 'number' && isNaN(a) && isNaN(b)) return true;\r\n    if ($.isArray(a) && $.isArray(b) || $.type(a) === 'object' && $.type(b) === 'object') {\r\n        if (a.length !== b.length) return false;\r\n        for (var i in $.extend($.isArray(a) ? [] : {}, a, b)) {\r\n            if (typeof a[i] === 'undefined' || typeof b[i] === 'undefined') return false;\r\n            if (!deepEqual(a[i], b[i])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * 复制文本\r\n * @param {jQuery} $target 要复制文本的目标元素\r\n * @param {?jQuery} $source 触发事件的源元素\r\n * @returns {boolean} 是否复制成功\r\n */\r\nexport const copyText = function ($target, $source = null) {\r\n    if (!('execCommand' in document) || !$target.length) return false;\r\n    let copyText = $target.data('copy-text');\r\n    if (copyText) {\r\n        $target = $(`<span class=\"text-hide\">${copyText}</span>`).insertAfter($target);\r\n    }\r\n    let s = window.getSelection();\r\n    s.selectAllChildren($target.get(0));\r\n    let result = document.execCommand('copy');\r\n    s.removeAllRanges();\r\n    if (copyText) $target.remove();\r\n    if (result && $source) {\r\n        let msg = $source.data('copy-msg');\r\n        $source.attr('title', msg ? msg : '已复制').on('hidden.bs.tooltip', function () {\r\n            $(this).tooltip('dispose');\r\n        }).tooltip('show');\r\n    }\r\n    return result;\r\n};\r\n\r\n/**\r\n * 获取指定用户名在关注或屏蔽列表中的索引号\r\n * @param {string} name 指定用户名\r\n * @param {Array} list 指定列表\r\n * @returns {number} 指定用户在列表中的索引号，-1表示不在该列表中\r\n */\r\nexport const inFollowOrBlockUserList = (name, list) => list.findIndex(data => data.name && data.name === name);\r\n\r\n/**\r\n * 检测浏览器是否为Opera\r\n * @returns {boolean} 是否为Opera\r\n */\r\nexport const isOpera = () => typeof window.opera !== 'undefined';\r\n\r\n/**\r\n * 检测浏览器是否为Edge\r\n * @returns {boolean} 是否为Edge\r\n */\r\nexport const isEdge = () => navigator.appVersion && navigator.appVersion.includes('Edge');\r\n\r\n/**\r\n * HTML转义编码\r\n * @param {string} str 待编码的字符串\r\n * @returns {string} 编码后的字符串\r\n */\r\nexport const htmlEncode = function (str) {\r\n    if (!str.length) return '';\r\n    return str.replace(/&/g, '&amp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        .replace(/ /g, '&nbsp;')\r\n        .replace(/\\'/g, '&#39;')\r\n        .replace(/\\\"/g, '&quot;')\r\n        .replace(/\\n/g, '<br>');\r\n};\r\n\r\n/**\r\n * HTML转义解码\r\n * @param {string} str 待解码的字符串\r\n * @returns {string} 解码后的字符串\r\n */\r\nexport const htmlDecode = function (str) {\r\n    if (!str.length) return '';\r\n    return str.replace(/<br\\s*\\/?>/gi, '\\n')\r\n        .replace(/&quot;/gi, '\\\"')\r\n        .replace(/&#39;/gi, '\\'')\r\n        .replace(/&nbsp;/gi, ' ')\r\n        .replace(/&gt;/gi, '>')\r\n        .replace(/&lt;/gi, '<')\r\n        .replace(/&amp;/gi, '&');\r\n};\r\n\r\n/**\r\n * 获取URL中的指定参数\r\n * @param {string} name 参数名称\r\n * @returns {?string} URL中的指定参数\r\n */\r\nexport const getUrlParam = function (name) {\r\n    let regex = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');\r\n    let matches = Info.urlParam.match(regex);\r\n    if (matches) return decodeURI(matches[2]);\r\n    else return null;\r\n};\r\n\r\n/**\r\n * 去除不配对的BBCode\r\n * @param {string} content 引用内容\r\n * @returns {string} 去除了不配对BBCode的内容\r\n */\r\nexport const removeUnpairedBBCodeContent = function (content) {\r\n    let startCodeList = [\r\n        /\\[color=.+?\\]/g, /\\[backcolor=.+?\\]/g, /\\[size=.+?\\]/g, /\\[font=.+?\\]/g, /\\[align=.+?\\]/g, /\\[b\\]/g, /\\[i\\]/g, /\\[u\\]/g,\r\n        /\\[strike\\]/g, /\\[sup\\]/g, /\\[sub\\]/g\r\n    ];\r\n    let endCodeList = [\r\n        /\\[\\/color\\]/g, /\\[\\/backcolor\\]/g, /\\[\\/size\\]/g, /\\[\\/font\\]/g, /\\[\\/align\\]/g, /\\[\\/b\\]/g, /\\[\\/i\\]/g, /\\[\\/u\\]/g,\r\n        /\\[\\/strike\\]/g, /\\[\\/sup\\]/g, /\\[\\/sub\\]/g\r\n    ];\r\n    for (let i = 0; i < startCodeList.length; i++) {\r\n        let startMatches = content.match(startCodeList[i]);\r\n        let endMatches = content.match(endCodeList[i]);\r\n        let startMatchesNum = startMatches ? startMatches.length : 0;\r\n        let endMatchesNum = endMatches ? endMatches.length : 0;\r\n        if (startMatchesNum !== endMatchesNum) {\r\n            content = content.replace(startCodeList[i], '').replace(endCodeList[i], '');\r\n        }\r\n    }\r\n    return content;\r\n};"]}